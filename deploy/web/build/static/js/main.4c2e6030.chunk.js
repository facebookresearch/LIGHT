(this["webpackJsonplight-datamodel"]=this["webpackJsonplight-datamodel"]||[]).push([[0],{169:function(e,t,a){e.exports=a(258)},174:function(e,t,a){},258:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(13),l=a.n(i),c=(a(174),a(23)),o=a(24),s=a(18),d=a(6),m=a(48),u=a(53),p=a(12);var h=function(e){var t=e.setPopover,a=r.a.useRef(),n=r.a.useState(void 0),i=Object(d.a)(n,2),l=i[0],c=i[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{onChange:function(e){c(void 0);var a=new FileReader;a.onload=function(e){c(JSON.parse(e.target.result))};var n=e.target.files[0];a.readAsText(n),t(!1)},type:"file",ref:a,style:{display:"none"}}),l&&r.a.createElement(s.a,{to:{pathname:"/world_builder",state:{data:l}}}),r.a.createElement(m.m,{icon:"upload",onClick:function(){return a.current.click()},text:"Upload File",shouldDismissPopover:!1}))};var b=function(e){var t=e.children,a=r.a.useState(!1),n=Object(d.a)(a,2),i=n[0],l=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.n,null,r.a.createElement(m.n.Group,{align:u.a.LEFT},r.a.createElement(m.n.Heading,null,"LIGHT Data Model"),r.a.createElement(m.n.Divider,null),r.a.createElement(o.b,{"data-testid":"link-explore",className:"btn-link",to:"/explore"},r.a.createElement(m.b,{className:"bp3-minimal",icon:"path-search",text:"Explore"})),r.a.createElement(o.b,{"data-testid":"link-create",className:"btn-link",to:"/create"},r.a.createElement(m.b,{className:"bp3-minimal",icon:"cube",text:"Create"})),r.a.createElement(o.b,{"data-testid":"link-review",className:"btn-link",to:"/review"},r.a.createElement(m.b,{className:"bp3-minimal",icon:"form",text:"Review Edits"})),r.a.createElement(m.q,{position:p.a.BOTTOM_LEFT,minimal:!0,isOpen:i},r.a.createElement(m.b,{onClick:function(){return l(!i)},className:"bp3-minimal",icon:"map-create",text:"Build World"}),r.a.createElement(m.l,null,r.a.createElement(m.m,{icon:"new-object",text:r.a.createElement(o.b,{onClick:function(){return l(!1)},style:{color:"inherit"},"data-testid":"link-world-builder",className:"btn-link",to:"/world_builder"},"Create New"),shouldDismissPopover:!0,tagName:"div"}),r.a.createElement(h,{setPopover:l}))))),t)},f=a(8),E=a(34),y=a(43),g=a.n(y),v=a(7),x=a(132),j=a.n(x),O={host:"http://localhost",hostname:"localhost",port:"35494"};function C(e){return function(e){var t=r.a.useRef();return r.a.useEffect((function(){t.current=e})),t.current}(e)!==e}function w(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(a.body,a.params,arguments.length>3?arguments[3]:void 0),i=r.a.useState({loading:!0,result:void 0}),l=Object(d.a)(i,2),c=l[0],o=l[1],s=C(t);r.a.useEffect((function(){if(c.loading&&n)o({loading:!1,result:n});else{if(!s){var a=!0;return c.loading&&fetch(e.host+":"+e.port+"/builder"+t).then((function(e){return e.json()})).then((function(e){a&&o({loading:!1,result:e})})).catch((function(e){return console.log("Error fetching data")})),function(){return a=!1}}o({loading:!0,result:void 0})}}),[e.host,e.port,t,s,n,c]);var m=function(){o({loading:!0,result:void 0})};return{loading:c.loading,result:c.result,reload:m}}function S(e,t){var a=[];for(var n in t){var r=encodeURIComponent(n),i=encodeURIComponent("object"===typeof t[n]?JSON.stringify(t[n]):t[n]);a.push(r+"="+i)}return fetch("".concat(O.host,":").concat(O.port,"/builder/").concat(e),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.join("&")})}function _(e){var t=e.items,a=e.descriptionField,n=e.additionalFields,i=void 0===n?[]:n,l=e.selectedEntity,c=r.a.useState({expanded:-1,animating:0,nextState:-1}),o=Object(d.a)(c,2),s=o[0],m=o[1];return void 0===t||0===t.length?r.a.createElement("span",null,"No items found."):r.a.createElement("table",{"data-testid":"table-explore",style:{width:"100%"},className:"bp3-html-table bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Description"),i.map((function(e){return r.a.createElement("th",{key:e},e.name)})),r.a.createElement("th",null,"ID"))),r.a.createElement("tbody",null,t.map((function(e,t){return r.a.createElement(r.a.Fragment,{key:e.id},r.a.createElement("tr",{onClick:function(){return function(e){-1===s.expanded?m({expanded:e,animating:2,nextState:-1}):s.expanded===e?m({expanded:e,animating:3,nextState:-1}):m(Object(f.a)(Object(f.a)({},s),{},{animating:3,nextState:e}))}(t)},"data-testid":"tr-explore",style:{background:t%2===0?"rgba(191, 204, 214, 0.15)":void 0}},r.a.createElement("td",null,r.a.createElement("strong",null,e.name)),r.a.createElement("td",null,e[a]),i.map((function(t){return r.a.createElement("td",{key:t.name},e[t.key])})),r.a.createElement("td",null,e.id)),r.a.createElement("tr",{style:{background:t%2===0?"rgba(191, 204, 214, 0.15)":void 0}},r.a.createElement("td",{colSpan:5,style:{display:s.expanded===t?void 0:"none",padding:0,cursor:"unset"}},r.a.createElement(g.a,{duration:500,height:s.expanded!==t||2!==s.animating&&0!==s.animating?0:"auto",easing:"ease",onAnimationEnd:function(){return m({nextState:-1,expanded:2===s.animating?t:s.nextState,animating:3===s.animating&&-1!==s.nextState?2:0})},animateOpacity:!0},s.expanded===t&&r.a.createElement(k,{item:e,selectedEntity:l})))))}))))}function k(e){var t=e.item,a=e.selectedEntity;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{"data-testid":"dropdown",style:{padding:"20px 40px 0 40px"}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},Object.keys(t).map((function(e,a){return r.a.createElement("p",{key:a},r.a.createElement("strong",null,Object(v.startCase)(e)),": ",t[e])})))),r.a.createElement("div",{style:{display:"flex",padding:"0 20px 20px 20px",justifyContent:"flex-end"}},r.a.createElement(o.b,{style:{margin:"0 5px"},className:"bp3-button bp3-small",to:{pathname:"/create",state:{type:a,entity:t}}},"Create From"),r.a.createElement(o.b,{style:{margin:"0 5px"},className:"bp3-button bp3-small",to:{pathname:"/edit/".concat(t.id),state:{type:a,entity:t}}},"Edit")))}var N=function(){var e=r.a.useState("object"),t=Object(d.a)(e,2),a=t[0],n=t[1],i=r.a.useState(0),l=Object(d.a)(i,2),c=l[0],o=l[1],s=r.a.useState(""),u=Object(d.a)(s,2),p=u[0],h=u[1],b=w(O,"/entities/"+a+"?search="+p+"&page="+c),f=b.loading,y=b.result;return r.a.createElement("div",null,r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading"},"Explore"),r.a.createElement("div",{className:"bp3-text-large"},"Search across the LIGHT database for existing objects, characters, or rooms."),r.a.createElement("div",{className:"bp3-input-group bp3-large",style:{margin:"20px 0px 10px"}},r.a.createElement("span",{className:"bp3-icon bp3-icon-search"}),r.a.createElement("input",{className:"bp3-input",type:"search",placeholder:"Search...",dir:"auto",value:p,onChange:function(e){h(e.target.value),o(0)}})),r.a.createElement("div",{style:{display:"flex",marginBottom:30}},r.a.createElement("span",{style:{margin:"0px 20px 0px 40px"}},"Searching category:"),r.a.createElement(m.t,{inline:!0,large:!0,onChange:function(e){n(e.target.value),o(0)},selectedValue:a},r.a.createElement(m.s,{"data-testid":"radio-object",label:"Objects",value:"object"}),r.a.createElement(m.s,{"data-testid":"radio-character",label:"Characters",value:"character"}),r.a.createElement(m.s,{"data-testid":"radio-room",label:"Rooms",value:"room"}))),f?r.a.createElement(m.u,{intent:E.a.PRIMARY}):r.a.createElement(r.a.Fragment,null,r.a.createElement(_,{items:y.data,descriptionField:"room"===a?"description":"physical_description",additionalFields:"room"===a?[{name:"Backstory",key:"backstory"}]:[],selectedEntity:a}),r.a.createElement("div",{style:{margin:"20px"}},r.a.createElement(j.a,{previousLabel:"previous",nextLabel:"next",breakLabel:"...",forcePage:c,pageCount:y.total_pages,marginPagesDisplayed:2,pageRangeDisplayed:5,onPageChange:function(e){return o(e.selected)},containerClassName:"pagination",subContainerClassName:"pages pagination",activeClassName:"active"}))))},I=a(15),R=a.n(I),T=a(22),F=a(30),A=a(261),D=a(44),P=a.n(D);a(110);function L(e){var t=e.filteredItems,a=e.renderItem,n=t.slice(0,100);return r.a.createElement(m.l,null,t.length>0?r.a.createElement(r.a.Fragment,null,n.map((function(e,t){return a(e,t)})),t.length>100&&r.a.createElement(m.m,{style:{textAlign:"center"},disabled:!0,text:"..."})):r.a.createElement(m.m,{disabled:!0,text:"No results."}))}function B(e,t){var a=t.handleClick,n=t.modifiers,i=t.index;return n.matchesPredicate?r.a.createElement(m.m,{active:n.active,key:i,onClick:a,text:e.name,shouldDismissPopover:!1}):null}var G=function(e){var t=e.id,a=e.name,n=e.errors,i=e.touched,l=e.setFieldTouched,c=e.formValue,o=e.handleChange,s=e.type,m=e.onItemSelect,u=e.entities,p=r.a.useState([]),h=Object(d.a)(p,2),b=h[0],f=h[1],y=r.a.useState(""),g=Object(d.a)(y,2),v=g[0],x=g[1],j=r.a.useState(c),C=Object(d.a)(j,2),S=C[0],_=C[1],k=w(O,"/entities/".concat(s,"?search=").concat(v)),N=k.loading,I=k.result;return r.a.useEffect((function(){if(!N){if(u){var e=Object.values(u[s]),t=e.concat(I.slice(0,100+e.length+1)).filter((function(e,t,a){return a.findIndex((function(t){return P()(t,e)}))===t}));return f(t)}return f(I)}}),[I,N,u,s]),r.a.useEffect((function(){if(u)return _(c);if(isNaN(c))return _(null);for(var e in b)if(b[e].id===c)return _(b[e])}),[c,b,u]),r.a.createElement("div",{onBlur:function(e){return l(a)}},r.a.createElement(A.a,{id:t,name:a,items:b,itemRenderer:B,itemListRenderer:L,inputValueRenderer:function(e){return u&&u[s][e]?u[s][e].name:e.name},inputProps:{intent:n&&i?E.a.DANGER:null,"data-testid":"base-suggest"},onItemSelect:function(e){if(m){var t=m(e,s);_(t),o(a,t,e)}else _(e),o(a,e.id,e);x("")},popoverProps:{usePortal:!1},itemPredicate:function(e,t,a,n){var r=t.name.toLowerCase(),i=e.toLowerCase();if(n)return r===i;var l="";for(var c in t)l+=t[c]+". ";return l.toLowerCase().indexOf(i)>=0},selectedItem:S,query:v,onQueryChange:function(e){return x(e)},resetOnQuery:!0}))};var V={name:"",name_prefix:"",physical_description:"",base_id:0,is_container:0,is_drink:0,is_food:0,is_gettable:0,is_plural:0,is_surface:0,is_weapon:0,is_wearable:0},q=function(e){var t=e.initialInputs,a=e.handleSubmit,n=e.type;return r.a.createElement(F.a,{initialValues:t,validate:function(e){var t={};return e.name||(t.name="Required"),e.name_prefix||(t.name_prefix="Required"),e.physical_description||(t.physical_description="Required"),e.base_id||(t.base_id="Required"),t},onSubmit:a},(function(e){var t=e.values,a=e.setFieldValue,i=e.touched,l=e.setFieldTouched,c=e.errors,o=e.dirty,s=e.isValid,d=e.handleChange,p=e.handleBlur,h=e.handleSubmit,b=e.handleReset,f=function(e){var n=e.target.name;a(n,t[n]?0:1)};return r.a.createElement("form",{"data-testid":"form"},r.a.createElement(m.i,{label:"Name",labelInfo:"(required)",labelFor:"name-input"},r.a.createElement(m.k,{id:"name-input",name:"name",intent:c.name&&i.name?E.a.DANGER:null,onBlur:p,onChange:d,value:t.name}),c.name&&i.name&&r.a.createElement("div",{className:"form-error"},c.name)),r.a.createElement(m.i,{label:"Name Prefix",labelInfo:"(required)",labelFor:"name-prefix-input"},r.a.createElement(m.k,{id:"name-prefix-input",name:"name_prefix",intent:c.name_prefix&&i.name_prefix?E.a.DANGER:null,onBlur:p,onChange:d,value:t.name_prefix}),c.name_prefix&&i.name_prefix&&r.a.createElement("div",{className:"form-error"},c.name_prefix)),r.a.createElement(m.i,{label:"Physical Description",labelInfo:"(required)",labelFor:"physical-description-input"},r.a.createElement(m.x,{id:"physical-description-input",name:"physical_description",growVertically:!0,fill:!0,intent:c.physical_description&&i.physical_description?E.a.DANGER:null,onBlur:p,onChange:d,value:t.physical_description}),c.physical_description&&i.physical_description&&r.a.createElement("div",{className:"form-error"},c.physical_description)),r.a.createElement(m.i,{label:"Base Object",labelInfo:"(required)",labelFor:"base-id-input"},r.a.createElement(G,{id:"base-id-input",name:"base_id",type:"base_".concat(n),errors:c.base_id,touched:i.base_id,setFieldTouched:l,formValue:t.base_id,handleChange:a}),c.base_id&&i.base_id&&r.a.createElement("div",{className:"form-error"},c.base_id)),r.a.createElement(m.i,{label:"Properties",labelInfo:"(required)",large:!0},r.a.createElement("div",{style:{marginLeft:"15px",width:"150px"}},r.a.createElement(m.v,{label:"Container",name:"is_container",onChange:f,checked:!!t.is_container,alignIndicator:u.a.RIGHT}),r.a.createElement(m.v,{label:"Drink",name:"is_drink",onChange:f,checked:!!t.is_drink,alignIndicator:u.a.RIGHT}),r.a.createElement(m.v,{label:"Food",name:"is_food",onChange:f,checked:!!t.is_food,alignIndicator:u.a.RIGHT}),r.a.createElement(m.v,{label:"Gettable",name:"is_gettable",onChange:f,checked:!!t.is_gettable,alignIndicator:u.a.RIGHT}),r.a.createElement(m.v,{label:"Plural",name:"is_plural",onChange:f,checked:!!t.is_plural,alignIndicator:u.a.RIGHT}),r.a.createElement(m.v,{label:"Surface",name:"is_surface",onChange:f,checked:!!t.is_surface,alignIndicator:u.a.RIGHT}),r.a.createElement(m.v,{label:"Weapon",name:"is_weapon",onChange:f,checked:!!t.is_weapon,alignIndicator:u.a.RIGHT}),r.a.createElement(m.v,{label:"Wearable",name:"is_wearable",onChange:f,checked:!!t.is_wearable,alignIndicator:u.a.RIGHT}))),r.a.createElement(m.b,{type:"reset",onClick:b,disabled:!o,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.b,{intent:E.a.PRIMARY,type:"submit",onClick:h,disabled:!o||!s,style:{marginLeft:"15px"}},"Save Changes"))}))};var M={name:"",name_prefix:"",persona:"",physical_description:"",char_type:"",base_id:0,is_plural:0},H=function(e){var t=e.initialInputs,a=e.handleSubmit,n=e.type;return r.a.createElement(F.a,{initialValues:t,validate:function(e){var t={};return e.name||(t.name="Required"),e.name_prefix||(t.name_prefix="Required"),e.persona||(t.persona="Required"),e.physical_description||(t.physical_description="Required"),e.char_type||(t.char_type="Required"),e.base_id||(t.base_id="Required"),t},onSubmit:a},(function(e){var t=e.values,a=e.setFieldValue,i=e.touched,l=e.setFieldTouched,c=e.errors,o=e.dirty,s=e.isValid,d=e.handleChange,p=e.handleBlur,h=e.handleSubmit,b=e.handleReset;return r.a.createElement("form",{"data-testid":"form"},r.a.createElement(m.i,{label:"Name",labelInfo:"(required)",labelFor:"name-input"},r.a.createElement(m.k,{id:"name-input",name:"name",intent:c.name&&i.name?E.a.DANGER:null,onBlur:p,onChange:d,value:t.name}),c.name&&i.name&&r.a.createElement("div",{className:"form-error"},c.name)),r.a.createElement(m.i,{label:"Name Prefix",labelInfo:"(required)",labelFor:"name-prefix-input"},r.a.createElement(m.k,{id:"name-prefix-input",name:"name_prefix",intent:c.name_prefix&&i.name_prefix?E.a.DANGER:null,onBlur:p,onChange:d,value:t.name_prefix}),c.name_prefix&&i.name_prefix&&r.a.createElement("div",{className:"form-error"},c.name_prefix)),r.a.createElement(m.i,{label:"Persona",labelInfo:"(required)",labelFor:"persona-input"},r.a.createElement(m.x,{id:"persona-input",name:"persona",growVertically:!0,fill:!0,intent:c.persona&&i.persona?E.a.DANGER:null,onBlur:p,onChange:d,value:t.persona}),c.persona&&i.persona&&r.a.createElement("div",{className:"form-error"},c.persona)),r.a.createElement(m.i,{label:"Physical Description",labelInfo:"(required)",labelFor:"physical-description-input"},r.a.createElement(m.x,{id:"physical-description-input",name:"physical_description",growVertically:!0,fill:!0,intent:c.physical_description&&i.physical_description?E.a.DANGER:null,onBlur:p,onChange:d,value:t.physical_description}),c.physical_description&&i.physical_description&&r.a.createElement("div",{className:"form-error"},c.physical_description)),r.a.createElement(m.i,{label:"Character Type",labelInfo:"(required)",labelFor:"char-type-input"},r.a.createElement(m.k,{id:"char-type-input",name:"char_type",intent:c.char_type&&i.char_type?E.a.DANGER:null,onBlur:p,onChange:d,value:t.char_type}),c.char_type&&i.char_type&&r.a.createElement("div",{className:"form-error"},c.char_type)),r.a.createElement(m.i,{label:"Base Character",labelInfo:"(required)",labelFor:"base-id-input"},r.a.createElement(G,{id:"base-id-input",name:"base_id",type:"base_".concat(n),errors:c.base_id,touched:i.base_id,setFieldTouched:l,formValue:t.base_id,handleChange:a}),c.base_id&&i.base_id&&r.a.createElement("div",{className:"form-error"},c.base_id)),r.a.createElement(m.i,{label:"Properties",labelInfo:"(required)",large:!0},r.a.createElement("div",{style:{marginLeft:"15px",width:"150px"}},r.a.createElement(m.v,{label:"Plural",name:"is_plural",onChange:function(e){var n=e.target.name;a(n,t[n]?0:1)},checked:!!t.is_plural,alignIndicator:u.a.RIGHT}))),r.a.createElement(m.b,{type:"reset",onClick:b,disabled:!o,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.b,{intent:E.a.PRIMARY,type:"submit",onClick:h,disabled:!o||!s,style:{marginLeft:"15px"}},"Save Changes"))}))};var W={name:"",description:"",backstory:"",base_id:0},U=function(e){var t=e.initialInputs,a=e.handleSubmit,n=e.type;return r.a.createElement(F.a,{initialValues:t,validate:function(e){var t={};return e.name||(t.name="Required"),e.description||(t.description="Required"),e.backstory||(t.backstory="Required"),e.base_id||(t.base_id="Required"),t},onSubmit:a},(function(e){var t=e.values,a=e.setFieldValue,i=e.touched,l=e.setFieldTouched,c=e.errors,o=e.dirty,s=e.isValid,d=e.handleChange,u=e.handleBlur,p=e.handleSubmit,h=e.handleReset;return r.a.createElement("form",{"data-testid":"form"},r.a.createElement(m.i,{label:"Name",labelInfo:"(required)",labelFor:"name-input"},r.a.createElement(m.k,{id:"name-input",name:"name",intent:c.name&&i.name?E.a.DANGER:null,onBlur:u,onChange:d,value:t.name}),c.name&&i.name&&r.a.createElement("div",{className:"form-error"},c.name)),r.a.createElement(m.i,{label:"Description",labelInfo:"(required)",labelFor:"description-input"},r.a.createElement(m.x,{id:"description-input",name:"description",growVertically:!0,fill:!0,intent:c.description&&i.description?E.a.DANGER:null,onBlur:u,onChange:d,value:t.description}),c.description&&i.description&&r.a.createElement("div",{className:"form-error"},c.description)),r.a.createElement(m.i,{label:"Backstory",labelInfo:"(required)",labelFor:"backstory-input"},r.a.createElement(m.x,{id:"backstory-input",name:"backstory",growVertically:!0,fill:!0,intent:c.backstory&&i.backstory?E.a.DANGER:null,onBlur:u,onChange:d,value:t.backstory}),c.backstory&&i.backstory&&r.a.createElement("div",{className:"form-error"},c.backstory)),r.a.createElement(m.i,{label:"Base Room",labelInfo:"(required)",labelFor:"base-id-input"},r.a.createElement(G,{id:"base-id-input",name:"base_id",type:"base_".concat(n),errors:c.base_id,touched:i.base_id,setFieldTouched:l,formValue:t.base_id,handleChange:a}),c.base_id&&i.base_id&&r.a.createElement("div",{className:"form-error"},c.base_id)),r.a.createElement(m.b,{type:"reset",onClick:h,disabled:!o,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.b,{intent:E.a.PRIMARY,type:"submit",onClick:p,disabled:!o||!s,style:{marginLeft:"15px"}},"Save Changes"))}))},Y=m.y.create({position:p.a.TOP});function z(e){var t=e.type,a=e.initialInputs,n=Object(s.f)(),i=function(){var e=Object(T.a)(R.a.mark((function e(a){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("entities/".concat(t),a).then((function(){n.push("/")}));case 2:Y.show({intent:E.a.SUCCESS,message:"Successfully created entity"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();switch(t){case"object":return r.a.createElement(q,{type:t,initialInputs:a||V,handleSubmit:i});case"character":return r.a.createElement(H,{type:t,initialInputs:a||M,handleSubmit:i});case"room":return r.a.createElement(U,{type:t,initialInputs:a||W,handleSubmit:i});default:return"This entity cannot be created at the moment"}}var K=function(e){var t=e.location,a=r.a.useState(t.state?t.state.type:"object"),n=Object(d.a)(a,2),i=n[0],l=n[1];return r.a.createElement("div",null,r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading",style:{marginBottom:15}},"Create new entity"),r.a.createElement("div",{className:"bp3-text-large"},r.a.createElement("div",{style:{display:"flex",marginBottom:30}},r.a.createElement("span",{style:{marginRight:"20px"}},"Entity type:"),r.a.createElement(m.t,{inline:!0,large:!0,onChange:function(e){t.state=void 0,l(e.target.value)},selectedValue:i},r.a.createElement(m.s,{"data-testid":"radio-object",label:"Object",value:"object"}),r.a.createElement(m.s,{"data-testid":"radio-character",label:"Character",value:"character"}),r.a.createElement(m.s,{"data-testid":"radio-room",label:"Room",value:"room"}))),r.a.createElement(z,{type:i,initialInputs:t.state?t.state.entity:void 0})))},J=a(40),Q=a(1),X=a(136),Z=a.n(X);function $(e){var t=e.edits,a=e.status,n=e.reload,i=r.a.useState({expanded:-1,animating:0,nextState:-1}),l=Object(d.a)(i,2),c=l[0],o=l[1],s=r.a.useState({rows:[],all:0}),u=Object(d.a)(s,2),p=u[0],h=u[1],b=r.a.useState(void 0),y=Object(d.a)(b,2),x=y[0],j=y[1],O=r.a.useState(!1),C=Object(d.a)(O,2),w=C[0],_=C[1],k=r.a.useState([]),N=Object(d.a)(k,2),I=N[0],F=N[1];function A(e){"under review"===a&&(-1===c.expanded?o({expanded:e,animating:1,nextState:-1}):c.expanded===e?o({expanded:e,animating:3,nextState:-1}):o(Object(f.a)(Object(f.a)({},c),{},{animating:3,nextState:e})))}function D(){return(D=Object(T.a)(R.a.mark((function e(){var a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=I.map((function(e){return S("edits/".concat(t[e].edit_id,"/").concat(x))})),e.next=3,Promise.all(a).then((function(){n()}));case 3:Y.show({intent:E.a.SUCCESS,message:"Review submitted"});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t&&t.length>0&&0===p.rows.length&&h(Object(f.a)(Object(f.a)({},p),{},{rows:Object(v.fill)(Array(t.length),!1)}));var P=function(e){for(var t=[],a=0;a<p.rows.length;a++)p.rows[a]&&t.push(a);F(t),j(e),_(!0)};return void 0===t||0===t.length?r.a.createElement("span",null,"No edits found."):r.a.createElement(r.a.Fragment,null,r.a.createElement(m.f,{icon:"info-sign",onClose:function(){return _(!1)},title:"Confirm edits to be ".concat("reject"===x?"rejected":"accepted"),isOpen:w,usePortal:!1},r.a.createElement("div",{className:Q.a.DIALOG_BODY},r.a.createElement("table",{className:"bp3-html-table bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Edit ID"),r.a.createElement("th",null,"Entity ID"),r.a.createElement("th",null,"Edited Field"))),r.a.createElement("tbody",null,I.map((function(e,a){return r.a.createElement("tr",{key:a},r.a.createElement("td",null,t[e].edit_id),r.a.createElement("td",null,t[e].id),r.a.createElement("td",null,t[e].field))}))))),r.a.createElement("div",{className:Q.a.DIALOG_FOOTER},r.a.createElement("div",{className:Q.a.DIALOG_FOOTER_ACTIONS},r.a.createElement(m.b,{onClick:function(){return _(!1)}},"Close"),r.a.createElement(m.b,{intent:E.a.PRIMARY,onClick:function(){return D.apply(this,arguments)}},"Confirm Edits")))),r.a.createElement("table",{"data-testid":"table-review",style:{width:"100%"},className:"bp3-html-table bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,"under review"===a&&r.a.createElement("th",{style:{textAlign:"center"}},r.a.createElement(m.c,{checked:p.all,indeterminate:-1===p.all,onClick:function(){var e=p.all?0:1,a=Object(v.fill)(Array(t.length),!!e);h({rows:a,all:e})}})),r.a.createElement("th",null,"Edit ID"),r.a.createElement("th",null,"Entity ID"),r.a.createElement("th",null,"Edited Field"),r.a.createElement("th",null,"Edit"))),r.a.createElement("tbody",null,t.map((function(e,t){return r.a.createElement(r.a.Fragment,{key:e.edit_id},r.a.createElement("tr",{"data-testid":"tr-review",style:{background:t%2===0?"rgba(191, 204, 214, 0.15)":void 0}},"under review"===a&&r.a.createElement("td",{style:{textAlign:"center"}},r.a.createElement(m.c,{checked:p.rows[t],onClick:function(){return function(e){var t=Object(J.a)(p.rows);t[e]=!p.rows[e];var a=p.all;a=t.every((function(e){return!0===e}))?1:t.every((function(e){return!1===e}))?0:-1,h({rows:t,all:a})}(t)}})),r.a.createElement("td",{onClick:function(){return A(t)}},e.edit_id),r.a.createElement("td",{onClick:function(){return A(t)}},r.a.createElement("strong",null,e.id)),r.a.createElement("td",{onClick:function(){return A(t)}},e.field),r.a.createElement("td",{onClick:function(){return A(t)}},function(e,t){var a;if(isNaN(e)||isNaN(t)){var n=new Z.a;a=n.diff_main(e,t),n.diff_cleanupSemantic(a)}else a=[[-1,+(e=0+e)],[1,+(t=0+t)]];return r.a.createElement(r.a.Fragment,null,a.map((function(e,t){switch(e[0]){case-1:return r.a.createElement("strike",{key:t,style:{color:"#FF7373"}}," ",e[1]," ");case 0:return r.a.createElement("strong",{key:t},e[1]);case 1:return r.a.createElement("strong",{key:t,style:{color:"#0F9960"}},e[1]);default:return r.a.createElement(r.a.Fragment,null)}})))}(e.unedited_value,e.edited_value))),r.a.createElement("tr",{style:{background:t%2===0?"rgba(191, 204, 214, 0.15)":void 0}},r.a.createElement("td",{colSpan:5,style:{display:c.expanded===t?void 0:"none",padding:0,cursor:"unset"}},r.a.createElement(g.a,{duration:500,height:c.expanded!==t||2!==c.animating&&0!==c.animating?0:"auto",easing:"ease",onAnimationEnd:function(){return o({nextState:-1,expanded:2===c.animating?t:c.nextState,animating:3===c.animating&&-1!==c.nextState?1:0})},animateOpacity:!0},c.expanded===t&&r.a.createElement(ee,{edit:e,state:c,setState:o,reload:n})))))})))),"under review"===a&&r.a.createElement("div",{style:{display:"flex",margin:"10px",justifyContent:"flex-end"}},r.a.createElement(m.b,{intent:E.a.DANGER,type:"submit",onClick:function(){return P("reject")},style:{marginLeft:"15px"},disabled:!p.all},"Reject"),r.a.createElement(m.b,{intent:E.a.SUCCESS,type:"submit",onClick:function(){return P("accept/accepted")},style:{marginLeft:"15px"},disabled:!p.all},"Accept")))}function ee(e){var t=e.edit,a=e.state,n=e.setState,i=e.reload,l=w(O,"/entities/".concat(t.id)),c=l.loading,o=l.result;return r.a.useEffect((function(){o&&1===a.animating&&n(Object(f.a)(Object(f.a)({},a),{},{animating:2}))}),[c,n,a,o]),r.a.createElement(r.a.Fragment,null,c?r.a.createElement(r.a.Fragment,null):r.a.createElement(te,{edit:t,entity:o.entity,reload:i}))}function te(e){var t=e.edit,a=e.entity,n=e.reload;return delete a.id,r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{"data-testid":"dropdown",style:{display:"flex",flexDirection:"row",padding:"20px 20px 0 20px",alignItems:"center"}},r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"50%",maxWidth:"30vw",margin:"auto"}},Object.keys(a).map((function(e,n){return r.a.createElement("p",{key:n,style:{color:e===t.field?"#DB3737":void 0}},r.a.createElement("strong",null,Object(v.startCase)(e)),": ",a[e])})))),r.a.createElement("div",{style:{height:"100%",fontSize:"20px",color:"#394B59"}},"\u2794"),r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"50%",maxWidth:"30vw",margin:"auto"}},Object.keys(a).map((function(e,n){return r.a.createElement("p",{key:n,style:{color:e===t.field?"#0F9960":void 0}},r.a.createElement("strong",null,Object(v.startCase)(e)),":"," ",e===t.field?t.edited_value:a[e])}))))),r.a.createElement("div",{style:{display:"flex",padding:"0 20px 20px 20px",justifyContent:"flex-end"}},r.a.createElement(m.b,{intent:E.a.DANGER,type:"submit",onClick:function(){return S("edits/".concat(t.edit_id,"/reject")).then((function(){return n()}))},style:{marginLeft:"15px"}},"Reject Edit"),r.a.createElement(m.b,{intent:E.a.SUCCESS,type:"submit",onClick:function(){return S("edits/".concat(t.edit_id,"/accept/accepted")).then((function(){return n()}))},style:{marginLeft:"15px"}},"Accept Edit")))}var ae=function(){var e=r.a.useState("under review"),t=Object(d.a)(e,2),a=t[0],n=t[1],i=w(O,"/edits?expand=true&status=".concat(a)),l=i.loading,c=i.result,o=i.reload;return r.a.createElement("div",null,r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading"},"Review"),r.a.createElement("div",{className:"bp3-text-large"},"Review pending, accepted, and rejected edits to the LIGHT database."),r.a.createElement("br",null),r.a.createElement("div",{style:{display:"flex",marginBottom:"30px"}},r.a.createElement("span",{style:{margin:"0px 20px 0px 40px"}},"Searching category:"),r.a.createElement(m.t,{inline:!0,large:!0,onChange:function(e){return n(e.target.value)},selectedValue:a},r.a.createElement(m.s,{"data-testid":"radio-under-review",label:"Under Review",value:"under review"}),r.a.createElement(m.s,{"data-testid":"radio-accepted",label:"Accepted",value:"accepted"}),r.a.createElement(m.s,{"data-testid":"radio-rejected",label:"Rejected",value:"rejected"}))),l?r.a.createElement(m.u,{intent:E.a.PRIMARY}):r.a.createElement($,{edits:c,status:a,reload:o}))},ne=a(4),re=a.n(ne),ie=a(123),le=a(57),ce=[ie.a.GRAY3,ie.a.VIOLET5,ie.a.RED5,ie.a.SEPIA5,ie.a.GOLD5,ie.a.FOREST5,ie.a.BLUE5],oe=["grass","field","plains","forest","land","gardens","meadow","woods","jungle","swamp","green"],se=["water","lake","river","ocean","sea","pond","lagoon","shore","blue"],de=["castle","fortress","church","cathedral","tower","building","cave","gray","grey"],me=["king","queen","palace","purple"],ue=["brick","fire","red"],pe=["path","road","bridge","brown"],he=["farm","cottage","sand","beach","yellow","gold"];function be(e,t){var a=e.toLowerCase();return oe.some((function(e){return a.indexOf(e)>-1}))?ie.a.FOREST5:se.some((function(e){return a.indexOf(e)>-1}))?ie.a.BLUE5:ue.some((function(e){return a.indexOf(e)>-1}))?ie.a.RED5:pe.some((function(e){return a.indexOf(e)>-1}))?ie.a.SEPIA5:he.some((function(e){return a.indexOf(e)>-1}))?ie.a.GOLD5:de.some((function(e){return a.indexOf(e)>-1}))?ie.a.GRAY3:me.some((function(e){return a.indexOf(e)>-1}))?ie.a.VIOLET5:t}function fe(e){return 0===e.indexOf("#")&&(e=e.slice(1)),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),.299*parseInt(e.slice(0,2),16)+.587*parseInt(e.slice(2,4),16)+.114*parseInt(e.slice(4,6),16)>150?"#182026":"#F5F8FA"}function Ee(e){var t=le.b.search(e);if(t[0])return t[0].native;for(var a=e.split(" "),n=0;n<a.length;n++){var r=a[n];if("s"===a[n].charAt(a[n].length-1)&&(r=a[n].substring(0,a[n].length-1)),(t=le.b.search(r))[0])return t[0].native}return"\u2753"}var ye=function(e,t){switch(t.type){case"SET_MAP":return t.map;case"SET_TILE":return e.map((function(e,a){return a===t.floor?Object(f.a)(Object(f.a)({},e),{},{tiles:Object(f.a)(Object(f.a)({},e.tiles),{},Object(c.a)({},"".concat(t.x," ").concat(t.y),t.newTile))}):e}));case"EDIT_FLOOR_NAME":return e.map((function(e,a){return a===t.floor?Object(f.a)(Object(f.a)({},e),{},{name:t.name}):e}));default:return e}},ge=function(e,t){switch(t.type){case"SET_ALL":return t.entities;case"ADD_ENTITY":var a;return Object.assign({},e,(a={},Object(c.a)(a,t.entityType,Object(f.a)(Object(f.a)({},e[t.entityType]),{},Object(c.a)({},e.nextID,t.data))),Object(c.a)(a,"nextID",e.nextID+1),a));case"EDIT_ENTITY":return Object(v.merge)(e,Object(c.a)({},t.entityType,Object(c.a)({},t.id,t.data)));default:return e}};function ve(e){var t=r.a.useState(e?e.data.dimensions:{height:3,width:3,floors:1}),a=Object(d.a)(t,2),n=a[0],i=a[1],l=e?e.data.map:[{name:"1F",tiles:{},walls:{}}],o=r.a.useReducer(ye,l),s=Object(d.a)(o,2),m=s[0],u=s[1],p=r.a.useReducer(ge,e?e.data.entities:{room:{},character:{},object:{},nextID:1}),h=Object(d.a)(p,2),b=h[0],y=h[1],g=r.a.useState(0),x=Object(d.a)(g,2),j=x[0],C=x[1];r.a.useEffect((function(){for(var e=[],t=0;t<n.floors;t++)e.push(m[t]?m[t]:{name:"".concat(t+1,"F"),tiles:{},walls:{}});u({type:"SET_MAP",map:e})}),[n]);var w=function(e,t){for(var a in b[t])if(P()(b[t][a],e))return a;return function(e,t){var a=b.nextID;return y({type:"ADD_ENTITY",data:e,entityType:t}),a}(e,t)},_=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j;u({type:"SET_TILE",x:e,y:t,newTile:a,floor:n})},k=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j;a[n]&&a[n].tiles["".concat(e," ").concat(t)]&&(delete a[n].tiles["".concat(e," ").concat(t)].stairDown,delete a[n].tiles["".concat(e," ").concat(t)].stairUp),a[n-1]&&a[n-1].tiles["".concat(e," ").concat(t)]&&delete a[n-1].tiles["".concat(e," ").concat(t)].stairUp,a[n+1]&&a[n+1].tiles["".concat(e," ").concat(t)]&&delete a[n+1].tiles["".concat(e," ").concat(t)].stairDown},N=function(e,t){Object(v.isEmpty)(e)||Object(v.isEmpty)(e.tiles)||Object.keys(e.tiles).forEach((function(a){Object(v.isEmpty)(e.tiles[a])||delete e.tiles[a][t]}))},I=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j;try{return m[a].tiles["".concat(e," ").concat(t)]}catch(n){return{}}},F=function(){for(var e=[],t=0;t<m.length;t++){var a={name:m[t].name,walls:m[t].walls},r={};for(var i in m[t].tiles){var l=i.split(" "),c=Object(d.a)(l,2),o=c[0],s=c[1];o<n.width&&s<n.height&&(r[i]=m[t].tiles[i])}a.tiles=r,e.push(a)}return e},A=function(){var e=Object(T.a)(R.a.mark((function e(t){var a,n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("world/delete/".concat(t));case 2:return a=e.sent,e.next=5,a.json();case 5:n=e.sent,console.log(n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(T.a)(R.a.mark((function e(t){var a,r,l,c,o,s,d,m;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Y.show({intent:E.a.PRIMARY,message:"Loading your world...",timeout:1e4}),e.next=3,fetch("".concat(O.host,":").concat(O.port,"/builder/world/").concat(t),{method:"GET",headers:{"Content-Type":"application/json"}});case 3:return a=e.sent,e.next=6,a.json();case 6:return r=e.sent,console.log(r),i(Object(f.a)(Object(f.a)({},n),{},{height:r.height,width:r.width,floors:r.num_floors})),l={},c={},o={},s={},d={},r.rooms.forEach((function(e){t=w(e,"room"),l[e.id]=t,c[e.id]="room"})),r.characters.forEach((function(e){e.emoji=Ee(e.name),t=w(e,"character"),l[e.id]=t,c[e.id]="character"})),r.objects.forEach((function(e){e.emoji=Ee(e.name),t=w(e,"object"),l[e.id]=t,c[e.id]="object"})),m=F(),console.log("Before"),console.log(m),r.tiles.forEach((function(e){var t=e.floor,a=e.x_coordinate,n=e.y_coordinate;o[e.room_node_id]=[],s[e.room_node_id]=[],d[e.room_node_id]={x:a,y:n,floor:t};var r={room:l[e.room_entity_id],characters:[],objects:[],color:e.color};_(a,n,r,t)})),r.edges.forEach((function(e){"contains"==e.edge_type&&("character"==c[e.dst_entity_id]?o[e.src_id].push(l[e.dst_entity_id]):"object"==c[e.dst_entity_id]?s[e.src_id].push(l[e.dst_entity_id]):console.log("This should not be happening..."))})),console.log(d),console.log(o),console.log(s),Object.keys(d).forEach((function(e){var t=d[e],a=Object(v.cloneDeep)(I(t.x,t.y,t.floor));a.characters=Object(v.cloneDeep)(o[e]),a.objects=Object(v.cloneDeep)(s[e]),_(t.x,t.y,a,t.floor)})),console.log("After"),Y.show({intent:E.a.SUCCESS,message:"Done loading!"}),e.abrupt("return",r);case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(T.a)(R.a.mark((function e(){var t,a,r,i,l,c,o,s;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={height:n.height,width:n.width,floors:n.floors,tile:{},room:{},character:{},object:{}},(a=F()).forEach((function(e){Object.values(e.tiles).forEach((function(e){for(var a in t.room[e.room]=b.room[e.room],e.characters)t.character[e.characters[a]]=b.character[e.characters[a]];for(var n in e.objects)t.object[e.objects[n]]=b.object[e.objects[n]]}))})),console.table(a),r=[],i=0;i<a.length;i++)for(o in l=a[i].tiles,c=function(e){t.tile[e+" "+i]=l[e];var n={room:-1,chars:[],objs:[],neighbors:[]};n.room=t.room[l[e].room].id,l[e].characters.forEach((function(e){n.chars.push(t.character[e].id)})),l[e].objects.forEach((function(e){n.objs.push(t.object[e].id)})),l[e].stairUp&&n.neighbors.push({dst_id:t.room[a[i+1].tiles[e].room].id,dir:"neighbors above"}),l[e].stairDown&&n.neighbors.push({dst_id:t.room[a[i-1].tiles[e].room].id,dir:"neighbors below"});var c=e.split(" ").map((function(e){return parseInt(e)})),o=Object(d.a)(c,2),s=o[0],m=o[1],u=["".concat(s-1," ").concat(m),"".concat(s+1," ").concat(m),"".concat(s," ").concat(m-1),"".concat(s," ").concat(m+1)],p=["neighbors to the west","neighbors to the east","neighbors to the north","neighbors to the south"],h=function(r){var c=p[r],o=u[r];Object.keys(a[i].walls).some((function(t){return t.includes(o)&&t.includes(e)}))||Object(v.isEmpty)(l[o])||n.neighbors.push({dst_id:t.room[l[o].room].id,dir:c})};for(var b in u)h(b);r.push(n)},l)c(o);return t.edges=r,console.table(t),e.next=10,S("world/",t);case 10:return s=e.sent,e.next=13,s.json();case 13:e.sent,Y.show({intent:E.a.SUCCESS,message:"World Saved! "});case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(T.a)(R.a.mark((function e(){var t,a,n,r,i,l;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={room:{},character:{},object:{}},(a=F()).forEach((function(e){Object.values(e.tiles).forEach((function(e){for(var a in t.room[e.room]=b.room[e.room],e.characters)t.character[e.characters[a]]=b.character[e.characters[a]];for(var n in e.objects)t.object[e.objects[n]]=b.object[e.objects[n]]}))})),n=[].concat(Object.values(t.room).map(function(){var e=Object(T.a)(R.a.mark((function e(t){var a,n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("entities/room",t);case 2:return a=e.sent,e.next=5,a.json();case 5:n=e.sent,t.id=n[0];case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object.values(t.character).map(function(){var e=Object(T.a)(R.a.mark((function e(t){var a,n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("entities/character",t);case 2:return a=e.sent,e.next=5,a.json();case 5:n=e.sent,t.id=n[0];case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object.values(t.object).map(function(){var e=Object(T.a)(R.a.mark((function e(t){var a,n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("entities/object",t);case 2:return a=e.sent,e.next=5,a.json();case 5:n=e.sent,t.id=n[0];case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.next=6,Promise.all(n);case 6:for(r=[],i=function(e){var n=a[e].tiles,i=function(i){var l={room:-1,chars:[],objs:[],neighbors:[]};l.room=t.room[n[i].room].id,n[i].characters.forEach((function(e){l.chars.push(t.character[e].id)})),n[i].objects.forEach((function(e){l.objs.push(t.object[e].id)})),n[i].stairUp&&l.neighbors.push(t.room[a[e+1].tiles[i].room].id),n[i].stairDown&&l.neighbors.push(t.room[a[e-1].tiles[i].room].id);var c=i.split(" ").map((function(e){return parseInt(e)})),o=Object(d.a)(c,2),s=o[0],m=o[1];["".concat(s-1," ").concat(m),"".concat(s+1," ").concat(m),"".concat(s," ").concat(m-1),"".concat(s," ").concat(m+1)].forEach((function(r){Object.keys(a[e].walls).some((function(e){return e.includes(r)&&e.includes(i)}))||Object(v.isEmpty)(n[r])||l.neighbors.push(t.room[n[r].room].id)})),r.push(S("edges",l))};for(var l in n)i(l)},l=0;l<a.length;l++)i(l);return e.next=11,Promise.all(r);case 11:Y.show({intent:E.a.SUCCESS,message:"Successfully created all edges"});case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{floorManager:{setCurrFloor:C,addFloor:function(){i(Object(f.a)(Object(f.a)({},n),{},{floors:n.floors+1}))},deleteFloor:function(e){var t=m.filter((function(t,a){return a!==e}));N(t[e-1],"stairUp"),N(t[e],"stairDown"),u({type:"SET_MAP",map:t}),j>=n.floors-1&&C(0),i(Object(f.a)(Object(f.a)({},n),{},{floors:n.floors-1}))},reorderFloors:function(e,t){var a=m[e],r=m.filter((function(t,a){return a!==e}));N(a,"stairUp"),N(a,"stairDown"),N(r[e-1],"stairUp"),N(r[e],"stairDown");for(var i=[],l=0;l<n.floors;l++)i.push(l<t?r[l]:l===t?a:r[l-1]);N(i[t-1],"stairUp"),N(i[t+1],"stairDown"),u({type:"SET_MAP",map:i}),j===e&&C(t)},editFloorName:function(e,t){u({type:"EDIT_FLOOR_NAME",name:e,floor:t})}},currFloor:j,map:m,setTile:_,clearTile:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j,n=Object(v.cloneDeep)(m);k(e,t,n),delete n[a].tiles["".concat(e," ").concat(t)],u({type:"SET_MAP",map:n})},swapTiles:function(e,t,a,n){u({type:"SET_MAP",map:m.map((function(r,i){var l;return i===j?(k(e,t),k(a,n),Object(f.a)(Object(f.a)({},r),{},{tiles:Object(f.a)(Object(f.a)({},r.tiles),{},(l={},Object(c.a)(l,"".concat(e," ").concat(t),r.tiles["".concat(a," ").concat(n)]),Object(c.a)(l,"".concat(a," ").concat(n),r.tiles["".concat(e," ").concat(t)]),l))})):r}))})},getTileAt:I,toggleWall:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j;if(m[t].walls[e]){var a=Object(v.cloneDeep)(m);delete a[t].walls[e],u({type:"SET_MAP",map:a})}else u({type:"SET_MAP",map:m.map((function(a,n){return n===t?Object(f.a)(Object(f.a)({},a),{},{walls:Object(f.a)(Object(f.a)({},a.walls),{},Object(c.a)({},e,!0))}):a}))})},dimensions:n,setDimensions:i,addRowTop:function(){u({type:"SET_MAP",map:m.map((function(e){var t=Object.keys(e.tiles),a={};t.forEach((function(t){var n=t.split(" "),r=Object(d.a)(n,2),i=r[0],l=r[1];a["".concat(i," ").concat(parseInt(l)+1)]=e.tiles[t]}));var n=Object.keys(e.walls),r={};return n.forEach((function(t){var a=t.split("|"),n=Object(d.a)(a,2),i=n[0],l=n[1],c=i.split(" "),o=Object(d.a)(c,2),s=o[0],m=o[1],u=l.split(" "),p=Object(d.a)(u,2),h=p[0],b=p[1];r["".concat(s," ").concat(parseInt(m)+1,"|").concat(h," ").concat(parseInt(b)+1)]=e.walls[t]})),Object(f.a)(Object(f.a)({},e),{},{tiles:a,walls:r})}))}),i(Object(f.a)(Object(f.a)({},n),{},{height:n.height+1}))},addRowBot:function(){i(Object(f.a)(Object(f.a)({},n),{},{height:n.height+1}))},addColFront:function(){u({type:"SET_MAP",map:m.map((function(e){var t=Object.keys(e.tiles),a={};t.forEach((function(t){var n=t.split(" "),r=Object(d.a)(n,2),i=r[0],l=r[1];a["".concat(parseInt(i)+1," ").concat(l)]=e.tiles[t]}));var n=Object.keys(e.walls),r={};return n.forEach((function(t){var a=t.split("|"),n=Object(d.a)(a,2),i=n[0],l=n[1],c=i.split(" "),o=Object(d.a)(c,2),s=o[0],m=o[1],u=l.split(" "),p=Object(d.a)(u,2),h=p[0],b=p[1];r["".concat(parseInt(s)+1," ").concat(m,"|").concat(parseInt(h)+1," ").concat(b)]=e.walls[t]})),Object(f.a)(Object(f.a)({},e),{},{tiles:a,walls:r})}))}),i(Object(f.a)(Object(f.a)({},n),{},{width:n.width+1}))},addColEnd:function(){i(Object(f.a)(Object(f.a)({},n),{},{width:n.width+1}))},entities:b,editEntity:function(e,t,a){y({type:"EDIT_ENTITY",id:e,data:t,entityType:a})},findOrAddEntity:w,postEdges:B,exportWorld:function(){var e=JSON.stringify({dimensions:n,map:m,entities:b},null,"\t"),t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","world-".concat(Date.now().toString(),".json")),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)},postWorld:L,getWorld:D,deleteWorld:A}}var xe=function(e){var t=w(O,"/worlds/"),a=t.loading,n=t.result,i=(t.reload,n);return e.isOpen&&void 0!=i?a?r.a.createElement(m.u,{intent:E.a.PRIMARY}):r.a.createElement(r.a.Fragment,null,r.a.createElement("table",{"data-testid":"world-review",style:{width:"100%"},className:"bp3-html-table bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"World ID"),r.a.createElement("th",null,"World Name"),r.a.createElement("th",null,"Load"),r.a.createElement("th",null,"Delete"))),r.a.createElement("tbody",null,i.map((function(t){return r.a.createElement(r.a.Fragment,{key:t.id},r.a.createElement("tr",{"data-testid":"tr-review",style:{background:void 0}},r.a.createElement("td",null,t.id),r.a.createElement("td",null,r.a.createElement("strong",null,t.name)),r.a.createElement("td",null,r.a.createElement(m.b,{intent:E.a.SUCCESS,type:"submit",onClick:function(){e.toggleOverlay(!e.isOpen),e.state.getWorld(t.id)}},"Load")),r.a.createElement("td",null,r.a.createElement(m.b,{intent:E.a.DANGER,type:"submit",onClick:function(){e.state.deleteWorld(t.id),e.toggleOverlay(!e.isOpen),e.toggleOverlay(e.isOpen)}},"Delete"))))}))))):r.a.createElement(r.a.Fragment,null)},je=a(139),Oe=a.n(je);var Ce=function(e){var t=e.colors,a=e.value,n=e.handleChange,i=e.advanced;return r.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},t.map((function(e,t){return r.a.createElement("div",{key:t,style:{display:"inline-block",maxWidth:"20px",width:"20px",maxHeight:"20px",height:"20px",borderRadius:"5px",background:e,borderColor:"#5C7080",borderStyle:a===e?"solid":"",borderWidth:"2px",boxShadow:a===e?"0px 0px 8px ".concat(a):"",margin:"2px",cursor:"pointer"},onClick:function(){return n("color",e)}})})),i&&r.a.createElement("input",{style:{maxHeight:"20px",maxWidth:"20px",height:"20px",width:"20px",borderRadius:"5px",padding:"0px 0px 0px 0px"},type:"color",value:a,onChange:function(e){return n("color",e.target.value)}}))},we=a(262);function Se(e){var t=e.filteredItems,a=e.renderItem,n=t.slice(0,100);return r.a.createElement(m.l,null,t.length>0?r.a.createElement(r.a.Fragment,null,n.map((function(e,t){return a(e,t)})),t.length>100&&r.a.createElement(m.m,{style:{textAlign:"center"},disabled:!0,text:"..."})):r.a.createElement(m.m,{disabled:!0,text:"No results."}))}var _e=function(e){var t=e.id,a=e.name,n=e.errors,i=e.touched,l=e.setFieldTouched,c=e.formValue,o=e.handleChange,s=e.type,u=e.tooltip,h=e.onItemSelect,b=e.entities,f=r.a.useState([]),y=Object(d.a)(f,2),g=y[0],v=y[1],x=r.a.useState(""),j=Object(d.a)(x,2),C=j[0],S=j[1],_=r.a.useState([]),k=Object(d.a)(_,2),N=k[0],I=k[1],R=w(O,"/entities/".concat(s,"?search=").concat(C)),T=R.loading,F=R.result;return r.a.useEffect((function(){if(!T){if(b){var e=Object.values(b[s]),t=e.concat(F.slice(0,100+e.length+1)).filter((function(e,t,a){return a.findIndex((function(t){return P()(t,e)}))===t}));return v(t)}return v(F)}}),[F,T,b,s]),r.a.useEffect((function(){I(c)}),[c,g]),r.a.createElement("div",{onBlur:function(e){return l(a)}},r.a.createElement(we.a,{id:t,name:a,items:g,itemRenderer:function(e,t){var a=t.handleClick,n=t.modifiers,i=t.index;return n.matchesPredicate?r.a.createElement(m.m,{active:n.active,key:i,onClick:a,text:u?r.a.createElement(m.z,{content:e[u],targetTagName:"div",popoverClassName:"popover-tooltip",position:p.a.TOP_RIGHT,usePortal:!0},e.name):e.name,shouldDismissPopover:!1}):null},itemListRenderer:Se,tagInputProps:{intent:n&&i?E.a.DANGER:null,"data-testid":"base-multi-select",onRemove:function(e,t){var n=N.filter((function(e,a){return a!==t})),r=c.filter((function(e,a){return a!==t}));I(n),o(a,r)}},onItemSelect:function(e){if(h){var t=h(e,s);I([].concat(Object(J.a)(N),[t])),o(a,[].concat(Object(J.a)(c),[t]),e)}else I([].concat(Object(J.a)(N),[e])),o(a,[].concat(Object(J.a)(c),[e.id]));S("")},popoverProps:{usePortal:!1},itemPredicate:function(e,t,a,n){var r=t.name.toLowerCase(),i=e.toLowerCase();if(n)return r===i;var l="";for(var c in t)l+=t[c]+". ";return l.toLowerCase().indexOf(i)>=0},selectedItems:N,query:C,onQueryChange:function(e){return S(e)},resetOnQuery:!0,tagRenderer:function(e){return b&&b[s][e]?b[s][e].name:e.name}}))},ke={room:void 0,characters:[],objects:[],color:ce[0]};var Ne=function(e){var t=e.initialInputs,a=e.onSubmit,n=e.onClear,i=e.entities,l=e.findOrAddEntity,c=e.setShowAdvanced,o=e.selected,s=e.setSelected;return r.a.createElement(F.a,{initialValues:Object(v.isEmpty)(t)?ke:t,validate:function(e){var t={};return isNaN(e.room)&&(t.room="Required"),t},onSubmit:a},(function(e){var t=e.values,a=e.setFieldValue,d=e.touched,u=e.setFieldTouched,p=e.errors,h=e.dirty,b=e.isValid,y=e.handleSubmit,g=e.handleReset;return r.a.createElement("form",null,r.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignContent:"stretch",justifyContent:"space-between"}},r.a.createElement("h5",{style:{fontSize:"18px"},className:Q.a.HEADING},r.a.createElement(m.j,{color:"#5c7080",iconSize:20,icon:"edit"})," Tile Editor"),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"},onClick:function(){s(Object(f.a)(Object(f.a)({},o),{},{data:Object(f.a)({},t)})),c(!0)}},r.a.createElement(m.b,{icon:"build"}))),r.a.createElement(m.g,null),r.a.createElement(m.i,{label:"Room",labelInfo:"(required)",labelFor:"room-input"},r.a.createElement(G,{id:"room-input",name:"room",type:"room",errors:p.room,touched:d.room,setFieldTouched:u,formValue:t.room,handleChange:function(e,n,r){a(e,n),a("color",be(r.name,t.color))},entities:i,onItemSelect:l}),p.room&&d.room&&r.a.createElement("div",{className:"form-error"},p.room)),r.a.createElement(Ce,{colors:ce,value:t.color,handleChange:a}),r.a.createElement(m.i,{label:"Characters in Room",labelFor:"characters-input"},r.a.createElement(_e,{id:"characters-input",name:"characters",type:"character",errors:p.characters,touched:d.characters,setFieldTouched:u,formValue:t.characters,handleChange:a,tooltip:"persona",entities:i,onItemSelect:function(e,t){return e.emoji=Ee(e.name),l(e,t)}}),p.characters&&d.characters&&r.a.createElement("div",{className:"form-error"},p.characters)),r.a.createElement(m.i,{label:"Objects in Room",labelFor:"objects-input"},r.a.createElement(_e,{id:"objects-input",name:"objects",type:"object",errors:p.objects,touched:d.objects,setFieldTouched:u,formValue:t.objects,handleChange:a,tooltip:"physical_description",entities:i,onItemSelect:function(e,t){return e.emoji=Ee(e.name),l(e,t)}}),p.objects&&d.objects&&r.a.createElement("div",{className:"form-error"},p.objects)),r.a.createElement(m.b,{type:"reset",onClick:n,disabled:!(!isNaN(t.room)||!Object(v.isEmpty)(t.characters)||!Object(v.isEmpty)(t.objects)),style:{marginRight:"15px"}},"Clear"),r.a.createElement(m.b,{type:"reset",onClick:g,disabled:!h,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.b,{intent:E.a.PRIMARY,type:"submit",onClick:y,disabled:!h||!b,style:{marginLeft:"15px"}},"Save Changes"))}))};var Ie=function(e){var t=e.x,a=e.y,n=e.tile,i=e.selected,l=e.setSelected,c=e.showAdvanced,o=e.setShowAdvanced,s=e.tileStyle,d=e.state,u=function(e,r){e.stopPropagation();var i=!n[r],l=Object(v.cloneDeep)(n);l[r]=i,d.setTile(t,a,l);var c=d.currFloor+("stairDown"===r?-1:1),o=Object(v.cloneDeep)(d.getTileAt(t,a,c));o["stairDown"===r?"stairUp":"stairDown"]=i,d.setTile(t,a,o,c)},p=fe(n&&!isNaN(n.room)&&n.color?n.color:"#ced9e0");return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.j,{color:p,className:"react-grid-item-handle + ".concat(Object(v.isEmpty)(n)?"disabled":""),icon:"drag-handle-horizontal"}),!Object(v.isEmpty)(d.getTileAt(t,a,d.currFloor-1))&&r.a.createElement(m.j,{color:p,onClick:Object(v.isEmpty)(n)?void 0:function(e){return u(e,"stairDown")},className:Object(v.isEmpty)(n)?"disabled":"",style:{opacity:!Object(v.isEmpty)(n)&&n.stairDown?1:.35,position:"absolute",bottom:"5px",left:"5px"},icon:"arrow-bottom-left"}),!Object(v.isEmpty)(d.getTileAt(t,a,d.currFloor+1))&&r.a.createElement(m.j,{color:p,onClick:Object(v.isEmpty)(n)?void 0:function(e){return u(e,"stairUp")},className:Object(v.isEmpty)(n)?"disabled":"",style:{opacity:!Object(v.isEmpty)(n)&&n.stairUp?1:.35,position:"absolute",top:"5px",right:"5px"},icon:"arrow-top-right"}),r.a.createElement(m.q,{isOpen:!!i&&i.x===t&&i.y===a&&!c,onClose:function(){c||l(null)},usePortal:!0},r.a.createElement("div",{className:"react-grid-item-content",style:Object(f.a)(Object(f.a)({},s),{},{backgroundColor:n&&n.color?n.color:""})},r.a.createElement("div",{className:"center",style:{color:p,width:"100%",maxHeight:s.maxHeight-20,overflow:"hidden"}},r.a.createElement("p",null,Object(v.isEmpty)(n)?"":d.entities.room[n.room].name),r.a.createElement("p",null,Object(v.isEmpty)(n)?"":n.characters.map((function(e){return r.a.createElement(m.z,{content:d.entities.character[e].name},d.entities.character[e].emoji)}))),r.a.createElement("p",null,Object(v.isEmpty)(n)?"":n.objects.map((function(e){return r.a.createElement(m.z,{content:d.entities.object[e].name},d.entities.object[e].emoji)}))))),r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement(Ne,{initialInputs:n,onSubmit:function(e){d.setTile(t,a,Object(f.a)(Object(f.a)({},n),e)),l(null)},onClear:function(){d.clearTile(t,a),l(null)},entities:d.entities,findOrAddEntity:d.findOrAddEntity,setSelected:l,selected:i,setShowAdvanced:o}))))};a(251);function Re(e){var t=e.initialOpen,a=void 0===t||t,n=e.children,i=e.title,l=r.a.useState(a),c=Object(d.a)(l,2),o=c[0],s=c[1];return r.a.createElement("div",{style:{margin:"0 0 10px 0"}},r.a.createElement("div",{onClick:function(){return s(!o)},className:"hideable-header ".concat(o?"":"hidden")},r.a.createElement(m.j,{className:"hideable-arrow ".concat(o?"":"hidden"),icon:"chevron-down"})," ",i),r.a.createElement(g.a,{duration:500,height:o?"auto":0,easing:"ease",animateOpacity:!0},r.a.createElement("div",{className:"hideable-content"},n)))}function Te(e){var t=e.columnNames,a=e.columnKeys,n=e.items,i=e.entities,l=e.handleEdit,c=e.handleDuplicate,o=e.handleDelete,s=e.type,u=e.editEntity;function p(e){var t=e.item,a=r.a.useState(!1),n=Object(d.a)(a,2),l=n[0],c=n[1];return r.a.createElement(m.q,{interactionKind:m.r.CLICK,onInteraction:function(e){return c(e)},isOpen:l,wrapperTagName:"td"},r.a.createElement("div",{style:{height:"100%",width:"100%"}},i[s][t].emoji||"\u2753"),r.a.createElement(le.a,{onSelect:function(e){var a=Object(v.cloneDeep)(i[s][t]);a.emoji=e.native,u(t,a,s),c(!1)}}))}return r.a.createElement(r.a.Fragment,null,!Object(v.isEmpty)(n)&&r.a.createElement("table",{"data-testid":"table-explore",style:{width:"100%"},className:"bp3-html-table bp3-html-table-striped bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,t.map((function(e,t){return r.a.createElement("th",{key:t},e)})),r.a.createElement("th",null,"Actions"))),r.a.createElement("tbody",null,n.map((function(e,t){return r.a.createElement(r.a.Fragment,{key:t},r.a.createElement("tr",null,a.map((function(t){return"emoji"===t?r.a.createElement(p,{item:e,key:t}):r.a.createElement("td",{key:t},i[s][e][t])})),r.a.createElement("td",null,r.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},r.a.createElement(m.b,{onClick:function(){return l(e,i[s][e])},icon:"edit",minimal:!0}),r.a.createElement(m.b,{onClick:function(){return c(i[s][e])},icon:"duplicate",minimal:!0}),r.a.createElement(m.b,{onClick:function(){return o(t)},icon:"trash",minimal:!0})))))})))))}var Fe={BASE:0,CHOOSE:1,SELECT_FROM_EXISTING:2,CREATE_NEW:3,EDIT:4,DUPLICATE:5};function Ae(e){var t=e.initialState,a=void 0===t?Fe.BASE:t,n=e.handleChange,i=e.name,l=e.type,c=e.formValue,o=e.SelectFromExisting,s=e.selectFromExistingProps,u=e.Form,p=e.formProps,h=e.handleCreateSubmit,b=e.handleEditSubmit,f=e.Selected,E=e.selectedProps,y=r.a.useState(a),g=Object(d.a)(y,2),v=g[0],x=g[1],j=r.a.useState(void 0),O=Object(d.a)(j,2),C=O[0],w=O[1],S=r.a.useState(void 0),_=Object(d.a)(S,2),k=_[0],N=_[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(f,Object.assign({},E,{handleEdit:function(e,t){w({id:e,data:t}),x(Fe.EDIT)},handleDuplicate:function(e){N(e),x(Fe.DUPLICATE)},handleDelete:function(e){Array.isArray(c)?(c.splice(e,1),n(i,c)):n(i,void 0)}})),v===Fe.CHOOSE?r.a.createElement("div",{style:{display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",padding:"5px"}},r.a.createElement(m.b,{onClick:function(){return x(Fe.SELECT_FROM_EXISTING)},style:{margin:"5px"}},"Select from existing"),r.a.createElement("span",{style:{margin:"5px"}}," OR "),r.a.createElement(m.b,{onClick:function(){return x(Fe.CREATE_NEW)},style:{margin:"5px"}},"Create New")):v===Fe.SELECT_FROM_EXISTING?r.a.createElement("div",null,r.a.createElement(m.b,{onClick:function(){return x(a)},icon:"chevron-left",minimal:!0}),r.a.createElement(o,Object.assign({},s,{name:i,type:l,formValue:c}))):v===Fe.CREATE_NEW?r.a.createElement("div",null,r.a.createElement(m.b,{onClick:function(){return x(a)},icon:"chevron-left",minimal:!0}),r.a.createElement(u,Object.assign({},p,{type:l,handleSubmit:function(e){x(a),h(e)}}))):v===Fe.EDIT?r.a.createElement("div",null,r.a.createElement(m.b,{onClick:function(){return x(a)},icon:"chevron-left",minimal:!0}),r.a.createElement(u,Object.assign({},p,{type:l,initialInputs:C.data,handleSubmit:function(e){x(a),b(C.id,e,l),w(void 0)}}))):v===Fe.DUPLICATE?r.a.createElement("div",null,r.a.createElement(m.b,{onClick:function(){return x(a)},icon:"chevron-left",minimal:!0}),r.a.createElement(u,Object.assign({},p,{type:l,initialInputs:k,handleSubmit:function(e){x(a),h(e),N(void 0)}}))):r.a.createElement(m.b,{onClick:function(){return x(Fe.CHOOSE)},icon:"add"},"Add"))}var De=function(e){var t=e.x,a=e.y,n=e.currFloor,i=e.getTileAt,l=e.initialInputs,c=e.inheritedInputs,o=e.handleSubmit,s=e.handleClear,d=e.tileStyle,u=e.entities,p=e.findOrAddEntity,h=e.editEntity,b=function(e){var l=e.tile,c=fe(l&&!isNaN(l.room)&&l.color?l.color:"#ced9e0");return r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement("div",{style:{position:"relative"}},r.a.createElement(m.j,{color:c,className:"react-grid-item-handle + ".concat(isNaN(l.room)?"disabled":""),icon:"drag-handle-horizontal"}),!Object(v.isEmpty)(l)&&!Object(v.isEmpty)(i(t,a,n-1))&&r.a.createElement(m.j,{color:c,className:Object(v.isEmpty)(l)?"disabled":"",style:{opacity:l.stairDown?1:.2,position:"absolute",bottom:"5px",left:"5px"},icon:"arrow-bottom-left"}),!Object(v.isEmpty)(l)&&!Object(v.isEmpty)(i(t,a,n+1))&&r.a.createElement(m.j,{color:c,className:Object(v.isEmpty)(l)?"disabled":"",style:{opacity:l.stairUp?1:.2,position:"absolute",top:"5px",right:"5px"},icon:"arrow-top-right"}),r.a.createElement("div",{className:"react-grid-item-content",style:Object(f.a)(Object(f.a)({},d),{},{backgroundColor:l&&!isNaN(l.room)&&l.color?l.color:"#ced9e0"})},r.a.createElement("div",{className:"center",style:{color:c,width:"100%",maxHeight:d.maxHeight-20,overflow:"hidden"}},!Object(v.isEmpty)(l)&&u.room[l.room]?u.room[l.room].name:"",r.a.createElement("p",null,Object(v.isEmpty)(l)?"":l.characters.map((function(e){return r.a.createElement(m.z,{content:u.character[e].name},u.character[e].emoji)}))),r.a.createElement("p",null,Object(v.isEmpty)(l)?"":l.objects.map((function(e){return r.a.createElement(m.z,{content:u.object[e].name},u.object[e].emoji)})))))))};return r.a.createElement(F.a,{initialValues:c||(Object(v.isEmpty)(l)?void 0:l)||ke,validate:function(e){var t={};return e.room||(t.room="Required"),t},isInitialValid:!!c&&!!c.room,onSubmit:o},(function(e){var t=e.values,a=e.setFieldValue,n=e.touched,i=e.setFieldTouched,l=e.errors,c=e.dirty,o=e.isValid,d=e.handleSubmit,f=e.handleReset,y=function(e,n,r){a(e,n),a("color",be(r.name,t.color))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Re,{title:"Room"},r.a.createElement(Ae,{initialState:Fe.CHOOSE,SelectFromExisting:G,selectFromExistingProps:{id:"room-input",errors:l.room,touched:n.room,setFieldTouched:i,onItemSelect:p,entities:u,handleChange:y},handleChange:a,formValue:t.room,name:"room",type:"room",Form:U,formProps:{initialInputs:W},handleCreateSubmit:function(e){return y("room",p(e,"room"),e)},handleEditSubmit:h,Selected:Te,selectedProps:{columnNames:["Name","Description","Backstory"],columnKeys:["name","description","backstory"],items:isNaN(t.room)?void 0:[t.room],entities:u,type:"room"}}),l.room&&n.room&&r.a.createElement("div",{className:"form-error"},l.room),r.a.createElement("div",{style:{marginTop:"5px"}},r.a.createElement(Ce,{colors:ce,value:t.color,handleChange:a,advanced:!0}))),r.a.createElement(Re,{initialOpen:!Object(v.isEmpty)(t.characters),title:"Characters"},r.a.createElement(Ae,{SelectFromExisting:_e,selectFromExistingProps:{id:"characters-input",errors:l.characters,touched:n.characters,setFieldTouched:i,tooltip:"physical_description",onItemSelect:function(e,t){return e.emoji=Ee(e.name),p(e,t)},entities:u,handleChange:a},handleChange:a,formValue:t.characters,name:"characters",type:"character",Form:H,formProps:{initialInputs:M},handleCreateSubmit:function(e){e.emoji=Ee(e.name),a("characters",t.characters.concat(p(e,"character")))},handleEditSubmit:h,Selected:Te,selectedProps:{columnNames:["Name","Persona","Emoji"],columnKeys:["name","persona","emoji"],items:t.characters,entities:u,type:"character",editEntity:h}}),l.characters&&n.characters&&r.a.createElement("div",{className:"form-error"},l.characters)),r.a.createElement(Re,{initialOpen:!Object(v.isEmpty)(t.characters),title:"Objects"},r.a.createElement(Ae,{SelectFromExisting:_e,selectFromExistingProps:{id:"objects-input",errors:l.objects,touched:n.objects,setFieldTouched:i,tooltip:"physical_description",onItemSelect:function(e,t){return e.emoji=Ee(e.name),p(e,t)},entities:u,handleChange:a},handleChange:a,formValue:t.objects,name:"objects",type:"object",Form:q,formProps:{initialInputs:V},handleCreateSubmit:function(e){e.emoji=Ee(e.name),a("objects",t.objects.concat(p(e,"object")))},handleEditSubmit:h,Selected:Te,selectedProps:{columnNames:["Name","Description","emoji"],columnKeys:["name","physical_description","emoji"],items:t.objects,entities:u,type:"object",editEntity:h}}),l.objects&&n.objects&&r.a.createElement("div",{className:"form-error"},l.objects)),r.a.createElement(Re,{title:"Preview"},r.a.createElement(b,{tile:t})),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",padding:"10px"}},r.a.createElement(m.b,{type:"reset",onClick:s,disabled:!(!isNaN(t.room)||!Object(v.isEmpty)(t.characters)||!Object(v.isEmpty)(t.objects)),style:{marginRight:"15px"}},"Clear"),r.a.createElement(m.b,{type:"reset",onClick:f,disabled:!c,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.b,{intent:E.a.PRIMARY,type:"submit",onClick:d,disabled:!o,style:{marginLeft:"15px"}},"Save Changes")))}))};function Pe(e){var t=e.selected,a=e.setSelected,n=e.resetShowAdvanced,i=e.showAdvanced,l=e.state;return r.a.createElement(m.h,{icon:"build",title:"Build Tile",isOpen:i&&t,onClose:function(){a(null),n()}},r.a.createElement("div",{className:Q.a.DRAWER_BODY},r.a.createElement("div",{className:Q.a.DIALOG_BODY},t&&r.a.createElement(De,{x:t.x,y:t.y,currFloor:l.currFloor,getTileAt:l.getTileAt,initialInputs:l.getTileAt(t.x,t.y),inheritedInputs:t.data,handleSubmit:function(e){l.setTile(t.x,t.y,Object(f.a)(Object(f.a)({},l.getTileAt(t.x,t.y)),e)),a(null),n()},handleClear:function(){l.clearTile(t.x,t.y),a(null),n()},tileStyle:{width:150,height:150,maxWidth:150,maxHeight:150},entities:l.entities,findOrAddEntity:l.findOrAddEntity,editEntity:l.editEntity}))))}var Le=function(e){var t=e.state,a=e.initialShowAdvanced,n=r.a.useState(null),i=Object(d.a)(n,2),l=i[0],c=i[1],o=r.a.useState(null),s=Object(d.a)(o,2),u=s[0],p=s[1],h=r.a.useState(!1),b=Object(d.a)(h,2),f=b[0],E=b[1],y=r.a.useState(!1),g=Object(d.a)(y,2),x=g[0],j=g[1];r.a.useEffect((function(){E(a)}),[a]);var O=function(e,t,a){Object(v.isEqual)(t,a)||(j(!0),p(null));for(var n=0;n<l.length;n++)l[n].i!==a.i&&(l[n].x===a.x&&l[n].y===a.y&&l[n].i!==a.i?(e[n].x=t.x,e[n].y=t.y):(e[n].x=l[n].x,e[n].y=l[n].y));return!0};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{width:150*t.dimensions.width+24*(t.dimensions.width+1)+60,margin:"0 auto 75px auto",textAlign:"center"}},r.a.createElement(m.b,{className:"bp3-button",disabled:t.dimensions.height>=10,style:{width:150*t.dimensions.width+24*(t.dimensions.width+1)-20,margin:"auto"},onClick:t.addRowTop,icon:"add"}),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(m.b,{className:"bp3-button",disabled:t.dimensions.width>=10,style:{height:150*t.dimensions.height+24*(t.dimensions.height+1)-20,margin:"10px 0"},onClick:t.addColFront,icon:"add"}),r.a.createElement("div",{className:"map-container",style:{width:150*t.dimensions.width+24*(t.dimensions.width+1),height:150*t.dimensions.height+24*(t.dimensions.height+1)}},r.a.createElement("div",{className:"walls"},function(){for(var e=[],a=0;a<t.dimensions.height;a++)for(var n=0;n<t.dimensions.width;n++)n>0&&function(){var i="".concat(n-1," ").concat(a,"|").concat(n," ").concat(a);e.push(r.a.createElement("div",{key:i,onClick:function(){return t.toggleWall(i)},className:"wall ".concat(t.map[t.currFloor].walls[i]?"active":""),style:{top:24+174*a,left:174*n+7,height:150}}))}(),a>0&&function(){var i="".concat(n," ").concat(a-1,"|").concat(n," ").concat(a);e.push(r.a.createElement("div",{key:i,onClick:function(){return t.toggleWall(i)},className:"wall ".concat(t.map[t.currFloor].walls[i]?"active":""),style:{left:24+174*n,top:174*a+7,width:150}}))}();return e}()),r.a.createElement(Oe.a,{cols:t.dimensions.width,rowHeight:150,width:150*t.dimensions.width+24*(t.dimensions.width+1),onDragStart:function(e){c(Object(v.cloneDeep)(e))},onDrag:O,onDragStop:function(e,t,a){O(e,t,a),c([t.x,t.y,a.x,a.y])},margin:[24,24],onLayoutChange:function(){if(l){var e=Object(d.a)(l,4),a=e[0],n=e[1],r=e[2],i=e[3];a===r&&n===i||setTimeout((function(){return t.swapTiles(a,n,r,i)}),300),c(null)}},isResizable:!1,maxRows:t.dimensions.height,style:{width:150*t.dimensions.width+24*(t.dimensions.width+1)}},function(){for(var e=[],a=function(a){for(var n=function(n){var i=t.getTileAt(n,a,t.currFloor),l="".concat(t.currFloor," ").concat(n," ").concat(a," ").concat(i&&i&&i.room?i.room.id:"");e.push(r.a.createElement("div",{key:l,"data-grid":{x:n,y:a,w:1,h:1,draggableHandle:".react-grid-item-handle",draggableCancel:".react-grid-item",isDraggable:!Object(v.isEmpty)(i)},onClick:function(){x||u&&(!u||u.x===n&&u.y===a)?j(!1):p({x:n,y:a})}},r.a.createElement(Ie,{x:n,y:a,tile:i,selected:u,setSelected:p,showAdvanced:f,setShowAdvanced:E,setTile:t.setTile,clearTile:t.clearTile,getTileAt:t.getTileAt,currFloor:t.currFloor,tileStyle:{width:150,height:150,maxWidth:150,maxHeight:150},state:t})))},i=0;i<t.dimensions.width;i++)n(i)},n=0;n<t.dimensions.height;n++)a(n);return e}())),r.a.createElement(m.b,{className:"bp3-button",disabled:t.dimensions.width>=10,style:{height:150*t.dimensions.height+24*(t.dimensions.height+1)-20,margin:"10px 0"},onClick:t.addColEnd,icon:"add"})),r.a.createElement(m.b,{className:"bp3-button",disabled:t.dimensions.height>=10,style:{width:150*t.dimensions.width+24*(t.dimensions.width+1)-20,margin:"auto"},onClick:t.addRowBot,icon:"add"})),r.a.createElement(Pe,{showAdvanced:f,selected:u,setSelected:p,resetShowAdvanced:function(){E(a)},state:t}))},Be=a(140),Ge=a.n(Be),Ve=a(87),qe=a.n(Ve);var Me=function(e){var t=e.manager,a=e.map,n=e.currFloor,i=r.a.useState(!1),l=Object(d.a)(i,2),c=l[0],o=l[1],s=r.a.useState(null),u=Object(d.a)(s,2),p=u[0],h=u[1],b=r.a.useState({}),f=Object(d.a)(b,2),y=f[0],g=f[1],x=r.a.createRef(),j=a.map((function(e,t){return{name:e.name,index:t}})),O=Object(m.d)(qe()({displayName:"FloorButton",keypressHandler:function(e){"Enter"===e.key&&x.current.blur()},renderContextMenu:function(){var e=this;return o(!0),r.a.createElement(m.l,null,r.a.createElement(m.m,{icon:"edit",onClick:function(){return h(e.props.item.index)},text:"Edit Floor Name"}),r.a.createElement(m.m,{icon:"delete",disabled:j.length<=1,onClick:function(){g({confirmButtonText:"Confirm Delete",icon:"trash",intent:E.a.DANGER,onConfirm:function(){t.deleteFloor(e.props.item.index),g({})},content:"Are you sure you want to delete the entire ".concat(e.props.item.name," floor? All data on this floor and connections to this floor will be reset.")})},text:"Delete Floor"}))},onContextMenuClose:function(){o(!1)},handleBlur:function(e){t.editFloorName(e.target.value,this.props.item.index),h(null)},componentDidMount:function(){p===this.props.item.index&&(x.current.focus(),x.current.select())},render:function(){var e=this;return r.a.createElement("div",{style:{textAlign:"center",width:"100%",height:"100%",lineHeight:"30px",padding:"0px 5px"}},null!==p&&p===this.props.item.index?r.a.createElement(m.k,{inputRef:x,onBlur:this.handleBlur,defaultValue:this.props.item.name,onKeyPress:function(t){return e.keypressHandler(t)}}):r.a.createElement("div",null,this.props.item.name))}}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{confirmButtonText:y.confirmButtonText,cancelButtonText:"Cancel",icon:y.icon,intent:y.intent,isOpen:!Object(v.isEmpty)(y),onCancel:function(){y.onCancel&&y.onCancel(),g({})},onConfirm:y.onConfirm},r.a.createElement("p",null,y.content)),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(m.b,{disabled:a.length>=10,icon:"add",onClick:t.addFloor,style:{height:"30px"}}),r.a.createElement(Ge.a,{holdTime:"200",callback:function(e,a,n,r){n!==r&&g({confirmButtonText:"Confirm Reorder",icon:"layers",intent:E.a.WARNING,onConfirm:function(){t.reorderFloors(n,r),g({})},content:"Are you sure you want to reorder the entire ".concat(j[r].name," floor? All connections to and from this floor, in both positions, will be reset.")})},template:O,itemKey:"index",list:j,selected:j[n],itemClicked:function(e,a,n){c||p||t.setCurrFloor(n)},lock:"vertical",itemClass:"bp3-button floor-button"})))};function He(e){var t=ve(e.upload),a=r.a.useState(!1),n=Object(d.a)(a,2),i=n[0],l=n[1],c=r.a.useState(!1),o=Object(d.a)(c,2),s=o[0],u=o[1],h=re()(Q.a.CARD,Q.a.ELEVATION_4);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(m.p,{isOpen:s,onClose:function(){return u(!s)}},r.a.createElement("div",{className:h},r.a.createElement(xe,{isOpen:s,state:t,toggleOverlay:u}),r.a.createElement(m.b,{intent:E.a.DANGER,onClick:function(){return u(!s)},style:{margin:"10px"}},"Close")))),r.a.createElement(m.i,{inline:!0,label:"World Dimensions",labelInfo:"WxH (Max ".concat(10,"x").concat(10,")")},r.a.createElement(m.e,null,r.a.createElement(m.o,{value:t.dimensions.width,style:{width:"3rem"},max:10,min:1,onValueChange:function(e){t.setDimensions(Object(f.a)(Object(f.a)({},t.dimensions),{},{width:e}))}}),r.a.createElement(m.o,{value:t.dimensions.height,style:{width:"3rem"},max:10,min:1,onValueChange:function(e){t.setDimensions(Object(f.a)(Object(f.a)({},t.dimensions),{},{height:e}))}}))),r.a.createElement(m.i,{inline:!0,label:r.a.createElement(r.a.Fragment,null,"Floor"," ",r.a.createElement(m.z,{content:"Right click floor for more options. Click and hold floor to reorder.",position:p.a.BOTTOM,className:"inline"},r.a.createElement(m.j,{icon:"help"}))),labelInfo:"Max ".concat(10),style:{marginBottom:"0px"}},r.a.createElement(Me,{max:10,manager:t.floorManager,map:t.map,currFloor:t.currFloor})),r.a.createElement(m.i,{inline:!0,label:"Advanced"},r.a.createElement(m.v,{onChange:function(){return l(!i)},checked:!!i})),r.a.createElement(Le,{state:t,initialShowAdvanced:i}),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",position:"fixed",bottom:0,left:0,right:0,height:"50px"},className:"bp3-navbar"},r.a.createElement(m.b,{onClick:function(){return u(!s)},intent:"primary",style:{margin:"10px"}},"Manage Worlds"),r.a.createElement(m.b,{onClick:t.postWorld,intent:"primary",style:{margin:"10px"}},"Save"),r.a.createElement(m.b,{onClick:t.exportWorld,intent:"primary",style:{margin:"10px"}},"Export"),r.a.createElement(m.b,{onClick:t.postEdges,intent:"primary",style:{margin:"10px"}},"Commit Edges")))}var We=function(e){var t=e.location;return r.a.createElement("div",null,r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading"},"World Builder"),r.a.createElement("div",null,r.a.createElement(He,{upload:t.state})))};function Ue(e){var t=e.type,a=e.initialInputs,n=e.handleSubmit;switch(t){case"object":return r.a.createElement(q,{type:t,initialInputs:a,handleSubmit:n});case"character":return r.a.createElement(H,{type:t,initialInputs:a,handleSubmit:n});case"room":return r.a.createElement(U,{type:t,initialInputs:a,handleSubmit:n});default:return"This entity cannot be edited at the moment"}}function Ye(){return(Ye=Object(T.a)(R.a.mark((function e(t,a,n){var r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.map((function(e){return ze(t,e.property,e.editedValue)})),e.next=3,Promise.all(r).then((function(){n.push("/")}));case 3:Y.show({intent:E.a.SUCCESS,message:"Successfully created edits"});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ze(e,t,a){return S("edits",{id:e,field:t,edited_value:a,player:1})}var Ke=function(e){var t=e.match,a=e.location,n=r.a.useState(void 0),i=Object(d.a)(n,2),l=i[0],c=i[1],o=w(O,"/entities/".concat(t.params.id),{},a.state),u=o.loading,p=o.result,h=r.a.useState({}),b=Object(d.a)(h,2),f=b[0],y=b[1],g=r.a.useState(!1),x=Object(d.a)(g,2),j=x[0],C=x[1],S=r.a.useState([]),_=Object(d.a)(S,2),k=_[0],N=_[1],I=Object(s.f)();return!u&&Object(v.isEmpty)(f)&&(Object(v.isEmpty)(p)||Object(v.isEmpty)(p.entity)?(y({id:t.params.id}),c("invalid")):(y(p.entity),c(p.type))),r.a.createElement("div",null,r.a.createElement(m.f,{icon:"info-sign",onClose:function(){return C(!1)},title:"Confirm edits for Entity ".concat(t.params.id),isOpen:j,usePortal:!1},r.a.createElement("div",{className:Q.a.DIALOG_BODY},k.map((function(e,t){return r.a.createElement("p",{key:t},r.a.createElement("strong",null,e.property),": ",e.editedValue.toString())}))),r.a.createElement("div",{className:Q.a.DIALOG_FOOTER},r.a.createElement("div",{className:Q.a.DIALOG_FOOTER_ACTIONS},r.a.createElement(m.b,{onClick:function(){return C(!1)}},"Close"),r.a.createElement(m.b,{intent:E.a.PRIMARY,onClick:function(){return function(e,t,a){return Ye.apply(this,arguments)}(t.params.id,k,I)}},"Confirm Edits")))),r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading"},"Editing Entity ",t.params.id),r.a.createElement("div",{className:"bp3-text-large"},u?r.a.createElement(m.u,{intent:E.a.PRIMARY}):r.a.createElement(Ue,{type:l,initialInputs:f,handleSubmit:function(e){var t=[];for(var a in e)e[a]!==f[a]&&t.push({property:a,editedValue:e[a]});N(t),C(!0)}})))};function Je(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(b,null),r.a.createElement("div",{style:{margin:"40px 30px"}},r.a.createElement(s.b,{path:"/explore",component:N,exact:!0}),r.a.createElement(s.b,{path:"/create",component:K,exact:!0}),r.a.createElement(s.b,{path:"/review",component:ae,exact:!0}),r.a.createElement(s.b,{path:"/world_builder",render:function(e){return r.a.createElement(We,Object.assign({},e,{key:Math.random(),exact:!0}))}}),r.a.createElement(s.b,{path:"/edit/:id",component:Ke,exact:!0}),r.a.createElement(s.b,Object(c.a)({exact:!0,path:"/",render:function(){return r.a.createElement(s.a,{to:"/explore"})}},"exact",!0))))}var Qe=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(o.a,null,r.a.createElement(Je,null)))};a(255),a(256),a(257);l.a.render(r.a.createElement(Qe,null),document.getElementById("root"))}},[[169,1,2]]]);
//# sourceMappingURL=main.4c2e6030.chunk.js.map