(this["webpackJsonplight-datamodel"]=this["webpackJsonplight-datamodel"]||[]).push([[0],{217:function(e,t,n){e.exports=n(306)},222:function(e,t,n){},306:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(16),l=n.n(i),o=(n(222),n(27)),c=n(25),s=n(21),u=n(6),m=n(1);var d=function(e){var t=e.setPopover,n=r.a.useRef(),a=r.a.useState(void 0),i=Object(u.a)(a,2),l=i[0],o=i[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{onChange:function(e){o(void 0);var n=new FileReader;n.onload=function(e){o(JSON.parse(e.target.result))};var a=e.target.files[0];n.readAsText(a),t(!1)},type:"file",ref:n,style:{display:"none"}}),l&&r.a.createElement(s.a,{to:{pathname:"/world_builder",state:{data:l}}}),r.a.createElement(m.MenuItem,{icon:"upload",onClick:function(){return n.current.click()},text:"Upload File",shouldDismissPopover:!1}))};var p=function(e){var t=e.children,n=r.a.useState(!1),a=Object(u.a)(n,2),i=a[0],l=a[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.Navbar,null,r.a.createElement(m.Navbar.Group,{align:m.Alignment.LEFT},r.a.createElement(m.Navbar.Heading,null,"LIGHT Data Model"),r.a.createElement(m.Navbar.Divider,null),r.a.createElement(c.b,{"data-testid":"link-explore",className:"btn-link",to:"/explore"},r.a.createElement(m.Button,{className:"bp3-minimal",icon:"path-search",text:"Explore"})),r.a.createElement(c.b,{"data-testid":"link-create",className:"btn-link",to:"/create"},r.a.createElement(m.Button,{className:"bp3-minimal",icon:"cube",text:"Create"})),r.a.createElement(c.b,{"data-testid":"link-review",className:"btn-link",to:"/review"},r.a.createElement(m.Button,{className:"bp3-minimal",icon:"form",text:"Review Edits"})),r.a.createElement(m.Popover,{position:m.Position.BOTTOM_LEFT,minimal:!0,isOpen:i},r.a.createElement(m.Button,{onClick:function(){return l(!i)},className:"bp3-minimal",icon:"map-create",text:"Build World"}),r.a.createElement(m.Menu,null,r.a.createElement(m.MenuItem,{icon:"new-object",text:r.a.createElement(c.b,{onClick:function(){return l(!1)},style:{color:"inherit"},"data-testid":"link-world-builder",className:"btn-link",to:"/world_builder"},"Create New"),shouldDismissPopover:!0,tagName:"div"}),r.a.createElement(m.MenuItem,{icon:"cloud-upload",text:r.a.createElement(c.b,{onClick:function(){return l(!1)},style:{color:"inherit"},"data-testid":"link-world-builder-manage",className:"btn-link",to:"/world_builder?manage=true"},"Manage Existing"),shouldDismissPopover:!0,tagName:"div"}),r.a.createElement(d,{setPopover:l}))))),t)},h=n(9),f=n(53),E=n.n(f),b=n(8),y=n(174),g=n.n(y),v={host:"http://localhost",hostname:"localhost",port:"35494"};function x(e){return function(e){var t=r.a.useRef();return r.a.useEffect((function(){t.current=e})),t.current}(e)!==e}function O(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=(n.body,n.params,arguments.length>3?arguments[3]:void 0),i=r.a.useState({loading:!0,result:void 0}),l=Object(u.a)(i,2),o=l[0],c=l[1],s=x(t);r.a.useEffect((function(){if(o.loading&&a)c({loading:!1,result:a});else{if(!s){var n=!0;return o.loading&&fetch(e.host+":"+e.port+"/builder"+t).then((function(e){return e.json()})).then((function(e){n&&c({loading:!1,result:e})})).catch((function(e){return console.log("Error fetching data")})),function(){return n=!1}}c({loading:!0,result:void 0})}}),[e.host,e.port,t,s,a,o]);var m=function(){c({loading:!0,result:void 0})};return{loading:o.loading,result:o.result,reload:m}}function j(e,t){var n=[];for(var a in t){var r=encodeURIComponent(a),i=encodeURIComponent("object"===typeof t[a]?JSON.stringify(t[a]):t[a]);n.push(r+"="+i)}return fetch("".concat(v.host,":").concat(v.port,"/").concat(e),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.join("&")})}function C(e){var t=e.items,n=e.descriptionField,a=e.additionalFields,i=void 0===a?[]:a,l=e.selectedEntity,o=r.a.useState({expanded:-1,animating:0,nextState:-1}),c=Object(u.a)(o,2),s=c[0],m=c[1];return void 0===t||0===t.length?r.a.createElement("span",null,"No items found."):r.a.createElement("table",{"data-testid":"table-explore",style:{width:"100%"},className:"bp3-html-table bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Description"),i.map((function(e){return r.a.createElement("th",{key:e},e.name)})),r.a.createElement("th",null,"ID"))),r.a.createElement("tbody",null,t.map((function(e,t){return r.a.createElement(r.a.Fragment,{key:e.id},r.a.createElement("tr",{onClick:function(){return function(e){-1===s.expanded?m({expanded:e,animating:2,nextState:-1}):s.expanded===e?m({expanded:e,animating:3,nextState:-1}):m(Object(h.a)(Object(h.a)({},s),{},{animating:3,nextState:e}))}(t)},"data-testid":"tr-explore",style:{background:t%2===0?"rgba(191, 204, 214, 0.15)":void 0}},r.a.createElement("td",null,r.a.createElement("strong",null,e.name)),r.a.createElement("td",null,e[n]),i.map((function(t){return r.a.createElement("td",{key:t.name},e[t.key])})),r.a.createElement("td",null,e.id)),r.a.createElement("tr",{style:{background:t%2===0?"rgba(191, 204, 214, 0.15)":void 0}},r.a.createElement("td",{colSpan:5,style:{display:s.expanded===t?void 0:"none",padding:0,cursor:"unset"}},r.a.createElement(E.a,{duration:500,height:s.expanded!==t||2!==s.animating&&0!==s.animating?0:"auto",easing:"ease",onAnimationEnd:function(){return m({nextState:-1,expanded:2===s.animating?t:s.nextState,animating:3===s.animating&&-1!==s.nextState?2:0})},animateOpacity:!0},s.expanded===t&&r.a.createElement(w,{item:e,selectedEntity:l})))))}))))}function w(e){var t=e.item,n=e.selectedEntity;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{"data-testid":"dropdown",style:{padding:"20px 40px 0 40px"}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},Object.keys(t).map((function(e,n){return r.a.createElement("p",{key:n},r.a.createElement("strong",null,Object(b.startCase)(e)),": ",t[e])})))),r.a.createElement("div",{style:{display:"flex",padding:"0 20px 20px 20px",justifyContent:"flex-end"}},r.a.createElement(c.b,{style:{margin:"0 5px"},className:"bp3-button bp3-small",to:{pathname:"/create",state:{type:n,entity:t}}},"Create From"),r.a.createElement(c.b,{style:{margin:"0 5px"},className:"bp3-button bp3-small",to:{pathname:"/edit/".concat(t.id),state:{type:n,entity:t}}},"Edit")))}var I=function(){var e=r.a.useState("object"),t=Object(u.a)(e,2),n=t[0],a=t[1],i=r.a.useState(0),l=Object(u.a)(i,2),o=l[0],c=l[1],s=r.a.useState(""),d=Object(u.a)(s,2),p=d[0],h=d[1],f=O(v,"/entities/"+n+"?search="+p+"&page="+o),E=f.loading,b=f.result;return r.a.createElement("div",null,r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading"},"Explore"),r.a.createElement("div",{className:"bp3-text-large"},"Search across the LIGHT database for existing objects, characters, or rooms."),r.a.createElement("div",{className:"bp3-input-group bp3-large",style:{margin:"20px 0px 10px"}},r.a.createElement("span",{className:"bp3-icon bp3-icon-search"}),r.a.createElement("input",{className:"bp3-input",type:"search",placeholder:"Search...",dir:"auto",value:p,onChange:function(e){h(e.target.value),c(0)}})),r.a.createElement("div",{style:{display:"flex",marginBottom:30}},r.a.createElement("span",{style:{margin:"0px 20px 0px 40px"}},"Searching category:"),r.a.createElement(m.RadioGroup,{inline:!0,large:!0,onChange:function(e){a(e.target.value),c(0)},selectedValue:n},r.a.createElement(m.Radio,{"data-testid":"radio-object",label:"Objects",value:"object"}),r.a.createElement(m.Radio,{"data-testid":"radio-character",label:"Characters",value:"character"}),r.a.createElement(m.Radio,{"data-testid":"radio-room",label:"Rooms",value:"room"}))),E?r.a.createElement(m.Spinner,{intent:m.Intent.PRIMARY}):r.a.createElement(r.a.Fragment,null,r.a.createElement(C,{items:b.data,descriptionField:"room"===n?"description":"physical_description",additionalFields:"room"===n?[{name:"Backstory",key:"backstory"}]:[],selectedEntity:n}),r.a.createElement("div",{style:{margin:"20px"}},r.a.createElement(g.a,{previousLabel:"previous",nextLabel:"next",breakLabel:"...",forcePage:o,pageCount:b.total_pages,marginPagesDisplayed:2,pageRangeDisplayed:5,onPageChange:function(e){return c(e.selected)},containerClassName:"pagination",subContainerClassName:"pages pagination",activeClassName:"active"}))))},S=n(18),k=n.n(S),N=n(28),_=n(34),R=n(309),F=n(54),T=n.n(F);n(150);function A(e){var t=e.filteredItems,n=e.renderItem,a=t.slice(0,100);return r.a.createElement(m.Menu,null,t.length>0?r.a.createElement(r.a.Fragment,null,a.map((function(e,t){return n(e,t)})),t.length>100&&r.a.createElement(m.MenuItem,{style:{textAlign:"center"},disabled:!0,text:"..."})):r.a.createElement(m.MenuItem,{disabled:!0,text:"No results."}))}function D(e,t){var n=t.handleClick,a=t.modifiers,i=t.index;return a.matchesPredicate?r.a.createElement(m.MenuItem,{active:a.active,key:i,onClick:n,text:e.name,shouldDismissPopover:!1}):null}var B=function(e){var t=e.id,n=e.name,a=e.errors,i=e.touched,l=e.setFieldTouched,o=e.formValue,c=e.handleChange,s=e.type,d=e.onItemSelect,p=e.entities,h=r.a.useState([]),f=Object(u.a)(h,2),E=f[0],b=f[1],y=r.a.useState(""),g=Object(u.a)(y,2),x=g[0],j=g[1],C=r.a.useState(o),w=Object(u.a)(C,2),I=w[0],S=w[1],k=O(v,"/entities/".concat(s,"?search=").concat(x)),N=k.loading,_=k.result;return r.a.useEffect((function(){if(!N){if(p){var e=Object.values(p[s]),t=e.concat(_.slice(0,100+e.length+1)).filter((function(e,t,n){return n.findIndex((function(t){return T()(t,e)}))===t}));return b(t)}return b(_)}}),[_,N,p,s]),r.a.useEffect((function(){if(p)return S(o);if(isNaN(o))return S(null);for(var e in E)if(E[e].id===o)return S(E[e])}),[o,E,p]),r.a.createElement("div",{onBlur:function(e){return l(n)}},r.a.createElement(R.a,{id:t,name:n,items:E,itemRenderer:D,itemListRenderer:A,inputValueRenderer:function(e){return p&&p[s][e]?p[s][e].name:e.name},inputProps:{intent:a&&i?m.Intent.DANGER:null,"data-testid":"base-suggest"},onItemSelect:function(e){if(d){var t=d(e,s);S(t),c(n,t,e)}else S(e),c(n,e.id,e);j("")},popoverProps:{usePortal:!1},itemPredicate:function(e,t,n,a){var r=t.name.toLowerCase(),i=e.toLowerCase();if(a)return r===i;var l="";for(var o in t)l+=t[o]+". ";return l.toLowerCase().indexOf(i)>=0},selectedItem:I,query:x,onQueryChange:function(e){return j(e)},resetOnQuery:!0}))};var P={name:"",name_prefix:"",physical_description:"",base_id:0,is_container:0,is_drink:0,is_food:0,is_gettable:0,is_plural:0,is_surface:0,is_weapon:0,is_wearable:0},G=function(e){var t=e.initialInputs,n=e.handleSubmit,a=e.type;return r.a.createElement(_.a,{initialValues:t,validate:function(e){var t={};return e.name||(t.name="Required"),e.name_prefix||(t.name_prefix="Required"),e.physical_description||(t.physical_description="Required"),e.base_id||(t.base_id="Required"),t},onSubmit:n},(function(e){var t=e.values,n=e.setFieldValue,i=e.touched,l=e.setFieldTouched,o=e.errors,c=e.dirty,s=e.isValid,u=e.handleChange,d=e.handleBlur,p=e.handleSubmit,h=e.handleReset,f=function(e){var a=e.target.name;n(a,t[a]?0:1)};return r.a.createElement("form",{"data-testid":"form"},r.a.createElement(m.FormGroup,{label:"Name",labelInfo:"(required)",labelFor:"name-input"},r.a.createElement(m.InputGroup,{id:"name-input",name:"name",intent:o.name&&i.name?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.name}),o.name&&i.name&&r.a.createElement("div",{className:"form-error"},o.name)),r.a.createElement(m.FormGroup,{label:"Name Prefix",labelInfo:"(required)",labelFor:"name-prefix-input"},r.a.createElement(m.InputGroup,{id:"name-prefix-input",name:"name_prefix",intent:o.name_prefix&&i.name_prefix?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.name_prefix}),o.name_prefix&&i.name_prefix&&r.a.createElement("div",{className:"form-error"},o.name_prefix)),r.a.createElement(m.FormGroup,{label:"Physical Description",labelInfo:"(required)",labelFor:"physical-description-input"},r.a.createElement(m.TextArea,{id:"physical-description-input",name:"physical_description",growVertically:!0,fill:!0,intent:o.physical_description&&i.physical_description?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.physical_description}),o.physical_description&&i.physical_description&&r.a.createElement("div",{className:"form-error"},o.physical_description)),r.a.createElement(m.FormGroup,{label:"Base Object",labelInfo:"(required)",labelFor:"base-id-input"},r.a.createElement(B,{id:"base-id-input",name:"base_id",type:"base_".concat(a),errors:o.base_id,touched:i.base_id,setFieldTouched:l,formValue:t.base_id,handleChange:n}),o.base_id&&i.base_id&&r.a.createElement("div",{className:"form-error"},o.base_id)),r.a.createElement(m.FormGroup,{label:"Properties",labelInfo:"(required)",large:!0},r.a.createElement("div",{style:{marginLeft:"15px",width:"150px"}},r.a.createElement(m.Switch,{label:"Container",name:"is_container",onChange:f,checked:!!t.is_container,alignIndicator:m.Alignment.RIGHT}),r.a.createElement(m.Switch,{label:"Drink",name:"is_drink",onChange:f,checked:!!t.is_drink,alignIndicator:m.Alignment.RIGHT}),r.a.createElement(m.Switch,{label:"Food",name:"is_food",onChange:f,checked:!!t.is_food,alignIndicator:m.Alignment.RIGHT}),r.a.createElement(m.Switch,{label:"Gettable",name:"is_gettable",onChange:f,checked:!!t.is_gettable,alignIndicator:m.Alignment.RIGHT}),r.a.createElement(m.Switch,{label:"Plural",name:"is_plural",onChange:f,checked:!!t.is_plural,alignIndicator:m.Alignment.RIGHT}),r.a.createElement(m.Switch,{label:"Surface",name:"is_surface",onChange:f,checked:!!t.is_surface,alignIndicator:m.Alignment.RIGHT}),r.a.createElement(m.Switch,{label:"Weapon",name:"is_weapon",onChange:f,checked:!!t.is_weapon,alignIndicator:m.Alignment.RIGHT}),r.a.createElement(m.Switch,{label:"Wearable",name:"is_wearable",onChange:f,checked:!!t.is_wearable,alignIndicator:m.Alignment.RIGHT}))),r.a.createElement(m.Button,{type:"reset",onClick:h,disabled:!c,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,type:"submit",onClick:p,disabled:!c||!s,style:{marginLeft:"15px"}},"Save Changes"))}))};var L={name:"",name_prefix:"",persona:"",physical_description:"",char_type:"",base_id:0,is_plural:0},M=function(e){var t=e.initialInputs,n=e.handleSubmit,a=e.type;return r.a.createElement(_.a,{initialValues:t,validate:function(e){var t={};return e.name||(t.name="Required"),e.name_prefix||(t.name_prefix="Required"),e.persona||(t.persona="Required"),e.physical_description||(t.physical_description="Required"),e.char_type||(t.char_type="Required"),e.base_id||(t.base_id="Required"),t},onSubmit:n},(function(e){var t=e.values,n=e.setFieldValue,i=e.touched,l=e.setFieldTouched,o=e.errors,c=e.dirty,s=e.isValid,u=e.handleChange,d=e.handleBlur,p=e.handleSubmit,h=e.handleReset;return r.a.createElement("form",{"data-testid":"form"},r.a.createElement(m.FormGroup,{label:"Name",labelInfo:"(required)",labelFor:"name-input"},r.a.createElement(m.InputGroup,{id:"name-input",name:"name",intent:o.name&&i.name?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.name}),o.name&&i.name&&r.a.createElement("div",{className:"form-error"},o.name)),r.a.createElement(m.FormGroup,{label:"Name Prefix",labelInfo:"(required)",labelFor:"name-prefix-input"},r.a.createElement(m.InputGroup,{id:"name-prefix-input",name:"name_prefix",intent:o.name_prefix&&i.name_prefix?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.name_prefix}),o.name_prefix&&i.name_prefix&&r.a.createElement("div",{className:"form-error"},o.name_prefix)),r.a.createElement(m.FormGroup,{label:"Persona",labelInfo:"(required)",labelFor:"persona-input"},r.a.createElement(m.TextArea,{id:"persona-input",name:"persona",growVertically:!0,fill:!0,intent:o.persona&&i.persona?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.persona}),o.persona&&i.persona&&r.a.createElement("div",{className:"form-error"},o.persona)),r.a.createElement(m.FormGroup,{label:"Physical Description",labelInfo:"(required)",labelFor:"physical-description-input"},r.a.createElement(m.TextArea,{id:"physical-description-input",name:"physical_description",growVertically:!0,fill:!0,intent:o.physical_description&&i.physical_description?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.physical_description}),o.physical_description&&i.physical_description&&r.a.createElement("div",{className:"form-error"},o.physical_description)),r.a.createElement(m.FormGroup,{label:"Character Type",labelInfo:"(required)",labelFor:"char-type-input"},r.a.createElement(m.InputGroup,{id:"char-type-input",name:"char_type",intent:o.char_type&&i.char_type?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.char_type}),o.char_type&&i.char_type&&r.a.createElement("div",{className:"form-error"},o.char_type)),r.a.createElement(m.FormGroup,{label:"Base Character",labelInfo:"(required)",labelFor:"base-id-input"},r.a.createElement(B,{id:"base-id-input",name:"base_id",type:"base_".concat(a),errors:o.base_id,touched:i.base_id,setFieldTouched:l,formValue:t.base_id,handleChange:n}),o.base_id&&i.base_id&&r.a.createElement("div",{className:"form-error"},o.base_id)),r.a.createElement(m.FormGroup,{label:"Properties",labelInfo:"(required)",large:!0},r.a.createElement("div",{style:{marginLeft:"15px",width:"150px"}},r.a.createElement(m.Switch,{label:"Plural",name:"is_plural",onChange:function(e){var a=e.target.name;n(a,t[a]?0:1)},checked:!!t.is_plural,alignIndicator:m.Alignment.RIGHT}))),r.a.createElement(m.Button,{type:"reset",onClick:h,disabled:!c,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,type:"submit",onClick:p,disabled:!c||!s,style:{marginLeft:"15px"}},"Save Changes"))}))};var V={name:"",description:"",backstory:"",base_id:0},q=function(e){var t=e.initialInputs,n=e.handleSubmit,a=e.type;return r.a.createElement(_.a,{initialValues:t,validate:function(e){var t={};return e.name||(t.name="Required"),e.description||(t.description="Required"),e.backstory||(t.backstory="Required"),e.base_id||(t.base_id="Required"),t},onSubmit:n},(function(e){var t=e.values,n=e.setFieldValue,i=e.touched,l=e.setFieldTouched,o=e.errors,c=e.dirty,s=e.isValid,u=e.handleChange,d=e.handleBlur,p=e.handleSubmit,h=e.handleReset;return r.a.createElement("form",{"data-testid":"form"},r.a.createElement(m.FormGroup,{label:"Name",labelInfo:"(required)",labelFor:"name-input"},r.a.createElement(m.InputGroup,{id:"name-input",name:"name",intent:o.name&&i.name?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.name}),o.name&&i.name&&r.a.createElement("div",{className:"form-error"},o.name)),r.a.createElement(m.FormGroup,{label:"Description",labelInfo:"(required)",labelFor:"description-input"},r.a.createElement(m.TextArea,{id:"description-input",name:"description",growVertically:!0,fill:!0,intent:o.description&&i.description?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.description}),o.description&&i.description&&r.a.createElement("div",{className:"form-error"},o.description)),r.a.createElement(m.FormGroup,{label:"Backstory",labelInfo:"(required)",labelFor:"backstory-input"},r.a.createElement(m.TextArea,{id:"backstory-input",name:"backstory",growVertically:!0,fill:!0,intent:o.backstory&&i.backstory?m.Intent.DANGER:null,onBlur:d,onChange:u,value:t.backstory}),o.backstory&&i.backstory&&r.a.createElement("div",{className:"form-error"},o.backstory)),r.a.createElement(m.FormGroup,{label:"Base Room",labelInfo:"(required)",labelFor:"base-id-input"},r.a.createElement(B,{id:"base-id-input",name:"base_id",type:"base_".concat(a),errors:o.base_id,touched:i.base_id,setFieldTouched:l,formValue:t.base_id,handleChange:n}),o.base_id&&i.base_id&&r.a.createElement("div",{className:"form-error"},o.base_id)),r.a.createElement(m.Button,{type:"reset",onClick:h,disabled:!c,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,type:"submit",onClick:p,disabled:!c||!s,style:{marginLeft:"15px"}},"Save Changes"))}))},U=m.Toaster.create({position:m.Position.TOP});function H(e){var t=e.type,n=e.initialInputs,a=Object(s.f)(),i=function(){var e=Object(N.a)(k.a.mark((function e(n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("builder/entities/".concat(t),n).then((function(){a.push("/")}));case 2:U.show({intent:m.Intent.SUCCESS,message:"Successfully created entity"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();switch(t){case"object":return r.a.createElement(G,{type:t,initialInputs:n||P,handleSubmit:i});case"character":return r.a.createElement(M,{type:t,initialInputs:n||L,handleSubmit:i});case"room":return r.a.createElement(q,{type:t,initialInputs:n||V,handleSubmit:i});default:return"This entity cannot be created at the moment"}}var W=function(e){var t=e.location,n=r.a.useState(t.state?t.state.type:"object"),a=Object(u.a)(n,2),i=a[0],l=a[1];return r.a.createElement("div",null,r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading",style:{marginBottom:15}},"Create new entity"),r.a.createElement("div",{className:"bp3-text-large"},r.a.createElement("div",{style:{display:"flex",marginBottom:30}},r.a.createElement("span",{style:{marginRight:"20px"}},"Entity type:"),r.a.createElement(m.RadioGroup,{inline:!0,large:!0,onChange:function(e){t.state=void 0,l(e.target.value)},selectedValue:i},r.a.createElement(m.Radio,{"data-testid":"radio-object",label:"Object",value:"object"}),r.a.createElement(m.Radio,{"data-testid":"radio-character",label:"Character",value:"character"}),r.a.createElement(m.Radio,{"data-testid":"radio-room",label:"Room",value:"room"}))),r.a.createElement(H,{type:i,initialInputs:t.state?t.state.entity:void 0})))},Y=n(47),K=n(178),z=n.n(K);function J(e){var t=e.edits,n=e.status,a=e.reload,i=r.a.useState({expanded:-1,animating:0,nextState:-1}),l=Object(u.a)(i,2),o=l[0],c=l[1],s=r.a.useState({rows:[],all:0}),d=Object(u.a)(s,2),p=d[0],f=d[1],y=r.a.useState(void 0),g=Object(u.a)(y,2),v=g[0],x=g[1],O=r.a.useState(!1),C=Object(u.a)(O,2),w=C[0],I=C[1],S=r.a.useState([]),_=Object(u.a)(S,2),R=_[0],F=_[1];function T(e){"under review"===n&&(-1===o.expanded?c({expanded:e,animating:1,nextState:-1}):o.expanded===e?c({expanded:e,animating:3,nextState:-1}):c(Object(h.a)(Object(h.a)({},o),{},{animating:3,nextState:e})))}function A(){return(A=Object(N.a)(k.a.mark((function e(){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=R.map((function(e){return j("builder/edits/".concat(t[e].edit_id,"/").concat(v))})),e.next=3,Promise.all(n).then((function(){a()}));case 3:U.show({intent:m.Intent.SUCCESS,message:"Review submitted"});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t&&t.length>0&&0===p.rows.length&&f(Object(h.a)(Object(h.a)({},p),{},{rows:Object(b.fill)(Array(t.length),!1)}));var D=function(e){for(var t=[],n=0;n<p.rows.length;n++)p.rows[n]&&t.push(n);F(t),x(e),I(!0)};return void 0===t||0===t.length?r.a.createElement("span",null,"No edits found."):r.a.createElement(r.a.Fragment,null,r.a.createElement(m.Dialog,{icon:"info-sign",onClose:function(){return I(!1)},title:"Confirm edits to be ".concat("reject"===v?"rejected":"accepted"),isOpen:w,usePortal:!1},r.a.createElement("div",{className:m.Classes.DIALOG_BODY},r.a.createElement("table",{className:"bp3-html-table bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Edit ID"),r.a.createElement("th",null,"Entity ID"),r.a.createElement("th",null,"Edited Field"))),r.a.createElement("tbody",null,R.map((function(e,n){return r.a.createElement("tr",{key:n},r.a.createElement("td",null,t[e].edit_id),r.a.createElement("td",null,t[e].id),r.a.createElement("td",null,t[e].field))}))))),r.a.createElement("div",{className:m.Classes.DIALOG_FOOTER},r.a.createElement("div",{className:m.Classes.DIALOG_FOOTER_ACTIONS},r.a.createElement(m.Button,{onClick:function(){return I(!1)}},"Close"),r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,onClick:function(){return A.apply(this,arguments)}},"Confirm Edits")))),r.a.createElement("table",{"data-testid":"table-review",style:{width:"100%"},className:"bp3-html-table bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,"under review"===n&&r.a.createElement("th",{style:{textAlign:"center"}},r.a.createElement(m.Checkbox,{checked:p.all,indeterminate:-1===p.all,onClick:function(){var e=p.all?0:1,n=Object(b.fill)(Array(t.length),!!e);f({rows:n,all:e})}})),r.a.createElement("th",null,"Edit ID"),r.a.createElement("th",null,"Entity ID"),r.a.createElement("th",null,"Edited Field"),r.a.createElement("th",null,"Edit"))),r.a.createElement("tbody",null,t.map((function(e,t){return r.a.createElement(r.a.Fragment,{key:e.edit_id},r.a.createElement("tr",{"data-testid":"tr-review",style:{background:t%2===0?"rgba(191, 204, 214, 0.15)":void 0}},"under review"===n&&r.a.createElement("td",{style:{textAlign:"center"}},r.a.createElement(m.Checkbox,{checked:p.rows[t],onClick:function(){return function(e){var t=Object(Y.a)(p.rows);t[e]=!p.rows[e];var n=p.all;n=t.every((function(e){return!0===e}))?1:t.every((function(e){return!1===e}))?0:-1,f({rows:t,all:n})}(t)}})),r.a.createElement("td",{onClick:function(){return T(t)}},e.edit_id),r.a.createElement("td",{onClick:function(){return T(t)}},r.a.createElement("strong",null,e.id)),r.a.createElement("td",{onClick:function(){return T(t)}},e.field),r.a.createElement("td",{onClick:function(){return T(t)}},function(e,t){var n;if(isNaN(e)||isNaN(t)){var a=new z.a;n=a.diff_main(e,t),a.diff_cleanupSemantic(n)}else n=[[-1,+(e=0+e)],[1,+(t=0+t)]];return r.a.createElement(r.a.Fragment,null,n.map((function(e,t){switch(e[0]){case-1:return r.a.createElement("strike",{key:t,style:{color:"#FF7373"}}," ",e[1]," ");case 0:return r.a.createElement("strong",{key:t},e[1]);case 1:return r.a.createElement("strong",{key:t,style:{color:"#0F9960"}},e[1]);default:return r.a.createElement(r.a.Fragment,null)}})))}(e.unedited_value,e.edited_value))),r.a.createElement("tr",{style:{background:t%2===0?"rgba(191, 204, 214, 0.15)":void 0}},r.a.createElement("td",{colSpan:5,style:{display:o.expanded===t?void 0:"none",padding:0,cursor:"unset"}},r.a.createElement(E.a,{duration:500,height:o.expanded!==t||2!==o.animating&&0!==o.animating?0:"auto",easing:"ease",onAnimationEnd:function(){return c({nextState:-1,expanded:2===o.animating?t:o.nextState,animating:3===o.animating&&-1!==o.nextState?1:0})},animateOpacity:!0},o.expanded===t&&r.a.createElement(Q,{edit:e,state:o,setState:c,reload:a})))))})))),"under review"===n&&r.a.createElement("div",{style:{display:"flex",margin:"10px",justifyContent:"flex-end"}},r.a.createElement(m.Button,{intent:m.Intent.DANGER,type:"submit",onClick:function(){return D("reject")},style:{marginLeft:"15px"},disabled:!p.all},"Reject"),r.a.createElement(m.Button,{intent:m.Intent.SUCCESS,type:"submit",onClick:function(){return D("accept/accepted")},style:{marginLeft:"15px"},disabled:!p.all},"Accept")))}function Q(e){var t=e.edit,n=e.state,a=e.setState,i=e.reload,l=O(v,"/entities/".concat(t.id)),o=l.loading,c=l.result;return r.a.useEffect((function(){c&&1===n.animating&&a(Object(h.a)(Object(h.a)({},n),{},{animating:2}))}),[o,a,n,c]),r.a.createElement(r.a.Fragment,null,o?r.a.createElement(r.a.Fragment,null):r.a.createElement(X,{edit:t,entity:c.entity,reload:i}))}function X(e){var t=e.edit,n=e.entity,a=e.reload;return delete n.id,r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{"data-testid":"dropdown",style:{display:"flex",flexDirection:"row",padding:"20px 20px 0 20px",alignItems:"center"}},r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"50%",maxWidth:"30vw",margin:"auto"}},Object.keys(n).map((function(e,a){return r.a.createElement("p",{key:a,style:{color:e===t.field?"#DB3737":void 0}},r.a.createElement("strong",null,Object(b.startCase)(e)),": ",n[e])})))),r.a.createElement("div",{style:{height:"100%",fontSize:"20px",color:"#394B59"}},"\u2794"),r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"50%",maxWidth:"30vw",margin:"auto"}},Object.keys(n).map((function(e,a){return r.a.createElement("p",{key:a,style:{color:e===t.field?"#0F9960":void 0}},r.a.createElement("strong",null,Object(b.startCase)(e)),":"," ",e===t.field?t.edited_value:n[e])}))))),r.a.createElement("div",{style:{display:"flex",padding:"0 20px 20px 20px",justifyContent:"flex-end"}},r.a.createElement(m.Button,{intent:m.Intent.DANGER,type:"submit",onClick:function(){return j("builder/edits/".concat(t.edit_id,"/reject")).then((function(){return a()}))},style:{marginLeft:"15px"}},"Reject Edit"),r.a.createElement(m.Button,{intent:m.Intent.SUCCESS,type:"submit",onClick:function(){return j("builder/edits/".concat(t.edit_id,"/accept/accepted")).then((function(){return a()}))},style:{marginLeft:"15px"}},"Accept Edit")))}var Z=function(){var e=r.a.useState("under review"),t=Object(u.a)(e,2),n=t[0],a=t[1],i=O(v,"/edits?expand=true&status=".concat(n)),l=i.loading,o=i.result,c=i.reload;return r.a.createElement("div",null,r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading"},"Review"),r.a.createElement("div",{className:"bp3-text-large"},"Review pending, accepted, and rejected edits to the LIGHT database."),r.a.createElement("br",null),r.a.createElement("div",{style:{display:"flex",marginBottom:"30px"}},r.a.createElement("span",{style:{margin:"0px 20px 0px 40px"}},"Searching category:"),r.a.createElement(m.RadioGroup,{inline:!0,large:!0,onChange:function(e){return a(e.target.value)},selectedValue:n},r.a.createElement(m.Radio,{"data-testid":"radio-under-review",label:"Under Review",value:"under review"}),r.a.createElement(m.Radio,{"data-testid":"radio-accepted",label:"Accepted",value:"accepted"}),r.a.createElement(m.Radio,{"data-testid":"radio-rejected",label:"Rejected",value:"rejected"}))),l?r.a.createElement(m.Spinner,{intent:m.Intent.PRIMARY}):r.a.createElement(J,{edits:o,status:n,reload:c}))},$=n(66),ee=[m.Colors.GRAY3,m.Colors.VIOLET5,m.Colors.RED5,m.Colors.SEPIA5,m.Colors.GOLD5,m.Colors.FOREST5,m.Colors.BLUE5],te=["grass","field","plains","forest","land","gardens","meadow","woods","jungle","swamp","green"],ne=["water","lake","river","ocean","sea","pond","lagoon","shore","blue"],ae=["castle","fortress","church","cathedral","tower","building","cave","gray","grey"],re=["king","queen","palace","purple"],ie=["brick","fire","red"],le=["path","road","bridge","brown"],oe=["farm","cottage","sand","beach","yellow","gold"];function ce(e,t){var n=e.toLowerCase();return te.some((function(e){return n.indexOf(e)>-1}))?m.Colors.FOREST5:ne.some((function(e){return n.indexOf(e)>-1}))?m.Colors.BLUE5:ie.some((function(e){return n.indexOf(e)>-1}))?m.Colors.RED5:le.some((function(e){return n.indexOf(e)>-1}))?m.Colors.SEPIA5:oe.some((function(e){return n.indexOf(e)>-1}))?m.Colors.GOLD5:ae.some((function(e){return n.indexOf(e)>-1}))?m.Colors.GRAY3:re.some((function(e){return n.indexOf(e)>-1}))?m.Colors.VIOLET5:t}function se(e){return 0===e.indexOf("#")&&(e=e.slice(1)),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),.299*parseInt(e.slice(0,2),16)+.587*parseInt(e.slice(2,4),16)+.114*parseInt(e.slice(4,6),16)>150?"#182026":"#F5F8FA"}function ue(e){var t=$.b.search(e);if(t[0])return t[0].native;for(var n=e.split(" "),a=0;a<n.length;a++){var r=n[a];if("s"===n[a].charAt(n[a].length-1)&&(r=n[a].substring(0,n[a].length-1)),(t=$.b.search(r))[0])return t[0].native}return"\u2753"}var me=function(e,t){switch(t.type){case"SET_MAP":return t.map;case"SET_TILE":return e.map((function(e,n){return n===t.floor?Object(h.a)(Object(h.a)({},e),{},{tiles:Object(h.a)(Object(h.a)({},e.tiles),{},Object(o.a)({},"".concat(t.x," ").concat(t.y),t.newTile))}):e}));case"EDIT_FLOOR_NAME":return e.map((function(e,n){return n===t.floor?Object(h.a)(Object(h.a)({},e),{},{name:t.name}):e}));default:return e}},de=function(e,t){switch(t.type){case"SET_ALL":return t.entities;case"ADD_ENTITY":var n;return Object.assign({},e,(n={},Object(o.a)(n,t.entityType,Object(h.a)(Object(h.a)({},e[t.entityType]),{},Object(o.a)({},e.nextID,t.data))),Object(o.a)(n,"nextID",e.nextID+1),n));case"EDIT_ENTITY":return Object(b.merge)(e,Object(o.a)({},t.entityType,Object(o.a)({},t.id,t.data)));default:return e}};function pe(e){var t=r.a.useState(e?e.data.dimensions:{name:null,height:3,width:3,floors:1}),n=Object(u.a)(t,2),a=n[0],i=n[1],l=e?e.data.map:[{name:"1F",tiles:{},walls:{}}],c=r.a.useReducer(me,l),s=Object(u.a)(c,2),m=s[0],d=s[1],p=r.a.useReducer(de,e?e.data.entities:{room:{},character:{},object:{},nextID:1}),f=Object(u.a)(p,2),E=f[0],y=f[1],g=r.a.useState(0),v=Object(u.a)(g,2),x=v[0],O=v[1];r.a.useEffect((function(){for(var e=[],t=0;t<a.floors;t++)e.push(m[t]?m[t]:{name:"".concat(t+1,"F"),tiles:{},walls:{}});d({type:"SET_MAP",map:e})}),[a]);var j=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x;n[a]&&n[a].tiles["".concat(e," ").concat(t)]&&(delete n[a].tiles["".concat(e," ").concat(t)].stairDown,delete n[a].tiles["".concat(e," ").concat(t)].stairUp),n[a-1]&&n[a-1].tiles["".concat(e," ").concat(t)]&&delete n[a-1].tiles["".concat(e," ").concat(t)].stairUp,n[a+1]&&n[a+1].tiles["".concat(e," ").concat(t)]&&delete n[a+1].tiles["".concat(e," ").concat(t)].stairDown},C=function(e,t){Object(b.isEmpty)(e)||Object(b.isEmpty)(e.tiles)||Object.keys(e.tiles).forEach((function(n){Object(b.isEmpty)(e.tiles[n])||delete e.tiles[n][t]}))};return{floorManager:{setCurrFloor:O,addFloor:function(){i(Object(h.a)(Object(h.a)({},a),{},{floors:a.floors+1}))},deleteFloor:function(e){var t=m.filter((function(t,n){return n!==e}));C(t[e-1],"stairUp"),C(t[e],"stairDown"),d({type:"SET_MAP",map:t}),x>=a.floors-1&&O(0),i(Object(h.a)(Object(h.a)({},a),{},{floors:a.floors-1}))},reorderFloors:function(e,t){var n=m[e],r=m.filter((function(t,n){return n!==e}));C(n,"stairUp"),C(n,"stairDown"),C(r[e-1],"stairUp"),C(r[e],"stairDown");for(var i=[],l=0;l<a.floors;l++)i.push(l<t?r[l]:l===t?n:r[l-1]);C(i[t-1],"stairUp"),C(i[t+1],"stairDown"),d({type:"SET_MAP",map:i}),x===e&&O(t)},editFloorName:function(e,t){d({type:"EDIT_FLOOR_NAME",name:e,floor:t})}},currFloor:x,map:m,filteredMap:function(){for(var e=[],t=0;t<m.length;t++){var n={name:m[t].name,walls:m[t].walls},r={};for(var i in m[t].tiles){var l=i.split(" "),o=Object(u.a)(l,2),c=o[0],s=o[1];c<a.width&&s<a.height&&(r[i]=m[t].tiles[i])}n.tiles=r,e.push(n)}return e},setTile:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x;d({type:"SET_TILE",x:e,y:t,newTile:n,floor:a})},clearTile:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x,a=Object(b.cloneDeep)(m);j(e,t,a),delete a[n].tiles["".concat(e," ").concat(t)],d({type:"SET_MAP",map:a})},swapTiles:function(e,t,n,a){d({type:"SET_MAP",map:m.map((function(r,i){var l;return i===x?(j(e,t),j(n,a),Object(h.a)(Object(h.a)({},r),{},{tiles:Object(h.a)(Object(h.a)({},r.tiles),{},(l={},Object(o.a)(l,"".concat(e," ").concat(t),r.tiles["".concat(n," ").concat(a)]),Object(o.a)(l,"".concat(n," ").concat(a),r.tiles["".concat(e," ").concat(t)]),l))})):r}))})},getTileAt:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x;try{return m[n].tiles["".concat(e," ").concat(t)]}catch(a){return{}}},toggleWall:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x;if(m[t].walls[e]){var n=Object(b.cloneDeep)(m);delete n[t].walls[e],d({type:"SET_MAP",map:n})}else d({type:"SET_MAP",map:m.map((function(n,a){return a===t?Object(h.a)(Object(h.a)({},n),{},{walls:Object(h.a)(Object(h.a)({},n.walls),{},Object(o.a)({},e,!0))}):n}))})},dimensions:a,setDimensions:i,addRowTop:function(){d({type:"SET_MAP",map:m.map((function(e){var t=Object.keys(e.tiles),n={};t.forEach((function(t){var a=t.split(" "),r=Object(u.a)(a,2),i=r[0],l=r[1];n["".concat(i," ").concat(parseInt(l)+1)]=e.tiles[t]}));var a=Object.keys(e.walls),r={};return a.forEach((function(t){var n=t.split("|"),a=Object(u.a)(n,2),i=a[0],l=a[1],o=i.split(" "),c=Object(u.a)(o,2),s=c[0],m=c[1],d=l.split(" "),p=Object(u.a)(d,2),h=p[0],f=p[1];r["".concat(s," ").concat(parseInt(m)+1,"|").concat(h," ").concat(parseInt(f)+1)]=e.walls[t]})),Object(h.a)(Object(h.a)({},e),{},{tiles:n,walls:r})}))}),i(Object(h.a)(Object(h.a)({},a),{},{height:a.height+1}))},addRowBot:function(){i(Object(h.a)(Object(h.a)({},a),{},{height:a.height+1}))},addColFront:function(){d({type:"SET_MAP",map:m.map((function(e){var t=Object.keys(e.tiles),n={};t.forEach((function(t){var a=t.split(" "),r=Object(u.a)(a,2),i=r[0],l=r[1];n["".concat(parseInt(i)+1," ").concat(l)]=e.tiles[t]}));var a=Object.keys(e.walls),r={};return a.forEach((function(t){var n=t.split("|"),a=Object(u.a)(n,2),i=a[0],l=a[1],o=i.split(" "),c=Object(u.a)(o,2),s=c[0],m=c[1],d=l.split(" "),p=Object(u.a)(d,2),h=p[0],f=p[1];r["".concat(parseInt(s)+1," ").concat(m,"|").concat(parseInt(h)+1," ").concat(f)]=e.walls[t]})),Object(h.a)(Object(h.a)({},e),{},{tiles:n,walls:r})}))}),i(Object(h.a)(Object(h.a)({},a),{},{width:a.width+1}))},addColEnd:function(){i(Object(h.a)(Object(h.a)({},a),{},{width:a.width+1}))},entities:E,editEntity:function(e,t,n){y({type:"EDIT_ENTITY",id:e,data:t,entityType:n})},findOrAddEntity:function(e,t){for(var n in E[t])if(T()(E[t][n],e))return n;return function(e,t){var n=E.nextID;return y({type:"ADD_ENTITY",data:e,entityType:t}),n}(e,t)},exportWorld:function(){var e=JSON.stringify({dimensions:a,map:m,entities:E},null,"\t"),t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","world-".concat(Date.now().toString(),".json")),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}var he=n(5),fe=n.n(he),Ee="neighbors to the west",be="neighbors to the east",ye="neighbors to the north",ge="neighbors to the south",ve="neighbors above",xe="neighbors below",Oe="contains";function je(e){var t=e.isOpen,n=(e.setIsOverlayOpen,O(v,"/worlds/")),a=n.loading,i=n.result,l=(n.reload,r.a.useState(void 0)),o=Object(u.a)(l,2),c=o[0],d=o[1],p=function(){var e=Object(N.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(v.host,":").concat(v.port,"/builder/world/delete/").concat(t),{method:"DELETE"});case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(N.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(v.host,":").concat(v.port,"/builder/world/autosave/"),{method:"GET"});case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,U.show({intent:m.Intent.SUCCESS,message:"Done loading!"}),d(n);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(e,t,n,a){var r=e[n][t];r.emoji=ue(r.name),a[t]=n},E=function(e,t){e.forEach((function(e){t[e.room]={x:e.x_coordinate,y:e.y_coordinate,floor:e.floor,color:e.color,room:e.room,characters:[],objects:[],walls:[!0,!0,!0,!0]}}))},b=function(e,t,n){var a={};a[Ee]=0,a[be]=1,a[ye]=2,a[ge]=3,e.forEach((function(e){if(e.type===Oe)if("character"===n[e.dst])t[e.src].characters.push(e.dst);else{if("object"!==n[e.dst])throw"Cannot contain types other than character and object";t[e.src].objects.push(e.dst)}else e.type===ve?t[e.src].stairUp=!0:e.type===xe?t[e.src].stairDown=!0:t[e.src].walls[a[e.type]]=!1}))},y=function(e,t){Object.keys(e).forEach((function(n){var a=e[n],r={room:a.room,characters:a.characters,objects:a.objects,color:a.color};a.stairUp?r.stairUp=!0:a.stairDown&&(r.stairDown=!0),t[a.floor].tiles[a.x+" "+a.y]=r,function(e,t){for(var n=["".concat(e.x-1," ").concat(e.y),"".concat(e.x+1," ").concat(e.y),"".concat(e.x," ").concat(e.y-1),"".concat(e.x," ").concat(e.y+1)],a="".concat(e.x," ").concat(e.y),r=0;r<e.walls.length;r++)if(e.walls[r]){var i=n[r];i<a?t[e.floor].walls[i+"|"+a]=!0:t[e.floor].walls[a+"|"+i]=!0}}(a,t)}))},g=function(){var e=Object(N.a)(k.a.mark((function e(t){var n,a,r,i,l,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U.show({intent:m.Intent.PRIMARY,message:"Loading your world...",timeout:1e4}),e.next=3,fetch("".concat(v.host,":").concat(v.port,"/builder/world/").concat(t),{method:"GET",headers:{"Content-Type":"application/json"}});case 3:return n=e.sent,e.next=6,n.json();case 6:for(a=e.sent,r={dimensions:{id:a.dimensions.id,name:a.dimensions.name,height:a.dimensions.height,width:a.dimensions.width,floors:a.dimensions.floors},map:[{name:"1F",tiles:{},walls:{}}],entities:a.entities},i=2;r.map.length<r.dimensions.floors;)r.map.push({name:i+"F",tiles:{},walls:{}}),i+=1;l={},o={},Object.keys(r.entities).forEach((function(e){Object.keys(r.entities[e]).forEach((function(t){f(r.entities,t,e,l)}))})),E(a.map.tiles,o),b(a.map.edges,o,l),y(o,r.map),U.show({intent:m.Intent.SUCCESS,message:"Done loading!"}),d(r);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();if(t){if(a)return r.a.createElement(m.Spinner,{intent:m.Intent.PRIMARY});var x=i.data,j=null;return j=null==i.auto?r.a.createElement(r.a.Fragment,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("strong",null,"Autosave")),r.a.createElement("td",null," ",i.auto," "),r.a.createElement("td",null),r.a.createElement("td",null),r.a.createElement("td",null),r.a.createElement("td",null,r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,type:"submit",onClick:function(){return h()}},"Load")),r.a.createElement("td",null))),r.a.createElement(r.a.Fragment,null,r.a.createElement("table",{"data-testid":"world-review",style:{width:"100%"},className:"bp3-html-table bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"World ID"),r.a.createElement("th",null,"World Name"),r.a.createElement("th",null,"Height"),r.a.createElement("th",null,"Width"),r.a.createElement("th",null,"Number of Floors"),r.a.createElement("th",null,"Load"),r.a.createElement("th",null,"Delete"))),r.a.createElement("tbody",null,x.map((function(e){return r.a.createElement(r.a.Fragment,{key:e.id},r.a.createElement("tr",{"data-testid":"tr-review",style:{background:void 0}},r.a.createElement("td",null,e.id),r.a.createElement("td",null,r.a.createElement("strong",null,e.name)),r.a.createElement("td",null,e.height),r.a.createElement("td",null,e.width),r.a.createElement("td",null,e.num_floors),r.a.createElement("td",null,r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,type:"submit",onClick:function(){return g(e.id)}},"Load")),r.a.createElement("td",null,r.a.createElement(m.Button,{intent:m.Intent.DANGER,type:"submit",onClick:function(){return p(e.id)}},"Delete"))))})),j)),c&&r.a.createElement(s.a,{to:{pathname:"/world_builder",state:{data:c}}}))}return r.a.createElement(r.a.Fragment,null)}function Ce(){return(Ce=Object(N.a)(k.a.mark((function e(t){var n,a,r,i,l;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ie(t);case 2:return n=e.sent,a={world_id:n},e.next=6,j("game/new/",a);case 6:return r=e.sent,e.next=9,r.json();case 9:return i=e.sent,l="".concat(v.host,":").concat(v.port,"/?id=").concat(i),window.open(l),e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(){return(we=Object(N.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(b.cloneDeep)(t),t={data:n},e.next=4,j("builder/world/autosave/",t);case 4:e.sent;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e){return Se.apply(this,arguments)}function Se(){return(Se=Object(N.a)(k.a.mark((function e(t){var n,a,r,i,l,o,c,s,d;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"id"in(n={dimensions:Object(b.cloneDeep)(t.dimensions),map:{tiles:[],edges:[]},entities:Object(b.cloneDeep)(t.entities)}).dimensions||(n.dimensions.id=null),a=t.filteredMap(),r=[];for(i=0;i<a.length;i++)for(c in l=a[i].tiles,o=function(e){var t=Object(b.cloneDeep)(l[e]),o=e.split(" ").map((function(e){return parseInt(e)})),c=Object(u.a)(o,2),s=c[0],m=c[1],d=t.room;l[e].characters.forEach((function(e){r.push({src:d,dst:e,type:Oe})})),l[e].objects.forEach((function(e){r.push({src:d,dst:e,type:Oe})})),l[e].stairUp&&(delete t.stairUp,r.push({src:d,dst:a[i+1].tiles[e].room,type:ve})),l[e].stairDown&&(delete t.stairDown,r.push({src:d,dst:a[i-1].tiles[e].room,type:xe}));var p=["".concat(s-1," ").concat(m),"".concat(s+1," ").concat(m),"".concat(s," ").concat(m-1),"".concat(s," ").concat(m+1)],h=[Ee,be,ye,ge],f=function(t){var n=h[t],o=p[t];Object.keys(a[i].walls).some((function(t){return t.includes(o)&&t.includes(e)}))||Object(b.isEmpty)(l[o])||r.push({src:d,dst:a[i].tiles[o].room,type:n})};for(var E in p)f(E);t.x_coordinate=s,t.y_coordinate=m,t.floor=i,delete t.characters,delete t.objects,n.map.tiles.push(t)},l)o(c);return n.map.edges=r,e.next=8,j("builder/world/",n);case 8:return s=e.sent,e.next=11,s.json();case 11:return d=e.sent,t.dimensions.id=d,U.show({intent:m.Intent.SUCCESS,message:"World Saved! "}),e.abrupt("return",d);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ke=function(e){var t=e.isOverlayOpen,n=e.setIsOverlayOpen,a=fe()(m.Classes.CARD,m.Classes.ELEVATION_4);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(m.Overlay,{className:m.Classes.OVERLAY_SCROLL_CONTAINER,isOpen:t,onClose:function(){return n(!t)}},r.a.createElement("div",{className:a,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},r.a.createElement(je,{isOpen:t,setIsOverlayOpen:n}),r.a.createElement(m.Button,{intent:m.Intent.DANGER,onClick:function(){return n(!t)},style:{margin:"10px"}},"Close")))))},Ne=n(181),_e=n.n(Ne);var Re=function(e){var t=e.colors,n=e.value,a=e.handleChange,i=e.advanced;return r.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},t.map((function(e,t){return r.a.createElement("div",{key:t,style:{display:"inline-block",maxWidth:"20px",width:"20px",maxHeight:"20px",height:"20px",borderRadius:"5px",background:e,borderColor:"#5C7080",borderStyle:n===e?"solid":"",borderWidth:"2px",boxShadow:n===e?"0px 0px 8px ".concat(n):"",margin:"2px",cursor:"pointer"},onClick:function(){return a("color",e)}})})),i&&r.a.createElement("input",{style:{maxHeight:"20px",maxWidth:"20px",height:"20px",width:"20px",borderRadius:"5px",padding:"0px 0px 0px 0px"},type:"color",value:n,onChange:function(e){return a("color",e.target.value)}}))},Fe=n(310);function Te(e){var t=e.filteredItems,n=e.renderItem,a=t.slice(0,100);return r.a.createElement(m.Menu,null,t.length>0?r.a.createElement(r.a.Fragment,null,a.map((function(e,t){return n(e,t)})),t.length>100&&r.a.createElement(m.MenuItem,{style:{textAlign:"center"},disabled:!0,text:"..."})):r.a.createElement(m.MenuItem,{disabled:!0,text:"No results."}))}var Ae=function(e){var t=e.id,n=e.name,a=e.errors,i=e.touched,l=e.setFieldTouched,o=e.formValue,c=e.handleChange,s=e.type,d=e.tooltip,p=e.onItemSelect,h=e.entities,f=r.a.useState([]),E=Object(u.a)(f,2),b=E[0],y=E[1],g=r.a.useState(""),x=Object(u.a)(g,2),j=x[0],C=x[1],w=r.a.useState([]),I=Object(u.a)(w,2),S=I[0],k=I[1],N=O(v,"/entities/".concat(s,"?search=").concat(j)),_=N.loading,R=N.result;return r.a.useEffect((function(){if(!_){if(h){var e=Object.values(h[s]),t=e.concat(R.slice(0,100+e.length+1)).filter((function(e,t,n){return n.findIndex((function(t){return T()(t,e)}))===t}));return y(t)}return y(R)}}),[R,_,h,s]),r.a.useEffect((function(){k(o)}),[o,b]),r.a.createElement("div",{onBlur:function(e){return l(n)}},r.a.createElement(Fe.a,{id:t,name:n,items:b,itemRenderer:function(e,t){var n=t.handleClick,a=t.modifiers,i=t.index;return a.matchesPredicate?r.a.createElement(m.MenuItem,{active:a.active,key:i,onClick:n,text:d?r.a.createElement(m.Tooltip,{content:e[d],targetTagName:"div",popoverClassName:"popover-tooltip",position:m.Position.TOP_RIGHT,usePortal:!0},e.name):e.name,shouldDismissPopover:!1}):null},itemListRenderer:Te,tagInputProps:{intent:a&&i?m.Intent.DANGER:null,"data-testid":"base-multi-select",onRemove:function(e,t){var a=S.filter((function(e,n){return n!==t})),r=o.filter((function(e,n){return n!==t}));k(a),c(n,r)}},onItemSelect:function(e){if(p){var t=p(e,s);k([].concat(Object(Y.a)(S),[t])),c(n,[].concat(Object(Y.a)(o),[t]),e)}else k([].concat(Object(Y.a)(S),[e])),c(n,[].concat(Object(Y.a)(o),[e.id]));C("")},popoverProps:{usePortal:!1},itemPredicate:function(e,t,n,a){var r=t.name.toLowerCase(),i=e.toLowerCase();if(a)return r===i;var l="";for(var o in t)l+=t[o]+". ";return l.toLowerCase().indexOf(i)>=0},selectedItems:S,query:j,onQueryChange:function(e){return C(e)},resetOnQuery:!0,tagRenderer:function(e){return h&&h[s][e]?h[s][e].name:e.name}}))},De={room:void 0,characters:[],objects:[],color:ee[0]};var Be=function(e){var t=e.initialInputs,n=e.onSubmit,a=e.onClear,i=e.entities,l=e.findOrAddEntity,o=e.setShowAdvanced,c=e.selected,s=e.setSelected;return r.a.createElement(_.a,{initialValues:Object(b.isEmpty)(t)?De:t,validate:function(e){var t={};return isNaN(e.room)&&(t.room="Required"),t},onSubmit:n},(function(e){var t=e.values,n=e.setFieldValue,u=e.touched,d=e.setFieldTouched,p=e.errors,f=e.dirty,E=e.isValid,y=e.handleSubmit,g=e.handleReset;return r.a.createElement("form",null,r.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignContent:"stretch",justifyContent:"space-between"}},r.a.createElement("h5",{style:{fontSize:"18px"},className:m.Classes.HEADING},r.a.createElement(m.Icon,{color:"#5c7080",iconSize:20,icon:"edit"})," Tile Editor"),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"},onClick:function(){s(Object(h.a)(Object(h.a)({},c),{},{data:Object(h.a)({},t)})),o(!0)}},r.a.createElement(m.Button,{icon:"build"}))),r.a.createElement(m.Divider,null),r.a.createElement(m.FormGroup,{label:"Room",labelInfo:"(required)",labelFor:"room-input"},r.a.createElement(B,{id:"room-input",name:"room",type:"room",errors:p.room,touched:u.room,setFieldTouched:d,formValue:t.room,handleChange:function(e,a,r){n(e,a),n("color",ce(r.name,t.color))},entities:i,onItemSelect:l}),p.room&&u.room&&r.a.createElement("div",{className:"form-error"},p.room)),r.a.createElement(Re,{colors:ee,value:t.color,handleChange:n}),r.a.createElement(m.FormGroup,{label:"Characters in Room",labelFor:"characters-input"},r.a.createElement(Ae,{id:"characters-input",name:"characters",type:"character",errors:p.characters,touched:u.characters,setFieldTouched:d,formValue:t.characters,handleChange:n,tooltip:"persona",entities:i,onItemSelect:function(e,t){return e.emoji=ue(e.name),l(e,t)}}),p.characters&&u.characters&&r.a.createElement("div",{className:"form-error"},p.characters)),r.a.createElement(m.FormGroup,{label:"Objects in Room",labelFor:"objects-input"},r.a.createElement(Ae,{id:"objects-input",name:"objects",type:"object",errors:p.objects,touched:u.objects,setFieldTouched:d,formValue:t.objects,handleChange:n,tooltip:"physical_description",entities:i,onItemSelect:function(e,t){return e.emoji=ue(e.name),l(e,t)}}),p.objects&&u.objects&&r.a.createElement("div",{className:"form-error"},p.objects)),r.a.createElement(m.Button,{type:"reset",onClick:a,disabled:!(!isNaN(t.room)||!Object(b.isEmpty)(t.characters)||!Object(b.isEmpty)(t.objects)),style:{marginRight:"15px"}},"Clear"),r.a.createElement(m.Button,{type:"reset",onClick:g,disabled:!f,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,type:"submit",onClick:y,disabled:!f||!E,style:{marginLeft:"15px"}},"Save Changes"))}))};var Pe=function(e){var t=e.x,n=e.y,a=e.tile,i=e.selected,l=e.setSelected,o=e.showAdvanced,c=e.setShowAdvanced,s=e.tileStyle,u=e.state,d=function(e,r){e.stopPropagation();var i=!a[r],l=Object(b.cloneDeep)(a);l[r]=i,u.setTile(t,n,l);var o=u.currFloor+("stairDown"===r?-1:1),c=Object(b.cloneDeep)(u.getTileAt(t,n,o));c["stairDown"===r?"stairUp":"stairDown"]=i,u.setTile(t,n,c,o)},p=se(a&&!isNaN(a.room)&&a.color?a.color:"#ced9e0");return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.Icon,{color:p,className:"react-grid-item-handle + ".concat(Object(b.isEmpty)(a)?"disabled":""),icon:"drag-handle-horizontal"}),!Object(b.isEmpty)(u.getTileAt(t,n,u.currFloor-1))&&r.a.createElement(m.Icon,{color:p,onClick:Object(b.isEmpty)(a)?void 0:function(e){return d(e,"stairDown")},className:Object(b.isEmpty)(a)?"disabled":"",style:{opacity:!Object(b.isEmpty)(a)&&a.stairDown?1:.35,position:"absolute",bottom:"5px",left:"5px"},icon:"arrow-bottom-left"}),!Object(b.isEmpty)(u.getTileAt(t,n,u.currFloor+1))&&r.a.createElement(m.Icon,{color:p,onClick:Object(b.isEmpty)(a)?void 0:function(e){return d(e,"stairUp")},className:Object(b.isEmpty)(a)?"disabled":"",style:{opacity:!Object(b.isEmpty)(a)&&a.stairUp?1:.35,position:"absolute",top:"5px",right:"5px"},icon:"arrow-top-right"}),r.a.createElement(m.Popover,{isOpen:!!i&&i.x===t&&i.y===n&&!o,onClose:function(){o||l(null)},usePortal:!0},r.a.createElement("div",{className:"react-grid-item-content",style:Object(h.a)(Object(h.a)({},s),{},{backgroundColor:a&&a.color?a.color:""})},r.a.createElement("div",{className:"center",style:{color:p,width:"100%",maxHeight:s.maxHeight-20,overflow:"hidden"}},r.a.createElement("p",null,Object(b.isEmpty)(a)?"":u.entities.room[a.room].name),r.a.createElement("p",null,Object(b.isEmpty)(a)?"":a.characters.map((function(e){return r.a.createElement(m.Tooltip,{content:u.entities.character[e].name},u.entities.character[e].emoji)}))),r.a.createElement("p",null,Object(b.isEmpty)(a)?"":a.objects.map((function(e){return r.a.createElement(m.Tooltip,{content:u.entities.object[e].name},u.entities.object[e].emoji)}))))),r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement(Be,{initialInputs:a,onSubmit:function(e){u.setTile(t,n,Object(h.a)(Object(h.a)({},a),e)),l(null)},onClear:function(){u.clearTile(t,n),l(null)},entities:u.entities,findOrAddEntity:u.findOrAddEntity,setSelected:l,selected:i,setShowAdvanced:c}))))};n(299);function Ge(e){var t=e.initialOpen,n=void 0===t||t,a=e.children,i=e.title,l=r.a.useState(n),o=Object(u.a)(l,2),c=o[0],s=o[1];return r.a.createElement("div",{style:{margin:"0 0 10px 0"}},r.a.createElement("div",{onClick:function(){return s(!c)},className:"hideable-header ".concat(c?"":"hidden")},r.a.createElement(m.Icon,{className:"hideable-arrow ".concat(c?"":"hidden"),icon:"chevron-down"})," ",i),r.a.createElement(E.a,{duration:500,height:c?"auto":0,easing:"ease",animateOpacity:!0},r.a.createElement("div",{className:"hideable-content"},a)))}function Le(e){var t=e.columnNames,n=e.columnKeys,a=e.items,i=e.entities,l=e.handleEdit,o=e.handleDuplicate,c=e.handleDelete,s=e.type,d=e.editEntity;function p(e){var t=e.item,n=r.a.useState(!1),a=Object(u.a)(n,2),l=a[0],o=a[1];return r.a.createElement(m.Popover,{interactionKind:m.PopoverInteractionKind.CLICK,onInteraction:function(e){return o(e)},isOpen:l,wrapperTagName:"td"},r.a.createElement("div",{style:{height:"100%",width:"100%"}},i[s][t].emoji||"\u2753"),r.a.createElement($.a,{onSelect:function(e){var n=Object(b.cloneDeep)(i[s][t]);n.emoji=e.native,d(t,n,s),o(!1)}}))}return r.a.createElement(r.a.Fragment,null,!Object(b.isEmpty)(a)&&r.a.createElement("table",{"data-testid":"table-explore",style:{width:"100%"},className:"bp3-html-table bp3-html-table-striped bp3-html-table-condensed bp3-interactive"},r.a.createElement("thead",null,r.a.createElement("tr",null,t.map((function(e,t){return r.a.createElement("th",{key:t},e)})),r.a.createElement("th",null,"Actions"))),r.a.createElement("tbody",null,a.map((function(e,t){return r.a.createElement(r.a.Fragment,{key:t},r.a.createElement("tr",null,n.map((function(t){return"emoji"===t?r.a.createElement(p,{item:e,key:t}):r.a.createElement("td",{key:t},i[s][e][t])})),r.a.createElement("td",null,r.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},r.a.createElement(m.Button,{onClick:function(){return l(e,i[s][e])},icon:"edit",minimal:!0}),r.a.createElement(m.Button,{onClick:function(){return o(i[s][e])},icon:"duplicate",minimal:!0}),r.a.createElement(m.Button,{onClick:function(){return c(t)},icon:"trash",minimal:!0})))))})))))}var Me={BASE:0,CHOOSE:1,SELECT_FROM_EXISTING:2,CREATE_NEW:3,EDIT:4,DUPLICATE:5};function Ve(e){var t=e.initialState,n=void 0===t?Me.BASE:t,a=e.handleChange,i=e.name,l=e.type,o=e.formValue,c=e.SelectFromExisting,s=e.selectFromExistingProps,d=e.Form,p=e.formProps,h=e.handleCreateSubmit,f=e.handleEditSubmit,E=e.Selected,b=e.selectedProps,y=r.a.useState(n),g=Object(u.a)(y,2),v=g[0],x=g[1],O=r.a.useState(void 0),j=Object(u.a)(O,2),C=j[0],w=j[1],I=r.a.useState(void 0),S=Object(u.a)(I,2),k=S[0],N=S[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(E,Object.assign({},b,{handleEdit:function(e,t){w({id:e,data:t}),x(Me.EDIT)},handleDuplicate:function(e){N(e),x(Me.DUPLICATE)},handleDelete:function(e){Array.isArray(o)?(o.splice(e,1),a(i,o)):a(i,void 0)}})),v===Me.CHOOSE?r.a.createElement("div",{style:{display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",padding:"5px"}},r.a.createElement(m.Button,{onClick:function(){return x(Me.SELECT_FROM_EXISTING)},style:{margin:"5px"}},"Select from existing"),r.a.createElement("span",{style:{margin:"5px"}}," OR "),r.a.createElement(m.Button,{onClick:function(){return x(Me.CREATE_NEW)},style:{margin:"5px"}},"Create New")):v===Me.SELECT_FROM_EXISTING?r.a.createElement("div",null,r.a.createElement(m.Button,{onClick:function(){return x(n)},icon:"chevron-left",minimal:!0}),r.a.createElement(c,Object.assign({},s,{name:i,type:l,formValue:o}))):v===Me.CREATE_NEW?r.a.createElement("div",null,r.a.createElement(m.Button,{onClick:function(){return x(n)},icon:"chevron-left",minimal:!0}),r.a.createElement(d,Object.assign({},p,{type:l,handleSubmit:function(e){x(n),h(e)}}))):v===Me.EDIT?r.a.createElement("div",null,r.a.createElement(m.Button,{onClick:function(){return x(n)},icon:"chevron-left",minimal:!0}),r.a.createElement(d,Object.assign({},p,{type:l,initialInputs:C.data,handleSubmit:function(e){x(n),f(C.id,e,l),w(void 0)}}))):v===Me.DUPLICATE?r.a.createElement("div",null,r.a.createElement(m.Button,{onClick:function(){return x(n)},icon:"chevron-left",minimal:!0}),r.a.createElement(d,Object.assign({},p,{type:l,initialInputs:k,handleSubmit:function(e){x(n),h(e),N(void 0)}}))):r.a.createElement(m.Button,{onClick:function(){return x(Me.CHOOSE)},icon:"add"},"Add"))}var qe=function(e){var t=e.x,n=e.y,a=e.currFloor,i=e.getTileAt,l=e.initialInputs,o=e.inheritedInputs,c=e.handleSubmit,s=e.handleClear,u=e.tileStyle,d=e.entities,p=e.findOrAddEntity,f=e.editEntity,E=function(e){var l=e.tile,o=se(l&&!isNaN(l.room)&&l.color?l.color:"#ced9e0");return r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement("div",{style:{position:"relative"}},r.a.createElement(m.Icon,{color:o,className:"react-grid-item-handle + ".concat(isNaN(l.room)?"disabled":""),icon:"drag-handle-horizontal"}),!Object(b.isEmpty)(l)&&!Object(b.isEmpty)(i(t,n,a-1))&&r.a.createElement(m.Icon,{color:o,className:Object(b.isEmpty)(l)?"disabled":"",style:{opacity:l.stairDown?1:.2,position:"absolute",bottom:"5px",left:"5px"},icon:"arrow-bottom-left"}),!Object(b.isEmpty)(l)&&!Object(b.isEmpty)(i(t,n,a+1))&&r.a.createElement(m.Icon,{color:o,className:Object(b.isEmpty)(l)?"disabled":"",style:{opacity:l.stairUp?1:.2,position:"absolute",top:"5px",right:"5px"},icon:"arrow-top-right"}),r.a.createElement("div",{className:"react-grid-item-content",style:Object(h.a)(Object(h.a)({},u),{},{backgroundColor:l&&!isNaN(l.room)&&l.color?l.color:"#ced9e0"})},r.a.createElement("div",{className:"center",style:{color:o,width:"100%",maxHeight:u.maxHeight-20,overflow:"hidden"}},!Object(b.isEmpty)(l)&&d.room[l.room]?d.room[l.room].name:"",r.a.createElement("p",null,Object(b.isEmpty)(l)?"":l.characters.map((function(e){return r.a.createElement(m.Tooltip,{content:d.character[e].name},d.character[e].emoji)}))),r.a.createElement("p",null,Object(b.isEmpty)(l)?"":l.objects.map((function(e){return r.a.createElement(m.Tooltip,{content:d.object[e].name},d.object[e].emoji)})))))))};return r.a.createElement(_.a,{initialValues:o||(Object(b.isEmpty)(l)?void 0:l)||De,validate:function(e){var t={};return e.room||(t.room="Required"),t},isInitialValid:!!o&&!!o.room,onSubmit:c},(function(e){var t=e.values,n=e.setFieldValue,a=e.touched,i=e.setFieldTouched,l=e.errors,o=e.dirty,c=e.isValid,u=e.handleSubmit,h=e.handleReset,y=function(e,a,r){n(e,a),n("color",ce(r.name,t.color))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ge,{title:"Room"},r.a.createElement(Ve,{initialState:Me.CHOOSE,SelectFromExisting:B,selectFromExistingProps:{id:"room-input",errors:l.room,touched:a.room,setFieldTouched:i,onItemSelect:p,entities:d,handleChange:y},handleChange:n,formValue:t.room,name:"room",type:"room",Form:q,formProps:{initialInputs:V},handleCreateSubmit:function(e){return y("room",p(e,"room"),e)},handleEditSubmit:f,Selected:Le,selectedProps:{columnNames:["Name","Description","Backstory"],columnKeys:["name","description","backstory"],items:isNaN(t.room)?void 0:[t.room],entities:d,type:"room"}}),l.room&&a.room&&r.a.createElement("div",{className:"form-error"},l.room),r.a.createElement("div",{style:{marginTop:"5px"}},r.a.createElement(Re,{colors:ee,value:t.color,handleChange:n,advanced:!0}))),r.a.createElement(Ge,{initialOpen:!Object(b.isEmpty)(t.characters),title:"Characters"},r.a.createElement(Ve,{SelectFromExisting:Ae,selectFromExistingProps:{id:"characters-input",errors:l.characters,touched:a.characters,setFieldTouched:i,tooltip:"physical_description",onItemSelect:function(e,t){return e.emoji=ue(e.name),p(e,t)},entities:d,handleChange:n},handleChange:n,formValue:t.characters,name:"characters",type:"character",Form:M,formProps:{initialInputs:L},handleCreateSubmit:function(e){e.emoji=ue(e.name),n("characters",t.characters.concat(p(e,"character")))},handleEditSubmit:f,Selected:Le,selectedProps:{columnNames:["Name","Persona","Emoji"],columnKeys:["name","persona","emoji"],items:t.characters,entities:d,type:"character",editEntity:f}}),l.characters&&a.characters&&r.a.createElement("div",{className:"form-error"},l.characters)),r.a.createElement(Ge,{initialOpen:!Object(b.isEmpty)(t.characters),title:"Objects"},r.a.createElement(Ve,{SelectFromExisting:Ae,selectFromExistingProps:{id:"objects-input",errors:l.objects,touched:a.objects,setFieldTouched:i,tooltip:"physical_description",onItemSelect:function(e,t){return e.emoji=ue(e.name),p(e,t)},entities:d,handleChange:n},handleChange:n,formValue:t.objects,name:"objects",type:"object",Form:G,formProps:{initialInputs:P},handleCreateSubmit:function(e){e.emoji=ue(e.name),n("objects",t.objects.concat(p(e,"object")))},handleEditSubmit:f,Selected:Le,selectedProps:{columnNames:["Name","Description","emoji"],columnKeys:["name","physical_description","emoji"],items:t.objects,entities:d,type:"object",editEntity:f}}),l.objects&&a.objects&&r.a.createElement("div",{className:"form-error"},l.objects)),r.a.createElement(Ge,{title:"Preview"},r.a.createElement(E,{tile:t})),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",padding:"10px"}},r.a.createElement(m.Button,{type:"reset",onClick:s,disabled:!(!isNaN(t.room)||!Object(b.isEmpty)(t.characters)||!Object(b.isEmpty)(t.objects)),style:{marginRight:"15px"}},"Clear"),r.a.createElement(m.Button,{type:"reset",onClick:h,disabled:!o,style:{marginRight:"15px"}},"Reset"),r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,type:"submit",onClick:u,disabled:!c,style:{marginLeft:"15px"}},"Save Changes")))}))};function Ue(e){var t=e.selected,n=e.setSelected,a=e.resetShowAdvanced,i=e.showAdvanced,l=e.state;return r.a.createElement(m.Drawer,{icon:"build",title:"Build Tile",isOpen:i&&t,onClose:function(){n(null),a()}},r.a.createElement("div",{className:m.Classes.DRAWER_BODY},r.a.createElement("div",{className:m.Classes.DIALOG_BODY},t&&r.a.createElement(qe,{x:t.x,y:t.y,currFloor:l.currFloor,getTileAt:l.getTileAt,initialInputs:l.getTileAt(t.x,t.y),inheritedInputs:t.data,handleSubmit:function(e){l.setTile(t.x,t.y,Object(h.a)(Object(h.a)({},l.getTileAt(t.x,t.y)),e)),n(null),a()},handleClear:function(){l.clearTile(t.x,t.y),n(null),a()},tileStyle:{width:150,height:150,maxWidth:150,maxHeight:150},entities:l.entities,findOrAddEntity:l.findOrAddEntity,editEntity:l.editEntity}))))}var He=function(e){var t=e.state,n=e.initialShowAdvanced,a=r.a.useState(null),i=Object(u.a)(a,2),l=i[0],o=i[1],c=r.a.useState(null),s=Object(u.a)(c,2),d=s[0],p=s[1],h=r.a.useState(!1),f=Object(u.a)(h,2),E=f[0],y=f[1],g=r.a.useState(!1),v=Object(u.a)(g,2),x=v[0],O=v[1];r.a.useEffect((function(){y(n)}),[n]);var j=function(e,t,n){Object(b.isEqual)(t,n)||(O(!0),p(null));for(var a=0;a<l.length;a++)l[a].i!==n.i&&(l[a].x===n.x&&l[a].y===n.y&&l[a].i!==n.i?(e[a].x=t.x,e[a].y=t.y):(e[a].x=l[a].x,e[a].y=l[a].y));return!0};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{width:150*t.dimensions.width+24*(t.dimensions.width+1)+60,margin:"0 auto 75px auto",textAlign:"center"}},r.a.createElement(m.Button,{className:"bp3-button",disabled:t.dimensions.height>=10,style:{width:150*t.dimensions.width+24*(t.dimensions.width+1)-20,margin:"auto"},onClick:t.addRowTop,icon:"add"}),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(m.Button,{className:"bp3-button",disabled:t.dimensions.width>=10,style:{height:150*t.dimensions.height+24*(t.dimensions.height+1)-20,margin:"10px 0"},onClick:t.addColFront,icon:"add"}),r.a.createElement("div",{className:"map-container",style:{width:150*t.dimensions.width+24*(t.dimensions.width+1),height:150*t.dimensions.height+24*(t.dimensions.height+1)}},r.a.createElement("div",{className:"walls"},function(){for(var e=[],n=0;n<t.dimensions.height;n++)for(var a=0;a<t.dimensions.width;a++)a>0&&function(){var i="".concat(a-1," ").concat(n,"|").concat(a," ").concat(n);e.push(r.a.createElement("div",{key:i,onClick:function(){return t.toggleWall(i)},className:"wall ".concat(t.map[t.currFloor].walls[i]?"active":""),style:{top:24+174*n,left:174*a+7,height:150}}))}(),n>0&&function(){var i="".concat(a," ").concat(n-1,"|").concat(a," ").concat(n);e.push(r.a.createElement("div",{key:i,onClick:function(){return t.toggleWall(i)},className:"wall ".concat(t.map[t.currFloor].walls[i]?"active":""),style:{left:24+174*a,top:174*n+7,width:150}}))}();return e}()),r.a.createElement(_e.a,{cols:t.dimensions.width,rowHeight:150,width:150*t.dimensions.width+24*(t.dimensions.width+1),onDragStart:function(e){o(Object(b.cloneDeep)(e))},onDrag:j,onDragStop:function(e,t,n){j(e,t,n),o([t.x,t.y,n.x,n.y])},margin:[24,24],onLayoutChange:function(){if(l){var e=Object(u.a)(l,4),n=e[0],a=e[1],r=e[2],i=e[3];n===r&&a===i||setTimeout((function(){return t.swapTiles(n,a,r,i)}),300),o(null)}},isResizable:!1,maxRows:t.dimensions.height,style:{width:150*t.dimensions.width+24*(t.dimensions.width+1)}},function(){for(var e=[],n=function(n){for(var a=function(a){var i=t.getTileAt(a,n,t.currFloor),l="".concat(t.currFloor," ").concat(a," ").concat(n," ").concat(i&&i&&i.room?i.room.id:"");e.push(r.a.createElement("div",{key:l,"data-grid":{x:a,y:n,w:1,h:1,draggableHandle:".react-grid-item-handle",draggableCancel:".react-grid-item",isDraggable:!Object(b.isEmpty)(i)},onClick:function(){x||d&&(!d||d.x===a&&d.y===n)?O(!1):p({x:a,y:n})}},r.a.createElement(Pe,{x:a,y:n,tile:i,selected:d,setSelected:p,showAdvanced:E,setShowAdvanced:y,setTile:t.setTile,clearTile:t.clearTile,getTileAt:t.getTileAt,currFloor:t.currFloor,tileStyle:{width:150,height:150,maxWidth:150,maxHeight:150},state:t})))},i=0;i<t.dimensions.width;i++)a(i)},a=0;a<t.dimensions.height;a++)n(a);return e}())),r.a.createElement(m.Button,{className:"bp3-button",disabled:t.dimensions.width>=10,style:{height:150*t.dimensions.height+24*(t.dimensions.height+1)-20,margin:"10px 0"},onClick:t.addColEnd,icon:"add"})),r.a.createElement(m.Button,{className:"bp3-button",disabled:t.dimensions.height>=10,style:{width:150*t.dimensions.width+24*(t.dimensions.width+1)-20,margin:"auto"},onClick:t.addRowBot,icon:"add"})),r.a.createElement(Ue,{showAdvanced:E,selected:d,setSelected:p,resetShowAdvanced:function(){y(n)},state:t}))},We=n(182),Ye=n.n(We),Ke=n(112),ze=n.n(Ke);var Je=function(e){var t=e.manager,n=e.map,a=e.currFloor,i=r.a.useState(!1),l=Object(u.a)(i,2),o=l[0],c=l[1],s=r.a.useState(null),d=Object(u.a)(s,2),p=d[0],h=d[1],f=r.a.useState({}),E=Object(u.a)(f,2),y=E[0],g=E[1],v=r.a.createRef(),x=n.map((function(e,t){return{name:e.name,index:t}})),O=Object(m.ContextMenuTarget)(ze()({displayName:"FloorButton",keypressHandler:function(e){"Enter"===e.key&&v.current.blur()},renderContextMenu:function(){var e=this;return c(!0),r.a.createElement(m.Menu,null,r.a.createElement(m.MenuItem,{icon:"edit",onClick:function(){return h(e.props.item.index)},text:"Edit Floor Name"}),r.a.createElement(m.MenuItem,{icon:"delete",disabled:x.length<=1,onClick:function(){g({confirmButtonText:"Confirm Delete",icon:"trash",intent:m.Intent.DANGER,onConfirm:function(){t.deleteFloor(e.props.item.index),g({})},content:"Are you sure you want to delete the entire ".concat(e.props.item.name," floor? All data on this floor and connections to this floor will be reset.")})},text:"Delete Floor"}))},onContextMenuClose:function(){c(!1)},handleBlur:function(e){t.editFloorName(e.target.value,this.props.item.index),h(null)},componentDidMount:function(){p===this.props.item.index&&(v.current.focus(),v.current.select())},render:function(){var e=this;return r.a.createElement("div",{style:{textAlign:"center",width:"100%",height:"100%",lineHeight:"30px",padding:"0px 5px"}},null!==p&&p===this.props.item.index?r.a.createElement(m.InputGroup,{inputRef:v,onBlur:this.handleBlur,defaultValue:this.props.item.name,onKeyPress:function(t){return e.keypressHandler(t)}}):r.a.createElement("div",null,this.props.item.name))}}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.Alert,{confirmButtonText:y.confirmButtonText,cancelButtonText:"Cancel",icon:y.icon,intent:y.intent,isOpen:!Object(b.isEmpty)(y),onCancel:function(){y.onCancel&&y.onCancel(),g({})},onConfirm:y.onConfirm},r.a.createElement("p",null,y.content)),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(m.Button,{disabled:n.length>=10,icon:"add",onClick:t.addFloor,style:{height:"30px"}}),r.a.createElement(Ye.a,{holdTime:"200",callback:function(e,n,a,r){a!==r&&g({confirmButtonText:"Confirm Reorder",icon:"layers",intent:m.Intent.WARNING,onConfirm:function(){t.reorderFloors(a,r),g({})},content:"Are you sure you want to reorder the entire ".concat(x[r].name," floor? All connections to and from this floor, in both positions, will be reset.")})},template:O,itemKey:"index",list:x,selected:x[a],itemClicked:function(e,n,a){o||p||t.setCurrFloor(a)},lock:"vertical",itemClass:"bp3-button floor-button"})))};function Qe(e){var t=pe(e.upload),n=r.a.useState(!1),i=Object(u.a)(n,2),l=i[0],o=i[1],c=r.a.useState(function(){var e=window.location.href,t=e.indexOf("?"),n=!1;if(-1!=t){var a=e.substring(t+1).split("=");"manage"===a[0]&&(n="true"==a[1])}return n}()),s=Object(u.a)(c,2),d=s[0],p=s[1],f=null==t.dimensions.name?" ":t.dimensions.name,E=r.a.useRef(t);E.current=t;return Object(a.useEffect)((function(){var e=setTimeout((function e(){!function(e){we.apply(this,arguments)}(E.current),console.log("Autosaved!"),setTimeout(e,12e4)}),12e4);return function(){return clearTimeout(e)}}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"World: ",f),r.a.createElement(ke,{isOverlayOpen:d,setIsOverlayOpen:p}),r.a.createElement(m.FormGroup,{inline:!0,label:"World Name",labelFor:"name-input",labelInfo:"(optional)"},r.a.createElement(m.ControlGroup,null,r.a.createElement(m.InputGroup,{id:"name-input",placeholder:null==t.dimensions.name?"Unnamed World":t.dimensions.name}),r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,onClick:function(){t.setDimensions(Object(h.a)(Object(h.a)({},t.dimensions),{},{name:document.getElementById("name-input").value.trim()}))}},"Update"))),r.a.createElement(m.FormGroup,{inline:!0,label:"World Dimensions",labelInfo:"WxH (Max ".concat(10,"x").concat(10,")")},r.a.createElement(m.ControlGroup,null,r.a.createElement(m.NumericInput,{value:t.dimensions.width,style:{width:"3rem"},max:10,min:1,onValueChange:function(e){t.setDimensions(Object(h.a)(Object(h.a)({},t.dimensions),{},{width:e}))}}),r.a.createElement(m.NumericInput,{value:t.dimensions.height,style:{width:"3rem"},max:10,min:1,onValueChange:function(e){t.setDimensions(Object(h.a)(Object(h.a)({},t.dimensions),{},{height:e}))}}))),r.a.createElement(m.FormGroup,{inline:!0,label:r.a.createElement(r.a.Fragment,null,"Floor"," ",r.a.createElement(m.Tooltip,{content:"Right click floor for more options. Click and hold floor to reorder.",position:m.Position.BOTTOM,className:"inline"},r.a.createElement(m.Icon,{icon:"help"}))),labelInfo:"Max ".concat(10),style:{marginBottom:"0px"}},r.a.createElement(Je,{max:10,manager:t.floorManager,map:t.map,currFloor:t.currFloor})),r.a.createElement(m.FormGroup,{inline:!0,label:"Advanced"},r.a.createElement(m.Switch,{onChange:function(){return o(!l)},checked:!!l})),r.a.createElement(He,{state:t,initialShowAdvanced:l}),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",position:"fixed",bottom:0,left:0,right:0,height:"50px"},className:"bp3-navbar"},r.a.createElement(m.Button,{onClick:function(){return function(e){return Ce.apply(this,arguments)}(t)},intent:"primary",style:{margin:"10px"}},"Launch Game"),r.a.createElement(m.Button,{onClick:function(){return p(!d)},intent:"primary",style:{margin:"10px"}},"Manage Worlds"),r.a.createElement(m.Button,{onClick:function(){return Ie(t)},intent:"primary",style:{margin:"10px"}},"Save"),r.a.createElement(m.Button,{onClick:t.exportWorld,intent:"primary",style:{margin:"10px"}},"Export")))}var Xe=function(e){var t=e.location;return r.a.createElement("div",null,r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading"},"World Builder"),r.a.createElement("div",null,r.a.createElement(Qe,{upload:t.state})))};function Ze(e){var t=e.type,n=e.initialInputs,a=e.handleSubmit;switch(t){case"object":return r.a.createElement(G,{type:t,initialInputs:n,handleSubmit:a});case"character":return r.a.createElement(M,{type:t,initialInputs:n,handleSubmit:a});case"room":return r.a.createElement(q,{type:t,initialInputs:n,handleSubmit:a});default:return"This entity cannot be edited at the moment"}}function $e(){return($e=Object(N.a)(k.a.mark((function e(t,n,a){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map((function(e){return et(t,e.property,e.editedValue)})),e.next=3,Promise.all(r).then((function(){a.push("/")}));case 3:U.show({intent:m.Intent.SUCCESS,message:"Successfully created edits"});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function et(e,t,n){return j("builder/edits",{id:e,field:t,edited_value:n,player:1})}var tt=function(e){var t=e.match,n=e.location,a=r.a.useState(void 0),i=Object(u.a)(a,2),l=i[0],o=i[1],c=O(v,"/entities/".concat(t.params.id),{},n.state),d=c.loading,p=c.result,h=r.a.useState({}),f=Object(u.a)(h,2),E=f[0],y=f[1],g=r.a.useState(!1),x=Object(u.a)(g,2),j=x[0],C=x[1],w=r.a.useState([]),I=Object(u.a)(w,2),S=I[0],k=I[1],N=Object(s.f)();return!d&&Object(b.isEmpty)(E)&&(Object(b.isEmpty)(p)||Object(b.isEmpty)(p.entity)?(y({id:t.params.id}),o("invalid")):(y(p.entity),o(p.type))),r.a.createElement("div",null,r.a.createElement(m.Dialog,{icon:"info-sign",onClose:function(){return C(!1)},title:"Confirm edits for Entity ".concat(t.params.id),isOpen:j,usePortal:!1},r.a.createElement("div",{className:m.Classes.DIALOG_BODY},S.map((function(e,t){return r.a.createElement("p",{key:t},r.a.createElement("strong",null,e.property),": ",e.editedValue.toString())}))),r.a.createElement("div",{className:m.Classes.DIALOG_FOOTER},r.a.createElement("div",{className:m.Classes.DIALOG_FOOTER_ACTIONS},r.a.createElement(m.Button,{onClick:function(){return C(!1)}},"Close"),r.a.createElement(m.Button,{intent:m.Intent.PRIMARY,onClick:function(){return function(e,t,n){return $e.apply(this,arguments)}(t.params.id,S,N)}},"Confirm Edits")))),r.a.createElement("h2",{"data-testid":"header",className:"bp3-heading"},"Editing Entity ",t.params.id),r.a.createElement("div",{className:"bp3-text-large"},d?r.a.createElement(m.Spinner,{intent:m.Intent.PRIMARY}):r.a.createElement(Ze,{type:l,initialInputs:E,handleSubmit:function(e){var t=[];for(var n in e)e[n]!==E[n]&&t.push({property:n,editedValue:e[n]});k(t),C(!0)}})))};function nt(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(p,null),r.a.createElement("div",{style:{margin:"40px 30px"}},r.a.createElement(s.b,{path:"/explore",component:I,exact:!0}),r.a.createElement(s.b,{path:"/create",component:W,exact:!0}),r.a.createElement(s.b,{path:"/review",component:Z,exact:!0}),r.a.createElement(s.b,{path:"/world_builder",render:function(e){return r.a.createElement(Xe,Object.assign({},e,{key:Math.random(),exact:!0}))}}),r.a.createElement(s.b,{path:"/edit/:id",component:tt,exact:!0}),r.a.createElement(s.b,Object(o.a)({exact:!0,path:"/",render:function(){return r.a.createElement(s.a,{to:"/explore"})}},"exact",!0))))}var at=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(c.a,null,r.a.createElement(nt,null)))};n(303),n(304),n(305);l.a.render(r.a.createElement(at,null),document.getElementById("root"))}},[[217,1,2]]]);
//# sourceMappingURL=main.25d73885.chunk.js.map