{"version":3,"sources":["components/WorldFileUpload.js","components/NavBar.js","config.js","utils.js","components/ExplorePage.js","components/forms/BaseSuggest.js","components/forms/ObjectForm.js","components/forms/CharacterForm.js","components/forms/RoomForm.js","components/AppToaster.js","components/CreatePage.js","components/ReviewPage.js","components/worldbuilding/utils.js","components/EdgeTypes.js","components/WorldManager.js","components/forms/ColorPicker.js","components/forms/BaseMultiSelect.js","components/forms/TileForm.js","components/worldbuilding/Tile.js","components/forms/AdvancedTileForm.js","components/worldbuilding/Grid.js","components/worldbuilding/FloorSelector.js","components/WorldBuilderPage.js","components/EditPage.js","App.js","index.js"],"names":["WorldFileUpload","setPopover","inputRef","React","useRef","useState","undefined","file","setFile","onChange","e","fileReader","FileReader","onload","event","JSON","parse","target","result","files","readAsText","type","ref","style","display","to","pathname","state","data","icon","onClick","current","click","text","shouldDismissPopover","NavBar","children","worldBuildPopover","setWorldBuildPopover","Fragment","Group","align","Alignment","LEFT","Heading","Divider","data-testid","className","position","Position","BOTTOM_LEFT","minimal","isOpen","color","tagName","DEV","host","hostname","port","useDidChange","val","value","useEffect","usePrevious","useAPI","CONFIG","url","preloaded","body","params","loading","setState","newUrl","isSubscribed","fetch","then","res","json","catch","err","console","log","reload","post","payload","formBody","property","encodedKey","encodeURIComponent","encodedValue","stringify","push","method","headers","join","ItemsList","items","descriptionField","additionalFields","selectedEntity","expanded","animating","nextState","length","width","map","field","key","name","item","index","id","handleTrClick","background","colSpan","padding","cursor","duration","height","easing","onAnimationEnd","animateOpacity","ExpandedTab","flexDirection","Object","keys","startCase","justifyContent","margin","entity","ExplorePage","setSelectedEntity","page","setPage","searchText","setSearchText","placeholder","dir","marginBottom","inline","large","selectedValue","label","intent","Intent","PRIMARY","previousLabel","nextLabel","breakLabel","forcePage","pageCount","total_pages","marginPagesDisplayed","pageRangeDisplayed","onPageChange","selected","containerClassName","subContainerClassName","activeClassName","renderItemList","filteredItems","renderItem","topResults","slice","textAlign","disabled","renderOption","obj","handleClick","modifiers","matchesPredicate","active","BaseSuggest","errors","touched","setFieldTouched","formValue","handleChange","onItemSelect","entities","setItems","query","setQuery","currItem","setCurrItem","localEntities","values","results","concat","filter","self","findIndex","t","equal","isNaN","onBlur","itemRenderer","itemListRenderer","inputValueRenderer","inputProps","DANGER","popoverProps","usePortal","itemPredicate","_index","exactMatch","normalizedTitle","toLowerCase","normalizedQuery","string","indexOf","selectedItem","onQueryChange","q","resetOnQuery","emptyObjectForm","name_prefix","physical_description","base_id","is_container","is_drink","is_food","is_gettable","is_plural","is_surface","is_weapon","is_wearable","ObjectForm","initialInputs","handleSubmit","initialValues","validate","onSubmit","props","setFieldValue","dirty","isValid","handleBlur","handleReset","handleSwitch","labelInfo","labelFor","growVertically","fill","marginLeft","checked","alignIndicator","RIGHT","marginRight","emptyCharacterForm","persona","char_type","CharacterForm","emptyRoomForm","description","backstory","RoomForm","AppToaster","Toaster","create","TOP","CreateForm","history","useHistory","submitEntity","a","show","SUCCESS","message","CreatePage","location","formType","setFormType","EditsList","edits","status","rows","all","setSelected","submitAction","setSubmitAction","showDialog","setShowDialog","pendingSubmission","setPendingSubmission","handleTdClick","reqs","edit_id","Promise","Array","showSubmission","action","i","onClose","title","Classes","DIALOG_BODY","edit","DIALOG_FOOTER","DIALOG_FOOTER_ACTIONS","indeterminate","newRows","newSelection","every","r","handleCheckbox","orig","diff","differ","DiffMatchPatch","diff_main","diff_cleanupSemantic","d","unedited_value","edited_value","Card","alignItems","flexGrow","maxWidth","fontSize","ReviewPage","selectedStatus","setSelectedStatus","TILE_COLORS","Colors","GRAY3","VIOLET5","RED5","SEPIA5","GOLD5","FOREST5","BLUE5","grass","water","buildings","royal","brick","path","farm","findBiome","lowName","some","biome","invertColor","hex","parseInt","findEmoji","emojiIndex","search","native","words","split","charAt","substring","mapReducer","floor","floorIndex","tiles","x","y","newTile","createdEntitiesReducer","assign","entityType","nextID","merge","useWorldBuilder","upload","dimensions","floors","setDimensions","initialMap","walls","useReducer","mapDispatch","room","character","object","entitiesDispatch","currFloor","setCurrFloor","newMap","f","removeStairsTile","baseMap","stairDown","stairUp","removeStairsFloor","stair","isEmpty","forEach","floorManager","addFloor","deleteFloor","_floor","reorderFloors","i1","i2","reorderedFloor","filteredMap","editFloorName","newName","filtered","newFloor","newTiles","tile","setTile","clearTile","cloneDeep","swapTiles","x1","y1","x2","y2","getTileAt","toggleWall","addRowTop","tileKeys","wallKeys","newWalls","t1","t2","addRowBot","addColFront","addColEnd","editEntity","findOrAddEntity","addEntity","exportWorld","element","document","createElement","setAttribute","Date","now","toString","appendChild","removeChild","EDGE_TYPES","ListWorlds","setIsOverlayOpen","setUpload","deleteWorld","getAutosave","storeEntity","entityId","entityToType","emoji","parseTiles","roomToTile","x_coordinate","y_coordinate","characters","objects","parseEdges","edges","dirs","edge","dst","src","constructTilesAndWalls","datMap","roomId","tileInfo","temp","neighbors","myLoc","otherLoc","constructWallsForTile","getWorld","timeout","dat","datType","auto","num_floors","postWorld","world_id","world_map","window","open","coord","direction","neighbor","wall","includes","resData","ListWorldsOverlay","isOverlayOpen","classes","classNames","CARD","ELEVATION_4","OVERLAY_SCROLL_CONTAINER","top","left","transform","ColorPicker","colors","advanced","maxHeight","borderRadius","borderColor","borderStyle","borderWidth","boxShadow","BaseMultiSelect","tooltip","currItems","setCurrItems","content","targetTagName","popoverClassName","TOP_RIGHT","tagInputProps","onRemove","_value","newItems","_item","change","selectedItems","tagRenderer","emptyTileForm","TileForm","onClear","setShowAdvanced","alignContent","HEADING","iconSize","fullValue","Tile","showAdvanced","tileStyle","toggleStairs","stopPropagation","toggleTo","otherFloor","newConnectedTile","contentColor","opacity","bottom","right","backgroundColor","overflow","char","Hideable","initialOpen","setOpen","SelectedTableView","columnNames","columnKeys","handleEdit","handleDuplicate","handleDelete","EmojiTD","showPicker","setShowPicker","interactionKind","PopoverInteractionKind","CLICK","onInteraction","wrapperTagName","onSelect","col","selectOrCreateState","BASE","CHOOSE","SELECT_FROM_EXISTING","CREATE_NEW","EDIT","DUPLICATE","SelectFromExistingOrCreateNew","initialState","SelectFromExisting","selectFromExistingProps","Form","formProps","handleCreateSubmit","handleEditSubmit","Selected","selectedProps","editing","setEditing","duplicating","setDuplicating","isArray","splice","AdvancedTileForm","inheritedInputs","handleClear","TilePreview","isInitialValid","setRoomValue","marginTop","AdvancedEditor","resetShowAdvanced","DRAWER_BODY","Grid","initialShowAdvanced","layout","setLayout","dragging","setDragging","onDragEvent","newState","initial","next","isEqual","j","generateWalls","cols","rowHeight","onDragStart","onDrag","onDragStop","onLayoutChange","setTimeout","isResizable","maxRows","data-grid","w","h","draggableHandle","draggableCancel","isDraggable","generateTiles","FloorSelector","manager","contextShowing","setContextShowing","confirmAlert","setConfirmAlert","createRef","FloorButton","ContextMenuTarget","createReactClass","keypressHandler","blur","renderContextMenu","confirmButtonText","onConfirm","onContextMenuClose","this","componentDidMount","focus","select","render","lineHeight","defaultValue","onKeyPress","cancelButtonText","onCancel","holdTime","callback","_e","initialIndex","newIndex","WARNING","template","itemKey","list","itemClicked","lock","itemClass","WorldBuilder","setAdvanced","loc","href","paramsIdx","initOverlay","getManageOn","world_name","stateRef","timer","autosave","postAutosave","clearTimeout","getElementById","trim","max","min","onValueChange","BOTTOM","launchWorld","WorldBuilderPage","EditForm","submitEdit","editedValue","player","EditPage","match","setInitialInputs","pendingEdits","setPendingEdits","submitEdits","Routes","component","exact","Math","random","App","ReactDOM"],"mappings":"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","file":"static/js/main.25d73885.chunk.js","sourcesContent":["import React from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport { MenuItem } from \"@blueprintjs/core\";\n\nfunction WorldFileUpload({ setPopover }) {\n  const inputRef = React.useRef();\n  const [file, setFile] = React.useState(undefined);\n  return (\n    <>\n      <input\n        onChange={(e) => {\n          setFile(undefined);\n          const fileReader = new FileReader();\n          fileReader.onload = function (event) {\n            setFile(JSON.parse(event.target.result));\n          };\n          const file = e.target.files[0];\n          fileReader.readAsText(file);\n          setPopover(false);\n        }}\n        type=\"file\"\n        ref={inputRef}\n        style={{ display: \"none\" }}\n      />\n      {file && (\n        <Redirect to={{ pathname: \"/world_builder\", state: { data: file } }} />\n      )}\n      <MenuItem\n        icon=\"upload\"\n        onClick={() => inputRef.current.click()}\n        text=\"Upload File\"\n        shouldDismissPopover={false}\n      />\n    </>\n  );\n}\n\nexport default WorldFileUpload;\n","import React from \"react\";\nimport {\n  Navbar,\n  Alignment,\n  Button,\n  Position,\n  Popover,\n  Menu,\n  MenuItem,\n} from \"@blueprintjs/core\";\nimport { Link } from \"react-router-dom\";\n\nimport WorldFileUpload from \"./WorldFileUpload\";\n\nfunction NavBar({ children }) {\n  const [worldBuildPopover, setWorldBuildPopover] = React.useState(false);\n  return (\n    <React.Fragment>\n      <Navbar>\n        <Navbar.Group align={Alignment.LEFT}>\n          <Navbar.Heading>LIGHT Data Model</Navbar.Heading>\n          <Navbar.Divider />\n          <Link data-testid=\"link-explore\" className=\"btn-link\" to=\"/explore\">\n            <Button className=\"bp3-minimal\" icon=\"path-search\" text=\"Explore\" />\n          </Link>\n          <Link data-testid=\"link-create\" className=\"btn-link\" to=\"/create\">\n            <Button className=\"bp3-minimal\" icon=\"cube\" text=\"Create\" />\n          </Link>\n          <Link data-testid=\"link-review\" className=\"btn-link\" to=\"/review\">\n            <Button className=\"bp3-minimal\" icon=\"form\" text=\"Review Edits\" />\n          </Link>\n          <Popover\n            position={Position.BOTTOM_LEFT}\n            minimal\n            isOpen={worldBuildPopover}\n          >\n            <Button\n              onClick={() => setWorldBuildPopover(!worldBuildPopover)}\n              className=\"bp3-minimal\"\n              icon=\"map-create\"\n              text=\"Build World\"\n            />\n            <Menu>\n              <MenuItem\n                icon=\"new-object\"\n                text={\n                  <Link\n                    onClick={() => setWorldBuildPopover(false)}\n                    style={{ color: \"inherit\" }}\n                    data-testid=\"link-world-builder\"\n                    className=\"btn-link\"\n                    to=\"/world_builder\"\n                  >\n                    Create New\n                  </Link>\n                }\n                shouldDismissPopover={true}\n                tagName=\"div\"\n              />\n              <MenuItem\n                icon=\"cloud-upload\"\n                text={\n                  <Link\n                    onClick={() => setWorldBuildPopover(false)}\n                    style={{ color: \"inherit\" }}\n                    data-testid=\"link-world-builder-manage\"\n                    className=\"btn-link\"\n                    to=\"/world_builder?manage=true\"\n                  >\n                    Manage Existing\n                  </Link>\n                }\n                shouldDismissPopover={true}\n                tagName=\"div\"\n              />\n              <WorldFileUpload setPopover={setWorldBuildPopover} />\n            </Menu>\n          </Popover>\n        </Navbar.Group>\n      </Navbar>\n      {children}\n    </React.Fragment>\n  );\n}\n\nexport default NavBar;\n","const DEV = {\n  host: \"http://localhost\",\n  hostname: \"localhost\",\n  port: \"35494\",\n};\n\nexport default DEV;\n","import React from \"react\";\n\nimport CONFIG from \"./config\";\n\nexport function usePrevious(value) {\n  const ref = React.useRef();\n  React.useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n\nexport function useDidChange(val) {\n  const prevVal = usePrevious(val);\n  return prevVal !== val;\n}\n\nexport function useAPI(CONFIG, url, { body, params } = {}, preloaded) {\n  const [state, setState] = React.useState({\n    loading: true,\n    result: undefined,\n  });\n\n  const newUrl = useDidChange(url);\n\n  React.useEffect(() => {\n    if (state.loading && preloaded) {\n      setState({ loading: false, result: preloaded });\n      return;\n    }\n    if (newUrl) {\n      setState({ loading: true, result: undefined });\n      return;\n    }\n    let isSubscribed = true;\n\n    if (state.loading) {\n      fetch(CONFIG.host + \":\" + CONFIG.port + \"/builder\" + url)\n        .then((res) => res.json())\n        .then((data) => {\n          if (isSubscribed) {\n            setState({ loading: false, result: data });\n          }\n        })\n        .catch((err) => console.log(\"Error fetching data\"));\n    }\n\n    return () => (isSubscribed = false);\n  }, [CONFIG.host, CONFIG.port, url, newUrl, preloaded, state]);\n\n  const reload = () => {\n    setState({ loading: true, result: undefined });\n  };\n\n  return {\n    loading: state.loading,\n    result: state.result,\n    reload,\n  };\n}\n\nexport function post(url, payload) {\n  const formBody = [];\n  for (let property in payload) {\n    const encodedKey = encodeURIComponent(property);\n    const encodedValue = encodeURIComponent(\n      typeof payload[property] === \"object\"\n        ? JSON.stringify(payload[property])\n        : payload[property]\n    );\n    formBody.push(encodedKey + \"=\" + encodedValue);\n  }\n  return fetch(`${CONFIG.host}:${CONFIG.port}/${url}`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n    },\n    body: formBody.join(\"&\"),\n  });\n}\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { Intent, Spinner, RadioGroup, Radio } from \"@blueprintjs/core\";\nimport AnimateHeight from \"react-animate-height\";\nimport { startCase } from \"lodash\";\nimport ReactPaginate from \"react-paginate\";\n\nimport CONFIG from \"../config\";\nimport { useAPI } from \"../utils\";\n\nfunction ExplorePage() {\n  const [selectedEntity, setSelectedEntity] = React.useState(\"object\");\n  const [page, setPage] = React.useState(0);\n\n  const [searchText, setSearchText] = React.useState(\"\");\n  const { loading, result } = useAPI(\n    CONFIG,\n    \"/entities/\" + selectedEntity + \"?search=\" + searchText + \"&page=\" + page\n  );\n\n  return (\n    <div>\n      <h2 data-testid=\"header\" className=\"bp3-heading\">\n        Explore\n      </h2>\n      <div className=\"bp3-text-large\">\n        Search across the LIGHT database for existing objects, characters, or\n        rooms.\n      </div>\n      <div\n        className=\"bp3-input-group bp3-large\"\n        style={{ margin: \"20px 0px 10px\" }}\n      >\n        <span className=\"bp3-icon bp3-icon-search\" />\n        <input\n          className=\"bp3-input\"\n          type=\"search\"\n          placeholder=\"Search...\"\n          dir=\"auto\"\n          value={searchText}\n          onChange={(e) => {\n            setSearchText(e.target.value);\n            setPage(0);\n          }}\n        />\n      </div>\n      <div style={{ display: \"flex\", marginBottom: 30 }}>\n        <span style={{ margin: \"0px 20px 0px 40px\" }}>Searching category:</span>\n        <RadioGroup\n          inline\n          large\n          onChange={(e) => {\n            setSelectedEntity(e.target.value);\n            setPage(0);\n          }}\n          selectedValue={selectedEntity}\n        >\n          <Radio data-testid=\"radio-object\" label=\"Objects\" value=\"object\" />\n          <Radio\n            data-testid=\"radio-character\"\n            label=\"Characters\"\n            value=\"character\"\n          />\n          <Radio data-testid=\"radio-room\" label=\"Rooms\" value=\"room\" />\n        </RadioGroup>\n      </div>\n\n      {loading ? (\n        <Spinner intent={Intent.PRIMARY} />\n      ) : (\n        <>\n          <ItemsList\n            items={result.data}\n            descriptionField={\n              selectedEntity === \"room\" ? \"description\" : \"physical_description\"\n            }\n            additionalFields={\n              selectedEntity === \"room\"\n                ? [{ name: \"Backstory\", key: \"backstory\" }]\n                : []\n            }\n            selectedEntity={selectedEntity}\n          />\n          <div style={{ margin: \"20px\" }}>\n            <ReactPaginate\n              previousLabel={\"previous\"}\n              nextLabel={\"next\"}\n              breakLabel={\"...\"}\n              forcePage={page}\n              pageCount={result.total_pages}\n              marginPagesDisplayed={2}\n              pageRangeDisplayed={5}\n              onPageChange={(data) => setPage(data.selected)}\n              containerClassName={\"pagination\"}\n              subContainerClassName={\"pages pagination\"}\n              activeClassName={\"active\"}\n            />\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nfunction ItemsList({\n  items,\n  descriptionField,\n  additionalFields = [],\n  selectedEntity,\n}) {\n  const [state, setState] = React.useState({\n    expanded: -1,\n    animating: 0,\n    nextState: -1,\n  });\n\n  function handleTrClick(index) {\n    if (state.expanded === -1) {\n      setState({ expanded: index, animating: 2, nextState: -1 });\n    } else if (state.expanded === index) {\n      setState({ expanded: index, animating: 3, nextState: -1 });\n    } else {\n      setState({ ...state, animating: 3, nextState: index });\n    }\n  }\n\n  if (items === undefined || items.length === 0) {\n    return <span>No items found.</span>;\n  } else {\n    return (\n      <table\n        data-testid=\"table-explore\"\n        style={{ width: \"100%\" }}\n        className=\"bp3-html-table bp3-html-table-condensed bp3-interactive\"\n      >\n        <thead>\n          <tr>\n            <th>Name</th>\n            <th>Description</th>\n            {additionalFields.map((field) => (\n              <th key={field}>{field.name}</th>\n            ))}\n\n            <th>ID</th>\n          </tr>\n        </thead>\n        <tbody>\n          {items.map((item, index) => (\n            <React.Fragment key={item.id}>\n              <tr\n                onClick={() => handleTrClick(index)}\n                data-testid=\"tr-explore\"\n                style={{\n                  background:\n                    index % 2 === 0 ? \"rgba(191, 204, 214, 0.15)\" : undefined,\n                }}\n              >\n                <td>\n                  <strong>{item.name}</strong>\n                </td>\n                <td>{item[descriptionField]}</td>\n                {additionalFields.map((field) => (\n                  <td key={field.name}>{item[field.key]}</td>\n                ))}\n                <td>{item.id}</td>\n              </tr>\n              <tr\n                style={{\n                  background:\n                    index % 2 === 0 ? \"rgba(191, 204, 214, 0.15)\" : undefined,\n                }}\n              >\n                <td\n                  colSpan={5}\n                  style={{\n                    display: state.expanded === index ? undefined : \"none\",\n                    padding: 0,\n                    cursor: \"unset\",\n                  }}\n                >\n                  <AnimateHeight\n                    duration={500}\n                    height={\n                      state.expanded === index &&\n                      (state.animating === 2 || state.animating === 0)\n                        ? \"auto\"\n                        : 0\n                    }\n                    easing={\"ease\"}\n                    onAnimationEnd={() =>\n                      setState({\n                        nextState: -1,\n                        expanded:\n                          state.animating === 2 ? index : state.nextState,\n                        animating:\n                          state.animating === 3 && state.nextState !== -1\n                            ? 2\n                            : 0,\n                      })\n                    }\n                    animateOpacity={true}\n                  >\n                    {state.expanded === index && (\n                      <ExpandedTab\n                        item={item}\n                        selectedEntity={selectedEntity}\n                      />\n                    )}\n                  </AnimateHeight>\n                </td>\n              </tr>\n            </React.Fragment>\n          ))}\n        </tbody>\n      </table>\n    );\n  }\n}\n\nfunction ExpandedTab({ item, selectedEntity }) {\n  return (\n    <>\n      <div\n        data-testid=\"dropdown\"\n        style={{\n          padding: \"20px 40px 0 40px\",\n        }}\n      >\n        <div\n          style={{\n            display: \"flex\",\n            flexDirection: \"column\",\n          }}\n        >\n          {Object.keys(item).map((key, index) => (\n            <p key={index}>\n              <strong>{startCase(key)}</strong>: {item[key]}\n            </p>\n          ))}\n        </div>\n      </div>\n      <div\n        style={{\n          display: \"flex\",\n          padding: \"0 20px 20px 20px\",\n          justifyContent: \"flex-end\",\n        }}\n      >\n        <Link\n          style={{ margin: \"0 5px\" }}\n          className=\"bp3-button bp3-small\"\n          to={{\n            pathname: `/create`,\n            state: {\n              type: selectedEntity,\n              entity: item,\n            },\n          }}\n        >\n          Create From\n        </Link>\n        <Link\n          style={{ margin: \"0 5px\" }}\n          className=\"bp3-button bp3-small\"\n          to={{\n            pathname: `/edit/${item.id}`,\n            state: {\n              type: selectedEntity,\n              entity: item,\n            },\n          }}\n        >\n          Edit\n        </Link>\n      </div>\n    </>\n  );\n}\n\nexport default ExplorePage;\n","import React from \"react\";\nimport { Intent, Menu, MenuItem } from \"@blueprintjs/core\";\nimport { Suggest } from \"@blueprintjs/select\";\nimport equal from \"fast-deep-equal\";\nimport \"@blueprintjs/select/lib/css/blueprint-select.css\";\n\nimport CONFIG from \"../../config\";\nimport { useAPI } from \"../../utils\";\n\nconst SUGGEST_SIZE = 100;\n\nfunction BaseSuggest({\n  id,\n  name,\n  errors,\n  touched,\n  setFieldTouched,\n  formValue,\n  handleChange,\n  type,\n  onItemSelect,\n  entities,\n}) {\n  const [items, setItems] = React.useState([]);\n  const [query, setQuery] = React.useState(\"\");\n  const [currItem, setCurrItem] = React.useState(formValue);\n  const { loading, result } = useAPI(\n    CONFIG,\n    `/entities/${type}?search=${query}`\n  );\n\n  React.useEffect(() => {\n    if (!loading) {\n      if (entities) {\n        const localEntities = Object.values(entities[type]);\n        const results = localEntities\n          .concat(result.slice(0, SUGGEST_SIZE + localEntities.length + 1))\n          .filter(\n            (item, index, self) =>\n              self.findIndex((t) => equal(t, item)) === index\n          );\n\n        return setItems(results);\n      }\n      return setItems(result);\n    }\n  }, [result, loading, entities, type]);\n\n  React.useEffect(() => {\n    if (entities) {\n      return setCurrItem(formValue);\n    }\n    // When Reset is clicked on the form\n    if (isNaN(formValue)) {\n      return setCurrItem(null);\n    }\n    for (let item in items) {\n      if (items[item].id === formValue) {\n        return setCurrItem(items[item]);\n      }\n    }\n  }, [formValue, items, entities]);\n\n  const filterItems = (query, obj, _index, exactMatch) => {\n    const normalizedTitle = obj.name.toLowerCase();\n    const normalizedQuery = query.toLowerCase();\n    if (exactMatch) {\n      return normalizedTitle === normalizedQuery;\n    } else {\n      let string = \"\";\n      for (let key in obj) {\n        string += obj[key] + \". \";\n      }\n      const result = string.toLowerCase().indexOf(normalizedQuery) >= 0;\n      return result;\n    }\n  };\n\n  return (\n    <div onBlur={(e) => setFieldTouched(name)}>\n      <Suggest\n        id={id}\n        name={name}\n        items={items}\n        itemRenderer={renderOption}\n        itemListRenderer={renderItemList}\n        inputValueRenderer={(item) =>\n          entities && entities[type][item]\n            ? entities[type][item].name\n            : item.name\n        }\n        inputProps={{\n          intent: errors && touched ? Intent.DANGER : null,\n          \"data-testid\": \"base-suggest\",\n        }}\n        onItemSelect={(e) => {\n          if (onItemSelect) {\n            const result = onItemSelect(e, type);\n            setCurrItem(result);\n            handleChange(name, result, e);\n          } else {\n            setCurrItem(e);\n            handleChange(name, e.id, e);\n          }\n          setQuery(\"\");\n        }}\n        popoverProps={{ usePortal: false }}\n        itemPredicate={filterItems}\n        selectedItem={currItem}\n        query={query}\n        onQueryChange={(q) => setQuery(q)}\n        resetOnQuery={true}\n      />\n    </div>\n  );\n}\n\nfunction renderItemList({ filteredItems, renderItem }) {\n  const topResults = filteredItems.slice(0, SUGGEST_SIZE);\n  return (\n    <Menu>\n      {filteredItems.length > 0 ? (\n        <>\n          {topResults.map((item, index) => {\n            return renderItem(item, index);\n          })}\n          {filteredItems.length > SUGGEST_SIZE && (\n            <MenuItem\n              style={{ textAlign: \"center\" }}\n              disabled={true}\n              text=\"...\"\n            />\n          )}\n        </>\n      ) : (\n        <MenuItem disabled={true} text=\"No results.\" />\n      )}\n    </Menu>\n  );\n}\n\nfunction renderOption(obj, { handleClick, modifiers, index }) {\n  if (!modifiers.matchesPredicate) {\n    return null;\n  }\n\n  return (\n    <MenuItem\n      active={modifiers.active}\n      key={index}\n      onClick={handleClick}\n      text={obj.name}\n      shouldDismissPopover={false}\n    />\n  );\n}\n\nexport default BaseSuggest;\n","import React from \"react\";\nimport {\n  Button,\n  FormGroup,\n  Intent,\n  InputGroup,\n  Switch,\n  TextArea,\n  Alignment,\n} from \"@blueprintjs/core\";\nimport { Formik } from \"formik\";\n\nimport BaseSuggest from \"./BaseSuggest\";\n\nfunction ObjectForm({ initialInputs, handleSubmit, type }) {\n  return (\n    <Formik\n      initialValues={initialInputs}\n      validate={(values) => {\n        let errors = {};\n        if (!values.name) {\n          errors.name = \"Required\";\n        }\n        if (!values.name_prefix) {\n          errors.name_prefix = \"Required\";\n        }\n        if (!values.physical_description) {\n          errors.physical_description = \"Required\";\n        }\n        if (!values.base_id) {\n          errors.base_id = \"Required\";\n        }\n        return errors;\n      }}\n      onSubmit={handleSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleChange,\n          handleBlur,\n          handleSubmit,\n          handleReset,\n        } = props;\n\n        const handleSwitch = (e) => {\n          const { name } = e.target;\n          setFieldValue(name, values[name] ? 0 : 1);\n        };\n\n        return (\n          <form data-testid=\"form\">\n            <FormGroup\n              label=\"Name\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-input\"\n            >\n              <InputGroup\n                id=\"name-input\"\n                name=\"name\"\n                intent={errors.name && touched.name ? Intent.DANGER : null}\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name}\n              />\n              {errors.name && touched.name && (\n                <div className=\"form-error\">{errors.name}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Name Prefix\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-prefix-input\"\n            >\n              <InputGroup\n                id=\"name-prefix-input\"\n                name=\"name_prefix\"\n                intent={\n                  errors.name_prefix && touched.name_prefix\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name_prefix}\n              />\n              {errors.name_prefix && touched.name_prefix && (\n                <div className=\"form-error\">{errors.name_prefix}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Physical Description\"\n              labelInfo=\"(required)\"\n              labelFor=\"physical-description-input\"\n            >\n              <TextArea\n                id=\"physical-description-input\"\n                name=\"physical_description\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.physical_description && touched.physical_description\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.physical_description}\n              />\n              {errors.physical_description && touched.physical_description && (\n                <div className=\"form-error\">{errors.physical_description}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Base Object\"\n              labelInfo=\"(required)\"\n              labelFor=\"base-id-input\"\n            >\n              <BaseSuggest\n                id=\"base-id-input\"\n                name=\"base_id\"\n                type={`base_${type}`}\n                errors={errors.base_id}\n                touched={touched.base_id}\n                setFieldTouched={setFieldTouched}\n                formValue={values.base_id}\n                handleChange={setFieldValue}\n              />\n              {errors.base_id && touched.base_id && (\n                <div className=\"form-error\">{errors.base_id}</div>\n              )}\n            </FormGroup>\n            <FormGroup label=\"Properties\" labelInfo=\"(required)\" large={true}>\n              <div style={{ marginLeft: \"15px\", width: \"150px\" }}>\n                <Switch\n                  label=\"Container\"\n                  name=\"is_container\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_container}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Drink\"\n                  name=\"is_drink\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_drink}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Food\"\n                  name=\"is_food\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_food}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Gettable\"\n                  name=\"is_gettable\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_gettable}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Plural\"\n                  name=\"is_plural\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_plural}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Surface\"\n                  name=\"is_surface\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_surface}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Weapon\"\n                  name=\"is_weapon\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_weapon}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Wearable\"\n                  name=\"is_wearable\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_wearable}\n                  alignIndicator={Alignment.RIGHT}\n                />\n              </div>\n            </FormGroup>\n\n            <Button\n              type=\"reset\"\n              onClick={handleReset}\n              disabled={!dirty}\n              style={{ marginRight: \"15px\" }}\n            >\n              Reset\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              type=\"submit\"\n              onClick={handleSubmit}\n              disabled={!dirty || !isValid}\n              style={{ marginLeft: \"15px\" }}\n            >\n              Save Changes\n            </Button>\n          </form>\n        );\n      }}\n    </Formik>\n  );\n}\n\nexport const emptyObjectForm = {\n  name: \"\",\n  name_prefix: \"\",\n  physical_description: \"\",\n  base_id: 0,\n  is_container: 0,\n  is_drink: 0,\n  is_food: 0,\n  is_gettable: 0,\n  is_plural: 0,\n  is_surface: 0,\n  is_weapon: 0,\n  is_wearable: 0,\n};\n\nexport default ObjectForm;\n","import React from \"react\";\nimport {\n  Button,\n  FormGroup,\n  Intent,\n  InputGroup,\n  Switch,\n  TextArea,\n  Alignment,\n} from \"@blueprintjs/core\";\nimport { Formik } from \"formik\";\n\nimport BaseSuggest from \"./BaseSuggest\";\n\nfunction CharacterForm({ initialInputs, handleSubmit, type }) {\n  return (\n    <Formik\n      initialValues={initialInputs}\n      validate={(values) => {\n        let errors = {};\n        if (!values.name) {\n          errors.name = \"Required\";\n        }\n        if (!values.name_prefix) {\n          errors.name_prefix = \"Required\";\n        }\n        if (!values.persona) {\n          errors.persona = \"Required\";\n        }\n        if (!values.physical_description) {\n          errors.physical_description = \"Required\";\n        }\n        if (!values.char_type) {\n          errors.char_type = \"Required\";\n        }\n        if (!values.base_id) {\n          errors.base_id = \"Required\";\n        }\n        return errors;\n      }}\n      onSubmit={handleSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleChange,\n          handleBlur,\n          handleSubmit,\n          handleReset,\n        } = props;\n\n        const handleSwitch = (e) => {\n          const { name } = e.target;\n          setFieldValue(name, values[name] ? 0 : 1);\n        };\n\n        return (\n          <form data-testid=\"form\">\n            <FormGroup\n              label=\"Name\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-input\"\n            >\n              <InputGroup\n                id=\"name-input\"\n                name=\"name\"\n                intent={errors.name && touched.name ? Intent.DANGER : null}\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name}\n              />\n              {errors.name && touched.name && (\n                <div className=\"form-error\">{errors.name}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Name Prefix\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-prefix-input\"\n            >\n              <InputGroup\n                id=\"name-prefix-input\"\n                name=\"name_prefix\"\n                intent={\n                  errors.name_prefix && touched.name_prefix\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name_prefix}\n              />\n              {errors.name_prefix && touched.name_prefix && (\n                <div className=\"form-error\">{errors.name_prefix}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Persona\"\n              labelInfo=\"(required)\"\n              labelFor=\"persona-input\"\n            >\n              <TextArea\n                id=\"persona-input\"\n                name=\"persona\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.persona && touched.persona ? Intent.DANGER : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.persona}\n              />\n              {errors.persona && touched.persona && (\n                <div className=\"form-error\">{errors.persona}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Physical Description\"\n              labelInfo=\"(required)\"\n              labelFor=\"physical-description-input\"\n            >\n              <TextArea\n                id=\"physical-description-input\"\n                name=\"physical_description\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.physical_description && touched.physical_description\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.physical_description}\n              />\n              {errors.physical_description && touched.physical_description && (\n                <div className=\"form-error\">{errors.physical_description}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Character Type\"\n              labelInfo=\"(required)\"\n              labelFor=\"char-type-input\"\n            >\n              <InputGroup\n                id=\"char-type-input\"\n                name=\"char_type\"\n                intent={\n                  errors.char_type && touched.char_type ? Intent.DANGER : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.char_type}\n              />\n              {errors.char_type && touched.char_type && (\n                <div className=\"form-error\">{errors.char_type}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Base Character\"\n              labelInfo=\"(required)\"\n              labelFor=\"base-id-input\"\n            >\n              <BaseSuggest\n                id=\"base-id-input\"\n                name=\"base_id\"\n                type={`base_${type}`}\n                errors={errors.base_id}\n                touched={touched.base_id}\n                setFieldTouched={setFieldTouched}\n                formValue={values.base_id}\n                handleChange={setFieldValue}\n              />\n              {errors.base_id && touched.base_id && (\n                <div className=\"form-error\">{errors.base_id}</div>\n              )}\n            </FormGroup>\n            <FormGroup label=\"Properties\" labelInfo=\"(required)\" large={true}>\n              <div style={{ marginLeft: \"15px\", width: \"150px\" }}>\n                <Switch\n                  label=\"Plural\"\n                  name=\"is_plural\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_plural}\n                  alignIndicator={Alignment.RIGHT}\n                />\n              </div>\n            </FormGroup>\n\n            <Button\n              type=\"reset\"\n              onClick={handleReset}\n              disabled={!dirty}\n              style={{ marginRight: \"15px\" }}\n            >\n              Reset\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              type=\"submit\"\n              onClick={handleSubmit}\n              disabled={!dirty || !isValid}\n              style={{ marginLeft: \"15px\" }}\n            >\n              Save Changes\n            </Button>\n          </form>\n        );\n      }}\n    </Formik>\n  );\n}\n\nexport const emptyCharacterForm = {\n  name: \"\",\n  name_prefix: \"\",\n  persona: \"\",\n  physical_description: \"\",\n  char_type: \"\",\n  base_id: 0,\n  is_plural: 0,\n};\n\nexport default CharacterForm;\n","import React from \"react\";\nimport {\n  Button,\n  FormGroup,\n  Intent,\n  InputGroup,\n  TextArea,\n} from \"@blueprintjs/core\";\nimport { Formik } from \"formik\";\n\nimport BaseSuggest from \"./BaseSuggest\";\n\nfunction RoomForm({ initialInputs, handleSubmit, type }) {\n  return (\n    <Formik\n      initialValues={initialInputs}\n      validate={(values) => {\n        let errors = {};\n        if (!values.name) {\n          errors.name = \"Required\";\n        }\n        if (!values.description) {\n          errors.description = \"Required\";\n        }\n        if (!values.backstory) {\n          errors.backstory = \"Required\";\n        }\n        if (!values.base_id) {\n          errors.base_id = \"Required\";\n        }\n        return errors;\n      }}\n      onSubmit={handleSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleChange,\n          handleBlur,\n          handleSubmit,\n          handleReset,\n        } = props;\n\n        return (\n          <form data-testid=\"form\">\n            <FormGroup\n              label=\"Name\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-input\"\n            >\n              <InputGroup\n                id=\"name-input\"\n                name=\"name\"\n                intent={errors.name && touched.name ? Intent.DANGER : null}\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name}\n              />\n              {errors.name && touched.name && (\n                <div className=\"form-error\">{errors.name}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Description\"\n              labelInfo=\"(required)\"\n              labelFor=\"description-input\"\n            >\n              <TextArea\n                id=\"description-input\"\n                name=\"description\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.description && touched.description\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.description}\n              />\n              {errors.description && touched.description && (\n                <div className=\"form-error\">{errors.description}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Backstory\"\n              labelInfo=\"(required)\"\n              labelFor=\"backstory-input\"\n            >\n              <TextArea\n                id=\"backstory-input\"\n                name=\"backstory\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.backstory && touched.backstory ? Intent.DANGER : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.backstory}\n              />\n              {errors.backstory && touched.backstory && (\n                <div className=\"form-error\">{errors.backstory}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Base Room\"\n              labelInfo=\"(required)\"\n              labelFor=\"base-id-input\"\n            >\n              <BaseSuggest\n                id=\"base-id-input\"\n                name=\"base_id\"\n                type={`base_${type}`}\n                errors={errors.base_id}\n                touched={touched.base_id}\n                setFieldTouched={setFieldTouched}\n                formValue={values.base_id}\n                handleChange={setFieldValue}\n              />\n              {errors.base_id && touched.base_id && (\n                <div className=\"form-error\">{errors.base_id}</div>\n              )}\n            </FormGroup>\n            <Button\n              type=\"reset\"\n              onClick={handleReset}\n              disabled={!dirty}\n              style={{ marginRight: \"15px\" }}\n            >\n              Reset\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              type=\"submit\"\n              onClick={handleSubmit}\n              disabled={!dirty || !isValid}\n              style={{ marginLeft: \"15px\" }}\n            >\n              Save Changes\n            </Button>\n          </form>\n        );\n      }}\n    </Formik>\n  );\n}\n\nexport const emptyRoomForm = {\n  name: \"\",\n  description: \"\",\n  backstory: \"\",\n  base_id: 0,\n};\n\nexport default RoomForm;\n","import { Position, Toaster } from \"@blueprintjs/core\";\n\nconst AppToaster = Toaster.create({\n  position: Position.TOP,\n});\n\nexport default AppToaster;\n","import React from \"react\";\nimport { Radio, RadioGroup, Intent } from \"@blueprintjs/core\";\nimport { useHistory } from \"react-router-dom\";\n\nimport { post } from \"../utils\";\nimport ObjectForm, { emptyObjectForm } from \"./forms/ObjectForm\";\nimport CharacterForm, { emptyCharacterForm } from \"./forms/CharacterForm\";\nimport RoomForm, { emptyRoomForm } from \"./forms/RoomForm\";\nimport AppToaster from \"./AppToaster\";\n\nfunction CreatePage({ location }) {\n  const [formType, setFormType] = React.useState(\n    location.state ? location.state.type : \"object\"\n  );\n\n  return (\n    <div>\n      <h2\n        data-testid=\"header\"\n        className=\"bp3-heading\"\n        style={{ marginBottom: 15 }}\n      >\n        Create new entity\n      </h2>\n      <div className=\"bp3-text-large\">\n        <div style={{ display: \"flex\", marginBottom: 30 }}>\n          <span style={{ marginRight: \"20px\" }}>Entity type:</span>\n          <RadioGroup\n            inline\n            large\n            onChange={(e) => {\n              location.state = undefined;\n              setFormType(e.target.value);\n            }}\n            selectedValue={formType}\n          >\n            <Radio data-testid=\"radio-object\" label=\"Object\" value=\"object\" />\n            <Radio\n              data-testid=\"radio-character\"\n              label=\"Character\"\n              value=\"character\"\n            />\n            <Radio data-testid=\"radio-room\" label=\"Room\" value=\"room\" />\n          </RadioGroup>\n        </div>\n        <CreateForm\n          type={formType}\n          initialInputs={location.state ? location.state.entity : undefined}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction CreateForm({ type, initialInputs }) {\n  const history = useHistory();\n  const submitEntity = async (payload) => {\n    await post(`builder/entities/${type}`, payload).then(() => {\n      history.push(\"/\");\n    });\n    AppToaster.show({\n      intent: Intent.SUCCESS,\n      message: \"Successfully created entity\",\n    });\n  };\n\n  switch (type) {\n    case \"object\":\n      return (\n        <ObjectForm\n          type={type}\n          initialInputs={initialInputs ? initialInputs : emptyObjectForm}\n          handleSubmit={submitEntity}\n        />\n      );\n    case \"character\":\n      return (\n        <CharacterForm\n          type={type}\n          initialInputs={initialInputs ? initialInputs : emptyCharacterForm}\n          handleSubmit={submitEntity}\n        />\n      );\n    case \"room\":\n      return (\n        <RoomForm\n          type={type}\n          initialInputs={initialInputs ? initialInputs : emptyRoomForm}\n          handleSubmit={submitEntity}\n        />\n      );\n    default:\n      return \"This entity cannot be created at the moment\";\n  }\n}\n\nexport default CreatePage;\n","import React from \"react\";\nimport {\n  Button,\n  Checkbox,\n  Classes,\n  Dialog,\n  Intent,\n  Radio,\n  RadioGroup,\n  Spinner,\n} from \"@blueprintjs/core\";\nimport DiffMatchPatch from \"diff-match-patch\";\nimport AnimateHeight from \"react-animate-height\";\nimport { startCase, fill } from \"lodash\";\n\nimport CONFIG from \"../config\";\nimport { useAPI, post } from \"../utils\";\nimport AppToaster from \"./AppToaster\";\n\nfunction ReviewPage() {\n  const [selectedStatus, setSelectedStatus] = React.useState(\"under review\");\n\n  const { loading, result, reload } = useAPI(\n    CONFIG,\n    `/edits?expand=true&status=${selectedStatus}`\n  );\n\n  return (\n    <div>\n      <h2 data-testid=\"header\" className=\"bp3-heading\">\n        Review\n      </h2>\n      <div className=\"bp3-text-large\">\n        Review pending, accepted, and rejected edits to the LIGHT database.\n      </div>\n      <br />\n      <div style={{ display: \"flex\", marginBottom: \"30px\" }}>\n        <span style={{ margin: \"0px 20px 0px 40px\" }}>Searching category:</span>\n        <RadioGroup\n          inline\n          large\n          onChange={(e) => setSelectedStatus(e.target.value)}\n          selectedValue={selectedStatus}\n        >\n          <Radio\n            data-testid=\"radio-under-review\"\n            label=\"Under Review\"\n            value=\"under review\"\n          />\n          <Radio\n            data-testid=\"radio-accepted\"\n            label=\"Accepted\"\n            value=\"accepted\"\n          />\n          <Radio\n            data-testid=\"radio-rejected\"\n            label=\"Rejected\"\n            value=\"rejected\"\n          />\n        </RadioGroup>\n      </div>\n      {loading ? (\n        <Spinner intent={Intent.PRIMARY} />\n      ) : (\n        <EditsList edits={result} status={selectedStatus} reload={reload} />\n      )}\n    </div>\n  );\n}\n\nfunction EditsList({ edits, status, reload }) {\n  const [state, setState] = React.useState({\n    expanded: -1,\n    animating: 0,\n    nextState: -1,\n  });\n  const [selected, setSelected] = React.useState({ rows: [], all: 0 });\n  const [submitAction, setSubmitAction] = React.useState(undefined);\n  const [showDialog, setShowDialog] = React.useState(false);\n  const [pendingSubmission, setPendingSubmission] = React.useState([]);\n\n  if (edits && edits.length > 0 && selected.rows.length === 0) {\n    setSelected({ ...selected, rows: fill(Array(edits.length), false) });\n  }\n\n  function handleTdClick(index) {\n    if (status === \"under review\") {\n      if (state.expanded === -1) {\n        setState({ expanded: index, animating: 1, nextState: -1 });\n      } else if (state.expanded === index) {\n        setState({ expanded: index, animating: 3, nextState: -1 });\n      } else {\n        setState({ ...state, animating: 3, nextState: index });\n      }\n    }\n  }\n\n  function handleCheckbox(index) {\n    const newSelection = [...selected.rows];\n    newSelection[index] = selected.rows[index] ? false : true;\n    let all = selected.all;\n    if (newSelection.every((r) => r === true)) {\n      all = 1;\n    } else if (newSelection.every((r) => r === false)) {\n      all = 0;\n    } else {\n      all = -1;\n    }\n    setSelected({ rows: newSelection, all });\n  }\n\n  function handleSelectAll() {\n    const all = selected.all ? 0 : 1;\n    const newRows = fill(Array(edits.length), !!all);\n    setSelected({ rows: newRows, all });\n  }\n\n  async function handleSubmitSelected() {\n    const reqs = pendingSubmission.map((index) =>\n      post(`builder/edits/${edits[index].edit_id}/${submitAction}`)\n    );\n    await Promise.all(reqs).then(() => {\n      reload();\n    });\n    AppToaster.show({ intent: Intent.SUCCESS, message: \"Review submitted\" });\n  }\n\n  const showSubmission = (action) => {\n    const checked = [];\n    for (let i = 0; i < selected.rows.length; i++) {\n      if (selected.rows[i]) {\n        checked.push(i);\n      }\n    }\n    setPendingSubmission(checked);\n    setSubmitAction(action);\n    setShowDialog(true);\n  };\n\n  if (edits === undefined || edits.length === 0) {\n    return <span>No edits found.</span>;\n  } else {\n    return (\n      <>\n        <Dialog\n          icon=\"info-sign\"\n          onClose={() => setShowDialog(false)}\n          title={`Confirm edits to be ${\n            submitAction === \"reject\" ? \"rejected\" : \"accepted\"\n          }`}\n          isOpen={showDialog}\n          usePortal={false}\n        >\n          <div className={Classes.DIALOG_BODY}>\n            <table className=\"bp3-html-table bp3-html-table-condensed bp3-interactive\">\n              <thead>\n                <tr>\n                  <th>Edit ID</th>\n                  <th>Entity ID</th>\n                  <th>Edited Field</th>\n                </tr>\n              </thead>\n              <tbody>\n                {pendingSubmission.map((edit, index) => {\n                  return (\n                    <tr key={index}>\n                      <td>{edits[edit].edit_id}</td>\n                      <td>{edits[edit].id}</td>\n                      <td>{edits[edit].field}</td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n          <div className={Classes.DIALOG_FOOTER}>\n            <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n              <Button onClick={() => setShowDialog(false)}>Close</Button>\n              <Button intent={Intent.PRIMARY} onClick={handleSubmitSelected}>\n                Confirm Edits\n              </Button>\n            </div>\n          </div>\n        </Dialog>\n        <table\n          data-testid=\"table-review\"\n          style={{ width: \"100%\" }}\n          className=\"bp3-html-table bp3-html-table-condensed bp3-interactive\"\n        >\n          <thead>\n            <tr>\n              {status === \"under review\" && (\n                <th style={{ textAlign: \"center\" }}>\n                  <Checkbox\n                    checked={selected.all}\n                    indeterminate={selected.all === -1}\n                    onClick={handleSelectAll}\n                  />\n                </th>\n              )}\n              <th>Edit ID</th>\n              <th>Entity ID</th>\n              <th>Edited Field</th>\n              <th>Edit</th>\n            </tr>\n          </thead>\n          <tbody>\n            {edits.map((edit, index) => (\n              <React.Fragment key={edit.edit_id}>\n                <tr\n                  data-testid=\"tr-review\"\n                  style={{\n                    background:\n                      index % 2 === 0 ? \"rgba(191, 204, 214, 0.15)\" : undefined,\n                  }}\n                >\n                  {status === \"under review\" && (\n                    <td style={{ textAlign: \"center\" }}>\n                      <Checkbox\n                        checked={selected.rows[index]}\n                        onClick={() => handleCheckbox(index)}\n                      />\n                    </td>\n                  )}\n                  <td onClick={() => handleTdClick(index)}>{edit.edit_id}</td>\n                  <td onClick={() => handleTdClick(index)}>\n                    <strong>{edit.id}</strong>\n                  </td>\n                  <td onClick={() => handleTdClick(index)}>{edit.field}</td>\n                  <td onClick={() => handleTdClick(index)}>\n                    {diff(edit.unedited_value, edit.edited_value)}\n                  </td>\n                </tr>\n                <tr\n                  style={{\n                    background:\n                      index % 2 === 0 ? \"rgba(191, 204, 214, 0.15)\" : undefined,\n                  }}\n                >\n                  <td\n                    colSpan={5}\n                    style={{\n                      display: state.expanded === index ? undefined : \"none\",\n                      padding: 0,\n                      cursor: \"unset\",\n                    }}\n                  >\n                    <AnimateHeight\n                      duration={500}\n                      height={\n                        state.expanded === index &&\n                        (state.animating === 2 || state.animating === 0)\n                          ? \"auto\"\n                          : 0\n                      }\n                      easing={\"ease\"}\n                      onAnimationEnd={() =>\n                        setState({\n                          nextState: -1,\n                          expanded:\n                            state.animating === 2 ? index : state.nextState,\n                          animating:\n                            state.animating === 3 && state.nextState !== -1\n                              ? 1\n                              : 0,\n                        })\n                      }\n                      animateOpacity={true}\n                    >\n                      {state.expanded === index && (\n                        <ExpandedTab\n                          edit={edit}\n                          state={state}\n                          setState={setState}\n                          reload={reload}\n                        />\n                      )}\n                    </AnimateHeight>\n                  </td>\n                </tr>\n              </React.Fragment>\n            ))}\n          </tbody>\n        </table>\n        {status === \"under review\" && (\n          <div\n            style={{\n              display: \"flex\",\n              margin: \"10px\",\n              justifyContent: \"flex-end\",\n            }}\n          >\n            <Button\n              intent={Intent.DANGER}\n              type=\"submit\"\n              onClick={() => showSubmission(\"reject\")}\n              style={{ marginLeft: \"15px\" }}\n              disabled={!selected.all}\n            >\n              Reject\n            </Button>\n            <Button\n              intent={Intent.SUCCESS}\n              type=\"submit\"\n              onClick={() => showSubmission(\"accept/accepted\")}\n              style={{ marginLeft: \"15px\" }}\n              disabled={!selected.all}\n            >\n              Accept\n            </Button>\n          </div>\n        )}\n      </>\n    );\n  }\n}\n\nfunction ExpandedTab({ edit, state, setState, reload }) {\n  const { loading, result } = useAPI(CONFIG, `/entities/${edit.id}`);\n  React.useEffect(() => {\n    if (result && state.animating === 1) {\n      setState({ ...state, animating: 2 });\n    }\n  }, [loading, setState, state, result]);\n  return (\n    <>\n      {loading ? (\n        <></>\n      ) : (\n        <Card edit={edit} entity={result.entity} reload={reload} />\n      )}\n    </>\n  );\n}\n\nfunction Card({ edit, entity, reload }) {\n  delete entity.id;\n  return (\n    <>\n      <div\n        data-testid=\"dropdown\"\n        style={{\n          display: \"flex\",\n          flexDirection: \"row\",\n          padding: \"20px 20px 0 20px\",\n          alignItems: \"center\",\n        }}\n      >\n        <div style={{ flexGrow: 1 }}>\n          <div\n            style={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              width: \"50%\",\n              maxWidth: \"30vw\",\n              margin: \"auto\",\n            }}\n          >\n            {Object.keys(entity).map((key, index) => (\n              <p\n                key={index}\n                style={{ color: key === edit.field ? \"#DB3737\" : undefined }}\n              >\n                <strong>{startCase(key)}</strong>: {entity[key]}\n              </p>\n            ))}\n          </div>\n        </div>\n        <div style={{ height: \"100%\", fontSize: \"20px\", color: \"#394B59\" }}>\n          \n        </div>\n        <div style={{ flexGrow: 1 }}>\n          <div\n            style={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              width: \"50%\",\n              maxWidth: \"30vw\",\n              margin: \"auto\",\n            }}\n          >\n            {Object.keys(entity).map((key, index) => (\n              <p\n                key={index}\n                style={{ color: key === edit.field ? \"#0F9960\" : undefined }}\n              >\n                <strong>{startCase(key)}</strong>:{\" \"}\n                {key === edit.field ? edit.edited_value : entity[key]}\n              </p>\n            ))}\n          </div>\n        </div>\n      </div>\n      <div\n        style={{\n          display: \"flex\",\n          padding: \"0 20px 20px 20px\",\n          justifyContent: \"flex-end\",\n        }}\n      >\n        <Button\n          intent={Intent.DANGER}\n          type=\"submit\"\n          onClick={() =>\n            post(`builder/edits/${edit.edit_id}/reject`).then(() => reload())\n          }\n          style={{ marginLeft: \"15px\" }}\n        >\n          Reject Edit\n        </Button>\n        <Button\n          intent={Intent.SUCCESS}\n          type=\"submit\"\n          onClick={() =>\n            post(`builder/edits/${edit.edit_id}/accept/accepted`).then(() =>\n              reload()\n            )\n          }\n          style={{ marginLeft: \"15px\" }}\n        >\n          Accept Edit\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction diff(orig, edit) {\n  let diff;\n  if (isNaN(orig) || isNaN(edit)) {\n    const differ = new DiffMatchPatch();\n    diff = differ.diff_main(orig, edit);\n    differ.diff_cleanupSemantic(diff);\n  } else {\n    orig = 0 + orig;\n    edit = 0 + edit;\n    diff = [\n      [-1, +orig],\n      [1, +edit],\n    ];\n  }\n  return (\n    <>\n      {diff.map((d, index) => {\n        switch (d[0]) {\n          case -1:\n            return (\n              <strike key={index} style={{ color: \"#FF7373\" }}>\n                {\" \"}\n                {d[1]}{\" \"}\n              </strike>\n            );\n          case 0:\n            return <strong key={index}>{d[1]}</strong>;\n          case 1:\n            return (\n              <strong key={index} style={{ color: \"#0F9960\" }}>\n                {d[1]}\n              </strong>\n            );\n          default:\n            return <></>;\n        }\n      })}\n    </>\n  );\n}\n\nexport default ReviewPage;\n","import React from \"react\";\nimport { Colors } from \"@blueprintjs/core\";\nimport { cloneDeep, isEmpty, merge } from \"lodash\";\nimport equal from \"fast-deep-equal\";\nimport { emojiIndex } from \"emoji-mart\";\n\nexport const MAX_WIDTH = 10;\nexport const MAX_HEIGHT = 10;\nexport const MAX_FLOORS = 10;\n\nconst STARTING_WIDTH = 3;\nconst STARTING_HEIGHT = 3;\nconst STARTING_FLOORS = 1;\n\nexport const DEFAULT_EMOJI = \"\";\n\nexport const TILE_COLORS = [\n  Colors.GRAY3,\n  Colors.VIOLET5,\n  Colors.RED5,\n  Colors.SEPIA5,\n  Colors.GOLD5,\n  Colors.FOREST5,\n  Colors.BLUE5,\n];\n\nconst grass = [\n  \"grass\",\n  \"field\",\n  \"plains\",\n  \"forest\",\n  \"land\",\n  \"gardens\",\n  \"meadow\",\n  \"woods\",\n  \"jungle\",\n  \"swamp\",\n  \"green\",\n];\nconst water = [\n  \"water\",\n  \"lake\",\n  \"river\",\n  \"ocean\",\n  \"sea\",\n  \"pond\",\n  \"lagoon\",\n  \"shore\",\n  \"blue\",\n];\nconst buildings = [\n  \"castle\",\n  \"fortress\",\n  \"church\",\n  \"cathedral\",\n  \"tower\",\n  \"building\",\n  \"cave\",\n  \"gray\",\n  \"grey\",\n];\nconst royal = [\"king\", \"queen\", \"palace\", \"purple\"];\nconst brick = [\"brick\", \"fire\", \"red\"];\nconst path = [\"path\", \"road\", \"bridge\", \"brown\"];\nconst farm = [\"farm\", \"cottage\", \"sand\", \"beach\", \"yellow\", \"gold\"];\n\n/**\n * Utility function for suggesting a biome (tile color) for a given room name\n */\nexport function findBiome(name, current) {\n  const lowName = name.toLowerCase();\n  if (grass.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.FOREST5;\n  }\n  if (water.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.BLUE5;\n  }\n  if (brick.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.RED5;\n  }\n  if (path.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.SEPIA5;\n  }\n  if (farm.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.GOLD5;\n  }\n  if (buildings.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.GRAY3;\n  }\n  if (royal.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.VIOLET5;\n  }\n  return current;\n}\n\n/**\n * Utility function for determining whether content should be \"white\" or \"black\" on a color background\n */\nexport function invertColor(hex) {\n  if (hex.indexOf(\"#\") === 0) {\n    hex = hex.slice(1);\n  }\n  // convert 3-digit hex to 6-digits.\n  if (hex.length === 3) {\n    hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n  }\n  // invert color components\n  var r = parseInt(hex.slice(0, 2), 16),\n    g = parseInt(hex.slice(2, 4), 16),\n    b = parseInt(hex.slice(4, 6), 16);\n  // pick black/white based on intensity\n  return r * 0.299 + g * 0.587 + b * 0.114 > 150 ? \"#182026\" : \"#F5F8FA\";\n}\n\nexport function findEmoji(name) {\n  let results = emojiIndex.search(name);\n  if (results[0]) {\n    return results[0].native;\n  }\n  const words = name.split(\" \");\n  for (let i = 0; i < words.length; i++) {\n    let string = words[i];\n    if (words[i].charAt(words[i].length - 1) === \"s\") {\n      string = words[i].substring(0, words[i].length - 1);\n    }\n    results = emojiIndex.search(string);\n    if (results[0]) {\n      return results[0].native;\n    }\n  }\n  return DEFAULT_EMOJI;\n}\n\nconst mapReducer = (state, action) => {\n  switch (action.type) {\n    case \"SET_MAP\":\n      return action.map;\n    case \"SET_TILE\":\n      return state.map((floor, floorIndex) => {\n        if (floorIndex === action.floor) {\n          return {\n            ...floor,\n            tiles: {\n              ...floor.tiles,\n              [`${action.x} ${action.y}`]: action.newTile,\n            },\n          };\n        } else {\n          return floor;\n        }\n      });\n    case \"EDIT_FLOOR_NAME\":\n      return state.map((floor, floorIndex) => {\n        if (floorIndex === action.floor) {\n          return {\n            ...floor,\n            name: action.name,\n          };\n        } else {\n          return floor;\n        }\n      });\n\n    default:\n      return state;\n  }\n};\n\nconst createdEntitiesReducer = (state, action) => {\n  switch (action.type) {\n    case \"SET_ALL\":\n      return action.entities;\n    case \"ADD_ENTITY\": {\n      return Object.assign({}, state, {\n        [action.entityType]: {\n          ...state[action.entityType],\n          [state.nextID]: action.data,\n        },\n        nextID: state.nextID + 1,\n      });\n    }\n    case \"EDIT_ENTITY\": {\n      return merge(state, {\n        [action.entityType]: { [action.id]: action.data },\n      });\n    }\n    default:\n      return state;\n  }\n};\n\n/**\n * Custom hook managing map state.\n * Includes utility functions for setting state of the map.\n */\nexport function useWorldBuilder(upload) {\n  const [dimensions, setDimensions] = React.useState(\n    upload\n      ? upload.data.dimensions\n      : {\n          name: null,\n          height: STARTING_HEIGHT,\n          width: STARTING_WIDTH,\n          floors: STARTING_FLOORS,\n        }\n  );\n\n  // Floors and tiles kept seperate to avoid unnecessary updates on either side\n  // The index key is used because the Reorder component does not pass index to children\n  // Represents the map state\n  // Structured as: Array(Map(name: FloorName, tiles: Map(x y': TileData), walls: Map('x1 y1|x2 y2': Wall)))\n  const initialMap = upload\n    ? upload.data.map\n    : [{ name: \"1F\", tiles: {}, walls: {} }];\n  const [map, mapDispatch] = React.useReducer(mapReducer, initialMap);\n\n  // Local entity store\n  const [entities, entitiesDispatch] = React.useReducer(\n    createdEntitiesReducer,\n    upload\n      ? upload.data.entities\n      : { room: {}, character: {}, object: {}, nextID: 1 }\n  );\n\n  // Floor currently being viewed in the editor\n  const [currFloor, setCurrFloor] = React.useState(0);\n\n  // make sure all floors are in the map\n  React.useEffect(() => {\n    const newMap = [];\n    for (let f = 0; f < dimensions.floors; f++) {\n      newMap.push(\n        map[f] ? map[f] : { name: `${f + 1}F`, tiles: {}, walls: {} }\n      );\n    }\n    mapDispatch({ type: \"SET_MAP\", map: newMap });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dimensions]);\n\n  // Add an entity to the local store and return its temporary id\n  const addEntity = (data, entityType) => {\n    const id = entities.nextID;\n    entitiesDispatch({ type: \"ADD_ENTITY\", data, entityType });\n    return id;\n  };\n\n  // Edit an entity in the local store\n  const editEntity = (id, data, entityType) => {\n    entitiesDispatch({ type: \"EDIT_ENTITY\", id, data, entityType });\n  };\n\n  // Return the id of the entity in the store, or add it to the store and return the new id\n  const findOrAddEntity = (data, entityType) => {\n    for (let entity in entities[entityType]) {\n      if (equal(entities[entityType][entity], data)) {\n        return entity;\n      }\n    }\n    return addEntity(data, entityType);\n  };\n\n  // Change data in a specific tile on the map\n  const setTile = (x, y, newTile, floor = currFloor) => {\n    mapDispatch({ type: \"SET_TILE\", x, y, newTile, floor });\n  };\n\n  // Clear data on a tile\n  const clearTile = (x, y, floor = currFloor) => {\n    const newMap = cloneDeep(map);\n    removeStairsTile(x, y, newMap);\n    delete newMap[floor].tiles[`${x} ${y}`];\n    mapDispatch({ type: \"SET_MAP\", map: newMap });\n  };\n\n  // Swap the position of two tiles on the current floor\n  const swapTiles = (x1, y1, x2, y2) => {\n    mapDispatch({\n      type: \"SET_MAP\",\n      map: map.map((floor, f) => {\n        if (f === currFloor) {\n          removeStairsTile(x1, y1);\n          removeStairsTile(x2, y2);\n          return {\n            ...floor,\n            tiles: {\n              ...floor.tiles,\n              [`${x1} ${y1}`]: floor.tiles[`${x2} ${y2}`],\n              [`${x2} ${y2}`]: floor.tiles[`${x1} ${y1}`],\n            },\n          };\n        } else {\n          return floor;\n        }\n      }),\n    });\n  };\n\n  // Add a row to the top of the map on all floors\n  const addRowTop = () => {\n    mapDispatch({\n      type: \"SET_MAP\",\n      map: map.map((floor) => {\n        const tileKeys = Object.keys(floor.tiles);\n        const newTiles = {};\n        tileKeys.forEach((key) => {\n          const [x, y] = key.split(\" \");\n          newTiles[`${x} ${parseInt(y) + 1}`] = floor.tiles[key];\n        });\n        const wallKeys = Object.keys(floor.walls);\n        const newWalls = {};\n        wallKeys.forEach((key) => {\n          const [t1, t2] = key.split(\"|\");\n          const [x1, y1] = t1.split(\" \");\n          const [x2, y2] = t2.split(\" \");\n          newWalls[`${x1} ${parseInt(y1) + 1}|${x2} ${parseInt(y2) + 1}`] =\n            floor.walls[key];\n        });\n        return { ...floor, tiles: newTiles, walls: newWalls };\n      }),\n    });\n    setDimensions({ ...dimensions, height: dimensions.height + 1 });\n  };\n\n  // Add a row to the bottom of the map on all floors\n  const addRowBot = () => {\n    setDimensions({ ...dimensions, height: dimensions.height + 1 });\n  };\n\n  // Add a column to the left side of the map on all floors\n  const addColFront = () => {\n    mapDispatch({\n      type: \"SET_MAP\",\n      map: map.map((floor) => {\n        const tileKeys = Object.keys(floor.tiles);\n        const newTiles = {};\n        tileKeys.forEach((key) => {\n          const [x, y] = key.split(\" \");\n          newTiles[`${parseInt(x) + 1} ${y}`] = floor.tiles[key];\n        });\n        const wallKeys = Object.keys(floor.walls);\n        const newWalls = {};\n        wallKeys.forEach((key) => {\n          const [t1, t2] = key.split(\"|\");\n          const [x1, y1] = t1.split(\" \");\n          const [x2, y2] = t2.split(\" \");\n          newWalls[`${parseInt(x1) + 1} ${y1}|${parseInt(x2) + 1} ${y2}`] =\n            floor.walls[key];\n        });\n        return { ...floor, tiles: newTiles, walls: newWalls };\n      }),\n    });\n    setDimensions({ ...dimensions, width: dimensions.width + 1 });\n  };\n\n  // Add a column to the right side of the map on all floors\n  const addColEnd = () => {\n    setDimensions({ ...dimensions, width: dimensions.width + 1 });\n  };\n\n  // Add a new floor\n  const addFloor = () => {\n    setDimensions({ ...dimensions, floors: dimensions.floors + 1 });\n  };\n\n  // Edit the name of a floor\n  const editFloorName = (newName, floor) => {\n    mapDispatch({ type: \"EDIT_FLOOR_NAME\", name: newName, floor });\n  };\n\n  // Remove stairs from a tile\n  const removeStairsTile = (x, y, baseMap = map, f = currFloor) => {\n    if (baseMap[f] && baseMap[f].tiles[`${x} ${y}`]) {\n      delete baseMap[f].tiles[`${x} ${y}`].stairDown;\n      delete baseMap[f].tiles[`${x} ${y}`].stairUp;\n    }\n    if (baseMap[f - 1] && baseMap[f - 1].tiles[`${x} ${y}`]) {\n      delete baseMap[f - 1].tiles[`${x} ${y}`].stairUp;\n    }\n    if (baseMap[f + 1] && baseMap[f + 1].tiles[`${x} ${y}`]) {\n      delete baseMap[f + 1].tiles[`${x} ${y}`].stairDown;\n    }\n  };\n\n  // Remove all stairs up or down from a floor\n  const removeStairsFloor = (floor, stair) => {\n    if (!isEmpty(floor) && !isEmpty(floor.tiles)) {\n      Object.keys(floor.tiles).forEach((key) => {\n        if (!isEmpty(floor.tiles[key])) {\n          delete floor.tiles[key][stair];\n        }\n      });\n    }\n  };\n\n  // Delete a floor\n  const deleteFloor = (index) => {\n    const newMap = map.filter((_floor, i) => i !== index);\n    removeStairsFloor(newMap[index - 1], \"stairUp\");\n    removeStairsFloor(newMap[index], \"stairDown\");\n    mapDispatch({ type: \"SET_MAP\", map: newMap });\n\n    if (currFloor >= dimensions.floors - 1) {\n      setCurrFloor(0);\n    }\n    setDimensions({ ...dimensions, floors: dimensions.floors - 1 });\n  };\n\n  // move a floor to a different position\n  const reorderFloors = (i1, i2) => {\n    const reorderedFloor = map[i1];\n    const filteredMap = map.filter((_floor, i) => i !== i1);\n\n    removeStairsFloor(reorderedFloor, \"stairUp\");\n    removeStairsFloor(reorderedFloor, \"stairDown\");\n    removeStairsFloor(filteredMap[i1 - 1], \"stairUp\");\n    removeStairsFloor(filteredMap[i1], \"stairDown\");\n\n    const newMap = [];\n    for (let i = 0; i < dimensions.floors; i++) {\n      newMap.push(\n        i < i2 ? filteredMap[i] : i === i2 ? reorderedFloor : filteredMap[i - 1]\n      );\n    }\n\n    removeStairsFloor(newMap[i2 - 1], \"stairUp\");\n    removeStairsFloor(newMap[i2 + 1], \"stairDown\");\n\n    mapDispatch({ type: \"SET_MAP\", map: newMap });\n\n    if (currFloor === i1) {\n      setCurrFloor(i2);\n    }\n  };\n\n  // Get tile at specified indices, or an empty object otherwise\n  const getTileAt = (x, y, f = currFloor) => {\n    try {\n      return map[f].tiles[`${x} ${y}`];\n    } catch {\n      return {};\n    }\n  };\n\n  // Toggle a wall\n  const toggleWall = (key, f = currFloor) => {\n    if (map[f].walls[key]) {\n      const newMap = cloneDeep(map);\n      delete newMap[f].walls[key];\n      mapDispatch({ type: \"SET_MAP\", map: newMap });\n    } else {\n      mapDispatch({\n        type: \"SET_MAP\",\n        map: map.map((floor, floorIndex) => {\n          if (floorIndex === f) {\n            return { ...floor, walls: { ...floor.walls, [key]: true } };\n          } else {\n            return floor;\n          }\n        }),\n      });\n    }\n  };\n\n  const filteredMap = () => {\n    const filtered = [];\n    for (let i = 0; i < map.length; i++) {\n      const newFloor = { name: map[i].name, walls: map[i].walls };\n      const newTiles = {};\n      for (let tile in map[i].tiles) {\n        const [x, y] = tile.split(\" \");\n        if (x < dimensions.width && y < dimensions.height) {\n          newTiles[tile] = map[i].tiles[tile];\n        }\n      }\n      newFloor.tiles = newTiles;\n      filtered.push(newFloor);\n    }\n    return filtered;\n  };\n\n  const exportWorld = () => {\n    const data = JSON.stringify({ dimensions, map, entities }, null, \"\\t\");\n    var element = document.createElement(\"a\");\n    element.setAttribute(\n      \"href\",\n      \"data:text/plain;charset=utf-8,\" + encodeURIComponent(data)\n    );\n    element.setAttribute(\"download\", `world-${Date.now().toString()}.json`);\n\n    element.style.display = \"none\";\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n  };\n\n  return {\n    floorManager: {\n      setCurrFloor,\n      addFloor,\n      deleteFloor,\n      reorderFloors,\n      editFloorName,\n    },\n    currFloor,\n    map,\n    filteredMap,\n    setTile,\n    clearTile,\n    swapTiles,\n    getTileAt,\n    toggleWall,\n    dimensions,\n    setDimensions,\n    addRowTop,\n    addRowBot,\n    addColFront,\n    addColEnd,\n    entities,\n    editEntity,\n    findOrAddEntity,\n    exportWorld,\n  };\n}\n","// File containing map of edge types to strings, see\n// light/data_model/light_database.py for matching onese\nexport const EDGE_TYPES = {\n  NEIGHBORS_WEST: \"neighbors to the west\",\n  NEIGHBORS_EAST: \"neighbors to the east\",\n  NEIGHBORS_NORTH: \"neighbors to the north\",\n  NEIGHBORS_SOUTH: \"neighbors to the south\",\n  NEIGHBORS_ABOVE: \"neighbors above\",\n  NEIGHBORS_BELOW: \"neighbors below\",\n  CONTAINS: \"contains\",\n};\n","import React from \"react\";\nimport classNames from \"classnames\";\nimport CONFIG from \"../config\";\nimport { post, useAPI } from \"../utils\";\nimport { findEmoji } from \"./worldbuilding/utils\";\nimport AppToaster from \"./AppToaster\";\nimport { Redirect } from \"react-router-dom\";\nimport { Button, Classes, Intent, Overlay, Spinner } from \"@blueprintjs/core\";\nimport { cloneDeep, isEmpty } from \"lodash\";\nimport { EDGE_TYPES } from \"./EdgeTypes\";\n\nfunction ListWorldsOverlay({ isOverlayOpen, setIsOverlayOpen }) {\n  const classes = classNames(Classes.CARD, Classes.ELEVATION_4);\n  var overlay_center = {\n    position: \"absolute\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translate(-50%, -50%)\",\n  };\n  return (\n    <>\n      <div>\n        <Overlay\n          className={Classes.OVERLAY_SCROLL_CONTAINER}\n          isOpen={isOverlayOpen}\n          onClose={() => setIsOverlayOpen(!isOverlayOpen)}\n        >\n          <div className={classes} style={overlay_center}>\n            <ListWorlds\n              isOpen={isOverlayOpen}\n              setIsOverlayOpen={setIsOverlayOpen}\n            />\n            <Button\n              intent={Intent.DANGER}\n              onClick={() => setIsOverlayOpen(!isOverlayOpen)}\n              style={{ margin: \"10px\" }}\n            >\n              Close\n            </Button>\n          </div>\n        </Overlay>\n      </div>\n    </>\n  );\n}\n\nfunction ListWorlds({ isOpen, setIsOverlayOpen }) {\n  const { loading, result, reload } = useAPI(CONFIG, `/worlds/`);\n  const [upload, setUpload] = React.useState(undefined);\n\n  const deleteWorld = async (id) => {\n    const res = await fetch(\n      `${CONFIG.host}:${CONFIG.port}/builder/world/delete/${id}`,\n      {\n        method: \"DELETE\",\n      }\n    );\n  };\n\n  const getAutosave = async () => {\n    const res = await fetch(\n      `${CONFIG.host}:${CONFIG.port}/builder/world/autosave/`,\n      {\n        method: \"GET\",\n      }\n    );\n    const data = await res.json();\n\n    // Mission accomplished!\n    AppToaster.show({\n      intent: Intent.SUCCESS,\n      message: \"Done loading!\",\n    });\n    setUpload(data);\n  };\n\n  /* Given an entity id, its type, and the local entities store, get \n        the matching emoji and associate the type with the id */\n  const storeEntity = (entities, entityId, type, entityToType) => {\n    let entity = entities[type][entityId];\n    entity.emoji = findEmoji(entity.name);\n    entityToType[entityId] = type;\n  };\n\n  /* Given the tiles, go through and intialize maps with the local room it holds\n        and set metadata for the tile */\n  const parseTiles = (tiles, roomToTile) => {\n    tiles.forEach((tile) => {\n      roomToTile[tile.room] = {\n        x: tile.x_coordinate,\n        y: tile.y_coordinate,\n        floor: tile.floor,\n        color: tile.color,\n        room: tile.room,\n        characters: [],\n        objects: [],\n        walls: [true, true, true, true],\n      };\n    });\n  };\n\n  /* Given the edges in the form of (src, dst, type), parse the rooms which contain the objects, \n        as well as the rooms that neighbor above or below for stairs */\n  const parseEdges = (edges, roomToTile, entityToType) => {\n    const dirs = {};\n    dirs[EDGE_TYPES.NEIGHBORS_WEST] = 0;\n    dirs[EDGE_TYPES.NEIGHBORS_EAST] = 1;\n    dirs[EDGE_TYPES.NEIGHBORS_NORTH] = 2;\n    dirs[EDGE_TYPES.NEIGHBORS_SOUTH] = 3;\n\n    edges.forEach((edge) => {\n      if (edge.type === EDGE_TYPES.CONTAINS) {\n        if (entityToType[edge.dst] === \"character\") {\n          roomToTile[edge.src].characters.push(edge.dst);\n        } else if (entityToType[edge.dst] === \"object\") {\n          roomToTile[edge.src].objects.push(edge.dst);\n        } else {\n          throw \"Cannot contain types other than character and object\";\n        }\n      } else if (edge.type === EDGE_TYPES.NEIGHBORS_ABOVE) {\n        roomToTile[edge.src].stairUp = true;\n      } else if (edge.type === EDGE_TYPES.NEIGHBORS_BELOW) {\n        roomToTile[edge.src].stairDown = true;\n      } else {\n        roomToTile[edge.src].walls[dirs[edge.type]] = false;\n      }\n    });\n  };\n\n  /* Given a specific tile and the datMap, add the walls which\n      are true in the wall array for the tile to the map*/\n  const constructWallsForTile = (tileInfo, datMap) => {\n    const neighbors = [\n      `${tileInfo.x - 1} ${tileInfo.y}`,\n      `${tileInfo.x + 1} ${tileInfo.y}`,\n      `${tileInfo.x} ${tileInfo.y - 1}`,\n      `${tileInfo.x} ${tileInfo.y + 1}`,\n    ];\n    let myLoc = `${tileInfo.x} ${tileInfo.y}`;\n    for (let i = 0; i < tileInfo.walls.length; i++) {\n      if (tileInfo.walls[i]) {\n        let otherLoc = neighbors[i];\n        // Need to sort in order for upload to work!\n        if (otherLoc < myLoc) {\n          datMap[tileInfo.floor].walls[otherLoc + \"|\" + myLoc] = true;\n        } else {\n          datMap[tileInfo.floor].walls[myLoc + \"|\" + otherLoc] = true;\n        }\n      }\n    }\n  };\n\n  /* Given the metadata for tiles, construct the format expected by the frontend which\n        involves mapping x, y, and floor into the map then storing the other data */\n  const constructTilesAndWalls = (roomToTile, datMap) => {\n    Object.keys(roomToTile).forEach((roomId) => {\n      let tileInfo = roomToTile[roomId];\n      const temp = {\n        room: tileInfo.room,\n        characters: tileInfo.characters,\n        objects: tileInfo.objects,\n        color: tileInfo.color,\n      };\n      if (tileInfo.stairUp) {\n        temp.stairUp = true;\n      } else if (tileInfo.stairDown) {\n        temp.stairDown = true;\n      }\n      datMap[tileInfo.floor].tiles[tileInfo.x + \" \" + tileInfo.y] = temp;\n      constructWallsForTile(tileInfo, datMap);\n    });\n  };\n\n  const getWorld = async (id) => {\n    AppToaster.show({\n      intent: Intent.PRIMARY,\n      message: \"Loading your world...\",\n      timeout: 10000,\n    });\n\n    const res = await fetch(\n      `${CONFIG.host}:${CONFIG.port}/builder/world/${id}`,\n      {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      }\n    );\n    const data = await res.json();\n\n    // Construct the 3 parts of state we need\n    const dat = {\n      dimensions: {\n        id: data.dimensions.id,\n        name: data.dimensions.name,\n        height: data.dimensions.height,\n        width: data.dimensions.width,\n        floors: data.dimensions.floors,\n      },\n      map: [{ name: \"1F\", tiles: {}, walls: {} }],\n      entities: data.entities,\n    };\n\n    // Add all the floors we will need to the map\n    var i = 2;\n    while (dat.map.length < dat.dimensions.floors) {\n      dat.map.push({ name: i + \"F\", tiles: {}, walls: {} });\n      i = i + 1;\n    }\n\n    // Maps responsible for taking the db entries to local entires\n    const entityToType = {};\n    // Associate characters, objects, and tiles with local store ids for rooms\n    const roomToTile = {};\n\n    // Add each room, character, and object emoji as well as record the type\n    Object.keys(dat.entities).forEach((datType) => {\n      Object.keys(dat.entities[datType]).forEach((entityId) => {\n        storeEntity(dat.entities, entityId, datType, entityToType);\n      });\n    });\n\n    parseTiles(data.map.tiles, roomToTile);\n    parseEdges(data.map.edges, roomToTile, entityToType);\n    constructTilesAndWalls(roomToTile, dat.map);\n\n    // Mission accomplished!\n    AppToaster.show({\n      intent: Intent.SUCCESS,\n      message: \"Done loading!\",\n    });\n    setUpload(dat);\n  };\n\n  if (!isOpen) {\n    return <></>;\n  } else if (loading) {\n    return <Spinner intent={Intent.PRIMARY} />;\n  } else {\n    const data = result.data;\n    var auto = null;\n    if (result.auto == null) {\n      auto = <></>;\n    } else {\n      auto = (\n        <>\n          <tr>\n            <td>\n              <strong>Autosave</strong>\n            </td>\n            <td> {result.auto} </td>\n            <td></td>\n            <td></td>\n            <td></td>\n            <td>\n              <Button\n                intent={Intent.PRIMARY}\n                type=\"submit\"\n                onClick={() => getAutosave()}\n              >\n                Load\n              </Button>\n            </td>\n            <td></td>\n          </tr>\n        </>\n      );\n    }\n    return (\n      <>\n        <table\n          data-testid=\"world-review\"\n          style={{ width: \"100%\" }}\n          className=\"bp3-html-table bp3-html-table-condensed bp3-interactive\"\n        >\n          <thead>\n            <tr>\n              <th>World ID</th>\n              <th>World Name</th>\n              <th>Height</th>\n              <th>Width</th>\n              <th>Number of Floors</th>\n              <th>Load</th>\n              <th>Delete</th>\n            </tr>\n          </thead>\n          <tbody>\n            {data.map((d) => (\n              <React.Fragment key={d.id}>\n                <tr\n                  data-testid=\"tr-review\"\n                  style={{\n                    background: undefined,\n                  }}\n                >\n                  <td>{d.id}</td>\n                  <td>\n                    <strong>{d.name}</strong>\n                  </td>\n                  <td>{d.height}</td>\n                  <td>{d.width}</td>\n                  <td>{d.num_floors}</td>\n                  <td>\n                    <Button\n                      intent={Intent.PRIMARY}\n                      type=\"submit\"\n                      onClick={() => getWorld(d.id)}\n                    >\n                      Load\n                    </Button>\n                  </td>\n                  <td>\n                    <Button\n                      intent={Intent.DANGER}\n                      type=\"submit\"\n                      onClick={() => deleteWorld(d.id)}\n                    >\n                      Delete\n                    </Button>\n                  </td>\n                </tr>\n              </React.Fragment>\n            ))}\n            {auto}\n          </tbody>\n        </table>\n        {upload && (\n          <Redirect\n            to={{ pathname: \"/world_builder\", state: { data: upload } }}\n          />\n        )}\n      </>\n    );\n  }\n}\n/* Functions should:\n  1. Save the world - regardless of if it has been saved or not!\n  2. Pass the id to the game (hit the POST game/new) endpoint\n    - Should we include cool naming as jason suggested?  i.e url param for name?\n    - get url param from response\n  3. Surface the url param/link on the page\n      * might be judicious to impose some limit on number of launches a user gets per session\n*/\nexport async function launchWorld(state) {\n  // TODO: See above\n  const world_id = await postWorld(state);\n  const world_map = { world_id: world_id };\n  const res = await post(\"game/new/\", world_map);\n  const data = await res.json();\n  const url = `${CONFIG.host}:${CONFIG.port}/?id=${data}`;\n  window.open(url);\n  return data;\n}\n\nexport async function postAutosave(state) {\n  // Just send the state dict\n  const data = cloneDeep(state);\n  state = { data: data };\n  const res = await post(\"builder/world/autosave/\", state);\n}\n\nexport async function postWorld(state) {\n  // can pretty much just take the dimensions and entities as is\n  const dat = {\n    dimensions: cloneDeep(state.dimensions),\n    map: { tiles: [], edges: [] },\n    entities: cloneDeep(state.entities),\n  };\n  if (!(\"id\" in dat.dimensions)) {\n    dat.dimensions[\"id\"] = null;\n  }\n  const map = state.filteredMap();\n\n  // create all edge relationships and tile metadata needed\n  const edges = [];\n  for (let floor = 0; floor < map.length; floor++) {\n    const tiles = map[floor].tiles;\n    for (let coord in tiles) {\n      const tile = cloneDeep(tiles[coord]);\n      const [x, y] = coord.split(\" \").map((i) => parseInt(i));\n\n      // Now, construct the edges - first contains\n      const room = tile.room;\n      tiles[coord].characters.forEach((character) => {\n        edges.push({ src: room, dst: character, type: EDGE_TYPES.CONTAINS });\n      });\n      tiles[coord].objects.forEach((object) => {\n        edges.push({ src: room, dst: object, type: EDGE_TYPES.CONTAINS });\n      });\n\n      if (tiles[coord].stairUp) {\n        delete tile.stairUp;\n        edges.push({\n          src: room,\n          dst: map[floor + 1].tiles[coord].room,\n          type: EDGE_TYPES.NEIGHBORS_ABOVE,\n        });\n      }\n      if (tiles[coord].stairDown) {\n        delete tile.stairDown;\n        edges.push({\n          src: room,\n          dst: map[floor - 1].tiles[coord].room,\n          type: EDGE_TYPES.NEIGHBORS_BELOW,\n        });\n      }\n      // Ensure neighbours aren't blocked by walls\n      const neighbors = [\n        `${x - 1} ${y}`,\n        `${x + 1} ${y}`,\n        `${x} ${y - 1}`,\n        `${x} ${y + 1}`,\n      ];\n      const dirs = [\n        EDGE_TYPES.NEIGHBORS_WEST,\n        EDGE_TYPES.NEIGHBORS_EAST,\n        EDGE_TYPES.NEIGHBORS_NORTH,\n        EDGE_TYPES.NEIGHBORS_SOUTH,\n      ];\n      for (let index in neighbors) {\n        const direction = dirs[index];\n        const neighbor = neighbors[index];\n        if (\n          !Object.keys(map[floor].walls).some(\n            (wall) => wall.includes(neighbor) && wall.includes(coord)\n          )\n        ) {\n          if (!isEmpty(tiles[neighbor])) {\n            edges.push({\n              src: room,\n              dst: map[floor].tiles[neighbor].room,\n              type: direction,\n            });\n          }\n        }\n      }\n\n      // Modify tile object to expected format and push\n      tile[\"x_coordinate\"] = x;\n      tile[\"y_coordinate\"] = y;\n      tile[\"floor\"] = floor;\n      delete tile.characters;\n      delete tile.objects;\n      dat.map.tiles.push(tile);\n    }\n  }\n  // send it to the saving format!\n  dat.map.edges = edges;\n  const res = await post(\"builder/world/\", dat);\n  const resData = await res.json();\n  state.dimensions.id = resData;\n  AppToaster.show({\n    intent: Intent.SUCCESS,\n    message: \"World Saved! \",\n  });\n  // Return the id\n  return resData;\n}\n\nexport default ListWorldsOverlay;\n","import React from \"react\";\n\nfunction ColorPicker({ colors, value, handleChange, advanced }) {\n  return (\n    <div\n      style={{ display: \"flex\", flexDirection: \"row\", alignItems: \"center\" }}\n    >\n      {colors.map((color, index) => {\n        return (\n          <div\n            key={index}\n            style={{\n              display: \"inline-block\",\n              maxWidth: \"20px\",\n              width: \"20px\",\n              maxHeight: \"20px\",\n              height: \"20px\",\n              borderRadius: \"5px\",\n              background: color,\n              borderColor: \"#5C7080\",\n              borderStyle: value === color ? \"solid\" : \"\",\n              borderWidth: \"2px\",\n              boxShadow: value === color ? `0px 0px 8px ${value}` : \"\",\n              margin: \"2px\",\n              cursor: \"pointer\",\n            }}\n            onClick={() => handleChange(\"color\", color)}\n          />\n        );\n      })}\n      {advanced && (\n        <input\n          style={{\n            maxHeight: \"20px\",\n            maxWidth: \"20px\",\n            height: \"20px\",\n            width: \"20px\",\n            borderRadius: \"5px\",\n            padding: \"0px 0px 0px 0px\",\n          }}\n          type=\"color\"\n          value={value}\n          onChange={(event) => handleChange(\"color\", event.target.value)}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default ColorPicker;\n","import React from \"react\";\nimport { Intent, Menu, MenuItem, Tooltip, Position } from \"@blueprintjs/core\";\nimport { MultiSelect } from \"@blueprintjs/select\";\nimport equal from \"fast-deep-equal\";\nimport \"@blueprintjs/select/lib/css/blueprint-select.css\";\n\nimport CONFIG from \"../../config\";\nimport { useAPI } from \"../../utils\";\n\nconst SUGGEST_SIZE = 100;\n\nfunction BaseMultiSelect({\n  id,\n  name,\n  errors,\n  touched,\n  setFieldTouched,\n  formValue,\n  handleChange,\n  type,\n  tooltip,\n  onItemSelect,\n  entities,\n}) {\n  const [items, setItems] = React.useState([]);\n  const [query, setQuery] = React.useState(\"\");\n  const [currItems, setCurrItems] = React.useState([]);\n  const { loading, result } = useAPI(\n    CONFIG,\n    `/entities/${type}?search=${query}`\n  );\n\n  React.useEffect(() => {\n    if (!loading) {\n      if (entities) {\n        const localEntities = Object.values(entities[type]);\n        const results = localEntities\n          .concat(result.slice(0, SUGGEST_SIZE + localEntities.length + 1))\n          .filter(\n            (item, index, self) =>\n              self.findIndex((t) => equal(t, item)) === index\n          );\n\n        return setItems(results);\n      }\n      return setItems(result);\n    }\n  }, [result, loading, entities, type]);\n\n  React.useEffect(() => {\n    // When Reset is clicked on the form\n    setCurrItems(formValue);\n  }, [formValue, items]);\n\n  const filterItems = (query, obj, _index, exactMatch) => {\n    const normalizedTitle = obj.name.toLowerCase();\n    const normalizedQuery = query.toLowerCase();\n    if (exactMatch) {\n      return normalizedTitle === normalizedQuery;\n    } else {\n      let string = \"\";\n      for (let key in obj) {\n        string += obj[key] + \". \";\n      }\n      const result = string.toLowerCase().indexOf(normalizedQuery) >= 0;\n      return result;\n    }\n  };\n\n  const removeTag = (_value, index) => {\n    const newItems = currItems.filter((_item, i) => {\n      return i !== index;\n    });\n    const change = formValue.filter((_item, i) => {\n      return i !== index;\n    });\n    setCurrItems(newItems);\n    handleChange(name, change);\n  };\n\n  const renderOption = (obj, { handleClick, modifiers, index }) => {\n    if (!modifiers.matchesPredicate) {\n      return null;\n    }\n\n    return (\n      <MenuItem\n        active={modifiers.active}\n        key={index}\n        onClick={handleClick}\n        text={\n          tooltip ? (\n            <Tooltip\n              content={obj[tooltip]}\n              targetTagName=\"div\"\n              popoverClassName=\"popover-tooltip\"\n              position={Position.TOP_RIGHT}\n              usePortal={true}\n            >\n              {obj.name}\n            </Tooltip>\n          ) : (\n            obj.name\n          )\n        }\n        shouldDismissPopover={false}\n      />\n    );\n  };\n\n  return (\n    <div onBlur={(e) => setFieldTouched(name)}>\n      <MultiSelect\n        id={id}\n        name={name}\n        items={items}\n        itemRenderer={renderOption}\n        itemListRenderer={renderItemList}\n        tagInputProps={{\n          intent: errors && touched ? Intent.DANGER : null,\n          \"data-testid\": \"base-multi-select\",\n          onRemove: removeTag,\n        }}\n        onItemSelect={(e) => {\n          if (onItemSelect) {\n            const result = onItemSelect(e, type);\n            setCurrItems([...currItems, result]);\n            handleChange(name, [...formValue, result], e);\n          } else {\n            setCurrItems([...currItems, e]);\n            handleChange(name, [...formValue, e.id]);\n          }\n          setQuery(\"\");\n        }}\n        popoverProps={{ usePortal: false }}\n        itemPredicate={filterItems}\n        selectedItems={currItems}\n        query={query}\n        onQueryChange={(q) => setQuery(q)}\n        resetOnQuery={true}\n        tagRenderer={(item) => {\n          return entities && entities[type][item]\n            ? entities[type][item].name\n            : item.name;\n        }}\n      />\n    </div>\n  );\n}\n\nfunction renderItemList({ filteredItems, renderItem }) {\n  const topResults = filteredItems.slice(0, SUGGEST_SIZE);\n  return (\n    <Menu>\n      {filteredItems.length > 0 ? (\n        <>\n          {topResults.map((item, index) => {\n            return renderItem(item, index);\n          })}\n          {filteredItems.length > SUGGEST_SIZE && (\n            <MenuItem\n              style={{ textAlign: \"center\" }}\n              disabled={true}\n              text=\"...\"\n            />\n          )}\n        </>\n      ) : (\n        <MenuItem disabled={true} text=\"No results.\" />\n      )}\n    </Menu>\n  );\n}\n\nexport default BaseMultiSelect;\n","import React from \"react\";\nimport { Formik } from \"formik\";\nimport {\n  FormGroup,\n  Button,\n  Intent,\n  Classes,\n  Divider,\n  Icon,\n} from \"@blueprintjs/core\";\nimport { isEmpty } from \"lodash\";\n\nimport ColorPicker from \"./ColorPicker\";\nimport BaseSuggest from \"./BaseSuggest\";\nimport BaseMultiSelect from \"./BaseMultiSelect\";\nimport { TILE_COLORS, findBiome, findEmoji } from \"../worldbuilding/utils\";\n\nexport const emptyTileForm = {\n  room: undefined,\n  characters: [],\n  objects: [],\n  color: TILE_COLORS[0],\n};\n\nfunction TileForm({\n  initialInputs,\n  onSubmit,\n  onClear,\n  entities,\n  findOrAddEntity,\n  setShowAdvanced,\n  selected,\n  setSelected,\n}) {\n  return (\n    <Formik\n      initialValues={isEmpty(initialInputs) ? emptyTileForm : initialInputs}\n      validate={(values) => {\n        let errors = {};\n        if (isNaN(values.room)) {\n          errors.room = \"Required\";\n        }\n        return errors;\n      }}\n      onSubmit={onSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleSubmit,\n          handleReset,\n        } = props;\n\n        const setRoomValue = (name, value, fullValue) => {\n          setFieldValue(name, value);\n          setFieldValue(\"color\", findBiome(fullValue.name, values.color));\n        };\n\n        const hasContent = () => {\n          return (\n            !isNaN(values.room) ||\n            !isEmpty(values.characters) ||\n            !isEmpty(values.objects)\n          );\n        };\n\n        return (\n          <form>\n            <div\n              style={{\n                display: \"flex\",\n                flexDirection: \"row\",\n                alignContent: \"stretch\",\n                justifyContent: \"space-between\",\n              }}\n            >\n              <h5 style={{ fontSize: \"18px\" }} className={Classes.HEADING}>\n                <Icon color=\"#5c7080\" iconSize={20} icon=\"edit\" /> Tile Editor\n              </h5>\n              <div\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"flex-end\",\n                }}\n                onClick={() => {\n                  setSelected({ ...selected, data: { ...values } });\n                  setShowAdvanced(true);\n                }}\n              >\n                <Button icon=\"build\" />\n              </div>\n            </div>\n            <Divider />\n            <FormGroup\n              label=\"Room\"\n              labelInfo=\"(required)\"\n              labelFor=\"room-input\"\n            >\n              <BaseSuggest\n                id=\"room-input\"\n                name=\"room\"\n                type=\"room\"\n                errors={errors.room}\n                touched={touched.room}\n                setFieldTouched={setFieldTouched}\n                formValue={values.room}\n                handleChange={setRoomValue}\n                entities={entities}\n                onItemSelect={findOrAddEntity}\n              />\n              {errors.room && touched.room && (\n                <div className=\"form-error\">{errors.room}</div>\n              )}\n            </FormGroup>\n            <ColorPicker\n              colors={TILE_COLORS}\n              value={values.color}\n              handleChange={setFieldValue}\n            />\n            <FormGroup label=\"Characters in Room\" labelFor=\"characters-input\">\n              <BaseMultiSelect\n                id=\"characters-input\"\n                name=\"characters\"\n                type=\"character\"\n                errors={errors.characters}\n                touched={touched.characters}\n                setFieldTouched={setFieldTouched}\n                formValue={values.characters}\n                handleChange={setFieldValue}\n                tooltip=\"persona\"\n                entities={entities}\n                onItemSelect={(e, type) => {\n                  e.emoji = findEmoji(e.name);\n                  return findOrAddEntity(e, type);\n                }}\n              />\n              {errors.characters && touched.characters && (\n                <div className=\"form-error\">{errors.characters}</div>\n              )}\n            </FormGroup>\n            <FormGroup label=\"Objects in Room\" labelFor=\"objects-input\">\n              <BaseMultiSelect\n                id=\"objects-input\"\n                name=\"objects\"\n                type=\"object\"\n                errors={errors.objects}\n                touched={touched.objects}\n                setFieldTouched={setFieldTouched}\n                formValue={values.objects}\n                handleChange={setFieldValue}\n                tooltip=\"physical_description\"\n                entities={entities}\n                onItemSelect={(e, type) => {\n                  e.emoji = findEmoji(e.name);\n                  return findOrAddEntity(e, type);\n                }}\n              />\n              {errors.objects && touched.objects && (\n                <div className=\"form-error\">{errors.objects}</div>\n              )}\n            </FormGroup>\n\n            <Button\n              type=\"reset\"\n              onClick={onClear}\n              disabled={!hasContent()}\n              style={{ marginRight: \"15px\" }}\n            >\n              Clear\n            </Button>\n            <Button\n              type=\"reset\"\n              onClick={handleReset}\n              disabled={!dirty}\n              style={{ marginRight: \"15px\" }}\n            >\n              Reset\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              type=\"submit\"\n              onClick={handleSubmit}\n              disabled={!dirty || !isValid}\n              style={{ marginLeft: \"15px\" }}\n            >\n              Save Changes\n            </Button>\n          </form>\n        );\n      }}\n    </Formik>\n  );\n}\n\nexport default TileForm;\n","import React from \"react\";\nimport { Popover, Icon, Tooltip } from \"@blueprintjs/core\";\nimport { isEmpty, cloneDeep } from \"lodash\";\n\nimport TileForm from \"../forms/TileForm\";\nimport { invertColor } from \"./utils\";\n\n/**\n * Component for each Tile in the map grid\n */\nfunction Tile({\n  x,\n  y,\n  tile,\n  selected,\n  setSelected,\n  showAdvanced,\n  setShowAdvanced,\n  tileStyle,\n  state,\n}) {\n  const handleSubmit = (data) => {\n    state.setTile(x, y, { ...tile, ...data });\n    setSelected(null);\n  };\n\n  const handleClear = () => {\n    state.clearTile(x, y);\n    setSelected(null);\n  };\n\n  // toggle stairs on the tile clicked, and this tile and on the other floor\n  const toggleStairs = (event, key) => {\n    event.stopPropagation(); // prevent the popup firing\n    const toggleTo = !tile[key];\n    const newTile = cloneDeep(tile);\n    newTile[key] = toggleTo;\n    state.setTile(x, y, newTile);\n    const otherFloor = state.currFloor + (key === \"stairDown\" ? -1 : 1);\n    const newConnectedTile = cloneDeep(state.getTileAt(x, y, otherFloor));\n    newConnectedTile[key === \"stairDown\" ? \"stairUp\" : \"stairDown\"] = toggleTo;\n    state.setTile(x, y, newConnectedTile, otherFloor);\n  };\n\n  const contentColor = invertColor(\n    tile && !isNaN(tile.room) && tile.color ? tile.color : \"#ced9e0\"\n  );\n\n  return (\n    <>\n      <Icon\n        color={contentColor}\n        className={`react-grid-item-handle + ${\n          isEmpty(tile) ? \"disabled\" : \"\"\n        }`}\n        icon=\"drag-handle-horizontal\"\n      />\n      {!isEmpty(state.getTileAt(x, y, state.currFloor - 1)) && (\n        <Icon\n          color={contentColor}\n          onClick={\n            !isEmpty(tile) ? (e) => toggleStairs(e, \"stairDown\") : undefined\n          }\n          className={isEmpty(tile) ? \"disabled\" : \"\"}\n          style={{\n            opacity: !isEmpty(tile) && tile.stairDown ? 1 : 0.35,\n            position: \"absolute\",\n            bottom: \"5px\",\n            left: \"5px\",\n          }}\n          icon=\"arrow-bottom-left\"\n        />\n      )}\n      {!isEmpty(state.getTileAt(x, y, state.currFloor + 1)) && (\n        <Icon\n          color={contentColor}\n          onClick={\n            !isEmpty(tile) ? (e) => toggleStairs(e, \"stairUp\") : undefined\n          }\n          className={isEmpty(tile) ? \"disabled\" : \"\"}\n          style={{\n            opacity: !isEmpty(tile) && tile.stairUp ? 1 : 0.35,\n            position: \"absolute\",\n            top: \"5px\",\n            right: \"5px\",\n          }}\n          icon=\"arrow-top-right\"\n        />\n      )}\n      <Popover\n        isOpen={\n          !!selected && selected.x === x && selected.y === y && !showAdvanced\n        }\n        onClose={() => {\n          if (!showAdvanced) {\n            setSelected(null);\n          }\n        }}\n        usePortal={true}\n      >\n        {/* Popover target */}\n        <div\n          className=\"react-grid-item-content\"\n          style={{\n            ...tileStyle,\n            backgroundColor: tile && tile.color ? tile.color : \"\",\n          }}\n        >\n          <div\n            className=\"center\"\n            style={{\n              color: contentColor,\n              width: \"100%\",\n              maxHeight: tileStyle.maxHeight - 20,\n              overflow: \"hidden\",\n            }}\n          >\n            <p>{!isEmpty(tile) ? state.entities.room[tile.room].name : \"\"}</p>\n            <p>\n              {!isEmpty(tile)\n                ? tile.characters.map((char) => (\n                    <Tooltip content={state.entities.character[char].name}>\n                      {state.entities.character[char].emoji}\n                    </Tooltip>\n                  ))\n                : \"\"}\n            </p>\n            <p>\n              {!isEmpty(tile)\n                ? tile.objects.map((obj) => (\n                    <Tooltip content={state.entities.object[obj].name}>\n                      {state.entities.object[obj].emoji}\n                    </Tooltip>\n                  ))\n                : \"\"}\n            </p>\n          </div>\n        </div>\n        {/* Popover content */}\n        <div style={{ padding: \"20px\" }}>\n          <TileForm\n            initialInputs={tile}\n            onSubmit={handleSubmit}\n            onClear={handleClear}\n            entities={state.entities}\n            findOrAddEntity={state.findOrAddEntity}\n            setSelected={setSelected}\n            selected={selected}\n            setShowAdvanced={setShowAdvanced}\n          />\n        </div>\n      </Popover>\n    </>\n  );\n}\n\nexport default Tile;\n","import React from \"react\";\nimport { Formik } from \"formik\";\nimport {\n  Button,\n  Intent,\n  Icon,\n  Popover,\n  PopoverInteractionKind,\n  Tooltip,\n} from \"@blueprintjs/core\";\nimport { isEmpty, cloneDeep } from \"lodash\";\nimport AnimateHeight from \"react-animate-height\";\nimport { Picker } from \"emoji-mart\";\nimport \"emoji-mart/css/emoji-mart.css\";\n\nimport ColorPicker from \"./ColorPicker\";\nimport BaseSuggest from \"./BaseSuggest\";\nimport BaseMultiSelect from \"./BaseMultiSelect\";\nimport {\n  TILE_COLORS,\n  findBiome,\n  invertColor,\n  findEmoji,\n  DEFAULT_EMOJI,\n} from \"../worldbuilding/utils\";\nimport ObjectForm, { emptyObjectForm } from \"./ObjectForm\";\nimport CharacterForm, { emptyCharacterForm } from \"./CharacterForm\";\nimport RoomForm, { emptyRoomForm } from \"./RoomForm\";\nimport { emptyTileForm } from \"./TileForm\";\n\n/**\n * Advanced tile editing options including creating, editing, and duplicating entities\n */\nfunction AdvancedTileForm({\n  x,\n  y,\n  currFloor,\n  getTileAt,\n  initialInputs,\n  inheritedInputs,\n  handleSubmit,\n  handleClear,\n  tileStyle,\n  entities,\n  findOrAddEntity,\n  editEntity,\n}) {\n  const TilePreview = ({ tile }) => {\n    const contentColor = invertColor(\n      tile && !isNaN(tile.room) && tile.color ? tile.color : \"#ced9e0\"\n    );\n    return (\n      <div style={{ display: \"flex\", justifyContent: \"center\" }}>\n        <div\n          style={{\n            position: \"relative\",\n          }}\n        >\n          <Icon\n            color={contentColor}\n            className={`react-grid-item-handle + ${\n              isNaN(tile.room) ? \"disabled\" : \"\"\n            }`}\n            icon=\"drag-handle-horizontal\"\n          />\n          {!isEmpty(tile) && !isEmpty(getTileAt(x, y, currFloor - 1)) && (\n            <Icon\n              color={contentColor}\n              className={isEmpty(tile) ? \"disabled\" : \"\"}\n              style={{\n                opacity: tile.stairDown ? 1 : 0.2,\n                position: \"absolute\",\n                bottom: \"5px\",\n                left: \"5px\",\n              }}\n              icon=\"arrow-bottom-left\"\n            />\n          )}\n          {!isEmpty(tile) && !isEmpty(getTileAt(x, y, currFloor + 1)) && (\n            <Icon\n              color={contentColor}\n              className={isEmpty(tile) ? \"disabled\" : \"\"}\n              style={{\n                opacity: tile.stairUp ? 1 : 0.2,\n                position: \"absolute\",\n                top: \"5px\",\n                right: \"5px\",\n              }}\n              icon=\"arrow-top-right\"\n            />\n          )}\n          <div\n            className=\"react-grid-item-content\"\n            style={{\n              ...tileStyle,\n              backgroundColor:\n                tile && !isNaN(tile.room) && tile.color\n                  ? tile.color\n                  : \"#ced9e0\",\n            }}\n          >\n            <div\n              className=\"center\"\n              style={{\n                color: contentColor,\n                width: \"100%\",\n                maxHeight: tileStyle.maxHeight - 20,\n                overflow: \"hidden\",\n              }}\n            >\n              {!isEmpty(tile) && entities.room[tile.room]\n                ? entities.room[tile.room].name\n                : \"\"}\n              <p>\n                {!isEmpty(tile)\n                  ? tile.characters.map((char) => (\n                      <Tooltip content={entities.character[char].name}>\n                        {entities.character[char].emoji}\n                      </Tooltip>\n                    ))\n                  : \"\"}\n              </p>\n              <p>\n                {!isEmpty(tile)\n                  ? tile.objects.map((obj) => (\n                      <Tooltip content={entities.object[obj].name}>\n                        {entities.object[obj].emoji}\n                      </Tooltip>\n                    ))\n                  : \"\"}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <Formik\n      initialValues={\n        inheritedInputs ||\n        (!isEmpty(initialInputs) ? initialInputs : undefined) ||\n        emptyTileForm\n      }\n      validate={(values) => {\n        let errors = {};\n        if (!values.room) {\n          errors.room = \"Required\";\n        }\n        return errors;\n      }}\n      isInitialValid={!!inheritedInputs && !!inheritedInputs.room}\n      onSubmit={handleSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleSubmit,\n          handleReset,\n        } = props;\n        const setRoomValue = (name, value, fullValue) => {\n          setFieldValue(name, value);\n          setFieldValue(\"color\", findBiome(fullValue.name, values.color));\n        };\n\n        const hasContent = () => {\n          return (\n            !isNaN(values.room) ||\n            !isEmpty(values.characters) ||\n            !isEmpty(values.objects)\n          );\n        };\n\n        return (\n          <>\n            <Hideable title=\"Room\">\n              <SelectFromExistingOrCreateNew\n                initialState={selectOrCreateState.CHOOSE}\n                SelectFromExisting={BaseSuggest}\n                selectFromExistingProps={{\n                  id: \"room-input\",\n                  errors: errors.room,\n                  touched: touched.room,\n                  setFieldTouched: setFieldTouched,\n                  onItemSelect: findOrAddEntity,\n                  entities: entities,\n                  handleChange: setRoomValue,\n                }}\n                handleChange={setFieldValue}\n                formValue={values.room}\n                name=\"room\"\n                type=\"room\"\n                Form={RoomForm}\n                formProps={{\n                  initialInputs: emptyRoomForm,\n                }}\n                handleCreateSubmit={(data) =>\n                  setRoomValue(\"room\", findOrAddEntity(data, \"room\"), data)\n                }\n                handleEditSubmit={editEntity}\n                Selected={SelectedTableView}\n                selectedProps={{\n                  columnNames: [\"Name\", \"Description\", \"Backstory\"],\n                  columnKeys: [\"name\", \"description\", \"backstory\"],\n                  items: !isNaN(values.room) ? [values.room] : undefined,\n                  entities,\n                  type: \"room\",\n                }}\n              ></SelectFromExistingOrCreateNew>\n              {errors.room && touched.room && (\n                <div className=\"form-error\">{errors.room}</div>\n              )}\n              <div style={{ marginTop: \"5px\" }}>\n                <ColorPicker\n                  colors={TILE_COLORS}\n                  value={values.color}\n                  handleChange={setFieldValue}\n                  advanced\n                />\n              </div>\n            </Hideable>\n            <Hideable\n              initialOpen={!isEmpty(values.characters)}\n              title=\"Characters\"\n            >\n              <SelectFromExistingOrCreateNew\n                SelectFromExisting={BaseMultiSelect}\n                selectFromExistingProps={{\n                  id: \"characters-input\",\n                  errors: errors.characters,\n                  touched: touched.characters,\n                  setFieldTouched: setFieldTouched,\n                  tooltip: \"physical_description\",\n                  onItemSelect: (e, type) => {\n                    e.emoji = findEmoji(e.name);\n                    return findOrAddEntity(e, type);\n                  },\n                  entities: entities,\n                  handleChange: setFieldValue,\n                }}\n                handleChange={setFieldValue}\n                formValue={values.characters}\n                name=\"characters\"\n                type=\"character\"\n                Form={CharacterForm}\n                formProps={{\n                  initialInputs: emptyCharacterForm,\n                }}\n                handleCreateSubmit={(data) => {\n                  data.emoji = findEmoji(data.name);\n                  setFieldValue(\n                    \"characters\",\n                    values.characters.concat(findOrAddEntity(data, \"character\"))\n                  );\n                }}\n                handleEditSubmit={editEntity}\n                Selected={SelectedTableView}\n                selectedProps={{\n                  columnNames: [\"Name\", \"Persona\", \"Emoji\"],\n                  columnKeys: [\"name\", \"persona\", \"emoji\"],\n                  items: values.characters,\n                  entities,\n                  type: \"character\",\n                  editEntity: editEntity,\n                }}\n              />\n              {errors.characters && touched.characters && (\n                <div className=\"form-error\">{errors.characters}</div>\n              )}\n            </Hideable>\n            <Hideable initialOpen={!isEmpty(values.characters)} title=\"Objects\">\n              <SelectFromExistingOrCreateNew\n                SelectFromExisting={BaseMultiSelect}\n                selectFromExistingProps={{\n                  id: \"objects-input\",\n                  errors: errors.objects,\n                  touched: touched.objects,\n                  setFieldTouched: setFieldTouched,\n                  tooltip: \"physical_description\",\n                  onItemSelect: (e, type) => {\n                    e.emoji = findEmoji(e.name);\n                    return findOrAddEntity(e, type);\n                  },\n                  entities: entities,\n                  handleChange: setFieldValue,\n                }}\n                handleChange={setFieldValue}\n                formValue={values.objects}\n                name=\"objects\"\n                type=\"object\"\n                Form={ObjectForm}\n                formProps={{\n                  initialInputs: emptyObjectForm,\n                }}\n                handleCreateSubmit={(data) => {\n                  data.emoji = findEmoji(data.name);\n                  setFieldValue(\n                    \"objects\",\n                    values.objects.concat(findOrAddEntity(data, \"object\"))\n                  );\n                }}\n                handleEditSubmit={editEntity}\n                Selected={SelectedTableView}\n                selectedProps={{\n                  columnNames: [\"Name\", \"Description\", \"emoji\"],\n                  columnKeys: [\"name\", \"physical_description\", \"emoji\"],\n                  items: values.objects,\n                  entities,\n                  type: \"object\",\n                  editEntity: editEntity,\n                }}\n              />\n              {errors.objects && touched.objects && (\n                <div className=\"form-error\">{errors.objects}</div>\n              )}\n            </Hideable>\n            <Hideable title=\"Preview\">\n              <TilePreview tile={values} />\n            </Hideable>\n            <div\n              style={{\n                display: \"flex\",\n                justifyContent: \"flex-end\",\n                padding: \"10px\",\n              }}\n            >\n              <Button\n                type=\"reset\"\n                onClick={handleClear}\n                disabled={!hasContent()}\n                style={{ marginRight: \"15px\" }}\n              >\n                Clear\n              </Button>\n              <Button\n                type=\"reset\"\n                onClick={handleReset}\n                disabled={!dirty}\n                style={{ marginRight: \"15px\" }}\n              >\n                Reset\n              </Button>\n              <Button\n                intent={Intent.PRIMARY}\n                type=\"submit\"\n                onClick={handleSubmit}\n                disabled={!isValid}\n                style={{ marginLeft: \"15px\" }}\n              >\n                Save Changes\n              </Button>\n            </div>\n          </>\n        );\n      }}\n    </Formik>\n  );\n}\n\n// Container for children that allows children to be hidden\nfunction Hideable({ initialOpen = true, children, title }) {\n  const [open, setOpen] = React.useState(initialOpen);\n\n  return (\n    <div style={{ margin: \"0 0 10px 0\" }}>\n      <div\n        onClick={() => setOpen(!open)}\n        className={`hideable-header ${open ? \"\" : \"hidden\"}`}\n      >\n        <Icon\n          className={`hideable-arrow ${open ? \"\" : \"hidden\"}`}\n          icon=\"chevron-down\"\n        />{\" \"}\n        {title}\n      </div>\n      <AnimateHeight\n        duration={500}\n        height={open ? \"auto\" : 0}\n        easing={\"ease\"}\n        animateOpacity={true}\n      >\n        <div className={`hideable-content`}>{children}</div>\n      </AnimateHeight>\n    </div>\n  );\n}\n\n// A table view for all selected entities with actions\nfunction SelectedTableView({\n  columnNames,\n  columnKeys,\n  items,\n  entities,\n  handleEdit,\n  handleDuplicate,\n  handleDelete,\n  type,\n  editEntity,\n}) {\n  function EmojiTD({ item }) {\n    const [showPicker, setShowPicker] = React.useState(false);\n    return (\n      <Popover\n        interactionKind={PopoverInteractionKind.CLICK}\n        onInteraction={(state) => setShowPicker(state)}\n        isOpen={showPicker}\n        wrapperTagName=\"td\"\n      >\n        <div\n          // onClick={() => setShowPicker(!showPicker)}\n          style={{ height: \"100%\", width: \"100%\" }}\n        >\n          {entities[type][item].emoji || DEFAULT_EMOJI}\n        </div>\n        <Picker\n          onSelect={(event) => {\n            const data = cloneDeep(entities[type][item]);\n            data.emoji = event.native;\n            editEntity(item, data, type);\n            setShowPicker(false);\n          }}\n        />\n      </Popover>\n    );\n  }\n  return (\n    <>\n      {!isEmpty(items) && (\n        <table\n          data-testid=\"table-explore\"\n          style={{ width: \"100%\" }}\n          className=\"bp3-html-table bp3-html-table-striped bp3-html-table-condensed bp3-interactive\"\n        >\n          <thead>\n            <tr>\n              {columnNames.map((col, index) => (\n                <th key={index}>{col}</th>\n              ))}\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {items.map((item, index) => {\n              return (\n                <React.Fragment key={index}>\n                  <tr>\n                    {columnKeys.map((key) => {\n                      if (key === \"emoji\") {\n                        return <EmojiTD item={item} key={key} />;\n                      }\n                      return <td key={key}>{entities[type][item][key]}</td>;\n                    })}\n                    <td>\n                      <div style={{ display: \"flex\", flexDirection: \"row\" }}>\n                        <Button\n                          onClick={() => handleEdit(item, entities[type][item])}\n                          icon=\"edit\"\n                          minimal\n                        />\n                        <Button\n                          onClick={() => handleDuplicate(entities[type][item])}\n                          icon=\"duplicate\"\n                          minimal\n                        />\n                        <Button\n                          onClick={() => handleDelete(index)}\n                          icon=\"trash\"\n                          minimal\n                        />\n                      </div>\n                    </td>\n                  </tr>\n                </React.Fragment>\n              );\n            })}\n          </tbody>\n        </table>\n      )}\n    </>\n  );\n}\n\nconst selectOrCreateState = {\n  BASE: 0,\n  CHOOSE: 1,\n  SELECT_FROM_EXISTING: 2,\n  CREATE_NEW: 3,\n  EDIT: 4,\n  DUPLICATE: 5,\n};\n\n// Input type component that includes the selected table,\n// a component for selecting from existing,\n// and a form for creating new/editing/duplicating\nfunction SelectFromExistingOrCreateNew({\n  initialState = selectOrCreateState.BASE,\n  handleChange,\n  name,\n  type,\n  formValue,\n  SelectFromExisting,\n  selectFromExistingProps,\n  Form,\n  formProps,\n  handleCreateSubmit,\n  handleEditSubmit,\n  Selected,\n  selectedProps,\n}) {\n  const [state, setState] = React.useState(initialState);\n  const [editing, setEditing] = React.useState(undefined);\n  const [duplicating, setDuplicating] = React.useState(undefined);\n\n  const handleEditClick = (id, data) => {\n    setEditing({ id, data });\n    setState(selectOrCreateState.EDIT);\n  };\n\n  const handleDuplicate = (data) => {\n    setDuplicating(data);\n    setState(selectOrCreateState.DUPLICATE);\n  };\n\n  const handleDelete = (index) => {\n    if (Array.isArray(formValue)) {\n      formValue.splice(index, 1);\n      handleChange(name, formValue);\n    } else {\n      handleChange(name, undefined);\n    }\n  };\n\n  return (\n    <>\n      <Selected\n        {...selectedProps}\n        handleEdit={handleEditClick}\n        handleDuplicate={handleDuplicate}\n        handleDelete={handleDelete}\n      />\n      {state === selectOrCreateState.CHOOSE ? (\n        // choose between creating new or selecting from existing\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"center\",\n            flexDirection: \"row\",\n            alignItems: \"center\",\n            padding: \"5px\",\n          }}\n        >\n          <Button\n            onClick={() => setState(selectOrCreateState.SELECT_FROM_EXISTING)}\n            style={{ margin: \"5px\" }}\n          >\n            Select from existing\n          </Button>\n          <span style={{ margin: \"5px\" }}> OR </span>\n          <Button\n            onClick={() => setState(selectOrCreateState.CREATE_NEW)}\n            style={{ margin: \"5px\" }}\n          >\n            Create New\n          </Button>\n        </div>\n      ) : state === selectOrCreateState.SELECT_FROM_EXISTING ? (\n        // selecting from existing\n        <div>\n          <Button\n            onClick={() => setState(initialState)}\n            icon=\"chevron-left\"\n            minimal\n          />\n          <SelectFromExisting\n            {...selectFromExistingProps}\n            name={name}\n            type={type}\n            formValue={formValue}\n          />\n        </div>\n      ) : state === selectOrCreateState.CREATE_NEW ? (\n        // creating new\n        <div>\n          <Button\n            onClick={() => setState(initialState)}\n            icon=\"chevron-left\"\n            minimal\n          />\n          <Form\n            {...formProps}\n            type={type}\n            handleSubmit={(value) => {\n              setState(initialState);\n              handleCreateSubmit(value);\n            }}\n          />\n        </div>\n      ) : state === selectOrCreateState.EDIT ? (\n        // editing\n        <div>\n          <Button\n            onClick={() => setState(initialState)}\n            icon=\"chevron-left\"\n            minimal\n          />\n          <Form\n            {...formProps}\n            type={type}\n            initialInputs={editing.data}\n            handleSubmit={(value) => {\n              setState(initialState);\n              handleEditSubmit(editing.id, value, type);\n              setEditing(undefined);\n            }}\n          />\n        </div>\n      ) : state === selectOrCreateState.DUPLICATE ? (\n        // duplicating\n        <div>\n          <Button\n            onClick={() => setState(initialState)}\n            icon=\"chevron-left\"\n            minimal\n          />\n          <Form\n            {...formProps}\n            type={type}\n            initialInputs={duplicating}\n            handleSubmit={(value) => {\n              setState(initialState);\n              handleCreateSubmit(value);\n              setDuplicating(undefined);\n            }}\n          />\n        </div>\n      ) : (\n        <Button onClick={() => setState(selectOrCreateState.CHOOSE)} icon=\"add\">\n          Add\n        </Button>\n      )}\n    </>\n  );\n}\n\nexport default AdvancedTileForm;\n","import React from \"react\";\nimport GridLayout from \"react-grid-layout\";\nimport { cloneDeep, isEmpty, isEqual } from \"lodash\";\nimport { Button, Drawer, Classes } from \"@blueprintjs/core\";\n\nimport Tile from \"./Tile\";\nimport { MAX_HEIGHT, MAX_WIDTH } from \"./utils\";\nimport AdvancedTileForm from \"../forms/AdvancedTileForm\";\n\nconst SIZE = 150;\nconst MARGIN = 24;\n\n/**\n * Component for the interactive grid.\n * Using react-grid-layout for the draggable interface with some custom drag behavior to maintain\n * grid dimensions and update map state.\n */\nfunction Grid({ state, initialShowAdvanced }) {\n  const [layout, setLayout] = React.useState(null);\n  const [selected, setSelected] = React.useState(null);\n  const [showAdvanced, setShowAdvanced] = React.useState(false);\n  const [dragging, setDragging] = React.useState(false);\n\n  React.useEffect(() => {\n    setShowAdvanced(initialShowAdvanced);\n  }, [initialShowAdvanced]);\n\n  const resetShowAdvanced = () => {\n    setShowAdvanced(initialShowAdvanced);\n  };\n\n  // store the initial layout of the grid\n  const onDragStart = (layout) => {\n    setLayout(cloneDeep(layout));\n  };\n\n  // prevent column growing by swapping position with colliding tile\n  const onDragEvent = (newState, initial, next) => {\n    if (!isEqual(initial, next)) {\n      setDragging(true);\n      setSelected(null);\n    }\n    for (let i = 0; i < layout.length; i++) {\n      if (layout[i].i === next.i) {\n        continue;\n      }\n      if (\n        layout[i].x === next.x &&\n        layout[i].y === next.y &&\n        layout[i].i !== next.i\n      ) {\n        newState[i].x = initial.x;\n        newState[i].y = initial.y;\n      } else {\n        newState[i].x = layout[i].x;\n        newState[i].y = layout[i].y;\n      }\n    }\n\n    return true;\n  };\n\n  // sets up for the layout to be updated in the superstate\n  const onDragStop = (newState, initial, next) => {\n    onDragEvent(newState, initial, next);\n    setLayout([initial.x, initial.y, next.x, next.y]);\n  };\n\n  // update superstate (updating in onDragStop causes tiles to vanish)\n  const handleLayoutChange = () => {\n    if (layout) {\n      const [x1, y1, x2, y2] = layout;\n      if (!(x1 === x2 && y1 === y2)) {\n        // allows the animation to finish\n        setTimeout(() => state.swapTiles(x1, y1, x2, y2), 300);\n      }\n      setLayout(null);\n    }\n  };\n\n  // Generate children for GridLayout component\n  const generateTiles = () => {\n    const tiles = [];\n    for (let i = 0; i < state.dimensions.height; i++) {\n      for (let j = 0; j < state.dimensions.width; j++) {\n        // tile will contain all form data and stair data, or be empty\n        const tile = state.getTileAt(j, i, state.currFloor);\n        // tile data is used in the key to force GridLayout to rerender the div component\n        // and update isDraggable under data-grid\n        const key = `${state.currFloor} ${j} ${i} ${\n          tile && tile && tile.room ? tile.room.id : \"\"\n        }`;\n        tiles.push(\n          <div\n            key={key}\n            data-grid={{\n              x: j,\n              y: i,\n              w: 1,\n              h: 1,\n              draggableHandle: \".react-grid-item-handle\",\n              draggableCancel: \".react-grid-item\",\n              isDraggable: !isEmpty(tile),\n            }}\n            onClick={() => {\n              if (\n                !dragging &&\n                (!selected ||\n                  (selected && (selected.x !== j || selected.y !== i)))\n              ) {\n                setSelected({ x: j, y: i });\n              } else {\n                setDragging(false);\n              }\n            }}\n          >\n            <Tile\n              x={j}\n              y={i}\n              tile={tile}\n              selected={selected}\n              setSelected={setSelected}\n              showAdvanced={showAdvanced}\n              setShowAdvanced={setShowAdvanced}\n              setTile={state.setTile}\n              clearTile={state.clearTile}\n              getTileAt={state.getTileAt}\n              currFloor={state.currFloor}\n              tileStyle={{\n                width: SIZE,\n                height: SIZE,\n                maxWidth: SIZE,\n                maxHeight: SIZE,\n              }}\n              state={state}\n            />\n          </div>\n        );\n      }\n    }\n    return tiles;\n  };\n\n  // Generate all walls for the floor\n  const generateWalls = () => {\n    const walls = [];\n    for (let i = 0; i < state.dimensions.height; i++) {\n      for (let j = 0; j < state.dimensions.width; j++) {\n        // vertical walls\n        if (j > 0) {\n          const key = `${j - 1} ${i}|${j} ${i}`;\n          walls.push(\n            <div\n              key={key}\n              onClick={() => state.toggleWall(key)}\n              className={`wall ${\n                state.map[state.currFloor].walls[key] ? \"active\" : \"\"\n              }`}\n              style={{\n                top: MARGIN + (MARGIN + SIZE) * i,\n                left: (MARGIN + SIZE) * j + (MARGIN - 10) / 2,\n                height: SIZE,\n              }}\n            />\n          );\n        }\n        // horizontal walls\n        if (i > 0) {\n          const key = `${j} ${i - 1}|${j} ${i}`;\n          walls.push(\n            <div\n              key={key}\n              onClick={() => state.toggleWall(key)}\n              className={`wall ${\n                state.map[state.currFloor].walls[key] ? \"active\" : \"\"\n              }`}\n              style={{\n                left: MARGIN + (MARGIN + SIZE) * j,\n                top: (MARGIN + SIZE) * i + (MARGIN - 10) / 2,\n                width: SIZE,\n              }}\n            />\n          );\n        }\n      }\n    }\n    return walls;\n  };\n\n  return (\n    <>\n      <div\n        style={{\n          width:\n            state.dimensions.width * SIZE +\n            (state.dimensions.width + 1) * MARGIN +\n            60,\n          margin: \"0 auto 75px auto\",\n          textAlign: \"center\",\n        }}\n      >\n        <Button\n          className=\"bp3-button\"\n          disabled={state.dimensions.height >= 10}\n          style={{\n            width:\n              state.dimensions.width * SIZE +\n              (state.dimensions.width + 1) * MARGIN -\n              20,\n            margin: \"auto\",\n          }}\n          onClick={state.addRowTop}\n          icon=\"add\"\n        />\n        <div style={{ display: \"flex\" }}>\n          <Button\n            className=\"bp3-button\"\n            disabled={state.dimensions.width >= 10}\n            style={{\n              height:\n                state.dimensions.height * SIZE +\n                (state.dimensions.height + 1) * MARGIN -\n                20,\n              margin: \"10px 0\",\n            }}\n            onClick={state.addColFront}\n            icon=\"add\"\n          />\n          <div\n            className=\"map-container\"\n            style={{\n              width:\n                state.dimensions.width * SIZE +\n                (state.dimensions.width + 1) * MARGIN,\n              height:\n                state.dimensions.height * SIZE +\n                (state.dimensions.height + 1) * MARGIN,\n            }}\n          >\n            <div className=\"walls\">{generateWalls()}</div>\n            <GridLayout\n              cols={state.dimensions.width}\n              rowHeight={SIZE}\n              width={\n                state.dimensions.width * SIZE +\n                (state.dimensions.width + 1) * MARGIN\n              }\n              onDragStart={onDragStart}\n              onDrag={onDragEvent}\n              onDragStop={onDragStop}\n              margin={[MARGIN, MARGIN]}\n              onLayoutChange={handleLayoutChange}\n              isResizable={false}\n              maxRows={state.dimensions.height}\n              style={{\n                width:\n                  state.dimensions.width * SIZE +\n                  (state.dimensions.width + 1) * MARGIN,\n              }}\n            >\n              {generateTiles()}\n            </GridLayout>\n          </div>\n          <Button\n            className=\"bp3-button\"\n            disabled={state.dimensions.width >= MAX_WIDTH}\n            style={{\n              height:\n                state.dimensions.height * SIZE +\n                (state.dimensions.height + 1) * MARGIN -\n                20,\n              margin: \"10px 0\",\n            }}\n            onClick={state.addColEnd}\n            icon=\"add\"\n          />\n        </div>\n        <Button\n          className=\"bp3-button\"\n          disabled={state.dimensions.height >= MAX_HEIGHT}\n          style={{\n            width:\n              state.dimensions.width * SIZE +\n              (state.dimensions.width + 1) * MARGIN -\n              20,\n            margin: \"auto\",\n          }}\n          onClick={state.addRowBot}\n          icon=\"add\"\n        />\n      </div>\n      <AdvancedEditor\n        showAdvanced={showAdvanced}\n        selected={selected}\n        setSelected={setSelected}\n        resetShowAdvanced={resetShowAdvanced}\n        state={state}\n      />\n    </>\n  );\n}\n\nfunction AdvancedEditor({\n  selected,\n  setSelected,\n  resetShowAdvanced,\n  showAdvanced,\n  state,\n}) {\n  const handleSubmit = (data) => {\n    state.setTile(selected.x, selected.y, {\n      ...state.getTileAt(selected.x, selected.y),\n      ...data,\n    });\n    setSelected(null);\n    resetShowAdvanced();\n  };\n\n  const handleClear = () => {\n    state.clearTile(selected.x, selected.y);\n    setSelected(null);\n    resetShowAdvanced();\n  };\n\n  return (\n    <Drawer\n      icon=\"build\"\n      title=\"Build Tile\"\n      isOpen={showAdvanced && selected}\n      onClose={() => {\n        setSelected(null);\n        resetShowAdvanced();\n      }}\n    >\n      <div className={Classes.DRAWER_BODY}>\n        <div className={Classes.DIALOG_BODY}>\n          {selected && (\n            <AdvancedTileForm\n              x={selected.x}\n              y={selected.y}\n              currFloor={state.currFloor}\n              getTileAt={state.getTileAt}\n              initialInputs={state.getTileAt(selected.x, selected.y)}\n              inheritedInputs={selected.data}\n              handleSubmit={handleSubmit}\n              handleClear={handleClear}\n              tileStyle={{\n                width: SIZE,\n                height: SIZE,\n                maxWidth: SIZE,\n                maxHeight: SIZE,\n              }}\n              entities={state.entities}\n              findOrAddEntity={state.findOrAddEntity}\n              editEntity={state.editEntity}\n            />\n          )}\n        </div>\n      </div>\n    </Drawer>\n  );\n}\n\nexport default Grid;\n","import React from \"react\";\nimport {\n  ContextMenuTarget,\n  Menu,\n  MenuItem,\n  Button,\n  InputGroup,\n  Alert,\n  Intent,\n} from \"@blueprintjs/core\";\nimport Reorder from \"react-reorder\";\nimport createReactClass from \"create-react-class\";\nimport { isEmpty } from \"lodash\";\n\nimport { MAX_FLOORS } from \"./utils\";\n\n/**\n * Component for interacting with floors of the map.\n * Uses react-reorder for the reorderable list.\n */\nfunction FloorSelector({ manager, map, currFloor }) {\n  // Prevents switching floors on a context click (which can cause several components to remount and break links)\n  const [contextShowing, setContextShowing] = React.useState(false);\n  const [editing, setEditing] = React.useState(null);\n  // Contains all data for a confirm alert (on Delete, or Reorder actions)\n  const [confirmAlert, setConfirmAlert] = React.useState({});\n  const inputRef = React.createRef();\n\n  const floors = map.map(({ name }, index) => {\n    return { name, index };\n  });\n\n  // Template component for each Floor Button\n  const FloorButton = ContextMenuTarget(\n    createReactClass({\n      keypressHandler: function (event) {\n        if (event.key === \"Enter\") {\n          inputRef.current.blur();\n        }\n      },\n      renderContextMenu: function () {\n        setContextShowing(true);\n        return (\n          <Menu>\n            <MenuItem\n              icon=\"edit\"\n              onClick={() => setEditing(this.props.item.index)}\n              text=\"Edit Floor Name\"\n            />\n            <MenuItem\n              icon=\"delete\"\n              disabled={floors.length <= 1}\n              onClick={() => {\n                setConfirmAlert({\n                  confirmButtonText: \"Confirm Delete\",\n                  icon: \"trash\",\n                  intent: Intent.DANGER,\n                  onConfirm: () => {\n                    manager.deleteFloor(this.props.item.index);\n                    setConfirmAlert({});\n                  },\n                  content: `Are you sure you want to delete the entire ${this.props.item.name} floor? All data on this floor and connections to this floor will be reset.`,\n                });\n              }}\n              text=\"Delete Floor\"\n            />\n          </Menu>\n        );\n      },\n      onContextMenuClose: function () {\n        setContextShowing(false);\n      },\n      handleBlur: function (e) {\n        manager.editFloorName(e.target.value, this.props.item.index);\n        setEditing(null);\n      },\n      componentDidMount: function () {\n        if (editing === this.props.item.index) {\n          inputRef.current.focus();\n          inputRef.current.select();\n        }\n      },\n      render: function () {\n        return (\n          <div\n            style={{\n              textAlign: \"center\",\n              width: \"100%\",\n              height: \"100%\",\n              lineHeight: \"30px\",\n              padding: \"0px 5px\",\n            }}\n          >\n            {editing !== null && editing === this.props.item.index ? (\n              <InputGroup\n                inputRef={inputRef}\n                onBlur={this.handleBlur}\n                defaultValue={this.props.item.name}\n                onKeyPress={(event) => this.keypressHandler(event)}\n              />\n            ) : (\n              <div>{this.props.item.name}</div>\n            )}\n          </div>\n        );\n      },\n    })\n  );\n\n  // Prevent floor selection if context or editing has been triggered (prevents unintended switching)\n  const selectFloor = (_e, _floor, index) => {\n    if (!contextShowing && !editing) {\n      manager.setCurrFloor(index);\n    }\n  };\n\n  const handleReorder = (_e, _floor, initialIndex, newIndex) => {\n    if (initialIndex !== newIndex) {\n      setConfirmAlert({\n        confirmButtonText: \"Confirm Reorder\",\n        icon: \"layers\",\n        intent: Intent.WARNING,\n        onConfirm: () => {\n          manager.reorderFloors(initialIndex, newIndex);\n          setConfirmAlert({});\n        },\n        content: `Are you sure you want to reorder the entire ${floors[newIndex].name} floor? All connections to and from this floor, in both positions, will be reset.`,\n      });\n    }\n  };\n\n  return (\n    <>\n      <Alert\n        confirmButtonText={confirmAlert.confirmButtonText}\n        cancelButtonText=\"Cancel\"\n        icon={confirmAlert.icon}\n        intent={confirmAlert.intent}\n        isOpen={!isEmpty(confirmAlert)}\n        onCancel={() => {\n          if (confirmAlert.onCancel) {\n            confirmAlert.onCancel();\n          }\n          setConfirmAlert({});\n        }}\n        onConfirm={confirmAlert.onConfirm}\n      >\n        <p>{confirmAlert.content}</p>\n      </Alert>\n      <div\n        style={{\n          display: \"flex\",\n        }}\n      >\n        <Button\n          disabled={map.length >= MAX_FLOORS}\n          icon=\"add\"\n          onClick={manager.addFloor}\n          style={{\n            height: \"30px\",\n          }}\n        />\n        <Reorder\n          holdTime=\"200\"\n          callback={handleReorder}\n          template={FloorButton}\n          itemKey=\"index\"\n          list={floors}\n          selected={floors[currFloor]}\n          itemClicked={selectFloor}\n          lock=\"vertical\"\n          itemClass=\"bp3-button floor-button\"\n        />\n      </div>\n    </>\n  );\n}\n\nexport default FloorSelector;\n","import React, { useEffect } from \"react\";\nimport {\n  NumericInput,\n  InputGroup,\n  ControlGroup,\n  FormGroup,\n  Tooltip,\n  Position,\n  Icon,\n  Switch,\n  Button,\n  Intent,\n} from \"@blueprintjs/core\";\nimport {\n  useWorldBuilder,\n  MAX_HEIGHT,\n  MAX_WIDTH,\n  MAX_FLOORS,\n} from \"./worldbuilding/utils\";\nimport ListWorldsOverlay from \"./WorldManager\";\nimport { launchWorld, postAutosave, postWorld } from \"./WorldManager\";\nimport Grid from \"./worldbuilding/Grid\";\nimport FloorSelector from \"./worldbuilding/FloorSelector\";\n\nfunction WorldBuilderPage({ location }) {\n  return (\n    <div>\n      <h2 data-testid=\"header\" className=\"bp3-heading\">\n        World Builder\n      </h2>\n      <div>\n        <WorldBuilder upload={location.state} />\n      </div>\n    </div>\n  );\n}\n\nconst getManageOn = () => {\n  // Try and get if we should start with overlay or not\n  const loc = window.location.href;\n  const paramsIdx = loc.indexOf(\"?\");\n  var initOverlay = false;\n  if (paramsIdx != -1) {\n    const params = loc.substring(paramsIdx + 1);\n    var res = params.split(\"=\");\n    if (res[0] === \"manage\") {\n      initOverlay = res[1] == \"true\";\n    }\n  }\n  return initOverlay;\n};\n\nfunction WorldBuilder({ upload }) {\n  const state = useWorldBuilder(upload);\n  const [advanced, setAdvanced] = React.useState(false);\n\n  const [isOverlayOpen, setIsOverlayOpen] = React.useState(getManageOn());\n  const world_name =\n    state.dimensions.name == null ? \" \" : state.dimensions.name;\n  const stateRef = React.useRef(state);\n  stateRef.current = state;\n  const TWO_MINUTES = 120000;\n\n  useEffect(() => {\n    const timer = setTimeout(function autosave() {\n      postAutosave(stateRef.current);\n      console.log(\"Autosaved!\");\n      setTimeout(autosave, TWO_MINUTES);\n    }, TWO_MINUTES);\n    return () => clearTimeout(timer);\n  }, []);\n\n  return (\n    <>\n      <h3>World: {world_name}</h3>\n      <ListWorldsOverlay\n        isOverlayOpen={isOverlayOpen}\n        setIsOverlayOpen={setIsOverlayOpen}\n      />\n      <FormGroup\n        inline\n        label=\"World Name\"\n        labelFor=\"name-input\"\n        labelInfo={`(optional)`}\n      >\n        <ControlGroup>\n          <InputGroup\n            id=\"name-input\"\n            placeholder={\n              state.dimensions.name == null\n                ? \"Unnamed World\"\n                : state.dimensions.name\n            }\n          />\n          <Button\n            intent={Intent.PRIMARY}\n            onClick={() => {\n              state.setDimensions({\n                ...state.dimensions,\n                name: document.getElementById(\"name-input\").value.trim(),\n              });\n            }}\n          >\n            Update\n          </Button>\n        </ControlGroup>\n      </FormGroup>\n      <FormGroup\n        inline\n        label=\"World Dimensions\"\n        labelInfo={`WxH (Max ${MAX_WIDTH}x${MAX_HEIGHT})`}\n      >\n        <ControlGroup>\n          <NumericInput\n            value={state.dimensions.width}\n            style={{ width: \"3rem\" }}\n            max={MAX_WIDTH}\n            min={1}\n            onValueChange={(value) => {\n              state.setDimensions({ ...state.dimensions, width: value });\n            }}\n          />\n\n          <NumericInput\n            value={state.dimensions.height}\n            style={{ width: \"3rem\" }}\n            max={MAX_HEIGHT}\n            min={1}\n            onValueChange={(value) => {\n              state.setDimensions({ ...state.dimensions, height: value });\n            }}\n          />\n        </ControlGroup>\n      </FormGroup>\n      <FormGroup\n        inline\n        label={\n          <>\n            Floor{\" \"}\n            <Tooltip\n              content={\n                \"Right click floor for more options. Click and hold floor to reorder.\"\n              }\n              position={Position.BOTTOM}\n              className=\"inline\"\n            >\n              <Icon icon=\"help\" />\n            </Tooltip>\n          </>\n        }\n        labelInfo={`Max ${MAX_FLOORS}`}\n        style={{ marginBottom: \"0px\" }}\n      >\n        <FloorSelector\n          max={MAX_FLOORS}\n          manager={state.floorManager}\n          map={state.map}\n          currFloor={state.currFloor}\n        />\n      </FormGroup>\n      <FormGroup inline label=\"Advanced\">\n        <Switch onChange={() => setAdvanced(!advanced)} checked={!!advanced} />\n      </FormGroup>\n      <Grid state={state} initialShowAdvanced={advanced} />\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"flex-end\",\n          position: \"fixed\",\n          bottom: 0,\n          left: 0,\n          right: 0,\n          height: \"50px\",\n        }}\n        className=\"bp3-navbar\"\n      >\n        <Button\n          onClick={() => launchWorld(state)}\n          intent=\"primary\"\n          style={{ margin: \"10px\" }}\n        >\n          Launch Game\n        </Button>\n        <Button\n          onClick={() => setIsOverlayOpen(!isOverlayOpen)}\n          intent=\"primary\"\n          style={{ margin: \"10px\" }}\n        >\n          Manage Worlds\n        </Button>\n        <Button\n          onClick={() => postWorld(state)}\n          intent=\"primary\"\n          style={{ margin: \"10px\" }}\n        >\n          Save\n        </Button>\n        <Button\n          onClick={state.exportWorld}\n          intent=\"primary\"\n          style={{ margin: \"10px\" }}\n        >\n          Export\n        </Button>\n      </div>\n    </>\n  );\n}\n\nexport default WorldBuilderPage;\n","import React from \"react\";\nimport { isEmpty } from \"lodash\";\nimport { Button, Classes, Dialog, Intent, Spinner } from \"@blueprintjs/core\";\nimport { useHistory } from \"react-router-dom\";\n\nimport CONFIG from \"../config\";\nimport { useAPI, post } from \"../utils\";\nimport ObjectForm from \"./forms/ObjectForm\";\nimport CharacterForm from \"./forms/CharacterForm\";\nimport RoomForm from \"./forms/RoomForm\";\nimport AppToaster from \"./AppToaster\";\n\nfunction EditPage({ match, location }) {\n  const [formType, setFormType] = React.useState(undefined);\n  const { loading, result } = useAPI(\n    CONFIG,\n    `/entities/${match.params.id}`,\n    {},\n    location.state\n  );\n  const [initialInputs, setInitialInputs] = React.useState({});\n  const [showDialog, setShowDialog] = React.useState(false);\n  const [pendingEdits, setPendingEdits] = React.useState([]);\n  const history = useHistory();\n\n  if (!loading && isEmpty(initialInputs)) {\n    if (isEmpty(result) || isEmpty(result.entity)) {\n      setInitialInputs({ id: match.params.id });\n      setFormType(\"invalid\");\n    } else {\n      setInitialInputs(result.entity);\n      setFormType(result.type);\n    }\n  }\n\n  const showEdits = (values) => {\n    const edits = [];\n    for (let property in values) {\n      if (values[property] !== initialInputs[property]) {\n        edits.push({ property: property, editedValue: values[property] });\n      }\n    }\n    setPendingEdits(edits);\n    setShowDialog(true);\n  };\n\n  return (\n    <div>\n      <Dialog\n        icon=\"info-sign\"\n        onClose={() => setShowDialog(false)}\n        title={`Confirm edits for Entity ${match.params.id}`}\n        isOpen={showDialog}\n        usePortal={false}\n      >\n        <div className={Classes.DIALOG_BODY}>\n          {pendingEdits.map((edit, index) => {\n            return (\n              <p key={index}>\n                <strong>{edit.property}</strong>: {edit.editedValue.toString()}\n              </p>\n            );\n          })}\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <Button onClick={() => setShowDialog(false)}>Close</Button>\n            <Button\n              intent={Intent.PRIMARY}\n              onClick={() =>\n                submitEdits(match.params.id, pendingEdits, history)\n              }\n            >\n              Confirm Edits\n            </Button>\n          </div>\n        </div>\n      </Dialog>\n      <h2 data-testid=\"header\" className=\"bp3-heading\">\n        Editing Entity {match.params.id}\n      </h2>\n      <div className=\"bp3-text-large\">\n        {loading ? (\n          <Spinner intent={Intent.PRIMARY} />\n        ) : (\n          <EditForm\n            type={formType}\n            initialInputs={initialInputs}\n            handleSubmit={showEdits}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction EditForm({ type, initialInputs, handleSubmit }) {\n  switch (type) {\n    case \"object\":\n      return (\n        <ObjectForm\n          type={type}\n          initialInputs={initialInputs}\n          handleSubmit={handleSubmit}\n        />\n      );\n    case \"character\":\n      return (\n        <CharacterForm\n          type={type}\n          initialInputs={initialInputs}\n          handleSubmit={handleSubmit}\n        />\n      );\n    case \"room\":\n      return (\n        <RoomForm\n          type={type}\n          initialInputs={initialInputs}\n          handleSubmit={handleSubmit}\n        />\n      );\n    default:\n      return \"This entity cannot be edited at the moment\";\n  }\n}\n\nasync function submitEdits(id, edits, history) {\n  const reqs = edits.map((edit) =>\n    submitEdit(id, edit.property, edit.editedValue)\n  );\n  await Promise.all(reqs).then(() => {\n    history.push(\"/\");\n  });\n  AppToaster.show({\n    intent: Intent.SUCCESS,\n    message: \"Successfully created edits\",\n  });\n}\n\nfunction submitEdit(id, field, edited_value) {\n  const payload = {\n    id,\n    field,\n    edited_value,\n    player: 1,\n  };\n\n  return post(\"builder/edits\", payload);\n}\n\nexport default EditPage;\n","import React from \"react\";\nimport { HashRouter, Route, Redirect } from \"react-router-dom\";\n\nimport NavBar from \"./components/NavBar\";\nimport ExplorePage from \"./components/ExplorePage\";\nimport CreatePage from \"./components/CreatePage\";\nimport ReviewPage from \"./components/ReviewPage\";\nimport WorldBuilderPage from \"./components/WorldBuilderPage\";\nimport EditPage from \"./components/EditPage\";\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <HashRouter>\n        <Routes />\n      </HashRouter>\n    </div>\n  );\n}\n\nexport function Routes() {\n  return (\n    <>\n      <NavBar />\n      <div style={{ margin: \"40px 30px\" }}>\n        <Route path=\"/explore\" component={ExplorePage} exact />\n        <Route path=\"/create\" component={CreatePage} exact />\n        <Route path=\"/review\" component={ReviewPage} exact />\n        <Route\n          path=\"/world_builder\"\n          render={(props) => (\n            <WorldBuilderPage {...props} key={Math.random()} exact />\n          )}\n        />\n        <Route path=\"/edit/:id\" component={EditPage} exact />\n        <Route exact path=\"/\" render={() => <Redirect to=\"/explore\" />} exact />\n      </div>\n    </>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nimport \"normalize.css\";\nimport \"@blueprintjs/core/lib/css/blueprint.css\";\nimport \"@blueprintjs/icons/lib/css/blueprint-icons.css\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}