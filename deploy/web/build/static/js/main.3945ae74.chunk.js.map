{"version":3,"sources":["components/WorldFileUpload.js","components/NavBar.js","config.js","utils.js","components/ExplorePage.js","components/forms/BaseSuggest.js","components/forms/ObjectForm.js","components/forms/CharacterForm.js","components/forms/RoomForm.js","components/AppToaster.js","components/CreatePage.js","components/ReviewPage.js","components/worldbuilding/utils.js","components/EdgeTypes.js","components/WorldManager.js","components/forms/ColorPicker.js","components/forms/BaseMultiSelect.js","components/forms/TileForm.js","components/worldbuilding/Tile.js","components/forms/AdvancedTileForm.js","components/worldbuilding/Grid.js","components/worldbuilding/FloorSelector.js","components/WorldBuilderPage.js","components/EditPage.js","App.js","index.js"],"names":["WorldFileUpload","setPopover","inputRef","React","useRef","useState","undefined","file","setFile","onChange","e","fileReader","FileReader","onload","event","JSON","parse","target","result","files","readAsText","type","ref","style","display","to","pathname","state","data","icon","onClick","current","click","text","shouldDismissPopover","NavBar","children","worldBuildPopover","setWorldBuildPopover","Fragment","Group","align","Alignment","LEFT","Heading","Divider","data-testid","className","position","Position","BOTTOM_LEFT","minimal","isOpen","color","tagName","DEV","host","hostname","port","useDidChange","val","value","useEffect","usePrevious","useAPI","CONFIG","url","preloaded","body","params","loading","setState","newUrl","isSubscribed","fetch","then","res","json","catch","err","console","log","reload","post","payload","formBody","property","encodedKey","encodeURIComponent","encodedValue","stringify","push","method","headers","join","get_source","local_id","entities","room","id","object","character","ItemsList","items","descriptionField","additionalFields","selectedEntity","expanded","animating","nextState","length","width","map","field","key","name","item","index","handleTrClick","background","colSpan","padding","cursor","duration","height","easing","onAnimationEnd","animateOpacity","ExpandedTab","flexDirection","Object","keys","startCase","justifyContent","margin","entity","ExplorePage","setSelectedEntity","page","setPage","searchText","setSearchText","placeholder","dir","marginBottom","inline","large","selectedValue","label","intent","Intent","PRIMARY","previousLabel","nextLabel","breakLabel","forcePage","pageCount","total_pages","marginPagesDisplayed","pageRangeDisplayed","onPageChange","selected","containerClassName","subContainerClassName","activeClassName","renderItemList","filteredItems","renderItem","topResults","slice","textAlign","disabled","renderOption","obj","handleClick","modifiers","matchesPredicate","active","BaseSuggest","errors","touched","setFieldTouched","formValue","handleChange","onItemSelect","suggestionSource","setItems","query","setQuery","currItem","setCurrItem","loadingModel","modelResult","options","concat","localEntities","values","results","filter","self","findIndex","t","equal","isNaN","onBlur","itemRenderer","itemListRenderer","inputValueRenderer","inputProps","DANGER","popoverProps","usePortal","itemPredicate","_index","exactMatch","normalizedTitle","toLowerCase","normalizedQuery","string","indexOf","selectedItem","onQueryChange","q","resetOnQuery","emptyObjectForm","name_prefix","physical_description","base_id","is_container","is_drink","is_food","is_gettable","is_plural","is_surface","is_weapon","is_wearable","ObjectForm","initialInputs","handleSubmit","initialValues","validate","onSubmit","props","setFieldValue","dirty","isValid","handleBlur","handleReset","handleSwitch","labelInfo","labelFor","growVertically","fill","marginLeft","checked","alignIndicator","RIGHT","marginRight","emptyCharacterForm","persona","char_type","CharacterForm","emptyRoomForm","description","backstory","RoomForm","AppToaster","Toaster","create","TOP","CreateForm","history","useHistory","submitEntity","a","show","SUCCESS","message","CreatePage","location","formType","setFormType","EditsList","edits","status","rows","all","setSelected","submitAction","setSubmitAction","showDialog","setShowDialog","pendingSubmission","setPendingSubmission","handleTdClick","reqs","edit_id","Promise","Array","showSubmission","action","i","onClose","title","Classes","DIALOG_BODY","edit","DIALOG_FOOTER","DIALOG_FOOTER_ACTIONS","indeterminate","newRows","newSelection","every","r","handleCheckbox","orig","diff","differ","DiffMatchPatch","diff_main","diff_cleanupSemantic","d","unedited_value","edited_value","Card","alignItems","flexGrow","maxWidth","fontSize","ReviewPage","selectedStatus","setSelectedStatus","TILE_COLORS","Colors","GRAY3","VIOLET5","RED5","SEPIA5","GOLD5","FOREST5","BLUE5","grass","water","buildings","royal","brick","path","farm","findBiome","lowName","some","biome","invertColor","hex","parseInt","findEmoji","emojiIndex","search","native","words","split","charAt","substring","mapReducer","floor","floorIndex","tiles","x","y","newTile","createdEntitiesReducer","assign","entityType","nextID","merge","useWorldBuilder","upload","dimensions","floors","setDimensions","initialMap","walls","useReducer","mapDispatch","entitiesDispatch","currFloor","setCurrFloor","newMap","f","removeStairsTile","baseMap","stairDown","stairUp","removeStairsFloor","stair","isEmpty","forEach","floorManager","addFloor","deleteFloor","_floor","reorderFloors","i1","i2","reorderedFloor","filteredMap","editFloorName","newName","filtered","newFloor","newTiles","tile","setTile","clearTile","cloneDeep","swapTiles","x1","y1","x2","y2","getTileAt","toggleWall","addRowTop","tileKeys","wallKeys","newWalls","t1","t2","addRowBot","addColFront","addColEnd","editEntity","findOrAddEntity","addEntity","exportWorld","dimensionsWithoutId","element","document","createElement","setAttribute","Date","now","toString","appendChild","removeChild","EDGE_TYPES","ListWorlds","setIsOverlayOpen","setUpload","deleteWorld","getAutosave","storeEntity","entityId","entityToType","emoji","parseTiles","roomToTile","x_coordinate","y_coordinate","characters","objects","parseEdges","edges","dirs","edge","dst","src","constructTilesAndWalls","datMap","roomId","tileInfo","temp","neighbors","myLoc","otherLoc","constructWallsForTile","getWorld","timeout","dat","datType","auto","num_floors","postWorld","world_id","world_map","window","open","coord","direction","neighbor","wall","includes","resData","ListWorldsOverlay","isOverlayOpen","classes","classNames","CARD","ELEVATION_4","OVERLAY_SCROLL_CONTAINER","top","left","transform","ColorPicker","colors","advanced","maxHeight","borderRadius","borderColor","borderStyle","borderWidth","boxShadow","BaseMultiSelect","tooltip","currItems","setCurrItems","content","targetTagName","popoverClassName","TOP_RIGHT","tagInputProps","onRemove","_value","newItems","_item","change","selectedItems","tagRenderer","emptyTileForm","TileForm","onClear","setShowAdvanced","alignContent","HEADING","iconSize","fullValue","Tile","showAdvanced","tileStyle","toggleStairs","stopPropagation","toggleTo","otherFloor","newConnectedTile","contentColor","opacity","bottom","right","backgroundColor","overflow","char","Hideable","initialOpen","setOpen","SelectedTableView","columnNames","columnKeys","handleEdit","handleDuplicate","handleDelete","EmojiTD","showPicker","setShowPicker","interactionKind","PopoverInteractionKind","CLICK","onInteraction","wrapperTagName","onSelect","col","selectOrCreateState","BASE","CHOOSE","SELECT_FROM_EXISTING","CREATE_NEW","EDIT","DUPLICATE","SelectFromExistingOrCreateNew","initialState","SelectFromExisting","selectFromExistingProps","Form","formProps","handleCreateSubmit","handleEditSubmit","Selected","selectedProps","editing","setEditing","duplicating","setDuplicating","isArray","splice","AdvancedTileForm","inheritedInputs","handleClear","TilePreview","isInitialValid","setRoomValue","marginTop","get_neighbor","j","otherTile","AdvancedEditor","resetShowAdvanced","DRAWER_BODY","Grid","initialShowAdvanced","layout","setLayout","dragging","setDragging","onDragEvent","newState","initial","next","isEqual","generateWalls","cols","rowHeight","onDragStart","onDrag","onDragStop","onLayoutChange","setTimeout","isResizable","maxRows","data-grid","w","h","draggableHandle","draggableCancel","isDraggable","generateTiles","FloorSelector","manager","contextShowing","setContextShowing","confirmAlert","setConfirmAlert","createRef","FloorButton","ContextMenuTarget","createReactClass","keypressHandler","blur","renderContextMenu","confirmButtonText","onConfirm","onContextMenuClose","this","componentDidMount","focus","select","render","lineHeight","defaultValue","onKeyPress","cancelButtonText","onCancel","holdTime","callback","_e","initialIndex","newIndex","WARNING","template","itemKey","list","itemClicked","lock","itemClass","WorldBuilder","setAdvanced","loc","href","paramsIdx","initOverlay","getManageOn","world_name","stateRef","timer","autosave","postAutosave","clearTimeout","getElementById","trim","max","min","onValueChange","BOTTOM","launchWorld","WorldBuilderPage","EditForm","submitEdit","editedValue","player","EditPage","match","setInitialInputs","pendingEdits","setPendingEdits","submitEdits","Routes","component","exact","Math","random","App","ReactDOM"],"mappings":"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","file":"static/js/main.3945ae74.chunk.js","sourcesContent":["import React from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport { MenuItem } from \"@blueprintjs/core\";\n\nfunction WorldFileUpload({ setPopover }) {\n  const inputRef = React.useRef();\n  const [file, setFile] = React.useState(undefined);\n  return (\n    <>\n      <input\n        onChange={(e) => {\n          setFile(undefined);\n          const fileReader = new FileReader();\n          fileReader.onload = function (event) {\n            setFile(JSON.parse(event.target.result));\n          };\n          const file = e.target.files[0];\n          fileReader.readAsText(file);\n          setPopover(false);\n        }}\n        type=\"file\"\n        ref={inputRef}\n        style={{ display: \"none\" }}\n      />\n      {file && (\n        <Redirect to={{ pathname: \"/world_builder\", state: { data: file } }} />\n      )}\n      <MenuItem\n        icon=\"upload\"\n        onClick={() => inputRef.current.click()}\n        text=\"Upload File\"\n        shouldDismissPopover={false}\n      />\n    </>\n  );\n}\n\nexport default WorldFileUpload;\n","import React from \"react\";\nimport {\n  Navbar,\n  Alignment,\n  Button,\n  Position,\n  Popover,\n  Menu,\n  MenuItem,\n} from \"@blueprintjs/core\";\nimport { Link } from \"react-router-dom\";\n\nimport WorldFileUpload from \"./WorldFileUpload\";\n\nfunction NavBar({ children }) {\n  const [worldBuildPopover, setWorldBuildPopover] = React.useState(false);\n  return (\n    <React.Fragment>\n      <Navbar>\n        <Navbar.Group align={Alignment.LEFT}>\n          <Navbar.Heading>LIGHT Data Model</Navbar.Heading>\n          <Navbar.Divider />\n          <Link data-testid=\"link-explore\" className=\"btn-link\" to=\"/explore\">\n            <Button className=\"bp3-minimal\" icon=\"path-search\" text=\"Explore\" />\n          </Link>\n          <Link data-testid=\"link-create\" className=\"btn-link\" to=\"/create\">\n            <Button className=\"bp3-minimal\" icon=\"cube\" text=\"Create\" />\n          </Link>\n          <Link data-testid=\"link-review\" className=\"btn-link\" to=\"/review\">\n            <Button className=\"bp3-minimal\" icon=\"form\" text=\"Review Edits\" />\n          </Link>\n          <Popover\n            position={Position.BOTTOM_LEFT}\n            minimal\n            isOpen={worldBuildPopover}\n          >\n            <Button\n              onClick={() => setWorldBuildPopover(!worldBuildPopover)}\n              className=\"bp3-minimal\"\n              icon=\"map-create\"\n              text=\"Build World\"\n            />\n            <Menu>\n              <MenuItem\n                icon=\"new-object\"\n                text={\n                  <Link\n                    onClick={() => setWorldBuildPopover(false)}\n                    style={{ color: \"inherit\" }}\n                    data-testid=\"link-world-builder\"\n                    className=\"btn-link\"\n                    to=\"/world_builder\"\n                  >\n                    Create New\n                  </Link>\n                }\n                shouldDismissPopover={true}\n                tagName=\"div\"\n              />\n              <MenuItem\n                icon=\"cloud-upload\"\n                text={\n                  <Link\n                    onClick={() => setWorldBuildPopover(false)}\n                    style={{ color: \"inherit\" }}\n                    data-testid=\"link-world-builder-manage\"\n                    className=\"btn-link\"\n                    to=\"/world_builder?manage=true\"\n                  >\n                    Manage Existing\n                  </Link>\n                }\n                shouldDismissPopover={true}\n                tagName=\"div\"\n              />\n              <WorldFileUpload setPopover={setWorldBuildPopover} />\n            </Menu>\n          </Popover>\n        </Navbar.Group>\n      </Navbar>\n      {children}\n    </React.Fragment>\n  );\n}\n\nexport default NavBar;\n","const DEV = {\n  host: \"http://localhost\",\n  hostname: \"localhost\",\n  port: \"35494\",\n};\n\nexport default DEV;\n","import React from \"react\";\n\nimport CONFIG from \"./config\";\n\nexport function usePrevious(value) {\n  const ref = React.useRef();\n  React.useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n\nexport function useDidChange(val) {\n  const prevVal = usePrevious(val);\n  return prevVal !== val;\n}\n\nexport function useAPI(CONFIG, url, { body, params } = {}, preloaded) {\n  const [state, setState] = React.useState({\n    loading: true,\n    result: undefined,\n  });\n\n  const newUrl = useDidChange(url);\n\n  React.useEffect(() => {\n    if (state.loading && preloaded) {\n      setState({ loading: false, result: preloaded });\n      return;\n    }\n    if (newUrl) {\n      setState({ loading: true, result: undefined });\n      return;\n    }\n    let isSubscribed = true;\n\n    if (state.loading) {\n      fetch(CONFIG.host + \":\" + CONFIG.port + \"/builder\" + url)\n        .then((res) => res.json())\n        .then((data) => {\n          if (isSubscribed) {\n            setState({ loading: false, result: data });\n          }\n        })\n        .catch((err) => console.log(\"Error fetching data\"));\n    }\n\n    return () => (isSubscribed = false);\n  }, [CONFIG.host, CONFIG.port, url, newUrl, preloaded, state]);\n\n  const reload = () => {\n    setState({ loading: true, result: undefined });\n  };\n\n  return {\n    loading: state.loading,\n    result: state.result,\n    reload,\n  };\n}\n\nexport function post(url, payload) {\n  const formBody = [];\n  for (let property in payload) {\n    const encodedKey = encodeURIComponent(property);\n    const encodedValue = encodeURIComponent(\n      typeof payload[property] === \"object\"\n        ? JSON.stringify(payload[property])\n        : payload[property]\n    );\n    formBody.push(encodedKey + \"=\" + encodedValue);\n  }\n  return fetch(`${CONFIG.host}:${CONFIG.port}/${url}`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n    },\n    body: formBody.join(\"&\"),\n  });\n}\n\nexport function get_source(local_id, entities) {\n  if (local_id in entities.room) {\n    return entities.room[local_id].id;\n  } else if (local_id in entities.object) {\n    return entities.object[local_id].id;\n  } else if (local_id in entities.character) {\n    return entities.character[local_id].id;\n  } else {\n    return 0;\n  }\n}\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { Intent, Spinner, RadioGroup, Radio } from \"@blueprintjs/core\";\nimport AnimateHeight from \"react-animate-height\";\nimport { startCase } from \"lodash\";\nimport ReactPaginate from \"react-paginate\";\n\nimport CONFIG from \"../config\";\nimport { useAPI } from \"../utils\";\n\nfunction ExplorePage() {\n  const [selectedEntity, setSelectedEntity] = React.useState(\"object\");\n  const [page, setPage] = React.useState(0);\n\n  const [searchText, setSearchText] = React.useState(\"\");\n  const { loading, result } = useAPI(\n    CONFIG,\n    \"/entities/\" + selectedEntity + \"?search=\" + searchText + \"&page=\" + page\n  );\n\n  return (\n    <div>\n      <h2 data-testid=\"header\" className=\"bp3-heading\">\n        Explore\n      </h2>\n      <div className=\"bp3-text-large\">\n        Search across the LIGHT database for existing objects, characters, or\n        rooms.\n      </div>\n      <div\n        className=\"bp3-input-group bp3-large\"\n        style={{ margin: \"20px 0px 10px\" }}\n      >\n        <span className=\"bp3-icon bp3-icon-search\" />\n        <input\n          className=\"bp3-input\"\n          type=\"search\"\n          placeholder=\"Search...\"\n          dir=\"auto\"\n          value={searchText}\n          onChange={(e) => {\n            setSearchText(e.target.value);\n            setPage(0);\n          }}\n        />\n      </div>\n      <div style={{ display: \"flex\", marginBottom: 30 }}>\n        <span style={{ margin: \"0px 20px 0px 40px\" }}>Searching category:</span>\n        <RadioGroup\n          inline\n          large\n          onChange={(e) => {\n            setSelectedEntity(e.target.value);\n            setPage(0);\n          }}\n          selectedValue={selectedEntity}\n        >\n          <Radio data-testid=\"radio-object\" label=\"Objects\" value=\"object\" />\n          <Radio\n            data-testid=\"radio-character\"\n            label=\"Characters\"\n            value=\"character\"\n          />\n          <Radio data-testid=\"radio-room\" label=\"Rooms\" value=\"room\" />\n        </RadioGroup>\n      </div>\n\n      {loading ? (\n        <Spinner intent={Intent.PRIMARY} />\n      ) : (\n        <>\n          <ItemsList\n            items={result.data}\n            descriptionField={\n              selectedEntity === \"room\" ? \"description\" : \"physical_description\"\n            }\n            additionalFields={\n              selectedEntity === \"room\"\n                ? [{ name: \"Backstory\", key: \"backstory\" }]\n                : []\n            }\n            selectedEntity={selectedEntity}\n          />\n          <div style={{ margin: \"20px\" }}>\n            <ReactPaginate\n              previousLabel={\"previous\"}\n              nextLabel={\"next\"}\n              breakLabel={\"...\"}\n              forcePage={page}\n              pageCount={result.total_pages}\n              marginPagesDisplayed={2}\n              pageRangeDisplayed={5}\n              onPageChange={(data) => setPage(data.selected)}\n              containerClassName={\"pagination\"}\n              subContainerClassName={\"pages pagination\"}\n              activeClassName={\"active\"}\n            />\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nfunction ItemsList({\n  items,\n  descriptionField,\n  additionalFields = [],\n  selectedEntity,\n}) {\n  const [state, setState] = React.useState({\n    expanded: -1,\n    animating: 0,\n    nextState: -1,\n  });\n\n  function handleTrClick(index) {\n    if (state.expanded === -1) {\n      setState({ expanded: index, animating: 2, nextState: -1 });\n    } else if (state.expanded === index) {\n      setState({ expanded: index, animating: 3, nextState: -1 });\n    } else {\n      setState({ ...state, animating: 3, nextState: index });\n    }\n  }\n\n  if (items === undefined || items.length === 0) {\n    return <span>No items found.</span>;\n  } else {\n    return (\n      <table\n        data-testid=\"table-explore\"\n        style={{ width: \"100%\" }}\n        className=\"bp3-html-table bp3-html-table-condensed bp3-interactive\"\n      >\n        <thead>\n          <tr>\n            <th>Name</th>\n            <th>Description</th>\n            {additionalFields.map((field) => (\n              <th key={field}>{field.name}</th>\n            ))}\n\n            <th>ID</th>\n          </tr>\n        </thead>\n        <tbody>\n          {items.map((item, index) => (\n            <React.Fragment key={item.id}>\n              <tr\n                onClick={() => handleTrClick(index)}\n                data-testid=\"tr-explore\"\n                style={{\n                  background:\n                    index % 2 === 0 ? \"rgba(191, 204, 214, 0.15)\" : undefined,\n                }}\n              >\n                <td>\n                  <strong>{item.name}</strong>\n                </td>\n                <td>{item[descriptionField]}</td>\n                {additionalFields.map((field) => (\n                  <td key={field.name}>{item[field.key]}</td>\n                ))}\n                <td>{item.id}</td>\n              </tr>\n              <tr\n                style={{\n                  background:\n                    index % 2 === 0 ? \"rgba(191, 204, 214, 0.15)\" : undefined,\n                }}\n              >\n                <td\n                  colSpan={5}\n                  style={{\n                    display: state.expanded === index ? undefined : \"none\",\n                    padding: 0,\n                    cursor: \"unset\",\n                  }}\n                >\n                  <AnimateHeight\n                    duration={500}\n                    height={\n                      state.expanded === index &&\n                      (state.animating === 2 || state.animating === 0)\n                        ? \"auto\"\n                        : 0\n                    }\n                    easing={\"ease\"}\n                    onAnimationEnd={() =>\n                      setState({\n                        nextState: -1,\n                        expanded:\n                          state.animating === 2 ? index : state.nextState,\n                        animating:\n                          state.animating === 3 && state.nextState !== -1\n                            ? 2\n                            : 0,\n                      })\n                    }\n                    animateOpacity={true}\n                  >\n                    {state.expanded === index && (\n                      <ExpandedTab\n                        item={item}\n                        selectedEntity={selectedEntity}\n                      />\n                    )}\n                  </AnimateHeight>\n                </td>\n              </tr>\n            </React.Fragment>\n          ))}\n        </tbody>\n      </table>\n    );\n  }\n}\n\nfunction ExpandedTab({ item, selectedEntity }) {\n  return (\n    <>\n      <div\n        data-testid=\"dropdown\"\n        style={{\n          padding: \"20px 40px 0 40px\",\n        }}\n      >\n        <div\n          style={{\n            display: \"flex\",\n            flexDirection: \"column\",\n          }}\n        >\n          {Object.keys(item).map((key, index) => (\n            <p key={index}>\n              <strong>{startCase(key)}</strong>: {item[key]}\n            </p>\n          ))}\n        </div>\n      </div>\n      <div\n        style={{\n          display: \"flex\",\n          padding: \"0 20px 20px 20px\",\n          justifyContent: \"flex-end\",\n        }}\n      >\n        <Link\n          style={{ margin: \"0 5px\" }}\n          className=\"bp3-button bp3-small\"\n          to={{\n            pathname: `/create`,\n            state: {\n              type: selectedEntity,\n              entity: item,\n            },\n          }}\n        >\n          Create From\n        </Link>\n        <Link\n          style={{ margin: \"0 5px\" }}\n          className=\"bp3-button bp3-small\"\n          to={{\n            pathname: `/edit/${item.id}`,\n            state: {\n              type: selectedEntity,\n              entity: item,\n            },\n          }}\n        >\n          Edit\n        </Link>\n      </div>\n    </>\n  );\n}\n\nexport default ExplorePage;\n","import React from \"react\";\nimport { Intent, Menu, MenuItem } from \"@blueprintjs/core\";\nimport { Suggest } from \"@blueprintjs/select\";\nimport equal from \"fast-deep-equal\";\nimport \"@blueprintjs/select/lib/css/blueprint-select.css\";\n\nimport CONFIG from \"../../config\";\nimport { useAPI, get_source } from \"../../utils\";\n\nconst SUGGEST_SIZE = 100;\n\nfunction BaseSuggest({\n  id,\n  name,\n  errors,\n  touched,\n  setFieldTouched,\n  formValue,\n  handleChange,\n  type,\n  onItemSelect,\n  entities,\n  suggestionSource,\n}) {\n  const [items, setItems] = React.useState([]);\n  const [query, setQuery] = React.useState(\"\");\n  const [currItem, setCurrItem] = React.useState(formValue);\n  const { loading: loadingModel, result: modelResult } = useAPI(\n    CONFIG,\n    `/suggestions/${type}/${get_source(suggestionSource, entities)}`\n  );\n  const { loading, result } = useAPI(\n    CONFIG,\n    `/entities/${type}?search=${query}`\n  );\n\n  let options = result;\n\n  if (!loading && !loadingModel && modelResult !== undefined && !query) {\n    options = modelResult.concat(result);\n  }\n\n  React.useEffect(() => {\n    if (!loading) {\n      if (entities) {\n        const localEntities = Object.values(entities[type]);\n        const results = localEntities\n          .concat(options.slice(0, SUGGEST_SIZE + localEntities.length + 1))\n          .filter(\n            (item, index, self) =>\n              self.findIndex((t) => equal(t, item)) === index\n          );\n\n        return setItems(results);\n      }\n      return setItems(options);\n    }\n  }, [result, modelResult, loading, entities, type]);\n\n  React.useEffect(() => {\n    if (entities) {\n      return setCurrItem(formValue);\n    }\n    // When Reset is clicked on the form\n    if (isNaN(formValue)) {\n      return setCurrItem(null);\n    }\n    for (let item in items) {\n      if (items[item].id === formValue) {\n        return setCurrItem(items[item]);\n      }\n    }\n  }, [formValue, items, entities]);\n\n  const filterItems = (query, obj, _index, exactMatch) => {\n    const normalizedTitle = obj.name.toLowerCase();\n    const normalizedQuery = query.toLowerCase();\n    if (exactMatch) {\n      return normalizedTitle === normalizedQuery;\n    } else {\n      let string = \"\";\n      for (let key in obj) {\n        string += obj[key] + \". \";\n      }\n      const result = string.toLowerCase().indexOf(normalizedQuery) >= 0;\n      return result;\n    }\n  };\n\n  return (\n    <div onBlur={(e) => setFieldTouched(name)}>\n      <Suggest\n        id={id}\n        name={name}\n        items={items}\n        itemRenderer={renderOption}\n        itemListRenderer={renderItemList}\n        inputValueRenderer={(item) =>\n          entities && entities[type][item]\n            ? entities[type][item].name\n            : item.name\n        }\n        inputProps={{\n          intent: errors && touched ? Intent.DANGER : null,\n          \"data-testid\": \"base-suggest\",\n        }}\n        onItemSelect={(e) => {\n          if (onItemSelect) {\n            const result = onItemSelect(e, type);\n            setCurrItem(result);\n            handleChange(name, result, e);\n          } else {\n            setCurrItem(e);\n            handleChange(name, e.id, e);\n          }\n          setQuery(\"\");\n        }}\n        popoverProps={{ usePortal: false }}\n        itemPredicate={filterItems}\n        selectedItem={currItem}\n        query={query}\n        onQueryChange={(q) => setQuery(q)}\n        resetOnQuery={true}\n      />\n    </div>\n  );\n}\n\nfunction renderItemList({ filteredItems, renderItem }) {\n  const topResults = filteredItems.slice(0, SUGGEST_SIZE);\n  return (\n    <Menu>\n      {filteredItems.length > 0 ? (\n        <>\n          {topResults.map((item, index) => {\n            return renderItem(item, index);\n          })}\n          {filteredItems.length > SUGGEST_SIZE && (\n            <MenuItem\n              style={{ textAlign: \"center\" }}\n              disabled={true}\n              text=\"...\"\n            />\n          )}\n        </>\n      ) : (\n        <MenuItem disabled={true} text=\"No results.\" />\n      )}\n    </Menu>\n  );\n}\n\nfunction renderOption(obj, { handleClick, modifiers, index }) {\n  if (!modifiers.matchesPredicate) {\n    return null;\n  }\n\n  return (\n    <MenuItem\n      active={modifiers.active}\n      key={index}\n      onClick={handleClick}\n      text={obj.name}\n      shouldDismissPopover={false}\n    />\n  );\n}\n\nexport default BaseSuggest;\n","import React from \"react\";\nimport {\n  Button,\n  FormGroup,\n  Intent,\n  InputGroup,\n  Switch,\n  TextArea,\n  Alignment,\n} from \"@blueprintjs/core\";\nimport { Formik } from \"formik\";\n\nimport BaseSuggest from \"./BaseSuggest\";\n\nfunction ObjectForm({ initialInputs, handleSubmit, type }) {\n  return (\n    <Formik\n      initialValues={initialInputs}\n      validate={(values) => {\n        let errors = {};\n        if (!values.name) {\n          errors.name = \"Required\";\n        }\n        if (!values.name_prefix) {\n          errors.name_prefix = \"Required\";\n        }\n        if (!values.physical_description) {\n          errors.physical_description = \"Required\";\n        }\n        if (!values.base_id) {\n          errors.base_id = \"Required\";\n        }\n        return errors;\n      }}\n      onSubmit={handleSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleChange,\n          handleBlur,\n          handleSubmit,\n          handleReset,\n        } = props;\n\n        const handleSwitch = (e) => {\n          const { name } = e.target;\n          setFieldValue(name, values[name] ? 0 : 1);\n        };\n\n        return (\n          <form data-testid=\"form\">\n            <FormGroup\n              label=\"Name\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-input\"\n            >\n              <InputGroup\n                id=\"name-input\"\n                name=\"name\"\n                intent={errors.name && touched.name ? Intent.DANGER : null}\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name}\n              />\n              {errors.name && touched.name && (\n                <div className=\"form-error\">{errors.name}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Name Prefix\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-prefix-input\"\n            >\n              <InputGroup\n                id=\"name-prefix-input\"\n                name=\"name_prefix\"\n                intent={\n                  errors.name_prefix && touched.name_prefix\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name_prefix}\n              />\n              {errors.name_prefix && touched.name_prefix && (\n                <div className=\"form-error\">{errors.name_prefix}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Physical Description\"\n              labelInfo=\"(required)\"\n              labelFor=\"physical-description-input\"\n            >\n              <TextArea\n                id=\"physical-description-input\"\n                name=\"physical_description\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.physical_description && touched.physical_description\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.physical_description}\n              />\n              {errors.physical_description && touched.physical_description && (\n                <div className=\"form-error\">{errors.physical_description}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Base Object\"\n              labelInfo=\"(required)\"\n              labelFor=\"base-id-input\"\n            >\n              <BaseSuggest\n                id=\"base-id-input\"\n                name=\"base_id\"\n                type={`base_${type}`}\n                errors={errors.base_id}\n                touched={touched.base_id}\n                setFieldTouched={setFieldTouched}\n                formValue={values.base_id}\n                handleChange={setFieldValue}\n              />\n              {errors.base_id && touched.base_id && (\n                <div className=\"form-error\">{errors.base_id}</div>\n              )}\n            </FormGroup>\n            <FormGroup label=\"Properties\" labelInfo=\"(required)\" large={true}>\n              <div style={{ marginLeft: \"15px\", width: \"150px\" }}>\n                <Switch\n                  label=\"Container\"\n                  name=\"is_container\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_container}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Drink\"\n                  name=\"is_drink\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_drink}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Food\"\n                  name=\"is_food\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_food}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Gettable\"\n                  name=\"is_gettable\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_gettable}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Plural\"\n                  name=\"is_plural\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_plural}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Surface\"\n                  name=\"is_surface\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_surface}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Weapon\"\n                  name=\"is_weapon\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_weapon}\n                  alignIndicator={Alignment.RIGHT}\n                />\n                <Switch\n                  label=\"Wearable\"\n                  name=\"is_wearable\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_wearable}\n                  alignIndicator={Alignment.RIGHT}\n                />\n              </div>\n            </FormGroup>\n\n            <Button\n              type=\"reset\"\n              onClick={handleReset}\n              disabled={!dirty}\n              style={{ marginRight: \"15px\" }}\n            >\n              Reset\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              type=\"submit\"\n              onClick={handleSubmit}\n              disabled={!dirty || !isValid}\n              style={{ marginLeft: \"15px\" }}\n            >\n              Save Changes\n            </Button>\n          </form>\n        );\n      }}\n    </Formik>\n  );\n}\n\nexport const emptyObjectForm = {\n  name: \"\",\n  name_prefix: \"\",\n  physical_description: \"\",\n  base_id: 0,\n  is_container: 0,\n  is_drink: 0,\n  is_food: 0,\n  is_gettable: 0,\n  is_plural: 0,\n  is_surface: 0,\n  is_weapon: 0,\n  is_wearable: 0,\n};\n\nexport default ObjectForm;\n","import React from \"react\";\nimport {\n  Button,\n  FormGroup,\n  Intent,\n  InputGroup,\n  Switch,\n  TextArea,\n  Alignment,\n} from \"@blueprintjs/core\";\nimport { Formik } from \"formik\";\n\nimport BaseSuggest from \"./BaseSuggest\";\n\nfunction CharacterForm({ initialInputs, handleSubmit, type }) {\n  return (\n    <Formik\n      initialValues={initialInputs}\n      validate={(values) => {\n        let errors = {};\n        if (!values.name) {\n          errors.name = \"Required\";\n        }\n        if (!values.name_prefix) {\n          errors.name_prefix = \"Required\";\n        }\n        if (!values.persona) {\n          errors.persona = \"Required\";\n        }\n        if (!values.physical_description) {\n          errors.physical_description = \"Required\";\n        }\n        if (!values.char_type) {\n          errors.char_type = \"Required\";\n        }\n        if (!values.base_id) {\n          errors.base_id = \"Required\";\n        }\n        return errors;\n      }}\n      onSubmit={handleSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleChange,\n          handleBlur,\n          handleSubmit,\n          handleReset,\n        } = props;\n\n        const handleSwitch = (e) => {\n          const { name } = e.target;\n          setFieldValue(name, values[name] ? 0 : 1);\n        };\n\n        return (\n          <form data-testid=\"form\">\n            <FormGroup\n              label=\"Name\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-input\"\n            >\n              <InputGroup\n                id=\"name-input\"\n                name=\"name\"\n                intent={errors.name && touched.name ? Intent.DANGER : null}\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name}\n              />\n              {errors.name && touched.name && (\n                <div className=\"form-error\">{errors.name}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Name Prefix\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-prefix-input\"\n            >\n              <InputGroup\n                id=\"name-prefix-input\"\n                name=\"name_prefix\"\n                intent={\n                  errors.name_prefix && touched.name_prefix\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name_prefix}\n              />\n              {errors.name_prefix && touched.name_prefix && (\n                <div className=\"form-error\">{errors.name_prefix}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Persona\"\n              labelInfo=\"(required)\"\n              labelFor=\"persona-input\"\n            >\n              <TextArea\n                id=\"persona-input\"\n                name=\"persona\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.persona && touched.persona ? Intent.DANGER : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.persona}\n              />\n              {errors.persona && touched.persona && (\n                <div className=\"form-error\">{errors.persona}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Physical Description\"\n              labelInfo=\"(required)\"\n              labelFor=\"physical-description-input\"\n            >\n              <TextArea\n                id=\"physical-description-input\"\n                name=\"physical_description\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.physical_description && touched.physical_description\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.physical_description}\n              />\n              {errors.physical_description && touched.physical_description && (\n                <div className=\"form-error\">{errors.physical_description}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Character Type\"\n              labelInfo=\"(required)\"\n              labelFor=\"char-type-input\"\n            >\n              <InputGroup\n                id=\"char-type-input\"\n                name=\"char_type\"\n                intent={\n                  errors.char_type && touched.char_type ? Intent.DANGER : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.char_type}\n              />\n              {errors.char_type && touched.char_type && (\n                <div className=\"form-error\">{errors.char_type}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Base Character\"\n              labelInfo=\"(required)\"\n              labelFor=\"base-id-input\"\n            >\n              <BaseSuggest\n                id=\"base-id-input\"\n                name=\"base_id\"\n                type={`base_${type}`}\n                errors={errors.base_id}\n                touched={touched.base_id}\n                setFieldTouched={setFieldTouched}\n                formValue={values.base_id}\n                handleChange={setFieldValue}\n              />\n              {errors.base_id && touched.base_id && (\n                <div className=\"form-error\">{errors.base_id}</div>\n              )}\n            </FormGroup>\n            <FormGroup label=\"Properties\" labelInfo=\"(required)\" large={true}>\n              <div style={{ marginLeft: \"15px\", width: \"150px\" }}>\n                <Switch\n                  label=\"Plural\"\n                  name=\"is_plural\"\n                  onChange={handleSwitch}\n                  checked={!!values.is_plural}\n                  alignIndicator={Alignment.RIGHT}\n                />\n              </div>\n            </FormGroup>\n\n            <Button\n              type=\"reset\"\n              onClick={handleReset}\n              disabled={!dirty}\n              style={{ marginRight: \"15px\" }}\n            >\n              Reset\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              type=\"submit\"\n              onClick={handleSubmit}\n              disabled={!dirty || !isValid}\n              style={{ marginLeft: \"15px\" }}\n            >\n              Save Changes\n            </Button>\n          </form>\n        );\n      }}\n    </Formik>\n  );\n}\n\nexport const emptyCharacterForm = {\n  name: \"\",\n  name_prefix: \"\",\n  persona: \"\",\n  physical_description: \"\",\n  char_type: \"\",\n  base_id: 0,\n  is_plural: 0,\n};\n\nexport default CharacterForm;\n","import React from \"react\";\nimport {\n  Button,\n  FormGroup,\n  Intent,\n  InputGroup,\n  TextArea,\n} from \"@blueprintjs/core\";\nimport { Formik } from \"formik\";\n\nimport BaseSuggest from \"./BaseSuggest\";\n\nfunction RoomForm({ initialInputs, handleSubmit, type }) {\n  return (\n    <Formik\n      initialValues={initialInputs}\n      validate={(values) => {\n        let errors = {};\n        if (!values.name) {\n          errors.name = \"Required\";\n        }\n        if (!values.description) {\n          errors.description = \"Required\";\n        }\n        if (!values.backstory) {\n          errors.backstory = \"Required\";\n        }\n        if (!values.base_id) {\n          errors.base_id = \"Required\";\n        }\n        return errors;\n      }}\n      onSubmit={handleSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleChange,\n          handleBlur,\n          handleSubmit,\n          handleReset,\n        } = props;\n\n        return (\n          <form data-testid=\"form\">\n            <FormGroup\n              label=\"Name\"\n              labelInfo=\"(required)\"\n              labelFor=\"name-input\"\n            >\n              <InputGroup\n                id=\"name-input\"\n                name=\"name\"\n                intent={errors.name && touched.name ? Intent.DANGER : null}\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.name}\n              />\n              {errors.name && touched.name && (\n                <div className=\"form-error\">{errors.name}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Description\"\n              labelInfo=\"(required)\"\n              labelFor=\"description-input\"\n            >\n              <TextArea\n                id=\"description-input\"\n                name=\"description\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.description && touched.description\n                    ? Intent.DANGER\n                    : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.description}\n              />\n              {errors.description && touched.description && (\n                <div className=\"form-error\">{errors.description}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Backstory\"\n              labelInfo=\"(required)\"\n              labelFor=\"backstory-input\"\n            >\n              <TextArea\n                id=\"backstory-input\"\n                name=\"backstory\"\n                growVertically={true}\n                fill={true}\n                intent={\n                  errors.backstory && touched.backstory ? Intent.DANGER : null\n                }\n                onBlur={handleBlur}\n                onChange={handleChange}\n                value={values.backstory}\n              />\n              {errors.backstory && touched.backstory && (\n                <div className=\"form-error\">{errors.backstory}</div>\n              )}\n            </FormGroup>\n            <FormGroup\n              label=\"Base Room\"\n              labelInfo=\"(required)\"\n              labelFor=\"base-id-input\"\n            >\n              <BaseSuggest\n                id=\"base-id-input\"\n                name=\"base_id\"\n                type={`base_${type}`}\n                errors={errors.base_id}\n                touched={touched.base_id}\n                setFieldTouched={setFieldTouched}\n                formValue={values.base_id}\n                handleChange={setFieldValue}\n              />\n              {errors.base_id && touched.base_id && (\n                <div className=\"form-error\">{errors.base_id}</div>\n              )}\n            </FormGroup>\n            <Button\n              type=\"reset\"\n              onClick={handleReset}\n              disabled={!dirty}\n              style={{ marginRight: \"15px\" }}\n            >\n              Reset\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              type=\"submit\"\n              onClick={handleSubmit}\n              disabled={!dirty || !isValid}\n              style={{ marginLeft: \"15px\" }}\n            >\n              Save Changes\n            </Button>\n          </form>\n        );\n      }}\n    </Formik>\n  );\n}\n\nexport const emptyRoomForm = {\n  name: \"\",\n  description: \"\",\n  backstory: \"\",\n  base_id: 0,\n};\n\nexport default RoomForm;\n","import { Position, Toaster } from \"@blueprintjs/core\";\n\nconst AppToaster = Toaster.create({\n  position: Position.TOP,\n});\n\nexport default AppToaster;\n","import React from \"react\";\nimport { Radio, RadioGroup, Intent } from \"@blueprintjs/core\";\nimport { useHistory } from \"react-router-dom\";\n\nimport { post } from \"../utils\";\nimport ObjectForm, { emptyObjectForm } from \"./forms/ObjectForm\";\nimport CharacterForm, { emptyCharacterForm } from \"./forms/CharacterForm\";\nimport RoomForm, { emptyRoomForm } from \"./forms/RoomForm\";\nimport AppToaster from \"./AppToaster\";\n\nfunction CreatePage({ location }) {\n  const [formType, setFormType] = React.useState(\n    location.state ? location.state.type : \"object\"\n  );\n\n  return (\n    <div>\n      <h2\n        data-testid=\"header\"\n        className=\"bp3-heading\"\n        style={{ marginBottom: 15 }}\n      >\n        Create new entity\n      </h2>\n      <div className=\"bp3-text-large\">\n        <div style={{ display: \"flex\", marginBottom: 30 }}>\n          <span style={{ marginRight: \"20px\" }}>Entity type:</span>\n          <RadioGroup\n            inline\n            large\n            onChange={(e) => {\n              location.state = undefined;\n              setFormType(e.target.value);\n            }}\n            selectedValue={formType}\n          >\n            <Radio data-testid=\"radio-object\" label=\"Object\" value=\"object\" />\n            <Radio\n              data-testid=\"radio-character\"\n              label=\"Character\"\n              value=\"character\"\n            />\n            <Radio data-testid=\"radio-room\" label=\"Room\" value=\"room\" />\n          </RadioGroup>\n        </div>\n        <CreateForm\n          type={formType}\n          initialInputs={location.state ? location.state.entity : undefined}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction CreateForm({ type, initialInputs }) {\n  const history = useHistory();\n  const submitEntity = async (payload) => {\n    await post(`builder/entities/${type}`, payload).then(() => {\n      history.push(\"/\");\n    });\n    AppToaster.show({\n      intent: Intent.SUCCESS,\n      message: \"Successfully created entity\",\n    });\n  };\n\n  switch (type) {\n    case \"object\":\n      return (\n        <ObjectForm\n          type={type}\n          initialInputs={initialInputs ? initialInputs : emptyObjectForm}\n          handleSubmit={submitEntity}\n        />\n      );\n    case \"character\":\n      return (\n        <CharacterForm\n          type={type}\n          initialInputs={initialInputs ? initialInputs : emptyCharacterForm}\n          handleSubmit={submitEntity}\n        />\n      );\n    case \"room\":\n      return (\n        <RoomForm\n          type={type}\n          initialInputs={initialInputs ? initialInputs : emptyRoomForm}\n          handleSubmit={submitEntity}\n        />\n      );\n    default:\n      return \"This entity cannot be created at the moment\";\n  }\n}\n\nexport default CreatePage;\n","import React from \"react\";\nimport {\n  Button,\n  Checkbox,\n  Classes,\n  Dialog,\n  Intent,\n  Radio,\n  RadioGroup,\n  Spinner,\n} from \"@blueprintjs/core\";\nimport DiffMatchPatch from \"diff-match-patch\";\nimport AnimateHeight from \"react-animate-height\";\nimport { startCase, fill } from \"lodash\";\n\nimport CONFIG from \"../config\";\nimport { useAPI, post } from \"../utils\";\nimport AppToaster from \"./AppToaster\";\n\nfunction ReviewPage() {\n  const [selectedStatus, setSelectedStatus] = React.useState(\"under review\");\n\n  const { loading, result, reload } = useAPI(\n    CONFIG,\n    `/edits?expand=true&status=${selectedStatus}`\n  );\n\n  return (\n    <div>\n      <h2 data-testid=\"header\" className=\"bp3-heading\">\n        Review\n      </h2>\n      <div className=\"bp3-text-large\">\n        Review pending, accepted, and rejected edits to the LIGHT database.\n      </div>\n      <br />\n      <div style={{ display: \"flex\", marginBottom: \"30px\" }}>\n        <span style={{ margin: \"0px 20px 0px 40px\" }}>Searching category:</span>\n        <RadioGroup\n          inline\n          large\n          onChange={(e) => setSelectedStatus(e.target.value)}\n          selectedValue={selectedStatus}\n        >\n          <Radio\n            data-testid=\"radio-under-review\"\n            label=\"Under Review\"\n            value=\"under review\"\n          />\n          <Radio\n            data-testid=\"radio-accepted\"\n            label=\"Accepted\"\n            value=\"accepted\"\n          />\n          <Radio\n            data-testid=\"radio-rejected\"\n            label=\"Rejected\"\n            value=\"rejected\"\n          />\n        </RadioGroup>\n      </div>\n      {loading ? (\n        <Spinner intent={Intent.PRIMARY} />\n      ) : (\n        <EditsList edits={result} status={selectedStatus} reload={reload} />\n      )}\n    </div>\n  );\n}\n\nfunction EditsList({ edits, status, reload }) {\n  const [state, setState] = React.useState({\n    expanded: -1,\n    animating: 0,\n    nextState: -1,\n  });\n  const [selected, setSelected] = React.useState({ rows: [], all: 0 });\n  const [submitAction, setSubmitAction] = React.useState(undefined);\n  const [showDialog, setShowDialog] = React.useState(false);\n  const [pendingSubmission, setPendingSubmission] = React.useState([]);\n\n  if (edits && edits.length > 0 && selected.rows.length === 0) {\n    setSelected({ ...selected, rows: fill(Array(edits.length), false) });\n  }\n\n  function handleTdClick(index) {\n    if (status === \"under review\") {\n      if (state.expanded === -1) {\n        setState({ expanded: index, animating: 1, nextState: -1 });\n      } else if (state.expanded === index) {\n        setState({ expanded: index, animating: 3, nextState: -1 });\n      } else {\n        setState({ ...state, animating: 3, nextState: index });\n      }\n    }\n  }\n\n  function handleCheckbox(index) {\n    const newSelection = [...selected.rows];\n    newSelection[index] = selected.rows[index] ? false : true;\n    let all = selected.all;\n    if (newSelection.every((r) => r === true)) {\n      all = 1;\n    } else if (newSelection.every((r) => r === false)) {\n      all = 0;\n    } else {\n      all = -1;\n    }\n    setSelected({ rows: newSelection, all });\n  }\n\n  function handleSelectAll() {\n    const all = selected.all ? 0 : 1;\n    const newRows = fill(Array(edits.length), !!all);\n    setSelected({ rows: newRows, all });\n  }\n\n  async function handleSubmitSelected() {\n    const reqs = pendingSubmission.map((index) =>\n      post(`builder/edits/${edits[index].edit_id}/${submitAction}`)\n    );\n    await Promise.all(reqs).then(() => {\n      reload();\n    });\n    AppToaster.show({ intent: Intent.SUCCESS, message: \"Review submitted\" });\n  }\n\n  const showSubmission = (action) => {\n    const checked = [];\n    for (let i = 0; i < selected.rows.length; i++) {\n      if (selected.rows[i]) {\n        checked.push(i);\n      }\n    }\n    setPendingSubmission(checked);\n    setSubmitAction(action);\n    setShowDialog(true);\n  };\n\n  if (edits === undefined || edits.length === 0) {\n    return <span>No edits found.</span>;\n  } else {\n    return (\n      <>\n        <Dialog\n          icon=\"info-sign\"\n          onClose={() => setShowDialog(false)}\n          title={`Confirm edits to be ${\n            submitAction === \"reject\" ? \"rejected\" : \"accepted\"\n          }`}\n          isOpen={showDialog}\n          usePortal={false}\n        >\n          <div className={Classes.DIALOG_BODY}>\n            <table className=\"bp3-html-table bp3-html-table-condensed bp3-interactive\">\n              <thead>\n                <tr>\n                  <th>Edit ID</th>\n                  <th>Entity ID</th>\n                  <th>Edited Field</th>\n                </tr>\n              </thead>\n              <tbody>\n                {pendingSubmission.map((edit, index) => {\n                  return (\n                    <tr key={index}>\n                      <td>{edits[edit].edit_id}</td>\n                      <td>{edits[edit].id}</td>\n                      <td>{edits[edit].field}</td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n          <div className={Classes.DIALOG_FOOTER}>\n            <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n              <Button onClick={() => setShowDialog(false)}>Close</Button>\n              <Button intent={Intent.PRIMARY} onClick={handleSubmitSelected}>\n                Confirm Edits\n              </Button>\n            </div>\n          </div>\n        </Dialog>\n        <table\n          data-testid=\"table-review\"\n          style={{ width: \"100%\" }}\n          className=\"bp3-html-table bp3-html-table-condensed bp3-interactive\"\n        >\n          <thead>\n            <tr>\n              {status === \"under review\" && (\n                <th style={{ textAlign: \"center\" }}>\n                  <Checkbox\n                    checked={selected.all}\n                    indeterminate={selected.all === -1}\n                    onClick={handleSelectAll}\n                  />\n                </th>\n              )}\n              <th>Edit ID</th>\n              <th>Entity ID</th>\n              <th>Edited Field</th>\n              <th>Edit</th>\n            </tr>\n          </thead>\n          <tbody>\n            {edits.map((edit, index) => (\n              <React.Fragment key={edit.edit_id}>\n                <tr\n                  data-testid=\"tr-review\"\n                  style={{\n                    background:\n                      index % 2 === 0 ? \"rgba(191, 204, 214, 0.15)\" : undefined,\n                  }}\n                >\n                  {status === \"under review\" && (\n                    <td style={{ textAlign: \"center\" }}>\n                      <Checkbox\n                        checked={selected.rows[index]}\n                        onClick={() => handleCheckbox(index)}\n                      />\n                    </td>\n                  )}\n                  <td onClick={() => handleTdClick(index)}>{edit.edit_id}</td>\n                  <td onClick={() => handleTdClick(index)}>\n                    <strong>{edit.id}</strong>\n                  </td>\n                  <td onClick={() => handleTdClick(index)}>{edit.field}</td>\n                  <td onClick={() => handleTdClick(index)}>\n                    {diff(edit.unedited_value, edit.edited_value)}\n                  </td>\n                </tr>\n                <tr\n                  style={{\n                    background:\n                      index % 2 === 0 ? \"rgba(191, 204, 214, 0.15)\" : undefined,\n                  }}\n                >\n                  <td\n                    colSpan={5}\n                    style={{\n                      display: state.expanded === index ? undefined : \"none\",\n                      padding: 0,\n                      cursor: \"unset\",\n                    }}\n                  >\n                    <AnimateHeight\n                      duration={500}\n                      height={\n                        state.expanded === index &&\n                        (state.animating === 2 || state.animating === 0)\n                          ? \"auto\"\n                          : 0\n                      }\n                      easing={\"ease\"}\n                      onAnimationEnd={() =>\n                        setState({\n                          nextState: -1,\n                          expanded:\n                            state.animating === 2 ? index : state.nextState,\n                          animating:\n                            state.animating === 3 && state.nextState !== -1\n                              ? 1\n                              : 0,\n                        })\n                      }\n                      animateOpacity={true}\n                    >\n                      {state.expanded === index && (\n                        <ExpandedTab\n                          edit={edit}\n                          state={state}\n                          setState={setState}\n                          reload={reload}\n                        />\n                      )}\n                    </AnimateHeight>\n                  </td>\n                </tr>\n              </React.Fragment>\n            ))}\n          </tbody>\n        </table>\n        {status === \"under review\" && (\n          <div\n            style={{\n              display: \"flex\",\n              margin: \"10px\",\n              justifyContent: \"flex-end\",\n            }}\n          >\n            <Button\n              intent={Intent.DANGER}\n              type=\"submit\"\n              onClick={() => showSubmission(\"reject\")}\n              style={{ marginLeft: \"15px\" }}\n              disabled={!selected.all}\n            >\n              Reject\n            </Button>\n            <Button\n              intent={Intent.SUCCESS}\n              type=\"submit\"\n              onClick={() => showSubmission(\"accept/accepted\")}\n              style={{ marginLeft: \"15px\" }}\n              disabled={!selected.all}\n            >\n              Accept\n            </Button>\n          </div>\n        )}\n      </>\n    );\n  }\n}\n\nfunction ExpandedTab({ edit, state, setState, reload }) {\n  const { loading, result } = useAPI(CONFIG, `/entities/${edit.id}`);\n  React.useEffect(() => {\n    if (result && state.animating === 1) {\n      setState({ ...state, animating: 2 });\n    }\n  }, [loading, setState, state, result]);\n  return (\n    <>\n      {loading ? (\n        <></>\n      ) : (\n        <Card edit={edit} entity={result.entity} reload={reload} />\n      )}\n    </>\n  );\n}\n\nfunction Card({ edit, entity, reload }) {\n  delete entity.id;\n  return (\n    <>\n      <div\n        data-testid=\"dropdown\"\n        style={{\n          display: \"flex\",\n          flexDirection: \"row\",\n          padding: \"20px 20px 0 20px\",\n          alignItems: \"center\",\n        }}\n      >\n        <div style={{ flexGrow: 1 }}>\n          <div\n            style={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              width: \"50%\",\n              maxWidth: \"30vw\",\n              margin: \"auto\",\n            }}\n          >\n            {Object.keys(entity).map((key, index) => (\n              <p\n                key={index}\n                style={{ color: key === edit.field ? \"#DB3737\" : undefined }}\n              >\n                <strong>{startCase(key)}</strong>: {entity[key]}\n              </p>\n            ))}\n          </div>\n        </div>\n        <div style={{ height: \"100%\", fontSize: \"20px\", color: \"#394B59\" }}>\n          \n        </div>\n        <div style={{ flexGrow: 1 }}>\n          <div\n            style={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              width: \"50%\",\n              maxWidth: \"30vw\",\n              margin: \"auto\",\n            }}\n          >\n            {Object.keys(entity).map((key, index) => (\n              <p\n                key={index}\n                style={{ color: key === edit.field ? \"#0F9960\" : undefined }}\n              >\n                <strong>{startCase(key)}</strong>:{\" \"}\n                {key === edit.field ? edit.edited_value : entity[key]}\n              </p>\n            ))}\n          </div>\n        </div>\n      </div>\n      <div\n        style={{\n          display: \"flex\",\n          padding: \"0 20px 20px 20px\",\n          justifyContent: \"flex-end\",\n        }}\n      >\n        <Button\n          intent={Intent.DANGER}\n          type=\"submit\"\n          onClick={() =>\n            post(`builder/edits/${edit.edit_id}/reject`).then(() => reload())\n          }\n          style={{ marginLeft: \"15px\" }}\n        >\n          Reject Edit\n        </Button>\n        <Button\n          intent={Intent.SUCCESS}\n          type=\"submit\"\n          onClick={() =>\n            post(`builder/edits/${edit.edit_id}/accept/accepted`).then(() =>\n              reload()\n            )\n          }\n          style={{ marginLeft: \"15px\" }}\n        >\n          Accept Edit\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction diff(orig, edit) {\n  let diff;\n  if (isNaN(orig) || isNaN(edit)) {\n    const differ = new DiffMatchPatch();\n    diff = differ.diff_main(orig, edit);\n    differ.diff_cleanupSemantic(diff);\n  } else {\n    orig = 0 + orig;\n    edit = 0 + edit;\n    diff = [\n      [-1, +orig],\n      [1, +edit],\n    ];\n  }\n  return (\n    <>\n      {diff.map((d, index) => {\n        switch (d[0]) {\n          case -1:\n            return (\n              <strike key={index} style={{ color: \"#FF7373\" }}>\n                {\" \"}\n                {d[1]}{\" \"}\n              </strike>\n            );\n          case 0:\n            return <strong key={index}>{d[1]}</strong>;\n          case 1:\n            return (\n              <strong key={index} style={{ color: \"#0F9960\" }}>\n                {d[1]}\n              </strong>\n            );\n          default:\n            return <></>;\n        }\n      })}\n    </>\n  );\n}\n\nexport default ReviewPage;\n","import React from \"react\";\nimport { Colors } from \"@blueprintjs/core\";\nimport { cloneDeep, isEmpty, merge } from \"lodash\";\nimport equal from \"fast-deep-equal\";\nimport { emojiIndex } from \"emoji-mart\";\n\nexport const MAX_WIDTH = 10;\nexport const MAX_HEIGHT = 10;\nexport const MAX_FLOORS = 10;\n\nconst STARTING_WIDTH = 3;\nconst STARTING_HEIGHT = 3;\nconst STARTING_FLOORS = 1;\n\nexport const DEFAULT_EMOJI = \"\";\n\nexport const TILE_COLORS = [\n  Colors.GRAY3,\n  Colors.VIOLET5,\n  Colors.RED5,\n  Colors.SEPIA5,\n  Colors.GOLD5,\n  Colors.FOREST5,\n  Colors.BLUE5,\n];\n\nconst grass = [\n  \"grass\",\n  \"field\",\n  \"plains\",\n  \"forest\",\n  \"land\",\n  \"gardens\",\n  \"meadow\",\n  \"woods\",\n  \"jungle\",\n  \"swamp\",\n  \"green\",\n];\nconst water = [\n  \"water\",\n  \"lake\",\n  \"river\",\n  \"ocean\",\n  \"sea\",\n  \"pond\",\n  \"lagoon\",\n  \"shore\",\n  \"blue\",\n];\nconst buildings = [\n  \"castle\",\n  \"fortress\",\n  \"church\",\n  \"cathedral\",\n  \"tower\",\n  \"building\",\n  \"cave\",\n  \"gray\",\n  \"grey\",\n];\nconst royal = [\"king\", \"queen\", \"palace\", \"purple\"];\nconst brick = [\"brick\", \"fire\", \"red\"];\nconst path = [\"path\", \"road\", \"bridge\", \"brown\"];\nconst farm = [\"farm\", \"cottage\", \"sand\", \"beach\", \"yellow\", \"gold\"];\n\n/**\n * Utility function for suggesting a biome (tile color) for a given room name\n */\nexport function findBiome(name, current) {\n  const lowName = name.toLowerCase();\n  if (grass.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.FOREST5;\n  }\n  if (water.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.BLUE5;\n  }\n  if (brick.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.RED5;\n  }\n  if (path.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.SEPIA5;\n  }\n  if (farm.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.GOLD5;\n  }\n  if (buildings.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.GRAY3;\n  }\n  if (royal.some((biome) => lowName.indexOf(biome) > -1)) {\n    return Colors.VIOLET5;\n  }\n  return current;\n}\n\n/**\n * Utility function for determining whether content should be \"white\" or \"black\" on a color background\n */\nexport function invertColor(hex) {\n  if (hex.indexOf(\"#\") === 0) {\n    hex = hex.slice(1);\n  }\n  // convert 3-digit hex to 6-digits.\n  if (hex.length === 3) {\n    hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n  }\n  // invert color components\n  var r = parseInt(hex.slice(0, 2), 16),\n    g = parseInt(hex.slice(2, 4), 16),\n    b = parseInt(hex.slice(4, 6), 16);\n  // pick black/white based on intensity\n  return r * 0.299 + g * 0.587 + b * 0.114 > 150 ? \"#182026\" : \"#F5F8FA\";\n}\n\nexport function findEmoji(name) {\n  let results = emojiIndex.search(name);\n  if (results[0]) {\n    return results[0].native;\n  }\n  const words = name.split(\" \");\n  for (let i = 0; i < words.length; i++) {\n    let string = words[i];\n    if (words[i].charAt(words[i].length - 1) === \"s\") {\n      string = words[i].substring(0, words[i].length - 1);\n    }\n    results = emojiIndex.search(string);\n    if (results[0]) {\n      return results[0].native;\n    }\n  }\n  return DEFAULT_EMOJI;\n}\n\nconst mapReducer = (state, action) => {\n  switch (action.type) {\n    case \"SET_MAP\":\n      return action.map;\n    case \"SET_TILE\":\n      return state.map((floor, floorIndex) => {\n        if (floorIndex === action.floor) {\n          return {\n            ...floor,\n            tiles: {\n              ...floor.tiles,\n              [`${action.x} ${action.y}`]: action.newTile,\n            },\n          };\n        } else {\n          return floor;\n        }\n      });\n    case \"EDIT_FLOOR_NAME\":\n      return state.map((floor, floorIndex) => {\n        if (floorIndex === action.floor) {\n          return {\n            ...floor,\n            name: action.name,\n          };\n        } else {\n          return floor;\n        }\n      });\n\n    default:\n      return state;\n  }\n};\n\nconst createdEntitiesReducer = (state, action) => {\n  switch (action.type) {\n    case \"SET_ALL\":\n      return action.entities;\n    case \"ADD_ENTITY\": {\n      return Object.assign({}, state, {\n        [action.entityType]: {\n          ...state[action.entityType],\n          [state.nextID]: action.data,\n        },\n        nextID: state.nextID + 1,\n      });\n    }\n    case \"EDIT_ENTITY\": {\n      return merge(state, {\n        [action.entityType]: { [action.id]: action.data },\n      });\n    }\n    default:\n      return state;\n  }\n};\n\n/**\n * Custom hook managing map state.\n * Includes utility functions for setting state of the map.\n */\nexport function useWorldBuilder(upload) {\n  const [dimensions, setDimensions] = React.useState(\n    upload\n      ? upload.data.dimensions\n      : {\n          name: null,\n          height: STARTING_HEIGHT,\n          width: STARTING_WIDTH,\n          floors: STARTING_FLOORS,\n        }\n  );\n\n  // Floors and tiles kept seperate to avoid unnecessary updates on either side\n  // The index key is used because the Reorder component does not pass index to children\n  // Represents the map state\n  // Structured as: Array(Map(name: FloorName, tiles: Map(x y': TileData), walls: Map('x1 y1|x2 y2': Wall)))\n  const initialMap = upload\n    ? upload.data.map\n    : [{ name: \"1F\", tiles: {}, walls: {} }];\n  const [map, mapDispatch] = React.useReducer(mapReducer, initialMap);\n\n  // Local entity store\n  const [entities, entitiesDispatch] = React.useReducer(\n    createdEntitiesReducer,\n    upload\n      ? upload.data.entities\n      : { room: {}, character: {}, object: {}, nextID: 1 }\n  );\n\n  // Floor currently being viewed in the editor\n  const [currFloor, setCurrFloor] = React.useState(0);\n\n  // make sure all floors are in the map\n  React.useEffect(() => {\n    const newMap = [];\n    for (let f = 0; f < dimensions.floors; f++) {\n      newMap.push(\n        map[f] ? map[f] : { name: `${f + 1}F`, tiles: {}, walls: {} }\n      );\n    }\n    mapDispatch({ type: \"SET_MAP\", map: newMap });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dimensions]);\n\n  // Add an entity to the local store and return its temporary id\n  const addEntity = (data, entityType) => {\n    const id = entities.nextID;\n    entitiesDispatch({ type: \"ADD_ENTITY\", data, entityType });\n    return id;\n  };\n\n  // Edit an entity in the local store\n  const editEntity = (id, data, entityType) => {\n    entitiesDispatch({ type: \"EDIT_ENTITY\", id, data, entityType });\n  };\n\n  // Return the id of the entity in the store, or add it to the store and return the new id\n  const findOrAddEntity = (data, entityType) => {\n    for (let entity in entities[entityType]) {\n      if (equal(entities[entityType][entity], data)) {\n        return entity;\n      }\n    }\n    return addEntity(data, entityType);\n  };\n\n  // Change data in a specific tile on the map\n  const setTile = (x, y, newTile, floor = currFloor) => {\n    mapDispatch({ type: \"SET_TILE\", x, y, newTile, floor });\n  };\n\n  // Clear data on a tile\n  const clearTile = (x, y, floor = currFloor) => {\n    const newMap = cloneDeep(map);\n    removeStairsTile(x, y, newMap);\n    delete newMap[floor].tiles[`${x} ${y}`];\n    mapDispatch({ type: \"SET_MAP\", map: newMap });\n  };\n\n  // Swap the position of two tiles on the current floor\n  const swapTiles = (x1, y1, x2, y2) => {\n    mapDispatch({\n      type: \"SET_MAP\",\n      map: map.map((floor, f) => {\n        if (f === currFloor) {\n          removeStairsTile(x1, y1);\n          removeStairsTile(x2, y2);\n          return {\n            ...floor,\n            tiles: {\n              ...floor.tiles,\n              [`${x1} ${y1}`]: floor.tiles[`${x2} ${y2}`],\n              [`${x2} ${y2}`]: floor.tiles[`${x1} ${y1}`],\n            },\n          };\n        } else {\n          return floor;\n        }\n      }),\n    });\n  };\n\n  // Add a row to the top of the map on all floors\n  const addRowTop = () => {\n    mapDispatch({\n      type: \"SET_MAP\",\n      map: map.map((floor) => {\n        const tileKeys = Object.keys(floor.tiles);\n        const newTiles = {};\n        tileKeys.forEach((key) => {\n          const [x, y] = key.split(\" \");\n          newTiles[`${x} ${parseInt(y) + 1}`] = floor.tiles[key];\n        });\n        const wallKeys = Object.keys(floor.walls);\n        const newWalls = {};\n        wallKeys.forEach((key) => {\n          const [t1, t2] = key.split(\"|\");\n          const [x1, y1] = t1.split(\" \");\n          const [x2, y2] = t2.split(\" \");\n          newWalls[`${x1} ${parseInt(y1) + 1}|${x2} ${parseInt(y2) + 1}`] =\n            floor.walls[key];\n        });\n        return { ...floor, tiles: newTiles, walls: newWalls };\n      }),\n    });\n    setDimensions({ ...dimensions, height: dimensions.height + 1 });\n  };\n\n  // Add a row to the bottom of the map on all floors\n  const addRowBot = () => {\n    setDimensions({ ...dimensions, height: dimensions.height + 1 });\n  };\n\n  // Add a column to the left side of the map on all floors\n  const addColFront = () => {\n    mapDispatch({\n      type: \"SET_MAP\",\n      map: map.map((floor) => {\n        const tileKeys = Object.keys(floor.tiles);\n        const newTiles = {};\n        tileKeys.forEach((key) => {\n          const [x, y] = key.split(\" \");\n          newTiles[`${parseInt(x) + 1} ${y}`] = floor.tiles[key];\n        });\n        const wallKeys = Object.keys(floor.walls);\n        const newWalls = {};\n        wallKeys.forEach((key) => {\n          const [t1, t2] = key.split(\"|\");\n          const [x1, y1] = t1.split(\" \");\n          const [x2, y2] = t2.split(\" \");\n          newWalls[`${parseInt(x1) + 1} ${y1}|${parseInt(x2) + 1} ${y2}`] =\n            floor.walls[key];\n        });\n        return { ...floor, tiles: newTiles, walls: newWalls };\n      }),\n    });\n    setDimensions({ ...dimensions, width: dimensions.width + 1 });\n  };\n\n  // Add a column to the right side of the map on all floors\n  const addColEnd = () => {\n    setDimensions({ ...dimensions, width: dimensions.width + 1 });\n  };\n\n  // Add a new floor\n  const addFloor = () => {\n    setDimensions({ ...dimensions, floors: dimensions.floors + 1 });\n  };\n\n  // Edit the name of a floor\n  const editFloorName = (newName, floor) => {\n    mapDispatch({ type: \"EDIT_FLOOR_NAME\", name: newName, floor });\n  };\n\n  // Remove stairs from a tile\n  const removeStairsTile = (x, y, baseMap = map, f = currFloor) => {\n    if (baseMap[f] && baseMap[f].tiles[`${x} ${y}`]) {\n      delete baseMap[f].tiles[`${x} ${y}`].stairDown;\n      delete baseMap[f].tiles[`${x} ${y}`].stairUp;\n    }\n    if (baseMap[f - 1] && baseMap[f - 1].tiles[`${x} ${y}`]) {\n      delete baseMap[f - 1].tiles[`${x} ${y}`].stairUp;\n    }\n    if (baseMap[f + 1] && baseMap[f + 1].tiles[`${x} ${y}`]) {\n      delete baseMap[f + 1].tiles[`${x} ${y}`].stairDown;\n    }\n  };\n\n  // Remove all stairs up or down from a floor\n  const removeStairsFloor = (floor, stair) => {\n    if (!isEmpty(floor) && !isEmpty(floor.tiles)) {\n      Object.keys(floor.tiles).forEach((key) => {\n        if (!isEmpty(floor.tiles[key])) {\n          delete floor.tiles[key][stair];\n        }\n      });\n    }\n  };\n\n  // Delete a floor\n  const deleteFloor = (index) => {\n    const newMap = map.filter((_floor, i) => i !== index);\n    removeStairsFloor(newMap[index - 1], \"stairUp\");\n    removeStairsFloor(newMap[index], \"stairDown\");\n    mapDispatch({ type: \"SET_MAP\", map: newMap });\n\n    if (currFloor >= dimensions.floors - 1) {\n      setCurrFloor(0);\n    }\n    setDimensions({ ...dimensions, floors: dimensions.floors - 1 });\n  };\n\n  // move a floor to a different position\n  const reorderFloors = (i1, i2) => {\n    const reorderedFloor = map[i1];\n    const filteredMap = map.filter((_floor, i) => i !== i1);\n\n    removeStairsFloor(reorderedFloor, \"stairUp\");\n    removeStairsFloor(reorderedFloor, \"stairDown\");\n    removeStairsFloor(filteredMap[i1 - 1], \"stairUp\");\n    removeStairsFloor(filteredMap[i1], \"stairDown\");\n\n    const newMap = [];\n    for (let i = 0; i < dimensions.floors; i++) {\n      newMap.push(\n        i < i2 ? filteredMap[i] : i === i2 ? reorderedFloor : filteredMap[i - 1]\n      );\n    }\n\n    removeStairsFloor(newMap[i2 - 1], \"stairUp\");\n    removeStairsFloor(newMap[i2 + 1], \"stairDown\");\n\n    mapDispatch({ type: \"SET_MAP\", map: newMap });\n\n    if (currFloor === i1) {\n      setCurrFloor(i2);\n    }\n  };\n\n  // Get tile at specified indices, or an empty object otherwise\n  const getTileAt = (x, y, f = currFloor) => {\n    try {\n      return map[f].tiles[`${x} ${y}`];\n    } catch {\n      return {};\n    }\n  };\n\n  // Toggle a wall\n  const toggleWall = (key, f = currFloor) => {\n    if (map[f].walls[key]) {\n      const newMap = cloneDeep(map);\n      delete newMap[f].walls[key];\n      mapDispatch({ type: \"SET_MAP\", map: newMap });\n    } else {\n      mapDispatch({\n        type: \"SET_MAP\",\n        map: map.map((floor, floorIndex) => {\n          if (floorIndex === f) {\n            return { ...floor, walls: { ...floor.walls, [key]: true } };\n          } else {\n            return floor;\n          }\n        }),\n      });\n    }\n  };\n\n  const filteredMap = () => {\n    const filtered = [];\n    for (let i = 0; i < map.length; i++) {\n      const newFloor = { name: map[i].name, walls: map[i].walls };\n      const newTiles = {};\n      for (let tile in map[i].tiles) {\n        const [x, y] = tile.split(\" \");\n        if (x < dimensions.width && y < dimensions.height) {\n          newTiles[tile] = map[i].tiles[tile];\n        }\n      }\n      newFloor.tiles = newTiles;\n      filtered.push(newFloor);\n    }\n    return filtered;\n  };\n\n  const exportWorld = () => {\n    const { id, ...dimensionsWithoutId } = dimensions;\n    const data = JSON.stringify(\n      { dimensions: { ...dimensionsWithoutId }, map, entities },\n      null,\n      \"\\t\"\n    );\n    var element = document.createElement(\"a\");\n    element.setAttribute(\n      \"href\",\n      \"data:text/plain;charset=utf-8,\" + encodeURIComponent(data)\n    );\n    element.setAttribute(\"download\", `world-${Date.now().toString()}.json`);\n\n    element.style.display = \"none\";\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n  };\n\n  return {\n    floorManager: {\n      setCurrFloor,\n      addFloor,\n      deleteFloor,\n      reorderFloors,\n      editFloorName,\n    },\n    currFloor,\n    map,\n    filteredMap,\n    setTile,\n    clearTile,\n    swapTiles,\n    getTileAt,\n    toggleWall,\n    dimensions,\n    setDimensions,\n    addRowTop,\n    addRowBot,\n    addColFront,\n    addColEnd,\n    entities,\n    editEntity,\n    findOrAddEntity,\n    exportWorld,\n  };\n}\n","// File containing map of edge types to strings, see\n// light/data_model/light_database.py for matching onese\nexport const EDGE_TYPES = {\n  NEIGHBORS_WEST: \"neighbors to the west\",\n  NEIGHBORS_EAST: \"neighbors to the east\",\n  NEIGHBORS_NORTH: \"neighbors to the north\",\n  NEIGHBORS_SOUTH: \"neighbors to the south\",\n  NEIGHBORS_ABOVE: \"neighbors above\",\n  NEIGHBORS_BELOW: \"neighbors below\",\n  CONTAINS: \"contains\",\n};\n","import React from \"react\";\nimport classNames from \"classnames\";\nimport CONFIG from \"../config\";\nimport { post, useAPI } from \"../utils\";\nimport { findEmoji } from \"./worldbuilding/utils\";\nimport AppToaster from \"./AppToaster\";\nimport { Redirect } from \"react-router-dom\";\nimport { Button, Classes, Intent, Overlay, Spinner } from \"@blueprintjs/core\";\nimport { cloneDeep, isEmpty } from \"lodash\";\nimport { EDGE_TYPES } from \"./EdgeTypes\";\n\nfunction ListWorldsOverlay({ isOverlayOpen, setIsOverlayOpen }) {\n  const classes = classNames(Classes.CARD, Classes.ELEVATION_4);\n  var overlay_center = {\n    position: \"absolute\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translate(-50%, -50%)\",\n  };\n  return (\n    <>\n      <div>\n        <Overlay\n          className={Classes.OVERLAY_SCROLL_CONTAINER}\n          isOpen={isOverlayOpen}\n          onClose={() => setIsOverlayOpen(!isOverlayOpen)}\n        >\n          <div className={classes} style={overlay_center}>\n            <ListWorlds\n              isOpen={isOverlayOpen}\n              setIsOverlayOpen={setIsOverlayOpen}\n            />\n            <Button\n              intent={Intent.DANGER}\n              onClick={() => setIsOverlayOpen(!isOverlayOpen)}\n              style={{ margin: \"10px\" }}\n            >\n              Close\n            </Button>\n          </div>\n        </Overlay>\n      </div>\n    </>\n  );\n}\n\nfunction ListWorlds({ isOpen, setIsOverlayOpen }) {\n  const { loading, result, reload } = useAPI(CONFIG, `/worlds/`);\n  const [upload, setUpload] = React.useState(undefined);\n\n  const deleteWorld = async (id) => {\n    const res = await fetch(\n      `${CONFIG.host}:${CONFIG.port}/builder/world/delete/${id}`,\n      {\n        method: \"DELETE\",\n      }\n    );\n  };\n\n  const getAutosave = async () => {\n    const res = await fetch(\n      `${CONFIG.host}:${CONFIG.port}/builder/world/autosave/`,\n      {\n        method: \"GET\",\n      }\n    );\n    const data = await res.json();\n\n    // Mission accomplished!\n    AppToaster.show({\n      intent: Intent.SUCCESS,\n      message: \"Done loading!\",\n    });\n    setUpload(data);\n  };\n\n  /* Given an entity id, its type, and the local entities store, get \n        the matching emoji and associate the type with the id */\n  const storeEntity = (entities, entityId, type, entityToType) => {\n    let entity = entities[type][entityId];\n    entity.emoji = findEmoji(entity.name);\n    entityToType[entityId] = type;\n  };\n\n  /* Given the tiles, go through and intialize maps with the local room it holds\n        and set metadata for the tile */\n  const parseTiles = (tiles, roomToTile) => {\n    tiles.forEach((tile) => {\n      roomToTile[tile.room] = {\n        x: tile.x_coordinate,\n        y: tile.y_coordinate,\n        floor: tile.floor,\n        color: tile.color,\n        room: tile.room,\n        characters: [],\n        objects: [],\n        walls: [true, true, true, true],\n      };\n    });\n  };\n\n  /* Given the edges in the form of (src, dst, type), parse the rooms which contain the objects, \n        as well as the rooms that neighbor above or below for stairs */\n  const parseEdges = (edges, roomToTile, entityToType) => {\n    const dirs = {};\n    dirs[EDGE_TYPES.NEIGHBORS_WEST] = 0;\n    dirs[EDGE_TYPES.NEIGHBORS_EAST] = 1;\n    dirs[EDGE_TYPES.NEIGHBORS_NORTH] = 2;\n    dirs[EDGE_TYPES.NEIGHBORS_SOUTH] = 3;\n\n    edges.forEach((edge) => {\n      if (edge.type === EDGE_TYPES.CONTAINS) {\n        if (entityToType[edge.dst] === \"character\") {\n          roomToTile[edge.src].characters.push(edge.dst);\n        } else if (entityToType[edge.dst] === \"object\") {\n          roomToTile[edge.src].objects.push(edge.dst);\n        } else {\n          throw \"Cannot contain types other than character and object\";\n        }\n      } else if (edge.type === EDGE_TYPES.NEIGHBORS_ABOVE) {\n        roomToTile[edge.src].stairUp = true;\n      } else if (edge.type === EDGE_TYPES.NEIGHBORS_BELOW) {\n        roomToTile[edge.src].stairDown = true;\n      } else {\n        roomToTile[edge.src].walls[dirs[edge.type]] = false;\n      }\n    });\n  };\n\n  /* Given a specific tile and the datMap, add the walls which\n      are true in the wall array for the tile to the map*/\n  const constructWallsForTile = (tileInfo, datMap) => {\n    const neighbors = [\n      `${tileInfo.x - 1} ${tileInfo.y}`,\n      `${tileInfo.x + 1} ${tileInfo.y}`,\n      `${tileInfo.x} ${tileInfo.y - 1}`,\n      `${tileInfo.x} ${tileInfo.y + 1}`,\n    ];\n    let myLoc = `${tileInfo.x} ${tileInfo.y}`;\n    for (let i = 0; i < tileInfo.walls.length; i++) {\n      if (tileInfo.walls[i]) {\n        let otherLoc = neighbors[i];\n        // Need to sort in order for upload to work!\n        if (otherLoc < myLoc) {\n          datMap[tileInfo.floor].walls[otherLoc + \"|\" + myLoc] = true;\n        } else {\n          datMap[tileInfo.floor].walls[myLoc + \"|\" + otherLoc] = true;\n        }\n      }\n    }\n  };\n\n  /* Given the metadata for tiles, construct the format expected by the frontend which\n        involves mapping x, y, and floor into the map then storing the other data */\n  const constructTilesAndWalls = (roomToTile, datMap) => {\n    Object.keys(roomToTile).forEach((roomId) => {\n      let tileInfo = roomToTile[roomId];\n      const temp = {\n        room: tileInfo.room,\n        characters: tileInfo.characters,\n        objects: tileInfo.objects,\n        color: tileInfo.color,\n      };\n      if (tileInfo.stairUp) {\n        temp.stairUp = true;\n      } else if (tileInfo.stairDown) {\n        temp.stairDown = true;\n      }\n      datMap[tileInfo.floor].tiles[tileInfo.x + \" \" + tileInfo.y] = temp;\n      constructWallsForTile(tileInfo, datMap);\n    });\n  };\n\n  const getWorld = async (id) => {\n    AppToaster.show({\n      intent: Intent.PRIMARY,\n      message: \"Loading your world...\",\n      timeout: 10000,\n    });\n\n    const res = await fetch(\n      `${CONFIG.host}:${CONFIG.port}/builder/world/${id}`,\n      {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      }\n    );\n    const data = await res.json();\n\n    // Construct the 3 parts of state we need\n    const dat = {\n      dimensions: {\n        id: data.dimensions.id,\n        name: data.dimensions.name,\n        height: data.dimensions.height,\n        width: data.dimensions.width,\n        floors: data.dimensions.floors,\n      },\n      map: [{ name: \"1F\", tiles: {}, walls: {} }],\n      entities: data.entities,\n    };\n\n    // Add all the floors we will need to the map\n    var i = 2;\n    while (dat.map.length < dat.dimensions.floors) {\n      dat.map.push({ name: i + \"F\", tiles: {}, walls: {} });\n      i = i + 1;\n    }\n\n    // Maps responsible for taking the db entries to local entires\n    const entityToType = {};\n    // Associate characters, objects, and tiles with local store ids for rooms\n    const roomToTile = {};\n\n    // Add each room, character, and object emoji as well as record the type\n    Object.keys(dat.entities).forEach((datType) => {\n      Object.keys(dat.entities[datType]).forEach((entityId) => {\n        storeEntity(dat.entities, entityId, datType, entityToType);\n      });\n    });\n\n    parseTiles(data.map.tiles, roomToTile);\n    parseEdges(data.map.edges, roomToTile, entityToType);\n    constructTilesAndWalls(roomToTile, dat.map);\n\n    // Mission accomplished!\n    AppToaster.show({\n      intent: Intent.SUCCESS,\n      message: \"Done loading!\",\n    });\n    setUpload(dat);\n  };\n\n  if (!isOpen) {\n    return <></>;\n  } else if (loading) {\n    return <Spinner intent={Intent.PRIMARY} />;\n  } else {\n    const data = result.data;\n    var auto = null;\n    if (result.auto == null) {\n      auto = <></>;\n    } else {\n      auto = (\n        <>\n          <tr>\n            <td>\n              <strong>Autosave</strong>\n            </td>\n            <td> {result.auto} </td>\n            <td></td>\n            <td></td>\n            <td></td>\n            <td>\n              <Button\n                intent={Intent.PRIMARY}\n                type=\"submit\"\n                onClick={() => getAutosave()}\n              >\n                Load\n              </Button>\n            </td>\n            <td></td>\n          </tr>\n        </>\n      );\n    }\n    return (\n      <>\n        <table\n          data-testid=\"world-review\"\n          style={{ width: \"100%\" }}\n          className=\"bp3-html-table bp3-html-table-condensed bp3-interactive\"\n        >\n          <thead>\n            <tr>\n              <th>World ID</th>\n              <th>World Name</th>\n              <th>Height</th>\n              <th>Width</th>\n              <th>Number of Floors</th>\n              <th>Load</th>\n              <th>Delete</th>\n            </tr>\n          </thead>\n          <tbody>\n            {data.map((d) => (\n              <React.Fragment key={d.id}>\n                <tr\n                  data-testid=\"tr-review\"\n                  style={{\n                    background: undefined,\n                  }}\n                >\n                  <td>{d.id}</td>\n                  <td>\n                    <strong>{d.name}</strong>\n                  </td>\n                  <td>{d.height}</td>\n                  <td>{d.width}</td>\n                  <td>{d.num_floors}</td>\n                  <td>\n                    <Button\n                      intent={Intent.PRIMARY}\n                      type=\"submit\"\n                      onClick={() => getWorld(d.id)}\n                    >\n                      Load\n                    </Button>\n                  </td>\n                  <td>\n                    <Button\n                      intent={Intent.DANGER}\n                      type=\"submit\"\n                      onClick={() => deleteWorld(d.id)}\n                    >\n                      Delete\n                    </Button>\n                  </td>\n                </tr>\n              </React.Fragment>\n            ))}\n            {auto}\n          </tbody>\n        </table>\n        {upload && (\n          <Redirect\n            to={{ pathname: \"/world_builder\", state: { data: upload } }}\n          />\n        )}\n      </>\n    );\n  }\n}\n/* Functions should:\n  1. Save the world - regardless of if it has been saved or not!\n  2. Pass the id to the game (hit the POST game/new) endpoint\n    - Should we include cool naming as jason suggested?  i.e url param for name?\n    - get url param from response\n  3. Surface the url param/link on the page\n      * might be judicious to impose some limit on number of launches a user gets per session\n*/\nexport async function launchWorld(state) {\n  // TODO: See above\n  const world_id = await postWorld(state);\n  const world_map = { world_id: world_id };\n  const res = await post(\"game/new/\", world_map);\n  const data = await res.json();\n  const url = `${CONFIG.host}:${CONFIG.port}/?id=${data}`;\n  window.open(url);\n  return data;\n}\n\nexport async function postAutosave(state) {\n  // Just send the state dict\n  const data = cloneDeep(state);\n  state = { data: data };\n  const res = await post(\"builder/world/autosave/\", state);\n}\n\nexport async function postWorld(state) {\n  // can pretty much just take the dimensions and entities as is\n  const dat = {\n    dimensions: cloneDeep(state.dimensions),\n    map: { tiles: [], edges: [] },\n    entities: cloneDeep(state.entities),\n  };\n  if (!(\"id\" in dat.dimensions)) {\n    dat.dimensions[\"id\"] = null;\n  }\n  const map = state.filteredMap();\n  // create all edge relationships and tile metadata needed\n  const edges = [];\n  for (let floor = 0; floor < map.length; floor++) {\n    const tiles = map[floor].tiles;\n    for (let coord in tiles) {\n      const tile = cloneDeep(tiles[coord]);\n      const [x, y] = coord.split(\" \").map((i) => parseInt(i));\n\n      // Now, construct the edges - first contains\n      const room = tile.room;\n      tiles[coord].characters.forEach((character) => {\n        edges.push({ src: room, dst: character, type: EDGE_TYPES.CONTAINS });\n      });\n      tiles[coord].objects.forEach((object) => {\n        edges.push({ src: room, dst: object, type: EDGE_TYPES.CONTAINS });\n      });\n\n      if (tiles[coord].stairUp) {\n        delete tile.stairUp;\n        edges.push({\n          src: room,\n          dst: map[floor + 1].tiles[coord].room,\n          type: EDGE_TYPES.NEIGHBORS_ABOVE,\n        });\n      }\n      if (tiles[coord].stairDown) {\n        delete tile.stairDown;\n        edges.push({\n          src: room,\n          dst: map[floor - 1].tiles[coord].room,\n          type: EDGE_TYPES.NEIGHBORS_BELOW,\n        });\n      }\n      // Ensure neighbours aren't blocked by walls\n      const neighbors = [\n        `${x - 1} ${y}`,\n        `${x + 1} ${y}`,\n        `${x} ${y - 1}`,\n        `${x} ${y + 1}`,\n      ];\n      const dirs = [\n        EDGE_TYPES.NEIGHBORS_WEST,\n        EDGE_TYPES.NEIGHBORS_EAST,\n        EDGE_TYPES.NEIGHBORS_NORTH,\n        EDGE_TYPES.NEIGHBORS_SOUTH,\n      ];\n      for (let index in neighbors) {\n        const direction = dirs[index];\n        const neighbor = neighbors[index];\n        if (\n          !Object.keys(map[floor].walls).some(\n            (wall) =>\n              wall.includes(neighbor) &&\n              wall.includes(coord) &&\n              !wall.includes(\"-\")\n          )\n        ) {\n          if (!isEmpty(tiles[neighbor])) {\n            edges.push({\n              src: room,\n              dst: map[floor].tiles[neighbor].room,\n              type: direction,\n            });\n          }\n        }\n      }\n\n      // Modify tile object to expected format and push\n      tile[\"x_coordinate\"] = x;\n      tile[\"y_coordinate\"] = y;\n      tile[\"floor\"] = floor;\n      delete tile.characters;\n      delete tile.objects;\n      dat.map.tiles.push(tile);\n    }\n  }\n  // send it to the saving format!\n  dat.map.edges = edges;\n  const res = await post(\"builder/world/\", dat);\n  const resData = await res.json();\n  state.dimensions.id = resData;\n  AppToaster.show({\n    intent: Intent.SUCCESS,\n    message: \"World Saved! \",\n  });\n  // Return the id\n  return resData;\n}\n\nexport default ListWorldsOverlay;\n","import React from \"react\";\n\nfunction ColorPicker({ colors, value, handleChange, advanced }) {\n  return (\n    <div\n      style={{ display: \"flex\", flexDirection: \"row\", alignItems: \"center\" }}\n    >\n      {colors.map((color, index) => {\n        return (\n          <div\n            key={index}\n            style={{\n              display: \"inline-block\",\n              maxWidth: \"20px\",\n              width: \"20px\",\n              maxHeight: \"20px\",\n              height: \"20px\",\n              borderRadius: \"5px\",\n              background: color,\n              borderColor: \"#5C7080\",\n              borderStyle: value === color ? \"solid\" : \"\",\n              borderWidth: \"2px\",\n              boxShadow: value === color ? `0px 0px 8px ${value}` : \"\",\n              margin: \"2px\",\n              cursor: \"pointer\",\n            }}\n            onClick={() => handleChange(\"color\", color)}\n          />\n        );\n      })}\n      {advanced && (\n        <input\n          style={{\n            maxHeight: \"20px\",\n            maxWidth: \"20px\",\n            height: \"20px\",\n            width: \"20px\",\n            borderRadius: \"5px\",\n            padding: \"0px 0px 0px 0px\",\n          }}\n          type=\"color\"\n          value={value}\n          onChange={(event) => handleChange(\"color\", event.target.value)}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default ColorPicker;\n","import React from \"react\";\nimport { Intent, Menu, MenuItem, Tooltip, Position } from \"@blueprintjs/core\";\nimport { MultiSelect } from \"@blueprintjs/select\";\nimport equal from \"fast-deep-equal\";\nimport \"@blueprintjs/select/lib/css/blueprint-select.css\";\n\nimport CONFIG from \"../../config\";\nimport { useAPI, get_source } from \"../../utils\";\n\nconst SUGGEST_SIZE = 100;\n\nfunction BaseMultiSelect({\n  id,\n  name,\n  errors,\n  touched,\n  setFieldTouched,\n  formValue,\n  handleChange,\n  type,\n  tooltip,\n  onItemSelect,\n  entities,\n  suggestionSource,\n}) {\n  const [items, setItems] = React.useState([]);\n  const [query, setQuery] = React.useState(\"\");\n  const [currItems, setCurrItems] = React.useState([]);\n  const { loading: loadingModel, result: modelResult } = useAPI(\n    CONFIG,\n    `/suggestions/${type}/${get_source(suggestionSource, entities)}`\n  );\n  const { loading, result } = useAPI(\n    CONFIG,\n    `/entities/${type}?search=${query}`\n  );\n\n  let options = result;\n\n  if (!loading && !loadingModel && modelResult !== undefined && !query) {\n    options = modelResult.concat(result);\n  }\n\n  React.useEffect(() => {\n    if (!loading) {\n      if (entities) {\n        const localEntities = Object.values(entities[type]);\n        const results = localEntities\n          .concat(options.slice(0, SUGGEST_SIZE + localEntities.length + 1))\n          .filter(\n            (item, index, self) =>\n              self.findIndex((t) => equal(t, item)) === index\n          );\n\n        return setItems(results);\n      }\n      return setItems(options);\n    }\n  }, [result, modelResult, loading, entities, type]);\n\n  React.useEffect(() => {\n    // When Reset is clicked on the form\n    setCurrItems(formValue);\n  }, [formValue, items]);\n\n  const filterItems = (query, obj, _index, exactMatch) => {\n    const normalizedTitle = obj.name.toLowerCase();\n    const normalizedQuery = query.toLowerCase();\n    if (exactMatch) {\n      return normalizedTitle === normalizedQuery;\n    } else {\n      let string = \"\";\n      for (let key in obj) {\n        string += obj[key] + \". \";\n      }\n      const result = string.toLowerCase().indexOf(normalizedQuery) >= 0;\n      return result;\n    }\n  };\n\n  const removeTag = (_value, index) => {\n    const newItems = currItems.filter((_item, i) => {\n      return i !== index;\n    });\n    const change = formValue.filter((_item, i) => {\n      return i !== index;\n    });\n    setCurrItems(newItems);\n    handleChange(name, change);\n  };\n\n  const renderOption = (obj, { handleClick, modifiers, index }) => {\n    if (!modifiers.matchesPredicate) {\n      return null;\n    }\n\n    return (\n      <MenuItem\n        active={modifiers.active}\n        key={index}\n        onClick={handleClick}\n        text={\n          tooltip ? (\n            <Tooltip\n              content={obj[tooltip]}\n              targetTagName=\"div\"\n              popoverClassName=\"popover-tooltip\"\n              position={Position.TOP_RIGHT}\n              usePortal={true}\n            >\n              {obj.name}\n            </Tooltip>\n          ) : (\n            obj.name\n          )\n        }\n        shouldDismissPopover={false}\n      />\n    );\n  };\n\n  return (\n    <div onBlur={(e) => setFieldTouched(name)}>\n      <MultiSelect\n        id={id}\n        name={name}\n        items={items}\n        itemRenderer={renderOption}\n        itemListRenderer={renderItemList}\n        tagInputProps={{\n          intent: errors && touched ? Intent.DANGER : null,\n          \"data-testid\": \"base-multi-select\",\n          onRemove: removeTag,\n        }}\n        onItemSelect={(e) => {\n          if (onItemSelect) {\n            const result = onItemSelect(e, type);\n            setCurrItems([...currItems, result]);\n            handleChange(name, [...formValue, result], e);\n          } else {\n            setCurrItems([...currItems, e]);\n            handleChange(name, [...formValue, e.id]);\n          }\n          setQuery(\"\");\n        }}\n        popoverProps={{ usePortal: false }}\n        itemPredicate={filterItems}\n        selectedItems={currItems}\n        query={query}\n        onQueryChange={(q) => setQuery(q)}\n        resetOnQuery={true}\n        tagRenderer={(item) => {\n          return entities && entities[type][item]\n            ? entities[type][item].name\n            : item.name;\n        }}\n      />\n    </div>\n  );\n}\n\nfunction renderItemList({ filteredItems, renderItem }) {\n  const topResults = filteredItems.slice(0, SUGGEST_SIZE);\n  return (\n    <Menu>\n      {filteredItems.length > 0 ? (\n        <>\n          {topResults.map((item, index) => {\n            return renderItem(item, index);\n          })}\n          {filteredItems.length > SUGGEST_SIZE && (\n            <MenuItem\n              style={{ textAlign: \"center\" }}\n              disabled={true}\n              text=\"...\"\n            />\n          )}\n        </>\n      ) : (\n        <MenuItem disabled={true} text=\"No results.\" />\n      )}\n    </Menu>\n  );\n}\n\nexport default BaseMultiSelect;\n","import React from \"react\";\nimport { Formik } from \"formik\";\nimport {\n  FormGroup,\n  Button,\n  Intent,\n  Classes,\n  Divider,\n  Icon,\n} from \"@blueprintjs/core\";\nimport { isEmpty } from \"lodash\";\n\nimport ColorPicker from \"./ColorPicker\";\nimport BaseSuggest from \"./BaseSuggest\";\nimport BaseMultiSelect from \"./BaseMultiSelect\";\nimport { TILE_COLORS, findBiome, findEmoji } from \"../worldbuilding/utils\";\n\nexport const emptyTileForm = {\n  room: undefined,\n  characters: [],\n  objects: [],\n  color: TILE_COLORS[0],\n};\n\nfunction TileForm({\n  initialInputs,\n  onSubmit,\n  onClear,\n  entities,\n  findOrAddEntity,\n  setShowAdvanced,\n  selected,\n  setSelected,\n  neighbor,\n}) {\n  return (\n    <Formik\n      initialValues={isEmpty(initialInputs) ? emptyTileForm : initialInputs}\n      validate={(values) => {\n        let errors = {};\n        if (isNaN(values.room)) {\n          errors.room = \"Required\";\n        }\n        return errors;\n      }}\n      onSubmit={onSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleSubmit,\n          handleReset,\n        } = props;\n\n        const setRoomValue = (name, value, fullValue) => {\n          setFieldValue(name, value);\n          setFieldValue(\"color\", findBiome(fullValue.name, values.color));\n        };\n\n        const hasContent = () => {\n          return (\n            !isNaN(values.room) ||\n            !isEmpty(values.characters) ||\n            !isEmpty(values.objects)\n          );\n        };\n\n        return (\n          <form>\n            <div\n              style={{\n                display: \"flex\",\n                flexDirection: \"row\",\n                alignContent: \"stretch\",\n                justifyContent: \"space-between\",\n              }}\n            >\n              <h5 style={{ fontSize: \"18px\" }} className={Classes.HEADING}>\n                <Icon color=\"#5c7080\" iconSize={20} icon=\"edit\" /> Tile Editor\n              </h5>\n              <div\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"flex-end\",\n                }}\n                onClick={() => {\n                  setSelected({ ...selected, data: { ...values } });\n                  setShowAdvanced(true);\n                }}\n              >\n                <Button icon=\"build\" />\n              </div>\n            </div>\n            <Divider />\n            <FormGroup\n              label=\"Room\"\n              labelInfo=\"(required)\"\n              labelFor=\"room-input\"\n            >\n              <BaseSuggest\n                id=\"room-input\"\n                name=\"room\"\n                type=\"room\"\n                errors={errors.room}\n                touched={touched.room}\n                setFieldTouched={setFieldTouched}\n                formValue={values.room}\n                handleChange={setRoomValue}\n                entities={entities}\n                onItemSelect={findOrAddEntity}\n                suggestionSource={neighbor}\n              />\n              {errors.room && touched.room && (\n                <div className=\"form-error\">{errors.room}</div>\n              )}\n            </FormGroup>\n            <ColorPicker\n              colors={TILE_COLORS}\n              value={values.color}\n              handleChange={setFieldValue}\n            />\n            <FormGroup label=\"Characters in Room\" labelFor=\"characters-input\">\n              <BaseMultiSelect\n                id=\"characters-input\"\n                name=\"characters\"\n                type=\"character\"\n                errors={errors.characters}\n                touched={touched.characters}\n                setFieldTouched={setFieldTouched}\n                formValue={values.characters}\n                handleChange={setFieldValue}\n                tooltip=\"persona\"\n                entities={entities}\n                onItemSelect={(e, type) => {\n                  e.emoji = findEmoji(e.name);\n                  return findOrAddEntity(e, type);\n                }}\n                suggestionSource={values.room}\n              />\n              {errors.characters && touched.characters && (\n                <div className=\"form-error\">{errors.characters}</div>\n              )}\n            </FormGroup>\n            <FormGroup label=\"Objects in Room\" labelFor=\"objects-input\">\n              <BaseMultiSelect\n                id=\"objects-input\"\n                name=\"objects\"\n                type=\"object\"\n                errors={errors.objects}\n                touched={touched.objects}\n                setFieldTouched={setFieldTouched}\n                formValue={values.objects}\n                handleChange={setFieldValue}\n                tooltip=\"physical_description\"\n                entities={entities}\n                onItemSelect={(e, type) => {\n                  e.emoji = findEmoji(e.name);\n                  return findOrAddEntity(e, type);\n                }}\n                suggestionSource={values.room}\n              />\n              {errors.objects && touched.objects && (\n                <div className=\"form-error\">{errors.objects}</div>\n              )}\n            </FormGroup>\n\n            <Button\n              type=\"reset\"\n              onClick={onClear}\n              disabled={!hasContent()}\n              style={{ marginRight: \"15px\" }}\n            >\n              Clear\n            </Button>\n            <Button\n              type=\"reset\"\n              onClick={handleReset}\n              disabled={!dirty}\n              style={{ marginRight: \"15px\" }}\n            >\n              Reset\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              onClick={handleSubmit}\n              disabled={!dirty || !isValid}\n              style={{ marginLeft: \"15px\" }}\n            >\n              Save Changes\n            </Button>\n          </form>\n        );\n      }}\n    </Formik>\n  );\n}\n\nexport default TileForm;\n","import React from \"react\";\nimport { Popover, Icon, Tooltip } from \"@blueprintjs/core\";\nimport { isEmpty, cloneDeep } from \"lodash\";\n\nimport TileForm from \"../forms/TileForm\";\nimport { invertColor } from \"./utils\";\n\n/**\n * Component for each Tile in the map grid\n */\nfunction Tile({\n  x,\n  y,\n  tile,\n  selected,\n  setSelected,\n  showAdvanced,\n  setShowAdvanced,\n  tileStyle,\n  state,\n  neighbor,\n}) {\n  const handleSubmit = (data) => {\n    state.setTile(x, y, { ...tile, ...data });\n    setSelected(null);\n  };\n\n  const handleClear = () => {\n    state.clearTile(x, y);\n    setSelected(null);\n  };\n\n  // toggle stairs on the tile clicked, and this tile and on the other floor\n  const toggleStairs = (event, key) => {\n    event.stopPropagation(); // prevent the popup firing\n    const toggleTo = !tile[key];\n    const newTile = cloneDeep(tile);\n    newTile[key] = toggleTo;\n    state.setTile(x, y, newTile);\n    const otherFloor = state.currFloor + (key === \"stairDown\" ? -1 : 1);\n    const newConnectedTile = cloneDeep(state.getTileAt(x, y, otherFloor));\n    newConnectedTile[key === \"stairDown\" ? \"stairUp\" : \"stairDown\"] = toggleTo;\n    state.setTile(x, y, newConnectedTile, otherFloor);\n  };\n\n  const contentColor = invertColor(\n    tile && !isNaN(tile.room) && tile.color ? tile.color : \"#ced9e0\"\n  );\n\n  return (\n    <>\n      <Icon\n        color={contentColor}\n        className={`react-grid-item-handle + ${\n          isEmpty(tile) ? \"disabled\" : \"\"\n        }`}\n        icon=\"drag-handle-horizontal\"\n      />\n      {!isEmpty(state.getTileAt(x, y, state.currFloor - 1)) && (\n        <Icon\n          color={contentColor}\n          onClick={\n            !isEmpty(tile) ? (e) => toggleStairs(e, \"stairDown\") : undefined\n          }\n          className={isEmpty(tile) ? \"disabled\" : \"\"}\n          style={{\n            opacity: !isEmpty(tile) && tile.stairDown ? 1 : 0.35,\n            position: \"absolute\",\n            bottom: \"5px\",\n            left: \"5px\",\n          }}\n          icon=\"arrow-bottom-left\"\n        />\n      )}\n      {!isEmpty(state.getTileAt(x, y, state.currFloor + 1)) && (\n        <Icon\n          color={contentColor}\n          onClick={\n            !isEmpty(tile) ? (e) => toggleStairs(e, \"stairUp\") : undefined\n          }\n          className={isEmpty(tile) ? \"disabled\" : \"\"}\n          style={{\n            opacity: !isEmpty(tile) && tile.stairUp ? 1 : 0.35,\n            position: \"absolute\",\n            top: \"5px\",\n            right: \"5px\",\n          }}\n          icon=\"arrow-top-right\"\n        />\n      )}\n      <Popover\n        isOpen={\n          !!selected && selected.x === x && selected.y === y && !showAdvanced\n        }\n        onClose={() => {\n          if (!showAdvanced) {\n            setSelected(null);\n          }\n        }}\n        usePortal={true}\n      >\n        {/* Popover target */}\n        <div\n          className=\"react-grid-item-content\"\n          style={{\n            ...tileStyle,\n            backgroundColor: tile && tile.color ? tile.color : \"\",\n          }}\n        >\n          <div\n            className=\"center\"\n            style={{\n              color: contentColor,\n              width: \"100%\",\n              maxHeight: tileStyle.maxHeight - 20,\n              overflow: \"hidden\",\n            }}\n          >\n            <p>{!isEmpty(tile) ? state.entities.room[tile.room].name : \"\"}</p>\n            <p>\n              {!isEmpty(tile)\n                ? tile.characters.map((char) => (\n                    <Tooltip content={state.entities.character[char].name}>\n                      {state.entities.character[char].emoji}\n                    </Tooltip>\n                  ))\n                : \"\"}\n            </p>\n            <p>\n              {!isEmpty(tile)\n                ? tile.objects.map((obj) => (\n                    <Tooltip content={state.entities.object[obj].name}>\n                      {state.entities.object[obj].emoji}\n                    </Tooltip>\n                  ))\n                : \"\"}\n            </p>\n          </div>\n        </div>\n        {/* Popover content */}\n        <div style={{ padding: \"20px\" }}>\n          <TileForm\n            initialInputs={tile}\n            onSubmit={handleSubmit}\n            onClear={handleClear}\n            entities={state.entities}\n            findOrAddEntity={state.findOrAddEntity}\n            setSelected={setSelected}\n            selected={selected}\n            setShowAdvanced={setShowAdvanced}\n            neighbor={neighbor}\n          />\n        </div>\n      </Popover>\n    </>\n  );\n}\n\nexport default Tile;\n","import React from \"react\";\nimport { Formik } from \"formik\";\nimport {\n  Button,\n  Intent,\n  Icon,\n  Popover,\n  PopoverInteractionKind,\n  Tooltip,\n} from \"@blueprintjs/core\";\nimport { isEmpty, cloneDeep } from \"lodash\";\nimport AnimateHeight from \"react-animate-height\";\nimport { Picker } from \"emoji-mart\";\nimport \"emoji-mart/css/emoji-mart.css\";\n\nimport ColorPicker from \"./ColorPicker\";\nimport BaseSuggest from \"./BaseSuggest\";\nimport BaseMultiSelect from \"./BaseMultiSelect\";\nimport {\n  TILE_COLORS,\n  findBiome,\n  invertColor,\n  findEmoji,\n  DEFAULT_EMOJI,\n} from \"../worldbuilding/utils\";\nimport ObjectForm, { emptyObjectForm } from \"./ObjectForm\";\nimport CharacterForm, { emptyCharacterForm } from \"./CharacterForm\";\nimport RoomForm, { emptyRoomForm } from \"./RoomForm\";\nimport { emptyTileForm } from \"./TileForm\";\n\n/**\n * Advanced tile editing options including creating, editing, and duplicating entities\n */\nfunction AdvancedTileForm({\n  x,\n  y,\n  currFloor,\n  getTileAt,\n  initialInputs,\n  inheritedInputs,\n  handleSubmit,\n  handleClear,\n  tileStyle,\n  entities,\n  findOrAddEntity,\n  editEntity,\n}) {\n  const TilePreview = ({ tile }) => {\n    const contentColor = invertColor(\n      tile && !isNaN(tile.room) && tile.color ? tile.color : \"#ced9e0\"\n    );\n    return (\n      <div style={{ display: \"flex\", justifyContent: \"center\" }}>\n        <div\n          style={{\n            position: \"relative\",\n          }}\n        >\n          <Icon\n            color={contentColor}\n            className={`react-grid-item-handle + ${\n              isNaN(tile.room) ? \"disabled\" : \"\"\n            }`}\n            icon=\"drag-handle-horizontal\"\n          />\n          {!isEmpty(tile) && !isEmpty(getTileAt(x, y, currFloor - 1)) && (\n            <Icon\n              color={contentColor}\n              className={isEmpty(tile) ? \"disabled\" : \"\"}\n              style={{\n                opacity: tile.stairDown ? 1 : 0.2,\n                position: \"absolute\",\n                bottom: \"5px\",\n                left: \"5px\",\n              }}\n              icon=\"arrow-bottom-left\"\n            />\n          )}\n          {!isEmpty(tile) && !isEmpty(getTileAt(x, y, currFloor + 1)) && (\n            <Icon\n              color={contentColor}\n              className={isEmpty(tile) ? \"disabled\" : \"\"}\n              style={{\n                opacity: tile.stairUp ? 1 : 0.2,\n                position: \"absolute\",\n                top: \"5px\",\n                right: \"5px\",\n              }}\n              icon=\"arrow-top-right\"\n            />\n          )}\n          <div\n            className=\"react-grid-item-content\"\n            style={{\n              ...tileStyle,\n              backgroundColor:\n                tile && !isNaN(tile.room) && tile.color\n                  ? tile.color\n                  : \"#ced9e0\",\n            }}\n          >\n            <div\n              className=\"center\"\n              style={{\n                color: contentColor,\n                width: \"100%\",\n                maxHeight: tileStyle.maxHeight - 20,\n                overflow: \"hidden\",\n              }}\n            >\n              {!isEmpty(tile) && entities.room[tile.room]\n                ? entities.room[tile.room].name\n                : \"\"}\n              <p>\n                {!isEmpty(tile)\n                  ? tile.characters.map((char) => (\n                      <Tooltip content={entities.character[char].name}>\n                        {entities.character[char].emoji}\n                      </Tooltip>\n                    ))\n                  : \"\"}\n              </p>\n              <p>\n                {!isEmpty(tile)\n                  ? tile.objects.map((obj) => (\n                      <Tooltip content={entities.object[obj].name}>\n                        {entities.object[obj].emoji}\n                      </Tooltip>\n                    ))\n                  : \"\"}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <Formik\n      initialValues={\n        inheritedInputs ||\n        (!isEmpty(initialInputs) ? initialInputs : undefined) ||\n        emptyTileForm\n      }\n      validate={(values) => {\n        let errors = {};\n        if (!values.room) {\n          errors.room = \"Required\";\n        }\n        return errors;\n      }}\n      isInitialValid={!!inheritedInputs && !!inheritedInputs.room}\n      onSubmit={handleSubmit}\n    >\n      {(props) => {\n        const {\n          values,\n          setFieldValue,\n          touched,\n          setFieldTouched,\n          errors,\n          dirty,\n          isValid,\n          handleSubmit,\n          handleReset,\n        } = props;\n        const setRoomValue = (name, value, fullValue) => {\n          setFieldValue(name, value);\n          setFieldValue(\"color\", findBiome(fullValue.name, values.color));\n        };\n\n        const hasContent = () => {\n          return (\n            !isNaN(values.room) ||\n            !isEmpty(values.characters) ||\n            !isEmpty(values.objects)\n          );\n        };\n\n        return (\n          <>\n            <Hideable title=\"Room\">\n              <SelectFromExistingOrCreateNew\n                initialState={selectOrCreateState.CHOOSE}\n                SelectFromExisting={BaseSuggest}\n                selectFromExistingProps={{\n                  id: \"room-input\",\n                  errors: errors.room,\n                  touched: touched.room,\n                  setFieldTouched: setFieldTouched,\n                  onItemSelect: findOrAddEntity,\n                  entities: entities,\n                  handleChange: setRoomValue,\n                }}\n                handleChange={setFieldValue}\n                formValue={values.room}\n                name=\"room\"\n                type=\"room\"\n                Form={RoomForm}\n                formProps={{\n                  initialInputs: emptyRoomForm,\n                }}\n                handleCreateSubmit={(data) =>\n                  setRoomValue(\"room\", findOrAddEntity(data, \"room\"), data)\n                }\n                handleEditSubmit={editEntity}\n                Selected={SelectedTableView}\n                selectedProps={{\n                  columnNames: [\"Name\", \"Description\", \"Backstory\"],\n                  columnKeys: [\"name\", \"description\", \"backstory\"],\n                  items: !isNaN(values.room) ? [values.room] : undefined,\n                  entities,\n                  type: \"room\",\n                }}\n              ></SelectFromExistingOrCreateNew>\n              {errors.room && touched.room && (\n                <div className=\"form-error\">{errors.room}</div>\n              )}\n              <div style={{ marginTop: \"5px\" }}>\n                <ColorPicker\n                  colors={TILE_COLORS}\n                  value={values.color}\n                  handleChange={setFieldValue}\n                  advanced\n                />\n              </div>\n            </Hideable>\n            <Hideable\n              initialOpen={!isEmpty(values.characters)}\n              title=\"Characters\"\n            >\n              <SelectFromExistingOrCreateNew\n                SelectFromExisting={BaseMultiSelect}\n                selectFromExistingProps={{\n                  id: \"characters-input\",\n                  errors: errors.characters,\n                  touched: touched.characters,\n                  setFieldTouched: setFieldTouched,\n                  tooltip: \"physical_description\",\n                  onItemSelect: (e, type) => {\n                    e.emoji = findEmoji(e.name);\n                    return findOrAddEntity(e, type);\n                  },\n                  entities: entities,\n                  handleChange: setFieldValue,\n                }}\n                handleChange={setFieldValue}\n                formValue={values.characters}\n                name=\"characters\"\n                type=\"character\"\n                Form={CharacterForm}\n                formProps={{\n                  initialInputs: emptyCharacterForm,\n                }}\n                handleCreateSubmit={(data) => {\n                  data.emoji = findEmoji(data.name);\n                  setFieldValue(\n                    \"characters\",\n                    values.characters.concat(findOrAddEntity(data, \"character\"))\n                  );\n                }}\n                handleEditSubmit={editEntity}\n                Selected={SelectedTableView}\n                selectedProps={{\n                  columnNames: [\"Name\", \"Persona\", \"Emoji\"],\n                  columnKeys: [\"name\", \"persona\", \"emoji\"],\n                  items: values.characters,\n                  entities,\n                  type: \"character\",\n                  editEntity: editEntity,\n                }}\n              />\n              {errors.characters && touched.characters && (\n                <div className=\"form-error\">{errors.characters}</div>\n              )}\n            </Hideable>\n            <Hideable initialOpen={!isEmpty(values.characters)} title=\"Objects\">\n              <SelectFromExistingOrCreateNew\n                SelectFromExisting={BaseMultiSelect}\n                selectFromExistingProps={{\n                  id: \"objects-input\",\n                  errors: errors.objects,\n                  touched: touched.objects,\n                  setFieldTouched: setFieldTouched,\n                  tooltip: \"physical_description\",\n                  onItemSelect: (e, type) => {\n                    e.emoji = findEmoji(e.name);\n                    return findOrAddEntity(e, type);\n                  },\n                  entities: entities,\n                  handleChange: setFieldValue,\n                }}\n                handleChange={setFieldValue}\n                formValue={values.objects}\n                name=\"objects\"\n                type=\"object\"\n                Form={ObjectForm}\n                formProps={{\n                  initialInputs: emptyObjectForm,\n                }}\n                handleCreateSubmit={(data) => {\n                  data.emoji = findEmoji(data.name);\n                  setFieldValue(\n                    \"objects\",\n                    values.objects.concat(findOrAddEntity(data, \"object\"))\n                  );\n                }}\n                handleEditSubmit={editEntity}\n                Selected={SelectedTableView}\n                selectedProps={{\n                  columnNames: [\"Name\", \"Description\", \"emoji\"],\n                  columnKeys: [\"name\", \"physical_description\", \"emoji\"],\n                  items: values.objects,\n                  entities,\n                  type: \"object\",\n                  editEntity: editEntity,\n                }}\n              />\n              {errors.objects && touched.objects && (\n                <div className=\"form-error\">{errors.objects}</div>\n              )}\n            </Hideable>\n            <Hideable title=\"Preview\">\n              <TilePreview tile={values} />\n            </Hideable>\n            <div\n              style={{\n                display: \"flex\",\n                justifyContent: \"flex-end\",\n                padding: \"10px\",\n              }}\n            >\n              <Button\n                type=\"reset\"\n                onClick={handleClear}\n                disabled={!hasContent()}\n                style={{ marginRight: \"15px\" }}\n              >\n                Clear\n              </Button>\n              <Button\n                type=\"reset\"\n                onClick={handleReset}\n                disabled={!dirty}\n                style={{ marginRight: \"15px\" }}\n              >\n                Reset\n              </Button>\n              <Button\n                intent={Intent.PRIMARY}\n                type=\"submit\"\n                onClick={handleSubmit}\n                disabled={!isValid}\n                style={{ marginLeft: \"15px\" }}\n              >\n                Save Changes\n              </Button>\n            </div>\n          </>\n        );\n      }}\n    </Formik>\n  );\n}\n\n// Container for children that allows children to be hidden\nfunction Hideable({ initialOpen = true, children, title }) {\n  const [open, setOpen] = React.useState(initialOpen);\n\n  return (\n    <div style={{ margin: \"0 0 10px 0\" }}>\n      <div\n        onClick={() => setOpen(!open)}\n        className={`hideable-header ${open ? \"\" : \"hidden\"}`}\n      >\n        <Icon\n          className={`hideable-arrow ${open ? \"\" : \"hidden\"}`}\n          icon=\"chevron-down\"\n        />{\" \"}\n        {title}\n      </div>\n      <AnimateHeight\n        duration={500}\n        height={open ? \"auto\" : 0}\n        easing={\"ease\"}\n        animateOpacity={true}\n      >\n        <div className={`hideable-content`}>{children}</div>\n      </AnimateHeight>\n    </div>\n  );\n}\n\n// A table view for all selected entities with actions\nfunction SelectedTableView({\n  columnNames,\n  columnKeys,\n  items,\n  entities,\n  handleEdit,\n  handleDuplicate,\n  handleDelete,\n  type,\n  editEntity,\n}) {\n  function EmojiTD({ item }) {\n    const [showPicker, setShowPicker] = React.useState(false);\n    return (\n      <Popover\n        interactionKind={PopoverInteractionKind.CLICK}\n        onInteraction={(state) => setShowPicker(state)}\n        isOpen={showPicker}\n        wrapperTagName=\"td\"\n      >\n        <div\n          // onClick={() => setShowPicker(!showPicker)}\n          style={{ height: \"100%\", width: \"100%\" }}\n        >\n          {entities[type][item].emoji || DEFAULT_EMOJI}\n        </div>\n        <Picker\n          onSelect={(event) => {\n            const data = cloneDeep(entities[type][item]);\n            data.emoji = event.native;\n            editEntity(item, data, type);\n            setShowPicker(false);\n          }}\n        />\n      </Popover>\n    );\n  }\n  return (\n    <>\n      {!isEmpty(items) && (\n        <table\n          data-testid=\"table-explore\"\n          style={{ width: \"100%\" }}\n          className=\"bp3-html-table bp3-html-table-striped bp3-html-table-condensed bp3-interactive\"\n        >\n          <thead>\n            <tr>\n              {columnNames.map((col, index) => (\n                <th key={index}>{col}</th>\n              ))}\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {items.map((item, index) => {\n              return (\n                <React.Fragment key={index}>\n                  <tr>\n                    {columnKeys.map((key) => {\n                      if (key === \"emoji\") {\n                        return <EmojiTD item={item} key={key} />;\n                      }\n                      return <td key={key}>{entities[type][item][key]}</td>;\n                    })}\n                    <td>\n                      <div style={{ display: \"flex\", flexDirection: \"row\" }}>\n                        <Button\n                          onClick={() => handleEdit(item, entities[type][item])}\n                          icon=\"edit\"\n                          minimal\n                        />\n                        <Button\n                          onClick={() => handleDuplicate(entities[type][item])}\n                          icon=\"duplicate\"\n                          minimal\n                        />\n                        <Button\n                          onClick={() => handleDelete(index)}\n                          icon=\"trash\"\n                          minimal\n                        />\n                      </div>\n                    </td>\n                  </tr>\n                </React.Fragment>\n              );\n            })}\n          </tbody>\n        </table>\n      )}\n    </>\n  );\n}\n\nconst selectOrCreateState = {\n  BASE: 0,\n  CHOOSE: 1,\n  SELECT_FROM_EXISTING: 2,\n  CREATE_NEW: 3,\n  EDIT: 4,\n  DUPLICATE: 5,\n};\n\n// Input type component that includes the selected table,\n// a component for selecting from existing,\n// and a form for creating new/editing/duplicating\nfunction SelectFromExistingOrCreateNew({\n  initialState = selectOrCreateState.BASE,\n  handleChange,\n  name,\n  type,\n  formValue,\n  SelectFromExisting,\n  selectFromExistingProps,\n  Form,\n  formProps,\n  handleCreateSubmit,\n  handleEditSubmit,\n  Selected,\n  selectedProps,\n}) {\n  const [state, setState] = React.useState(initialState);\n  const [editing, setEditing] = React.useState(undefined);\n  const [duplicating, setDuplicating] = React.useState(undefined);\n\n  const handleEditClick = (id, data) => {\n    setEditing({ id, data });\n    setState(selectOrCreateState.EDIT);\n  };\n\n  const handleDuplicate = (data) => {\n    setDuplicating(data);\n    setState(selectOrCreateState.DUPLICATE);\n  };\n\n  const handleDelete = (index) => {\n    if (Array.isArray(formValue)) {\n      formValue.splice(index, 1);\n      handleChange(name, formValue);\n    } else {\n      handleChange(name, undefined);\n    }\n  };\n\n  return (\n    <>\n      <Selected\n        {...selectedProps}\n        handleEdit={handleEditClick}\n        handleDuplicate={handleDuplicate}\n        handleDelete={handleDelete}\n      />\n      {state === selectOrCreateState.CHOOSE ? (\n        // choose between creating new or selecting from existing\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"center\",\n            flexDirection: \"row\",\n            alignItems: \"center\",\n            padding: \"5px\",\n          }}\n        >\n          <Button\n            onClick={() => setState(selectOrCreateState.SELECT_FROM_EXISTING)}\n            style={{ margin: \"5px\" }}\n          >\n            Select from existing\n          </Button>\n          <span style={{ margin: \"5px\" }}> OR </span>\n          <Button\n            onClick={() => setState(selectOrCreateState.CREATE_NEW)}\n            style={{ margin: \"5px\" }}\n          >\n            Create New\n          </Button>\n        </div>\n      ) : state === selectOrCreateState.SELECT_FROM_EXISTING ? (\n        // selecting from existing\n        <div>\n          <Button\n            onClick={() => setState(initialState)}\n            icon=\"chevron-left\"\n            minimal\n          />\n          <SelectFromExisting\n            {...selectFromExistingProps}\n            name={name}\n            type={type}\n            formValue={formValue}\n          />\n        </div>\n      ) : state === selectOrCreateState.CREATE_NEW ? (\n        // creating new\n        <div>\n          <Button\n            onClick={() => setState(initialState)}\n            icon=\"chevron-left\"\n            minimal\n          />\n          <Form\n            {...formProps}\n            type={type}\n            handleSubmit={(value) => {\n              setState(initialState);\n              handleCreateSubmit(value);\n            }}\n          />\n        </div>\n      ) : state === selectOrCreateState.EDIT ? (\n        // editing\n        <div>\n          <Button\n            onClick={() => setState(initialState)}\n            icon=\"chevron-left\"\n            minimal\n          />\n          <Form\n            {...formProps}\n            type={type}\n            initialInputs={editing.data}\n            handleSubmit={(value) => {\n              setState(initialState);\n              handleEditSubmit(editing.id, value, type);\n              setEditing(undefined);\n            }}\n          />\n        </div>\n      ) : state === selectOrCreateState.DUPLICATE ? (\n        // duplicating\n        <div>\n          <Button\n            onClick={() => setState(initialState)}\n            icon=\"chevron-left\"\n            minimal\n          />\n          <Form\n            {...formProps}\n            type={type}\n            initialInputs={duplicating}\n            handleSubmit={(value) => {\n              setState(initialState);\n              handleCreateSubmit(value);\n              setDuplicating(undefined);\n            }}\n          />\n        </div>\n      ) : (\n        <Button onClick={() => setState(selectOrCreateState.CHOOSE)} icon=\"add\">\n          Add\n        </Button>\n      )}\n    </>\n  );\n}\n\nexport default AdvancedTileForm;\n","import React from \"react\";\nimport GridLayout from \"react-grid-layout\";\nimport { cloneDeep, isEmpty, isEqual } from \"lodash\";\nimport { Button, Drawer, Classes } from \"@blueprintjs/core\";\n\nimport Tile from \"./Tile\";\nimport { MAX_HEIGHT, MAX_WIDTH } from \"./utils\";\nimport AdvancedTileForm from \"../forms/AdvancedTileForm\";\n\nconst SIZE = 150;\nconst MARGIN = 24;\n\n/**\n * Helper function to get a neighbor for the given tile. Right now only returns one\n * rather than trying to suggest based on all of them.\n */\nfunction get_neighbor(j, i, state) {\n  let otherTile = state.getTileAt(j-1, i, state.currFloor);\n  if (otherTile && !isNaN(otherTile.room)) {\n    return otherTile.room;\n  }\n  otherTile = state.getTileAt(j+1, i, state.currFloor);\n  if (otherTile && !isNaN(otherTile.room)) {\n    return otherTile.room;\n  }\n  otherTile = state.getTileAt(j, i-1, state.currFloor);\n  if (otherTile && !isNaN(otherTile.room)) {\n    return otherTile.room;\n  }\n  otherTile = state.getTileAt(j, i+1, state.currFloor);\n  if (otherTile && !isNaN(otherTile.room)) {\n    return otherTile.room;\n  }\n\n  return undefined;\n}\n\n/**\n * Component for the interactive grid.\n * Using react-grid-layout for the draggable interface with some custom drag behavior to maintain\n * grid dimensions and update map state.\n */\nfunction Grid({ state, initialShowAdvanced }) {\n  const [layout, setLayout] = React.useState(null);\n  const [selected, setSelected] = React.useState(null);\n  const [showAdvanced, setShowAdvanced] = React.useState(false);\n  const [dragging, setDragging] = React.useState(false);\n\n  React.useEffect(() => {\n    setShowAdvanced(initialShowAdvanced);\n  }, [initialShowAdvanced]);\n\n  const resetShowAdvanced = () => {\n    setShowAdvanced(initialShowAdvanced);\n  };\n\n  // store the initial layout of the grid\n  const onDragStart = (layout) => {\n    setLayout(cloneDeep(layout));\n  };\n\n  // prevent column growing by swapping position with colliding tile\n  const onDragEvent = (newState, initial, next) => {\n    if (!isEqual(initial, next)) {\n      setDragging(true);\n      setSelected(null);\n    }\n    for (let i = 0; i < layout.length; i++) {\n      if (layout[i].i === next.i) {\n        continue;\n      }\n      if (\n        layout[i].x === next.x &&\n        layout[i].y === next.y &&\n        layout[i].i !== next.i\n      ) {\n        newState[i].x = initial.x;\n        newState[i].y = initial.y;\n      } else {\n        newState[i].x = layout[i].x;\n        newState[i].y = layout[i].y;\n      }\n    }\n\n    return true;\n  };\n\n  // sets up for the layout to be updated in the superstate\n  const onDragStop = (newState, initial, next) => {\n    onDragEvent(newState, initial, next);\n    setLayout([initial.x, initial.y, next.x, next.y]);\n  };\n\n  // update superstate (updating in onDragStop causes tiles to vanish)\n  const handleLayoutChange = () => {\n    if (layout) {\n      const [x1, y1, x2, y2] = layout;\n      if (!(x1 === x2 && y1 === y2)) {\n        // allows the animation to finish\n        setTimeout(() => state.swapTiles(x1, y1, x2, y2), 300);\n      }\n      setLayout(null);\n    }\n  };\n\n  // Generate children for GridLayout component\n  const generateTiles = () => {\n    const tiles = [];\n    for (let i = 0; i < state.dimensions.height; i++) {\n      for (let j = 0; j < state.dimensions.width; j++) {\n        // tile will contain all form data and stair data, or be empty\n        const tile = state.getTileAt(j, i, state.currFloor);\n        // tile data is used in the key to force GridLayout to rerender the div component\n        // and update isDraggable under data-grid\n        const key = `${state.currFloor} ${j} ${i} ${\n          tile && tile && tile.room ? tile.room.id : \"\"\n        }`;\n        tiles.push(\n          <div\n            key={key}\n            data-grid={{\n              x: j,\n              y: i,\n              w: 1,\n              h: 1,\n              draggableHandle: \".react-grid-item-handle\",\n              draggableCancel: \".react-grid-item\",\n              isDraggable: !isEmpty(tile),\n            }}\n            onClick={() => {\n              if (\n                !dragging &&\n                (!selected ||\n                  (selected && (selected.x !== j || selected.y !== i)))\n              ) {\n                setSelected({ x: j, y: i });\n              } else {\n                setDragging(false);\n              }\n            }}\n          >\n            <Tile\n              x={j}\n              y={i}\n              tile={tile}\n              selected={selected}\n              setSelected={setSelected}\n              showAdvanced={showAdvanced}\n              setShowAdvanced={setShowAdvanced}\n              setTile={state.setTile}\n              clearTile={state.clearTile}\n              getTileAt={state.getTileAt}\n              currFloor={state.currFloor}\n              tileStyle={{\n                width: SIZE,\n                height: SIZE,\n                maxWidth: SIZE,\n                maxHeight: SIZE,\n              }}\n              state={state}\n              neighbor={get_neighbor(j, i, state)}\n            />\n          </div>\n        );\n      }\n    }\n    return tiles;\n  };\n\n  // Generate all walls for the floor\n  const generateWalls = () => {\n    const walls = [];\n    for (let i = 0; i < state.dimensions.height; i++) {\n      for (let j = 0; j < state.dimensions.width; j++) {\n        // vertical walls\n        if (j > 0) {\n          const key = `${j - 1} ${i}|${j} ${i}`;\n          walls.push(\n            <div\n              key={key}\n              onClick={() => state.toggleWall(key)}\n              className={`wall ${\n                state.map[state.currFloor].walls[key] ? \"active\" : \"\"\n              }`}\n              style={{\n                top: MARGIN + (MARGIN + SIZE) * i,\n                left: (MARGIN + SIZE) * j + (MARGIN - 10) / 2,\n                height: SIZE,\n              }}\n            />\n          );\n        }\n        // horizontal walls\n        if (i > 0) {\n          const key = `${j} ${i - 1}|${j} ${i}`;\n          walls.push(\n            <div\n              key={key}\n              onClick={() => state.toggleWall(key)}\n              className={`wall ${\n                state.map[state.currFloor].walls[key] ? \"active\" : \"\"\n              }`}\n              style={{\n                left: MARGIN + (MARGIN + SIZE) * j,\n                top: (MARGIN + SIZE) * i + (MARGIN - 10) / 2,\n                width: SIZE,\n              }}\n            />\n          );\n        }\n      }\n    }\n    return walls;\n  };\n\n  return (\n    <>\n      <div\n        style={{\n          width:\n            state.dimensions.width * SIZE +\n            (state.dimensions.width + 1) * MARGIN +\n            60,\n          margin: \"0 auto 75px auto\",\n          textAlign: \"center\",\n        }}\n      >\n        <Button\n          className=\"bp3-button\"\n          disabled={state.dimensions.height >= 10}\n          style={{\n            width:\n              state.dimensions.width * SIZE +\n              (state.dimensions.width + 1) * MARGIN -\n              20,\n            margin: \"auto\",\n          }}\n          onClick={state.addRowTop}\n          icon=\"add\"\n        />\n        <div style={{ display: \"flex\" }}>\n          <Button\n            className=\"bp3-button\"\n            disabled={state.dimensions.width >= 10}\n            style={{\n              height:\n                state.dimensions.height * SIZE +\n                (state.dimensions.height + 1) * MARGIN -\n                20,\n              margin: \"10px 0\",\n            }}\n            onClick={state.addColFront}\n            icon=\"add\"\n          />\n          <div\n            className=\"map-container\"\n            style={{\n              width:\n                state.dimensions.width * SIZE +\n                (state.dimensions.width + 1) * MARGIN,\n              height:\n                state.dimensions.height * SIZE +\n                (state.dimensions.height + 1) * MARGIN,\n            }}\n          >\n            <div className=\"walls\">{generateWalls()}</div>\n            <GridLayout\n              cols={state.dimensions.width}\n              rowHeight={SIZE}\n              width={\n                state.dimensions.width * SIZE +\n                (state.dimensions.width + 1) * MARGIN\n              }\n              onDragStart={onDragStart}\n              onDrag={onDragEvent}\n              onDragStop={onDragStop}\n              margin={[MARGIN, MARGIN]}\n              onLayoutChange={handleLayoutChange}\n              isResizable={false}\n              maxRows={state.dimensions.height}\n              style={{\n                width:\n                  state.dimensions.width * SIZE +\n                  (state.dimensions.width + 1) * MARGIN,\n              }}\n            >\n              {generateTiles()}\n            </GridLayout>\n          </div>\n          <Button\n            className=\"bp3-button\"\n            disabled={state.dimensions.width >= MAX_WIDTH}\n            style={{\n              height:\n                state.dimensions.height * SIZE +\n                (state.dimensions.height + 1) * MARGIN -\n                20,\n              margin: \"10px 0\",\n            }}\n            onClick={state.addColEnd}\n            icon=\"add\"\n          />\n        </div>\n        <Button\n          className=\"bp3-button\"\n          disabled={state.dimensions.height >= MAX_HEIGHT}\n          style={{\n            width:\n              state.dimensions.width * SIZE +\n              (state.dimensions.width + 1) * MARGIN -\n              20,\n            margin: \"auto\",\n          }}\n          onClick={state.addRowBot}\n          icon=\"add\"\n        />\n      </div>\n      <AdvancedEditor\n        showAdvanced={showAdvanced}\n        selected={selected}\n        setSelected={setSelected}\n        resetShowAdvanced={resetShowAdvanced}\n        state={state}\n      />\n    </>\n  );\n}\n\nfunction AdvancedEditor({\n  selected,\n  setSelected,\n  resetShowAdvanced,\n  showAdvanced,\n  state,\n}) {\n  const handleSubmit = (data) => {\n    state.setTile(selected.x, selected.y, {\n      ...state.getTileAt(selected.x, selected.y),\n      ...data,\n    });\n    setSelected(null);\n    resetShowAdvanced();\n  };\n\n  const handleClear = () => {\n    state.clearTile(selected.x, selected.y);\n    setSelected(null);\n    resetShowAdvanced();\n  };\n\n  return (\n    <Drawer\n      icon=\"build\"\n      title=\"Build Tile\"\n      isOpen={showAdvanced && selected}\n      onClose={() => {\n        setSelected(null);\n        resetShowAdvanced();\n      }}\n    >\n      <div className={Classes.DRAWER_BODY}>\n        <div className={Classes.DIALOG_BODY}>\n          {selected && (\n            <AdvancedTileForm\n              x={selected.x}\n              y={selected.y}\n              currFloor={state.currFloor}\n              getTileAt={state.getTileAt}\n              initialInputs={state.getTileAt(selected.x, selected.y)}\n              inheritedInputs={selected.data}\n              handleSubmit={handleSubmit}\n              handleClear={handleClear}\n              tileStyle={{\n                width: SIZE,\n                height: SIZE,\n                maxWidth: SIZE,\n                maxHeight: SIZE,\n              }}\n              entities={state.entities}\n              findOrAddEntity={state.findOrAddEntity}\n              editEntity={state.editEntity}\n            />\n          )}\n        </div>\n      </div>\n    </Drawer>\n  );\n}\n\nexport default Grid;\n","import React from \"react\";\nimport {\n  ContextMenuTarget,\n  Menu,\n  MenuItem,\n  Button,\n  InputGroup,\n  Alert,\n  Intent,\n} from \"@blueprintjs/core\";\nimport Reorder from \"react-reorder\";\nimport createReactClass from \"create-react-class\";\nimport { isEmpty } from \"lodash\";\n\nimport { MAX_FLOORS } from \"./utils\";\n\n/**\n * Component for interacting with floors of the map.\n * Uses react-reorder for the reorderable list.\n */\nfunction FloorSelector({ manager, map, currFloor }) {\n  // Prevents switching floors on a context click (which can cause several components to remount and break links)\n  const [contextShowing, setContextShowing] = React.useState(false);\n  const [editing, setEditing] = React.useState(null);\n  // Contains all data for a confirm alert (on Delete, or Reorder actions)\n  const [confirmAlert, setConfirmAlert] = React.useState({});\n  const inputRef = React.createRef();\n\n  const floors = map.map(({ name }, index) => {\n    return { name, index };\n  });\n\n  // Template component for each Floor Button\n  const FloorButton = ContextMenuTarget(\n    createReactClass({\n      keypressHandler: function (event) {\n        if (event.key === \"Enter\") {\n          inputRef.current.blur();\n        }\n      },\n      renderContextMenu: function () {\n        setContextShowing(true);\n        return (\n          <Menu>\n            <MenuItem\n              icon=\"edit\"\n              onClick={() => setEditing(this.props.item.index)}\n              text=\"Edit Floor Name\"\n            />\n            <MenuItem\n              icon=\"delete\"\n              disabled={floors.length <= 1}\n              onClick={() => {\n                setConfirmAlert({\n                  confirmButtonText: \"Confirm Delete\",\n                  icon: \"trash\",\n                  intent: Intent.DANGER,\n                  onConfirm: () => {\n                    manager.deleteFloor(this.props.item.index);\n                    setConfirmAlert({});\n                  },\n                  content: `Are you sure you want to delete the entire ${this.props.item.name} floor? All data on this floor and connections to this floor will be reset.`,\n                });\n              }}\n              text=\"Delete Floor\"\n            />\n          </Menu>\n        );\n      },\n      onContextMenuClose: function () {\n        setContextShowing(false);\n      },\n      handleBlur: function (e) {\n        manager.editFloorName(e.target.value, this.props.item.index);\n        setEditing(null);\n      },\n      componentDidMount: function () {\n        if (editing === this.props.item.index) {\n          inputRef.current.focus();\n          inputRef.current.select();\n        }\n      },\n      render: function () {\n        return (\n          <div\n            style={{\n              textAlign: \"center\",\n              width: \"100%\",\n              height: \"100%\",\n              lineHeight: \"30px\",\n              padding: \"0px 5px\",\n            }}\n          >\n            {editing !== null && editing === this.props.item.index ? (\n              <InputGroup\n                inputRef={inputRef}\n                onBlur={this.handleBlur}\n                defaultValue={this.props.item.name}\n                onKeyPress={(event) => this.keypressHandler(event)}\n              />\n            ) : (\n              <div>{this.props.item.name}</div>\n            )}\n          </div>\n        );\n      },\n    })\n  );\n\n  // Prevent floor selection if context or editing has been triggered (prevents unintended switching)\n  const selectFloor = (_e, _floor, index) => {\n    if (!contextShowing && !editing) {\n      manager.setCurrFloor(index);\n    }\n  };\n\n  const handleReorder = (_e, _floor, initialIndex, newIndex) => {\n    if (initialIndex !== newIndex) {\n      setConfirmAlert({\n        confirmButtonText: \"Confirm Reorder\",\n        icon: \"layers\",\n        intent: Intent.WARNING,\n        onConfirm: () => {\n          manager.reorderFloors(initialIndex, newIndex);\n          setConfirmAlert({});\n        },\n        content: `Are you sure you want to reorder the entire ${floors[newIndex].name} floor? All connections to and from this floor, in both positions, will be reset.`,\n      });\n    }\n  };\n\n  return (\n    <>\n      <Alert\n        confirmButtonText={confirmAlert.confirmButtonText}\n        cancelButtonText=\"Cancel\"\n        icon={confirmAlert.icon}\n        intent={confirmAlert.intent}\n        isOpen={!isEmpty(confirmAlert)}\n        onCancel={() => {\n          if (confirmAlert.onCancel) {\n            confirmAlert.onCancel();\n          }\n          setConfirmAlert({});\n        }}\n        onConfirm={confirmAlert.onConfirm}\n      >\n        <p>{confirmAlert.content}</p>\n      </Alert>\n      <div\n        style={{\n          display: \"flex\",\n        }}\n      >\n        <Button\n          disabled={map.length >= MAX_FLOORS}\n          icon=\"add\"\n          onClick={manager.addFloor}\n          style={{\n            height: \"30px\",\n          }}\n        />\n        <Reorder\n          holdTime=\"200\"\n          callback={handleReorder}\n          template={FloorButton}\n          itemKey=\"index\"\n          list={floors}\n          selected={floors[currFloor]}\n          itemClicked={selectFloor}\n          lock=\"vertical\"\n          itemClass=\"bp3-button floor-button\"\n        />\n      </div>\n    </>\n  );\n}\n\nexport default FloorSelector;\n","import React, { useEffect } from \"react\";\nimport {\n  NumericInput,\n  InputGroup,\n  ControlGroup,\n  FormGroup,\n  Tooltip,\n  Position,\n  Icon,\n  Switch,\n  Button,\n  Intent,\n} from \"@blueprintjs/core\";\nimport {\n  useWorldBuilder,\n  MAX_HEIGHT,\n  MAX_WIDTH,\n  MAX_FLOORS,\n} from \"./worldbuilding/utils\";\nimport ListWorldsOverlay from \"./WorldManager\";\nimport { launchWorld, postAutosave, postWorld } from \"./WorldManager\";\nimport Grid from \"./worldbuilding/Grid\";\nimport FloorSelector from \"./worldbuilding/FloorSelector\";\n\nfunction WorldBuilderPage({ location }) {\n  return (\n    <div>\n      <h2 data-testid=\"header\" className=\"bp3-heading\">\n        World Builder\n      </h2>\n      <div>\n        <WorldBuilder upload={location.state} />\n      </div>\n    </div>\n  );\n}\n\nconst getManageOn = () => {\n  // Try and get if we should start with overlay or not\n  const loc = window.location.href;\n  const paramsIdx = loc.indexOf(\"?\");\n  var initOverlay = false;\n  if (paramsIdx != -1) {\n    const params = loc.substring(paramsIdx + 1);\n    var res = params.split(\"=\");\n    if (res[0] === \"manage\") {\n      initOverlay = res[1] == \"true\";\n    }\n  }\n  return initOverlay;\n};\n\nfunction WorldBuilder({ upload }) {\n  const state = useWorldBuilder(upload);\n  const [advanced, setAdvanced] = React.useState(false);\n\n  const [isOverlayOpen, setIsOverlayOpen] = React.useState(getManageOn());\n  const world_name =\n    state.dimensions.name == null ? \" \" : state.dimensions.name;\n  const stateRef = React.useRef(state);\n  stateRef.current = state;\n  const TWO_MINUTES = 120000;\n\n  useEffect(() => {\n    const timer = setTimeout(function autosave() {\n      postAutosave(stateRef.current);\n      console.log(\"Autosaved!\");\n      setTimeout(autosave, TWO_MINUTES);\n    }, TWO_MINUTES);\n    return () => clearTimeout(timer);\n  }, []);\n\n  return (\n    <>\n      <h3>World: {world_name}</h3>\n      <ListWorldsOverlay\n        isOverlayOpen={isOverlayOpen}\n        setIsOverlayOpen={setIsOverlayOpen}\n      />\n      <FormGroup\n        inline\n        label=\"World Name\"\n        labelFor=\"name-input\"\n        labelInfo={`(optional)`}\n      >\n        <ControlGroup>\n          <InputGroup\n            id=\"name-input\"\n            placeholder={\n              state.dimensions.name == null\n                ? \"Unnamed World\"\n                : state.dimensions.name\n            }\n          />\n          <Button\n            intent={Intent.PRIMARY}\n            onClick={() => {\n              state.setDimensions({\n                ...state.dimensions,\n                name: document.getElementById(\"name-input\").value.trim(),\n              });\n            }}\n          >\n            Update\n          </Button>\n        </ControlGroup>\n      </FormGroup>\n      <FormGroup\n        inline\n        label=\"World Dimensions\"\n        labelInfo={`WxH (Max ${MAX_WIDTH}x${MAX_HEIGHT})`}\n      >\n        <ControlGroup>\n          <NumericInput\n            value={state.dimensions.width}\n            style={{ width: \"3rem\" }}\n            max={MAX_WIDTH}\n            min={1}\n            onValueChange={(value) => {\n              state.setDimensions({ ...state.dimensions, width: value });\n            }}\n          />\n\n          <NumericInput\n            value={state.dimensions.height}\n            style={{ width: \"3rem\" }}\n            max={MAX_HEIGHT}\n            min={1}\n            onValueChange={(value) => {\n              state.setDimensions({ ...state.dimensions, height: value });\n            }}\n          />\n        </ControlGroup>\n      </FormGroup>\n      <FormGroup\n        inline\n        label={\n          <>\n            Floor{\" \"}\n            <Tooltip\n              content={\n                \"Right click floor for more options. Click and hold floor to reorder.\"\n              }\n              position={Position.BOTTOM}\n              className=\"inline\"\n            >\n              <Icon icon=\"help\" />\n            </Tooltip>\n          </>\n        }\n        labelInfo={`Max ${MAX_FLOORS}`}\n        style={{ marginBottom: \"0px\" }}\n      >\n        <FloorSelector\n          max={MAX_FLOORS}\n          manager={state.floorManager}\n          map={state.map}\n          currFloor={state.currFloor}\n        />\n      </FormGroup>\n      <FormGroup inline label=\"Advanced\">\n        <Switch onChange={() => setAdvanced(!advanced)} checked={!!advanced} />\n      </FormGroup>\n      <Grid state={state} initialShowAdvanced={advanced} />\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"flex-end\",\n          position: \"fixed\",\n          bottom: 0,\n          left: 0,\n          right: 0,\n          height: \"50px\",\n        }}\n        className=\"bp3-navbar\"\n      >\n        <Button\n          onClick={() => launchWorld(state)}\n          intent=\"primary\"\n          style={{ margin: \"10px\" }}\n        >\n          Launch Game\n        </Button>\n        <Button\n          onClick={() => setIsOverlayOpen(!isOverlayOpen)}\n          intent=\"primary\"\n          style={{ margin: \"10px\" }}\n        >\n          Manage Worlds\n        </Button>\n        <Button\n          onClick={() => postWorld(state)}\n          intent=\"primary\"\n          style={{ margin: \"10px\" }}\n        >\n          Save\n        </Button>\n        <Button\n          onClick={state.exportWorld}\n          intent=\"primary\"\n          style={{ margin: \"10px\" }}\n        >\n          Export\n        </Button>\n      </div>\n    </>\n  );\n}\n\nexport default WorldBuilderPage;\n","import React from \"react\";\nimport { isEmpty } from \"lodash\";\nimport { Button, Classes, Dialog, Intent, Spinner } from \"@blueprintjs/core\";\nimport { useHistory } from \"react-router-dom\";\n\nimport CONFIG from \"../config\";\nimport { useAPI, post } from \"../utils\";\nimport ObjectForm from \"./forms/ObjectForm\";\nimport CharacterForm from \"./forms/CharacterForm\";\nimport RoomForm from \"./forms/RoomForm\";\nimport AppToaster from \"./AppToaster\";\n\nfunction EditPage({ match, location }) {\n  const [formType, setFormType] = React.useState(undefined);\n  const { loading, result } = useAPI(\n    CONFIG,\n    `/entities/${match.params.id}`,\n    {},\n    location.state\n  );\n  const [initialInputs, setInitialInputs] = React.useState({});\n  const [showDialog, setShowDialog] = React.useState(false);\n  const [pendingEdits, setPendingEdits] = React.useState([]);\n  const history = useHistory();\n\n  if (!loading && isEmpty(initialInputs)) {\n    if (isEmpty(result) || isEmpty(result.entity)) {\n      setInitialInputs({ id: match.params.id });\n      setFormType(\"invalid\");\n    } else {\n      setInitialInputs(result.entity);\n      setFormType(result.type);\n    }\n  }\n\n  const showEdits = (values) => {\n    const edits = [];\n    for (let property in values) {\n      if (values[property] !== initialInputs[property]) {\n        edits.push({ property: property, editedValue: values[property] });\n      }\n    }\n    setPendingEdits(edits);\n    setShowDialog(true);\n  };\n\n  return (\n    <div>\n      <Dialog\n        icon=\"info-sign\"\n        onClose={() => setShowDialog(false)}\n        title={`Confirm edits for Entity ${match.params.id}`}\n        isOpen={showDialog}\n        usePortal={false}\n      >\n        <div className={Classes.DIALOG_BODY}>\n          {pendingEdits.map((edit, index) => {\n            return (\n              <p key={index}>\n                <strong>{edit.property}</strong>: {edit.editedValue.toString()}\n              </p>\n            );\n          })}\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <Button onClick={() => setShowDialog(false)}>Close</Button>\n            <Button\n              intent={Intent.PRIMARY}\n              onClick={() =>\n                submitEdits(match.params.id, pendingEdits, history)\n              }\n            >\n              Confirm Edits\n            </Button>\n          </div>\n        </div>\n      </Dialog>\n      <h2 data-testid=\"header\" className=\"bp3-heading\">\n        Editing Entity {match.params.id}\n      </h2>\n      <div className=\"bp3-text-large\">\n        {loading ? (\n          <Spinner intent={Intent.PRIMARY} />\n        ) : (\n          <EditForm\n            type={formType}\n            initialInputs={initialInputs}\n            handleSubmit={showEdits}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction EditForm({ type, initialInputs, handleSubmit }) {\n  switch (type) {\n    case \"object\":\n      return (\n        <ObjectForm\n          type={type}\n          initialInputs={initialInputs}\n          handleSubmit={handleSubmit}\n        />\n      );\n    case \"character\":\n      return (\n        <CharacterForm\n          type={type}\n          initialInputs={initialInputs}\n          handleSubmit={handleSubmit}\n        />\n      );\n    case \"room\":\n      return (\n        <RoomForm\n          type={type}\n          initialInputs={initialInputs}\n          handleSubmit={handleSubmit}\n        />\n      );\n    default:\n      return \"This entity cannot be edited at the moment\";\n  }\n}\n\nasync function submitEdits(id, edits, history) {\n  const reqs = edits.map((edit) =>\n    submitEdit(id, edit.property, edit.editedValue)\n  );\n  await Promise.all(reqs).then(() => {\n    history.push(\"/\");\n  });\n  AppToaster.show({\n    intent: Intent.SUCCESS,\n    message: \"Successfully created edits\",\n  });\n}\n\nfunction submitEdit(id, field, edited_value) {\n  const payload = {\n    id,\n    field,\n    edited_value,\n    player: 1,\n  };\n\n  return post(\"builder/edits\", payload);\n}\n\nexport default EditPage;\n","import React from \"react\";\nimport { HashRouter, Route, Redirect } from \"react-router-dom\";\n\nimport NavBar from \"./components/NavBar\";\nimport ExplorePage from \"./components/ExplorePage\";\nimport CreatePage from \"./components/CreatePage\";\nimport ReviewPage from \"./components/ReviewPage\";\nimport WorldBuilderPage from \"./components/WorldBuilderPage\";\nimport EditPage from \"./components/EditPage\";\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <HashRouter>\n        <Routes />\n      </HashRouter>\n    </div>\n  );\n}\n\nexport function Routes() {\n  return (\n    <>\n      <NavBar />\n      <div style={{ margin: \"40px 30px\" }}>\n        <Route path=\"/explore\" component={ExplorePage} exact />\n        <Route path=\"/create\" component={CreatePage} exact />\n        <Route path=\"/review\" component={ReviewPage} exact />\n        <Route\n          path=\"/world_builder\"\n          render={(props) => (\n            <WorldBuilderPage {...props} key={Math.random()} exact />\n          )}\n        />\n        <Route path=\"/edit/:id\" component={EditPage} exact />\n        <Route exact path=\"/\" render={() => <Redirect to=\"/explore\" />} exact />\n      </div>\n    </>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nimport \"normalize.css\";\nimport \"@blueprintjs/core/lib/css/blueprint.css\";\nimport \"@blueprintjs/icons/lib/css/blueprint-icons.css\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}