(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{46:function(e,t,a){e.exports=a(88)},51:function(e,t,a){},88:function(e,t,a){"use strict";a.r(t);var n=a(45),r=a(2),o=a(0),l=a.n(o),c=a(9),i=a.n(c),s=(a(51),a(52),a(53),a(4)),u=a(26),m=a(25),f=a.n(m),d=a(43),p=a(15),g=a(44),E=function(e,t){var a=[].concat(Object(g.a)(e),[t]);return console.groupCollapsed("New message. Total: "+a.length),console.table(a),console.groupEnd(),a},h=function(e){var t=[];Object.keys(e.room.neighbors).forEach(function(a){var n=e.room.neighbors[a];t.push(n.label)});for(var a="",n=0;n<t.length;n++)0===n?a+=t[n]:n===t.length-1?a+=", and "+t[n]:a+=", "+t[n];return""===a&&(a="there are no exits"),a},v=function(e){var t=[];Object.keys(e.objects).forEach(function(a){var n=e.objects[a];t.push(n)});for(var a="",n=0;n<t.length;n++)0===n?a+=t[n]:n===t.length-1?a+=", and "+t[n]:a+=", "+t[n];return""===a&&(a="nothing of interest."),a};function b(){var e=window.location.protocol+"//"+window.location.host+"/builder";return l.a.createElement("div",{className:"header"},l.a.createElement("img",{alt:"logo",src:"/scribe.png"}),l.a.createElement("div",null,l.a.createElement("h1",null,"LIGHT"),l.a.createElement("span",null,"Learning in Interactive Games with Humans and Text"),l.a.createElement("p",null,l.a.createElement("a",{href:e,rel:"noopener noreferrer",target:"_blank"},"Go To World Builder"))))}var y=function(){var e=l.a.useState(!1),t=Object(r.a)(e,2),a=t[0],n=t[1];return l.a.useEffect(function(){if(!a){var e=setTimeout(function(){n(!0)},1e4);return function(){return clearTimeout(e)}}},[a,n]),l.a.createElement("div",{style:{height:"100vh",width:"100vw",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"}},l.a.createElement("div",{style:{width:500}},l.a.createElement("div",{style:{width:300}},l.a.createElement(b,null)),l.a.createElement("div",{style:{fontSize:20,marginTop:50,fontStyle:"italic"}},a?l.a.createElement("span",null,"It's been ",10," seconds, there's likely a server issue."):l.a.createElement("span",null,"Hang tight. You are entering a new world..."))))};a(16);var k={host:"http://localhost",hostname:"localhost",port:"35494"},w=function(e){var t="https:"===e.protocol?"wss":"ws",a=new URL(e).searchParams.get("server"),n=new URL(e).searchParams.get("id");return n||(n=""),a&&console.log("Using user-provided server hostname:",a),t+"://"+(a||k.hostname)+":"+k.port+"/game".concat(n,"/socket")},N=function(){return new URL(window.location).searchParams.get("builder")};function S(e){return l.a.createElement("div",{style:{clear:"both",overflow:"auto"}},l.a.createElement("div",{className:"message type-setting"},e.text.split("\n").map(function(e,t){return l.a.createElement("p",{key:t},e)})))}function x(e){var t=e.text,a=e.caller,n=e.actor,o=e.isSelf,c=e.onReply,i=l.a.useState(!1),u=Object(r.a)(i,2),m=u[0],f=u[1],d="message type-dialogue ";return["tell","say","whisper"].includes(a)&&(t="&ldquo;"+t+"&rdquo;",d="message type-dialogue "),d+=o?"me":"other",m?l.a.createElement("div",{className:d},l.a.createElement("div",{className:"agent"},l.a.createElement("span",null,n),o?null:l.a.createElement(l.a.Fragment,null,l.a.createElement("i",{className:"fa fa-reply",onClick:function(){return c(n)}})," ",l.a.createElement("i",{className:"fa fa-commenting-o ",onClick:function(){return f(!0)}}))),l.a.createElement("div",{style:{opacity:0,height:1,pointerEvents:"none"}},t),l.a.createElement("input",{className:"edit-message",defaultValue:t}),l.a.createElement("button",{type:"submit",onClick:function(){return f(!1)}},"Suggest edit")):l.a.createElement("div",{className:d},l.a.createElement("div",{className:"agent"},l.a.createElement("span",null,n),o?null:l.a.createElement(l.a.Fragment,null,l.a.createElement(s.Tooltip,{title:"tell ".concat(n,"..."),position:"top"},l.a.createElement("i",{className:"fa fa-reply",onClick:function(){return c(n)}}))," ",l.a.createElement(s.Tooltip,{title:"Do you think something else should have been said instead? Provide feedback via an edit...",position:"top"},l.a.createElement("i",{className:"fa fa-commenting-o ",onClick:function(){return f(!0)}})))),t)}function O(e){var t=e.msg,a=e.onReply,n=e.agents,r=e.selfId;if(["LookEvent","GoEvent","ExamineEvent","ErrorEvent","HelpEvent","text"].includes(t.caller)||null===t.caller)return l.a.createElement(S,{text:t.text});var o="";return o=void 0===t.actors?t.actor.node_id:t.actors[0],l.a.createElement(x,{text:t.text,isSelf:t.is_self||o===r,actor:n[o],onReply:a})}function j(){var e=function(e){var t=l.a.useRef(),a=l.a.useState(!1),n=Object(r.a)(a,2),o=n[0],c=n[1],i=l.a.useState(!1),s=Object(r.a)(i,2),u=s[0],m=s[1],f=l.a.useReducer(E,[]),d=Object(r.a)(f,2),g=d[0],b=d[1],y=l.a.useState(null),k=Object(r.a)(y,2),w=k[0],N=k[1],S=l.a.useState(null),x=Object(r.a)(S,2),O=x[0],j=x[1],C=l.a.useState({}),T=Object(r.a)(C,2),R=T[0],_=T[1],I=l.a.useRef(R);I.current=R;var L=l.a.useCallback(function(e){var t=JSON.parse(e.data);if("actions"===t.command){var a=[];t.data.forEach(function(e){var t="SoulSpawnEvent"===e.caller;e.caller,e.room=JSON.parse(e.room),e.actor=JSON.parse(e.actor);var n=Object(p.a)({},I.current,e.present_agent_ids);_(n),t&&N({name:e.actor.name,description:e.actor.persona,id:e.actor.node_id});var r=h(e),o=v(e);j({name:e.room.name,description:e.room.desc+"\nThere is "+o+"\nYou notice "+r,id:e.room.node_id}),a.push(e),a.forEach(function(e){return b(e)})})}},[b,N,_,j]);l.a.useEffect(function(){t.current.onmessage=L},[L]);var H=l.a.useCallback(function(e){b({caller:"say",text:e,is_self:!0,actors:[w.id]});var a=JSON.stringify({command:"act",data:e});return t.current.send(a)},[t,b,w]);return t.current||(t.current=new WebSocket(e),t.current.onopen=function(){console.log("opened"),c(!0)},t.current.onerror=t.current.onclose=function(){console.log("errored"),c(!1),m(!0),t.current=null}),{isConnected:o,messages:g,submitMessage:H,persona:w,location:O,isErrored:u,agents:R}}(l.a.useMemo(function(){return w(window.location)},[])),t=e.isErrored,a=e.messages,n=e.submitMessage,o=e.persona,c=e.location,i=e.agents;return t?l.a.createElement("div",{style:{textAlign:"center",marginTop:30,fontSize:30}},"Could not connect to the server."):0===a.length?l.a.createElement(y,null):l.a.createElement(C,{messages:a,onSubmit:n,persona:o,location:c,agents:i})}function C(e){var t=e.messages,a=e.onSubmit,n=e.persona,o=e.location,c=e.agents,i=l.a.useState(""),m=Object(r.a)(i,2),d=m[0],p=m[1],g=l.a.useRef(null),E=function(e){return e.match(/\d+$/)[0]},h=N(),v=l.a.useCallback(function(){return setTimeout(function(){g.current&&(g.current.scrollTop=g.current.scrollHeight)},0)},[g]);l.a.useEffect(function(){v()},[v,t]);var y=function(e){var t=e.filter(function(e){return!0!==e.is_self&&null!==e.caller});if(0===t.length)return[null,[]];var a=t[t.length-1];return{currentRoom:a.room_id,presentAgents:Object.keys(a.present_agent_ids)}}(t).presentAgents,k=l.a.useState(!1),w=Object(r.a)(k,2),S=w[0],x=w[1],j=l.a.useState("\u2753"),C=Object(r.a)(j,2),T=C[0],_=C[1],I=l.a.useRef();l.a.useLayoutEffect(function(){I.current.focus()},[]),l.a.useEffect(function(){if(null!==n&&null!==n.name){var e=["a","the","an","of","with","holding"],t=n?n.name.split(" ").filter(function(e){return!!e}).map(function(e){return e.replace(/\.$/,"")}).filter(function(t){return-1===e.indexOf(t.toLowerCase())}).flatMap(function(e){return u.b.search(e).map(function(e){return e.native})}):[],a=t.length>0?t[0]:"\u2753";_(a)}},[n,_]);var L=l.a.useCallback(function(e){var t="tell ".concat(e,' ""');p(t),setTimeout(function(){return function(e,t){if(null!=e)if(e.createTextRange){var a=e.createTextRange();a.move("character",t),a.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}(I.current,t.length-1)},0)},[p,I]);return l.a.createElement("div",{className:"App"},l.a.createElement("div",{className:"sidebar"},l.a.createElement(b,null),l.a.createElement("div",{className:"game-state"},n?l.a.createElement("div",{className:"persona"},l.a.createElement("div",{className:f()("icon",{editing:S}),style:{cursor:"pointer"}},l.a.createElement("div",{className:"overlay"},"edit"),l.a.createElement("span",{role:"img","aria-label":"avatar",onClick:function(){return x(!0)}},T),S?l.a.createElement("div",{style:{position:"absolute",top:"80px",left:"50%",transform:"translateX(-50%)",zIndex:999}},l.a.createElement(R,{autoFocus:!0,onBlur:function(){return x(!1)},onSelect:function(e){_(e.native),x(!1)}})):null),l.a.createElement("h3",null,"You are ",n.name),n.description,h&&l.a.createElement(s.Tooltip,{style:{position:"absolute",bottom:0,right:5},title:"suggest changes for ".concat(n.name),position:"bottom"},l.a.createElement("a",{className:"data-model-deep-link",href:"".concat(h,"/edit/").concat(E(n.id)),rel:"noopener noreferrer",target:"_blank"},l.a.createElement("i",{className:"fa fa-edit","aria-hidden":"true"})))):null,o?l.a.createElement("div",{className:"location"},l.a.createElement("h3",null,o.name),o.description.split("\n").map(function(e,t){return l.a.createElement("p",{key:t},e)}),h&&l.a.createElement(s.Tooltip,{style:{position:"absolute",bottom:0,right:5},title:"suggest changes for ".concat(o.name.split(" the ")[1]),position:"bottom"},l.a.createElement("a",{className:"data-model-deep-link",href:"".concat(h,"/edit/").concat(E(o.id)),rel:"noopener noreferrer",target:"_blank"},l.a.createElement("i",{className:"fa fa-edit","aria-hidden":"true"})))):null)),l.a.createElement("div",{className:"chat-wrapper"},l.a.createElement("div",{className:"chat",ref:g},l.a.createElement("div",{className:"chatlog"},t.map(function(e,t){return l.a.createElement(O,{key:t,msg:e,agents:c,onReply:function(e){return L(e)},selfId:n.id})}))),l.a.createElement("div",{className:"controls"},l.a.createElement("form",{style:{display:"flex"},onSubmit:function(e){e.preventDefault(),d&&(a(d),p(""),v())}},l.a.createElement("input",{ref:I,value:d,onChange:function(e){return p(e.target.value)},onKeyPress:function(e){if("Enter"===e.key&&e.shiftKey){var t=e.target.value.startsWith('"')?"":'"',a=e.target.value.endsWith('"')?"":'"';p(t+e.target.value+a)}},className:"chatbox",placeholder:"Enter text to interact with the world here..."})),l.a.createElement("div",{className:"actions"},l.a.createElement("div",{style:{float:"left"}},y.filter(function(e){return e!==n.id}).map(function(e){var t=function(e){return c?c[e]:e}(e),a=E(e);return l.a.createElement("span",{key:t,style:{backgroundColor:"#eee",borderRadius:3,padding:"1px 3px",marginRight:5}},l.a.createElement("span",{onClick:function(){L(t)}},t," ",l.a.createElement(s.Tooltip,{title:"tell ".concat(t,"..."),position:"bottom"},l.a.createElement("i",{className:"fa fa-comment-o","aria-hidden":"true"}))),h&&l.a.createElement(l.a.Fragment,null," ",l.a.createElement(s.Tooltip,{title:"suggest changes for ".concat(t),position:"bottom"},l.a.createElement("a",{className:"data-model-deep-link",href:"".concat(h,"/edit/").concat(a),rel:"noopener noreferrer",target:"_blank"},l.a.createElement("i",{className:"fa fa-edit","aria-hidden":"true"})))))})),l.a.createElement("div",{style:{display:"flex",alignItems:"center",float:"right"}},l.a.createElement("span",{className:f()("hint-message","fadeHidden",{fadeShow:d.length>0&&'"'===d[0]})},"Tip: Hit Shift+Enter to auto-wrap your entry in quotes")),[].map(function(e){return l.a.createElement("span",{className:"action",key:e},e)})))))}var T=function e(t){var a=t.onBlur,r=Object(n.a)(t,["onBlur"]);return e.handleClickOutside=function(){return a()},l.a.createElement(u.a,r)},R=Object(d.a)(T,{handleClickOutside:function(){return T.handleClickOutside}}),_=document.getElementById("root");i.a.render(l.a.createElement(j,null),_)}},[[46,1,2]]]);
//# sourceMappingURL=main.0dbc3d91.chunk.js.map